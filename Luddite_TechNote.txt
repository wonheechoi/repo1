git 1

##################### My forum posts

https://community.hortonworks.com/questions/33140/hbase-master-fails-to-start.html
https://community.hortonworks.com/questions/39820/hbase-server-fails-to-start-file-does-not-exist-ma.html

############ SQOOP
sqoop export --connect jdbc:mysql://namenode:3306/flightinfo --username root --password hadoop --table weather --export-dir /user/horton/weather
sqoop import --connect jdbc:mysql://namenode:3306/flightinfo -m1 --table weather --target-dir '/user/hdfs' -username root --password hadoop
sqoop import --connect jdbc:mysql://namenode:3306/flightinfo -username root -m 1 --password hadoop --table weather --hive-import --target-dir '/user/horton/' --create-hive-table --hive-table weather_wony 

############ FLUME
# RUN AGENT
bin/flume-ng agent -n $agent_name -c conf -f conf/flume-conf.properties
./flume-ng agent -n TwitterAgent -c /etc/flume/conf -f /etc/flume/conf/flumetwitter.conf

# Name the components on this agent
# Note the name of the agent, a1, should be specified as $agent_name in the above command
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = netcat
a1.sources.r1.bind = localhost
a1.sources.r1.port = 44444
 
# Describe the sink
a1.sinks.k1.type = logger
 
# Use a channel which buffers events in memory
# Memory channel
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1

############ PIG 
pig -useHCatalog -x tez

a = load 'flightdelays' using org.apache.hive.hcatalog.pig.HCatLoader();
b = filter a by (arrdelay > 0);
c = order b by arrdelay desc;
dump c;
store c into '/user/horton/flightdelays_nonzero/' using PigStorage(',');

a = load 'flightdelays' USING org.apache.hive.hcatalog.pig.HCatLoader();
b = filter a by $6 > 0;
c = order b by $6 desc;

a = load '/user/horton/wony/sfo_weather_wony.csv' using PigStorage(',') as (station_name:chararray, year:int, month:int, dayofmonth:int, precipitation: int, temperature_max: int,temperature_min: int);
b = foreach a generate $0 as station_name, $1 as year, $2 as month, $3 as dayofmonth, $4 as precipitation, $5 as temperature_max, $6 as temperature_min;
describe b;
store b into 'sfo_weather_wony_txt2' using org.apache.hive.hcatalog.pig.HCatStorer();

-- pig distinct
a = load '/user/horton/wony/sfo_weather_wony.csv' using PigStorage(',');
b = foreach a generate $0 as station_name, $1 as year, $2 as month;
c = group b all;
d = foreach c generate COUNT(b);
e = DISTINCT b;
f = group e all;
g = foreach f generate COUNT(e);

-- pig JOIN
a = load '/user/horton/wony/sfo_weather_wony.csv' using PigStorage(',') as (station_name:chararray, year:int, month:int, dayofmonth:int, precipitation: int, temperature_max: int,temperature_min: int);
b = load '/user/horton/flightdelays/flight_delays1.csv' using PigStorage(',') as (f1:int, f2:int, f3:int, f4:int, f5: int, f6: int,f7: int,f8: int,f9: chararray, f10: int, f11: chararray, f12: int, f13: int, f14: int, f15: int, f16: int,f17: chararray,f18: chararray, f19: int, f20: int, f21: int, f22: int, f23: int, f24: int, f25: int, f26: int, f27: int, f28: int, f29: int);
b2 = filter b by ($16 == 'SFO' OR $17 == 'SFO');
dump b2;
join_data = join a by ($1, $2, $3), b2 by ($0, $1, $2);

-- explain plan
explain [extended|dependency|authorization] select * from sfo_weather;

-- Register UDF JAR
register ./myjar.jar;
define toUpper `myjar.UPPER`;
A = LOAD 'student_data' AS (name: chararray, age: int, gpa: float);
B = FOREACH A GENERATE toUpper(name);

############ HIVE 
set hive.execution.engine=tez;

CREATE EXTERNAL TABLE IF NOT EXISTS flightdelays (
Year int, 
UniqueCarrier string
...
)
row format delimited
fields terminated by ','
stored as textfile
location '/user/horton/flightdelays_clean'
;

CREATE TABLE flight_weather as
SELECT a.*, b.temperature_max, b.temperature_min
from flightdelays a
JOIN
sfo_weather b ON (a.year=b.year AND a.month=b.month AND a.dayofmonth=b.dayofmonth)
WHERE a.dest='SFO' OR a.origin='SFO'
;

CREATE TABLE IF NOT EXISTS weather_partitioned (
station_name string,
yearnoquery int,
monthnoquery int
...
)
PARTITIONED BY (year int, month int)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS ORC
;
  
INSERT INTO TABLE weather_partitioned PARTITION (YEAR=2008, month=1)
SELECT * FROM sfo_weather WHERE YEAR=2008 and month=1;

create table if not exists sfo_weather_wony(
station_name string, 
Year int
...
)
CLUSTERED BY(station_name) INTO 2 BUCKETS
row format delimited
fields terminated by ','
stored as orc
TBLPROPERTIES ("transactional"="true");

load data local inpath '/home/horton/datasets/flightdelays/sfo_weather_wony.csv.gz' into table sfo_weather_wony_txt;


##################### postgresql

pg_ctl stop
pg_ctl stop -m immediate

# See table list
SELECT * FROM pg_catalog.pg_tables;

# list and choose database
postgres=# \l

postgres=# \c dmtest
psql (8.4.20)
You are now connected to database "dmtest".

OR psql dmtest

OR psql -d mydb -U myuser


##################### scp commands
scp root@172.31.25.3:/root/guardium_work/guard_diag_out/diag.ip-172-31-25-3.ap-southeast-2.compute.internal.16-05-29_232028.tar.gz ./

scp -i /Users/wonheechoi/Documents/Software/AWS_KEYPAIR/HadoopSandbox.pem ec2-user@ambari.datamigrators.com:/home/ec2-user/diag.ip-172-31-25-3.ap-southeast-2.compute.internal.16-06-10_161626.tar.gz ./


##################### pig
pig hdfs://ip-172-31-25-3.ap-southeast-2.compute.internal:8020/user/admin/pig/scripts/tutorial1-2016-09-12_03-22.pig

pig -useHCatalog -x tez -f /abcd.pig


##################### HBASE

Service log in the file system

/var/log/hbase/hbase-hbase-master-serverhost.log



##################### hdfs commands
hadoop fs -mkdir /apps/falcon/backupCluster
[falcon@ip-172-31-25-3 bin]$ hadoop fs -mkdir /apps/falcon/primaryCluster
[falcon@ip-172-31-25-3 bin]$ hadoop fs -chmod -R 777 /apps/falcon/*
[falcon@ip-172-31-25-3 bin]$ hadoop fs -chown -R falcon /apps/falcon/*
[falcon@ip-172-31-25-3 bin]$ hadoop fs -chmod -R 755 /apps/falcon/primaryCluster/working /apps/falcon/backupCluster/working

hadoop fs -chmod -R 755 /user/hadoop/dir1/pupularNames.txt

hadoop fs -copyFromLocal demo /user/ambari-qa/falcon/

hadoop fs -put ./mirror_test.txt /user/ambari-qa/falcon/mirrorSrc/
hadoop fs -put ./creditcard_nohead.csv /user/hadoop/dir1/

hdfs file url
hdfs://ip-172-31-25-3.ap-southeast-2.compute.internal:8020/apps/hbase/data/MasterProcWALs/state-############00000001.log

hdfs://ip-172-31-25-3.ap-southeast-2.compute.internal:8020/ranger/audit

# Read HDFS file
hdfs dfs -cat /apps/hive/warehouse/optim_sales_hive/part-m-00000


###################### HIVE commands HIVEQL
https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-WhatIsHive

LOAD DATA INPATH '/user/hdfs/Tutorial/Batting.csv' OVERWRITE INTO TABLE temp_batting;
SELECT * FROM temp_batting LIMIT 100;
create table temp_batting (col_value STRING);
SELECT year, max(runs) FROM batting GROUP BY year;


-- JOIN
SELECT a.year, a.player_id, a.runs from batting a  
JOIN (SELECT year, max(runs) runs FROM batting GROUP BY year ) b  
ON (a.year = b.year AND a.runs = b.runs);

-- moving data from csv

https://docs.hortonworks.com/HDPDocuments/HDP2/HDP-2.3.0/bk_dataintegration/content/moving_data_from_hdfs_to_hive_external_table_method.html

-- external table

--CARDID,FIRSTNAME,LASTNAME,CARDNUMBER,PIN,TXN_ID,TXN_DATE_TIME,SECURITYCODE,NAME_ON_CARD,EXP
0,Joe,Anthony,1234567890123450,*****,,,1230,Joe Anthony,14-MAY-08
drop table creditcard;
CREATE EXTERNAL TABLE IF NOT EXISTS creditcard_external(
        CARDID STRING, 
        FIRSTNAME STRING,
        LASTNAME STRING,
        CARDNUMBER STRING,
        PIN STRING,
        TXN_ID STRING, 
        TXN_DATE_TIME STRING,
        SECURITYCODE STRING,
        NAME_ON_CARD STRING,
        EXP STRING)
    COMMENT 'Data credit card'
    ROW FORMAT DELIMITED
    FIELDS TERMINATED BY ','
    STORED AS TEXTFILE
    location '/user/hadoop/dir1';
    
-- orc table
CREATE EXTERNAL TABLE IF NOT EXISTS creditcard_orc(
        CARDID STRING, 
        FIRSTNAME STRING,
        LASTNAME STRING,
        CARDNUMBER STRING,
        PIN STRING,
        TXN_ID STRING, 
        TXN_DATE_TIME STRING,
        SECURITYCODE STRING,
        NAME_ON_CARD STRING,
        EXP STRING)    
    COMMENT 'Data credit card orc'
    ROW FORMAT DELIMITED
    FIELDS TERMINATED BY ','
    STORED AS ORC;
    
    
-- move data

INSERT OVERWRITE TABLE creditcard_orc SELECT * FROM creditcard_external;


####################### HIVE BEELINE
https://cwiki.apache.org/confluence/display/Hive/HiveServer2+Clients#HiveServer2Clients-Beeline%E2%80%93CommandLineShell
!quit
!connect jdbc:hive2://localhost:10000 scott tiger

% bin/beeline
beeline> !connect jdbc:hive2://<host>:<port>/<db>;auth=noSasl hiveuser pass 


!connect jdbc:hive2://localhost:10000/default;auth=noSasl hive hive 

!connect jdbc:hive2://localhost:10000/default

[root@ip-172-31-25-3 ~]# beeline
WARNING: Use "yarn jar" to launch YARN applications.
Beeline version 1.2.1000.2.4.2.0-258 by Apache Hive
beeline> !connect jdbc:hive2://localhost:10000/default
Connecting to jdbc:hive2://localhost:10000/default
Enter username for jdbc:hive2://localhost:10000/default: hive
Enter password for jdbc:hive2://localhost:10000/default: ****
Connected to: Apache Hive (version 1.2.1000.2.4.2.0-258)
Driver: Hive JDBC (version 1.2.1000.2.4.2.0-258)
Transaction isolation: TRANSACTION_REPEATABLE_READ
0: jdbc:hive2://localhost:10000/default> 

0: jdbc:hive2://localhost:10000/default> show tables;
+--------------------+--+
|      tab_name      |
+--------------------+--+
| avg_mileage        |
| batting            |
| geolocation        |
| geolocation_stage  |
| temp_batting       |
| truck_mileage      |
| trucks             |
| trucks_stage       |
+--------------------+--+


##################### yum commands
$ yum install perl.x86_64
# Install gcc and relevant dev tools for possible K-TAP compilation
$ yum groupinstall 'Development Tools'
yum search
rpm -qa : check installed package

yum repolist

###################### commands nec
perl -v : perl verion check
free -m : check free memory

useradd -g 504 -d /home/testuser testuser
useradd -g 504 -d /home/admin admin

usermod -a -G 504,502 admin
usermod -a -G 500,0 ec2-user
usermod -a -G 504,502 hbase
hadoop:x:502
hdfs:x:504
hbase:x:492
[ec2-user@ip-172-31-6-69 ~]$ sudo -l

    
####################### HDP Hortonworks hadoop curl commands to stop, delete, check services

curl -s -u admin:admin -H “X-Requested-By: Ambari” -X GET http://localhost:8080/api/v1/clusters/dm_hdp/services/HBASE

curl -s -u admin:admin -H “X-Requested-By: Ambari” -X GET http://localhost:8080/api/v1/clusters/dm_hdp/services/HBASE/components/HBASE_MASTER

curl -s -u admin:admin -H “X-Requested-By: Ambari” -X PUT -d ‘{“RequestInfo”:{“context”:”Stop HBASE”},”Body”:{“ServiceInfo”:{“state”:”INSTALLED”}}}’ http://localhost:8080/api/v1/clusters/dm_hdp/services/HBASE

curl -s -u admin:admin -H “X-Requested-By: Ambari” -X DELETE http://localhost:8080/api/v1/clusters/dm_hdp/services/HBASE

curl -u admin:admin -X DELETE -H "X-Requested-By: ambari" http://localhost:8080/api/v1/clusters/dm_hdp/services/HBASE

############################# Adding disk and mount disk

[root@ip-172-31-25-148 ~]# df -k
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/xvda2      10473452 7347532   3125920  71% /
devtmpfs         1922324       0   1922324   0% /dev
tmpfs            1809504       8   1809496   1% /dev/shm
tmpfs            1809504   16900   1792604   1% /run
tmpfs            1809504       0   1809504   0% /sys/fs/cgroup
tmpfs             361904       0    361904   0% /run/user/1002
tmpfs             361904       0    361904   0% /run/user/1013
tmpfs             361904       0    361904   0% /run/user/1006
tmpfs             361904       0    361904   0% /run/user/1015
tmpfs             361904       0    361904   0% /run/user/1017
tmpfs             361904       0    361904   0% /run/user/1009
tmpfs             361904       0    361904   0% /run/user/0
[root@ip-172-31-25-148 ~]# lsblk
NAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
xvda    202:0    0  10G  0 disk
├─xvda1 202:1    0   1M  0 part
└─xvda2 202:2    0  10G  0 part /
xvdf    202:80   0  30G  0 disk
[root@ip-172-31-25-148 ~]# sudo mkfs -t ext4 /dev/xvdf
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
1966080 inodes, 7864320 blocks
393216 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2155872256
240 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
    4096000
 
Allocating group tables: done                           
Writing inode tables: done                           
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done  
 
[root@ip-172-31-25-148 ~]# mount /dev/xvdf /hadoop/hdfs/data -t ext4
[root@ip-172-31-25-148 ~]# df -k
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/xvda2      10473452 7339664   3133788  71% /
devtmpfs         1922324       0   1922324   0% /dev
tmpfs            1809504       8   1809496   1% /dev/shm
tmpfs            1809504   16900   1792604   1% /run
tmpfs            1809504       0   1809504   0% /sys/fs/cgroup
tmpfs             361904       0    361904   0% /run/user/1002
tmpfs             361904       0    361904   0% /run/user/1013
tmpfs             361904       0    361904   0% /run/user/1006
tmpfs             361904       0    361904   0% /run/user/1015
tmpfs             361904       0    361904   0% /run/user/1017
tmpfs             361904       0    361904   0% /run/user/1009
tmpfs             361904       0    361904   0% /run/user/0
/dev/xvdf       30832548   45080  29198220   1% /hadoop/data


#### Edit fstab to make the disk mounted on startup

[root@ip-172-31-21-148 /]# vi /etc/fstab
 
# /etc/fstab
# Created by anaconda on Mon Nov  9 20:20:10 2015
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=379de64d-ea11-4f5b-ae6a-0aa50ff7b24d /                       xfs     defaults        0 0
#/dev/xvdf       /hadoop/hdfs/data1   ext4    defaults,nofail        0       2
/dev/xvdf       /hdfs_data1   ext4    defaults,nofail        0       2



################################################## IT General



# service iptables status
Run the following commands to stop the iptables firewall for IPv4 :
# service iptables save
# service iptables stop (stop iptables for this session)
# chkconfig iptables off (permanently stop iptables, will not load at boot)




Subnet mask
https://www.iplocation.net/subnet-mask

Class   Address   # of Hosts  Netmask (Binary)  Netmask (Decimal)
CIDR  /4  240,435,456   11110000 00000000 00000000 00000000   240.0.0.0
CIDR  /5  134,217,728   11111000 00000000 00000000 00000000   248.0.0.0
CIDR  /6  67,108,864  11111100 00000000 00000000 00000000   252.0.0.0
CIDR  /7  33,554,432  11111110 00000000 00000000 00000000   254.0.0.0
A     /8  16,777,216  11111111 00000000 00000000 00000000   255.0.0.0
CIDR  /9  8,388,608   11111111 10000000 00000000 00000000   255.128.0.0
CIDR  /10   4,194,304   11111111 11000000 00000000 00000000   255.192.0.0
CIDR  /11   2,097,152   11111111 11100000 00000000 00000000   255.224.0.0
CIDR  /12   1,048,576   11111111 11110000 00000000 00000000   255.240.0.0
CIDR  /13   524,288   11111111 11111000 00000000 00000000   255.248.0.0
CIDR  /14   262,144   11111111 11111100 00000000 00000000   255.252.0.0
CIDR  /15   131,072   11111111 11111110 00000000 00000000   255.254.0.0
B     /16   65,534  11111111 11111111 00000000 00000000   255.255.0.0
CIDR  /17   32,768  11111111 11111111 10000000 00000000   255.255.128.0
CIDR  /18   16,384  11111111 11111111 11000000 00000000   255.255.192.0
CIDR  /19   8,192   11111111 11111111 11100000 00000000   255.255.224.0
CIDR  /20   4,096   11111111 11111111 11110000 00000000   255.255.240.0
CIDR  /21   2,048   11111111 11111111 11111000 00000000   255.255.248.0
CIDR  /22   1,024   11111111 11111111 11111100 00000000   255.255.252.0
CIDR  /23   512   11111111 11111111 11111110 00000000   255.255.254.0
C     /24   256   11111111 11111111 11111111 00000000   255.255.255.0
CIDR  /25   128   11111111 11111111 11111111 10000000   255.255.255.128
CIDR  /26   64  11111111 11111111 11111111 11000000   255.255.255.192
CIDR  /27   32  11111111 11111111 11111111 11100000   255.255.255.224
CIDR  /28   16  11111111 11111111 11111111 11110000   255.255.255.240
CIDR  /29   8   11111111 11111111 11111111 11111000   255.255.255.248
CIDR  /30   4   11111111 11111111 11111111 11111100   255.255.255.252

192.168.100.14/24 represents the IPv4 address 192.168.100.14 and 
its associated routing prefix 192.168.100.0, or equivalently, 
its subnet mask 255.255.255.0, which has 24 leading 1-bits.

<사설 IP 주소 대역>

 A Class
 10.0.0.0 /8(bit)

10.0.0.1 ~ 10.255.255.254

subnet mask : 255.0.0.0
  
 B Class 
 172.16.0.0 /16(bit)

172.16.0.1 ~ 172.31.255.254

subnet mask : 255.255.0.0
  
 C Class 
192.168.0.0 /24(bit)

192.168.0.1 ~ 192.168.255.254

subnet mask : 255.255.255.0 

[출처] 네트워크 해킹 :: TCP/IP - IP계층(1)/Forwarding/Routing/IP주소/IP Class/사설 IP/Subnet mask|작성자 ellenism

######################################################################################################
######################################################################################################
################################################### AWS
######################################################################################################
######################################################################################################


-- configure ssh with pem
http://rusticode.com/2012/11/19/ec2-ssh-configuration-with-pem-keys/
http://egloos.zum.com/nemonein/v/5267429


An Elastic Block Store is a virtual disk that can adjust up and down in size as necessary.
Go to the Elastic Block Store section  of EC2, look at the volumes.
Find the available one.  Right click and attach it to your Windows box (instance i-5df05282) (edited

http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-add-volume-to-instance.html


ssh -i RHEL7_ORA11XE_KEYPAIR.pem ec2-user@ec2-52-64-241-211.ap-southeast-2.compute.amazonaws.com
cd /Users/wonheechoi/documents/software/'AWS KEYPAIR'

ec2-52-64-2-111.ap-southeast-2.compute.amazonaws.com
ec2-52-64-241-211.ap-southeast-2.compute.amazonaws.com

ec2-52-64-241-211.ap-southeast-2.compute.amazonaws.com

scp -i RHEL7_ORA11XE_KEYPAIR.pem oracle-xe-11.2.0-1.0.x86_64.rpm.zip ec2-user@ec2-52-64-2-111.ap-southeast-2.compute.amazonaws.com:~


52.64.241.211

telnet ec2-52-64-241-211.ap-southeast-2.compute.amazonaws.com 1521
telnet ec2-52-64-241-211.ap-southeast-2.compute.amazonaws.com 1521

telnet ip-172-31-14-94.ap-southeast-2.compute.internal 1521

Public DNS
ec2-52-64-241-211.ap-southeast-2.compute.amazonaws.com
Instance state
running
  
Public IP
52.64.241.211


telnet 52.64.241.211 1521

/etc/init.d/oracle-xe stop

/etc/init.d/oracle-xe start


INSTALL ORA11XE On RHEL7 on AWS
http://docs.oracle.com/cd/E17781_01/install.112/e18802/toc.htm#XEINL121



as root

install bug
http://stackoverflow.com/questions/18028942/oracle-xe-database-configuration-failed

rpm -ivh oracle-xe-11.2.0-1.0.x86_64.rpm
rpm -i oracle-xe.rpm
rpm -i oracle-xe-11.2.0-1.0.x86_64.rpm
rpm -e oracle-xe-11.2.0-1.0.x86_64.rpm
rpm -e oracle-xe


create swap
http://stackoverflow.com/questions/17173972/how-do-you-add-swap-to-an-ec2-instance

It will usually be mounted to /mnt but if not run

sudo mount /dev/xvda2 /mnt

To then create a swap file on this device do the following for a 4GB swapfile

sudo dd if=/dev/zero of=/mnt/swapfile bs=1M count=2048

Make sure no other user can view the swap file

sudo chown root:root /mnt/swapfile
sudo chmod 600 /mnt/swapfile

Make and Flag as swap

sudo mkswap /mnt/swapfile
sudo swapon /mnt/swapfile

Add/Make sure the following are in your /etc/fstab

/dev/xvda2      /mnt    auto    defaults,nobootwait,comment=cloudconfig 0   2
/mnt/swapfile swap swap defaults 0 0

lastly enable swap

sudo swapon -a


cat /proc/meminfo



# /usr/sbin/groupadd oinstall



# /usr/sbin/groupadd dba

# /usr/sbin/useradd -g oinstall -G dba oracle


Database Configuration failed.  Look into /u01/app/oracle/product/11.2.0/xe/config/log for details

/etc/init.d/oracle-xe status
/etc/init.d/oracle-xe configure


[root@ip-172-31-14-94 ~]# hostname
ip-172-31-14-94.ap-southeast-2.compute.internal





------ Using scp to transfer data

“scp” means “secure copy”, which can copy files between computers on a network. You can use this tool in a Terminal on a Unix/Linux/Mac system.

To upload a file from your laptop to Amazon instance:

$scp -i ~/Desktop/amazon.pem ~/Desktop/MS115.fa  ubuntu@ec2-54-166-128-20.compute-1.amazonaws.com:~/data/

This command will upload a file - MS115.fa in your ~/Desktop/ folder of your laptop to folder ~/data/ on an Amazon instance. Note you still need to use the private key you used to connect to the Amazon instance with ssh. (In this example, it is the amazon.pem file in ~/Desktop/.

Note: You need to make sure that the user “ubuntu” has the permission to write in the target directory. In this example, if ~/data/ was created by user “ubuntu”, it should be fine.

Similarly, to download a file from Amazon instance to your laptop:

$scp -i ~/Desktop/amazon.pem ubuntu@ec2-54-166-128-20.compute-1.amazonaws.com:/data/ecoli_ref-5m-trim.fastq.gz ~/Download/





######################################################################################################
######################################################################################################
################################################### MySQL TIP
######################################################################################################
######################################################################################################

RENAME DATABASE  CPMDB TO CPMDB_MYISAM;

select TABLE_NAME,COLUMN_NAME,CONSTRAINT_NAME, REFERENCED_TABLE_NAME,REFERENCED_COLUMN_NAME 
from KEY_COLUMN_USAGE 
where REFERENCED_TABLE_SCHEMA = 'CPMDB' 
AND REFERENCED_TABLE_NAME = 'ATTRIBUTES'; 

SELECT * FROM information_schema.TABLE_CONSTRAINTS 
WHERE information_schema.TABLE_CONSTRAINTS.CONSTRAINT_TYPE = 'FOREIGN KEY' 
AND information_schema.TABLE_CONSTRAINTS.TABLE_SCHEMA = 'CPMDB'
AND information_schema.TABLE_CONSTRAINTS.TABLE_NAME = 'ATTRIBUTES';


ALTER TABLE CONS_LANGUAGES DROP FOREIGN KEY FK_CONS_LANGUAGES3;

ALTER TABLE CONS_LANGUAGES
ADD FOREIGN KEY FK_CONS_LANGUAGES1(CONSULTANT_ID)
REFERENCES CONSULTANTS(CONSULTANT_ID)
ON DELETE NO ACTION
ON UPDATE NO ACTION;


SELECT C.CONSULTANT_ID
,C.FIRST_NAME
,CL.LANGUAGE
,LANG_A.ATTRIBUTE_VALUE
,CL.LANGUAGE_LEVEL
,LANG_LEVEL_A.ATTRIBUTE_VALUE
FROM CONSULTANTS AS C
LEFT JOIN CONS_LANGUAGES AS CL ON C.CONSULTANT_ID = CL.CONSULTANT_ID
LEFT JOIN (SELECT * FROM ATTRIBUTES WHERE TYPE='Language' ) AS LANG_A ON CL.LANGUAGE = LANG_A.ATTRIBUTE_ID AND LANG_A.TYPE='Language'
LEFT JOIN (SELECT * FROM ATTRIBUTES WHERE TYPE='Language Level' ) AS LANG_LEVEL_A ON CL.LANGUAGE_LEVEL = LANG_LEVEL_A.ATTRIBUTE_ID AND LANG_LEVEL_A.TYPE='Language Level'
WHERE C.CONSULTANT_ID=21 -- Duncan, application needs to pass on the parameter variable to specify a consultant profile
ORDER BY C.CONSULTANT_ID;

grant all privileges on CPMDB.* to root@localhost ;
grant all privileges on db2.* to root@localhost ;
grant all privileges on information_schema.* to root@localhost ;
grant all privileges on joomla.* to root@localhost ;


######################################################################################################
######################################################################################################
################################################### ORACLE TIP
######################################################################################################
######################################################################################################


##################check instance sh

echo "DB INSTANCES ON NODE 2"
echo "--------------------------------------------------------"
ssh fllxnpodb002 ps -ef | grep ora_pmon | grep -v grep | awk -F_ '{ print $3 }'
echo "--------------------------------------------------------"
echo "LISTENERS ON NODE 2"
ssh fllxnpodb002 ps -ef |grep tns
echo "--------------------------------------------------------"
echo "FS NODE 2--"
ssh fllxnpodb002 df -HlP | gr
ep -vE '^Filesystem|tmpfs|cdrom' | awk '{ print $5 " " $6 }' | while read output;
do
usep=$(echo $output | awk '{ print $1}' | cut -d'%' -f1  )
if [ $usep -ge 80 ]; then
echo "mount points more than 80% full"
echo "$output"
fi
done
echo "--------------------------------------------------------"
echo "Failed export Backups"
grep -i "Some Problem with export backup" /new-backup/my_datapump_dir/logs/log_`date \+\%Y\%m\%d`
echo "END OF SCRIPT ------------------------------------------"



###################### shutdown linux

shutdown now -r


####################### RMAN COMMAND GENERAL

http://psoug.org/reference/rman.html

# Á¢¼Ó
RMAN
connect target / ;


###################### flashback area archive »èÁ¦ crosscheck
SQL> show parameter recovery

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
db_recovery_file_dest                string      /ora/PTLCAT2/fra001
db_recovery_file_dest_size           big integer 15G
recovery_parallelism                 integer     0

crosscheck archivelog all;

-- DELETE ARCHIVE
RMAN> delete expired copy of archivelog all;

released channel: ORA_DISK_1
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=30 device type=DISK
specification does not match any archived log in the repository


delete expired copy of archivelog all;

delete archivelog all completed before 'SYSDATE-10';


REPORT OBSOLETE 

RMAN> delete obsolete;

RMAN retention policy will be applied to the command
RMAN retention policy is set to recovery window of 7 days
using channel ORA_DISK_1
Deleting the following obsolete backups and copies:
Type                 Key    Completion Time    Filename/Handle
-------------------- ------ ------------------ --------------------
Backup Set           505    27-JUN-12
  Backup Piece       505    27-JUN-12          /ora/PTLCAT2/fra001/PTLCAT2/autobackup/2012_06_27/o1_mf_s_787088411_7yoo7vqm_.bkp
Backup Set           506    28-JUN-12
  Backup Piece       506    28-JUN-12          /ora/PTLCAT2/fra001/PTLCAT2/backupset/2012_06_28/o1_mf_annnn_PTLCAT2_ARC_20120628_7yr9hy9s_.bkp
Backup Set           509    28-JUN-12
  Backup Piece       509    28-JUN-12          /ora/PTLCAT2/fra001/PTLCAT2/backupset/2012_06_28/o1_mf_ncnnf_PTLCAT2_CTL_H_201206_7yr9mj9n_.bkp

Do you really want to delete the above objects (enter YES or NO)? yes
deleted backup piece
backup piece handle=/ora/PTLCAT2/fra001/PTLCAT2/autobackup/2012_06_27/o1_mf_s_787088411_7yoo7vqm_.bkp RECID=505 STAMP=787088411
deleted backup piece
backup piece handle=/ora/PTLCAT2/fra001/PTLCAT2/backupset/2012_06_28/o1_mf_annnn_PTLCAT2_ARC_20120628_7yr9hy9s_.bkp RECID=506 STAMP=787174686
deleted backup piece
backup piece handle=/ora/PTLCAT2/fra001/PTLCAT2/backupset/2012_06_28/o1_mf_ncnnf_PTLCAT2_CTL_H_201206_7yr9mj9n_.bkp RECID=509 STAMP=787174800
Deleted 3 objects

# RMAN OBSOLETE VS EXPIRED
A backup is obsolete when REPORT OBSOLETE or DELETE OBSOLETE determines, based on the user-defined retention policy, that it is not needed for recovery. 
A backup is considered an expired backup only when RMAN performs a crosscheck and cannot find the file. 
In short, obsolete means a file is not needed, whereas expired means it is not found.

  3) RMAN À¸·Î CROSSCHECK and DELETE EXPIRED ¼öÇà
  RMAN>crosscheck archivelog all;
  RMAN>delete expired archivelog all;
  
  
RMAN> delete obsolete;

RMAN retention policy will be applied to the command
RMAN retention policy is set to recovery window of 7 days
using channel ORA_DISK_1
Deleting the following obsolete backups and copies:
Type                 Key    Completion Time    Filename/Handle
-------------------- ------ ------------------ --------------------
Control File Copy     4      28-SEP-11          /var/opt/app/oracle/rda/output/TMP_odb02/odb02_BR_T29756_01_control.tmp
Control File Copy     7      19-MAR-12          /var/opt/app/oracle/product/11.2.0/db_1/dbs/snapcf_PTLDEV2.f
Backup Set           1496   27-JUN-12
  Backup Piece       1496   27-JUN-12          /ora/PTLDEV2/fra001/PTLDEV2/autobackup/2012_06_27/o1_mf_s_787088149_7yonzp3n_.bkp
Backup Set           1497   28-JUN-12
  Backup Piece       1497   28-JUN-12          /ora/PTLDEV2/fra001/PTLDEV2/backupset/2012_06_28/o1_mf_annnn_PTLDEV2_ARC_20120628_7yr914wf_.bkp
Backup Set           1500   28-JUN-12
  Backup Piece       1500   28-JUN-12          /ora/PTLDEV2/fra001/PTLDEV2/backupset/2012_06_28/o1_mf_ncnnf_PTLDEV2_CTL_H_201206_7yr9blg7_.bkp

Do you really want to delete the above objects (enter YES or NO)?



ORA-19815: WARNING: db_recovery_file_dest_size of 16106127360 bytes is 100.00% used

The information in this document applies to:
Oracle Server - Enterprise Edition - Version: 10.1.0.0 to 10.2.0.0
This problem can occur on any platform.
This affects RMAN backups to the 10g Flash Recovery Area
Errors
ORA-19815 WARNING: %s of %s bytes is %s used, and has %s remaining bytes
Symptoms

ALERT LOG
-----------
ORA-19815: WARNING: db_recovery_file_dest_size of 3221225472 bytes is 100.00% used, and has 0 remaining bytes available.
Cause

You are making backups to the flash recovery area. You may be using the Oracle disk strategy or just backing up the database to the FRA. All objects written to the FRA will consume space there and to reclaim this space you must backup the FRA files. Once you backup the recovery files they are placed on an internal "file can be deleted" list. Once this is done the reclaimable space increases and Oracle will manage the FRA automatically.

You can monitor the space in the flash_recovery_area using the provided query. The main column is the reclaimable column. If it is 0 then Oralce will not cleanup any files in the db_recovery_file_dest. Where if you backup the recovery area to tape as shown above the reclaimable space is > 0 and the files that were backed up are placed on a file can be deleted list because there is a tape backup of the files. If Oracle needs space after that it will remove the oldest can be delete file available in the FRA. It will remove old archivelogs that have been backed up then backupsets.

The only way to increase the reclaimable column is to have RMAN backup the flash recovery area. Once backed up the files in the recovery area are placed on a files that can be deleted list and Oracle will manage the flash recovery area space.
Fix


SELECT substr(name, 1, 30) name, space_limit AS quota,
       space_used        AS used,
        space_reclaimable AS reclaimable,
        number_of_files   AS files
  FROM  v$recovery_file_dest ;

NAME                                QUOTA       USED RECLAIMABLE      FILES
------------------------------ ---------- ---------- ----------- ----------
/n01/10G/FRAB                  4294967296 2647365120           0        105


# backup the flash recovery area to tape

RMAN> backup recovery area;

backup recovery area TO DESTINATION '+DGFRA';


SELECT substr(name, 1, 30) name, space_limit AS quota,
       space_used        AS used,
        space_reclaimable AS reclaimable,
        number_of_files   AS files
  FROM  v$recovery_file_dest ;

NAME                                QUOTA       USED RECLAIMABLE      FILES
------------------------------ ---------- ---------- ----------- ----------
/n01/10G/FRAB                  4294967296 2647365120  2254337536        105



SELECT * FROM v$flash_recovery_area_usage; 

alter system set db_recovery_file_dest_size = 16G;
alter system set db_recovery_file_dest_size = 10G;


############################## ASM DISK FILE SIZE CHECK Check the diskspace in ASM:
ORA-15041: diskgroup "DATA" space exhausted


SQL> select GROUP_NUMBER, NAME,TOTAL_MB, FREE_MB, USABLE_FILE_MB from V$ASM_DISK                        GROUP;

GROUP_NUMBER NAME                             TOTAL_MB    FREE_MB USABLE_FILE_MB
------------ ------------------------------ ---------- ---------- --------------
           1 CLUA                                30705      29779          14735
           2 CLUB                                30705      29877          14800
           3 DATA                               409530      24114          24114
           4 FRA                                163812     121108         121108


SQL> select substr(name,1,10) name,substr(path,1,20) path, REDUNDANCY, TOTAL_MB, os_mb, free_mb from V$ASM_DISK where GROUP_NUMBER = 3;

NAME                                     PATH                                                            REDUNDA   TOTAL_MB       OS_MB    FREE_MB
---------------------------------------- -------------------------------------------------------------------------------- ------- ---------- ---------- ----------
DATA_0000                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2422
DATA_0001                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2430
DATA_0002                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2420
DATA_0003                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2408
DATA_0004                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2403
DATA_0005                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2399
DATA_0006                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2410
DATA_0007                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2414
DATA_0008                                /dev/mapper/asmdata1                                            UNKNOWN      40953       40953       2400
DATA_0009                                /dev/mapper/asmdata0                                            UNKNOWN      40953       40953       2408

10 rows selected.

First try to extend current diskgroup.

SQL> ALTER DISKGROUP data RESIZE DISK VOL1 size 4G;
ALTER DISKGROUP data RESIZE DISK VOL1 size 4G
*
ERROR at line 1:
ORA-15032: not all alterations performed
ORA-15289: ASM disk VOL1 cannot be resized beyond 2039 M

Diskgroup cannot be extended. Only solution is to add a new disk.
After adding the new disk, the new disk device is /dev/sde

List all current disks on Linux:
sfdisk -l

Now create a partition on /dev/sde to span the whole disk.

[root@dbvisit32 /]# fdisk /dev/sde

Command (m for help): n
Command action
e extended
p primary partition (1-4)
p
Partition number (1-4): 1
First cylinder (1-261, default 1):
Using default value 1
Last cylinder or +size or +sizeM or +sizeK (1-261, default 261):
Using default value 261

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
[root@dbvisit32 /]# ls -la /dev/sde*
brw-r----- 1 root disk 8, 64 Jun 7 11:59 /dev/sde
brw-r----- 1 root disk 8, 65 Jun 7 11:59 /dev/sde1

Partition /dev/sde1 is now created.

Now make the disk available to ASM.

[root@dbvisit31 ~]# /etc/init.d/oracleasm listdisks
VOL1
VOL2
VOL3
[root@dbvisit31 ~]# /etc/init.d/oracleasm createdisk VOL4 /dev/sde1
Marking disk "/dev/sde1" as an ASM disk: [ OK ]
[root@dbvisit31 ~]# /etc/init.d/oracleasm listdisks
VOL1
VOL2
VOL3
VOL4

Go back to ASM and add the new disk.

SQL> select substr(name,1,10) name,substr(path,1,20) path, REDUNDANCY, TOTAL_MB, os_mb, free_mb from V$ASM_DISK;

NAME PATH REDUNDA TOTAL_MB OS_MB FREE_MB
---------- -------------------- ------- ---------- ---------- ----------
ORCL:VOL4 UNKNOWN 0 2047 0
VOL1 ORCL:VOL1 UNKNOWN 2039 2039 215
VOL2 ORCL:VOL2 UNKNOWN 705 705 606
VOL3 ORCL:VOL3 UNKNOWN 1349 1349 1214

SQL> ALTER DISKGROUP DATA ADD DISK 'ORCL:VOL4';

SQL> select substr(name,1,10) name,substr(path,1,20) path, REDUNDANCY, TOTAL_MB, os_mb, free_mb from V$ASM_DISK where GROUP_NUMBER = 2;

NAME PATH REDUNDA TOTAL_MB OS_MB FREE_MB
---------- -------------------- ------- ---------- ---------- ----------
VOL1 ORCL:VOL1 UNKNOWN 2039 2039 368
VOL4 ORCL:VOL4 UNKNOWN 2047 2047 1892

All done. Disk group DATA now has an extra 2G. 
#################### RMAN BACKUP

RMAN> BACKUP SPFILE;

Starting backup at 10-JAN-13
using channel ORA_DISK_1
channel ORA_DISK_1: starting full datafile backup set
channel ORA_DISK_1: specifying datafile(s) in backup set
including current SPFILE in backup set
channel ORA_DISK_1: starting piece 1 at 10-JAN-13
channel ORA_DISK_1: finished piece 1 at 10-JAN-13
piece handle=+DGFRA/mercury/backupset/2013_01_10/nnsnf0_tag20130110t110020_0.277.804337221 tag=TAG20130110T110020 comment=NONE
channel ORA_DISK_1: backup set complete, elapsed time: 00:00:01
Finished backup at 10-JAN-13

RMAN> LIST BACKUP OF SPFILE;


List of Backup Sets
===================


BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
6       Full    80.00K     DISK        00:00:00     10-JAN-13
        BP Key: 6   Status: AVAILABLE  Compressed: NO  Tag: TAG20130110T110020
        Piece Name: +DGFRA/mercury/backupset/2013_01_10/nnsnf0_tag20130110t110020_0.277.804337221
  SPFILE Included: Modification time: 23-DEC-12
  SPFILE db_unique_name: MERCURY



BACKUP DATABASE;

REPORT OBSOLETE;

DELETE OBSOLETE;

CONFIGURE RETENTION POLICY TO REDUNDANCY 1;
OR
CONFIGURE RETENTION POLICY TO RECOVERY WINDIW OF 7 DAYS;

CONFIGURE RETENTION POLICY TO NONE;

BACKUP INCREMENTAL LEVEL 0 DATABASE;

BACKUP INCREMENTAL LEVEL 1 CUMULATIVE DATABASE;

BACKUP INCREMENTAL LEVEL 1 DATABASE; (DIFFERENTIAL)

BACKUP VALIDATE CHECK LOGICAL ... BACKUP SET, DATAFILE ETC.

LIST BACKUP

CROSSCHECK BACKUP;

CROSSCHECK COPY;




Deleting backups using primary keys from LIST output:

DELETE BACKUPPIECE 101;

Deleting backups by filename on disk:

DELETE CONTROLFILECOPY '/tmp/control01.ctl';

Deleting archived redo logs from disk:

DELETE NOPROMPT ARCHIVELOG UNTIL SEQUENCE = 300;

Deleting backups based on tags:

DELETE BACKUP TAG='before_upgrade';

Delete backups based on the objects backed up and the media or disk location where the backup is stored:

DELETE BACKUP OF TABLESPACE users DEVICE TYPE sbt; # delete only from tape
DELETE COPY OF CONTROLFILE LIKE '/tmp/%';  # 

Delete all backups for this database recorded in the RMAN repository:

DELETE BACKUP; 





# example SHOW ALL;

RMAN configuration parameters for database with db_unique_name PROD1 are:
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 3 DAYS;
CONFIGURE BACKUP OPTIMIZATION ON;
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE SBT_TAPE TO '%F'; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 2 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS 'ENV=(OB_DEVICE=tape1)';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/disk1/oracle/dbs/snapcf_ev.f'; # default

# RMAN BACKUP-RESOTRE-RECOVERY
http://somahhh.tistory.com/98
http://blog.naver.com/dark396?Redirect=Log&logNo=80142371849

# CONFIGURING AN ASM DISK LOCATION
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT '+dgroup1';;

# RMAN script

root cron >
/oracle/backup/rman_full.sh >> /oracle/backup/full_backup.log

script>

su - oracle << EOF
/oracle/product/10.2.0/db_1/bin/rman target / nocatalog
CONFIGURE CONTROLFILE AUTOBACKUP ON;
run
{
sql "alter system switch logfile";
allocate channel ch1 type disk format '/oracle/backup/configure_%T_%U';
backup database format '/oracle/backup/db_full_%T_%U';
sql "alter system archive log current";
crosscheck archivelog all;
crosscheck backupset;
release channel ch1;
allocate channel ch2 type disk format '/oracle/backup/%d.%T.%u.arc.rman';
backup tag '%TAG' archivelog all not backed up;
delete noprompt archivelog until time 'sysdate - 7';
report obsolete;
delete noprompt obsolete;
release channel ch2;
}

CONFIGURE CONTROLFILE AUTOBACKUP OFF;

exit;
EOF 


restore>

su - oracle << EOF

/oracle/product/10.2.0/db_1/bin/rman target / nocatalog
run
{
restore database;
}
exit;
EOF



RMAN> RUN {
2> ALLOCATE CHANNEL t1 TYPE 'SBT'
3> MAXPIECESIZE = 4G;
4> BACKUP
5> FORMAT 'df_%t_%s_%p' FILESPERSET 3
6> (tablespace users); }
RMAN> run {
2> allocate channel c1 type sbt;
3> allocate channel c2 type sbt;
5> backup
6> incremental level = 0
7> format '/disk1/backup/df_%d_%s_%p.bak¡®
8> (datafile 1,4,5 channel c1 tag=DF1)
9> (datafile 2,3,6 channel c2 tag=DF2)
11> alter system archive log current;
12> }
RMAN> run
{
allocate channel c1 type disk;
backup(archivelog all);
release channel c1;
}
RMAN> list backupset of archivelog all;
or
archivelog from logseq=2524 until logseq=2530 thread 1
archivelog from time 'sysdate-1' all delete input

Online Redolog ´Â Backup ÇÒ ¼ö ¾øÀ¸¹Ç·Î ¸í½ÃÀûÀ¸·Î Archived ½ÃÅ² ÈÄ Backup ¼öÇà.
sql ¡®alter system archive log current¡¯;

############## Â÷µî ÁõºÐ ¹é¾÷ DIFFERENTIAL INCREMENTAL BACKUP
 
1. ÀÏ¿äÀÏ - level 0 À¸·Î µ¥ÀÌÅÍº£ÀÌ½º ÀüÃ¼ ¹é¾÷
 
RMAN>
run {
allocate channel c1 type disk;
allocate channel c2 type disk;
backup
incremental level 0
database
format '/data/backup/rman/%U_%T';
}
 
 
2. ¿ù¿äÀÏ - level 3 À¸·Î users tablespace ¸¸ Â÷µî ÁõºÐ ¹é¾÷
 
RMAN>
run {
allocate channel c1 type disk;
backup
incremental level 3
tablespace users;
}
 
 
 
3. ¼ö¿äÀÏ - level 3 À¸·Î ´©Àû ÁõºÐ ¹é¾÷  CUMULATIVE INCREMENTAL BACKUP
 
RMAN>
run {
allocate channel c2 type disk;
backup
incremental level 3 cumulative
tablespace example;
}





##################### rman °ø°£ºÎÁ· 

ORA-19815: WARNING: db_recovery_file_dest_size of 4718592000000 bytes is 99.98% used, and has 738197504 remaining bytes available.
************************************************************************
You have following choices to free up space from recovery area:
1. Consider changing RMAN RETENTION POLICY. If you are using Data Guard,
   then consider changing RMAN ARCHIVELOG DELETION POLICY.
2. Back up files to tertiary device such as tape using RMAN
   BACKUP RECOVERY AREA command.
3. Add disk space and increase db_recovery_file_dest_size parameter to
   reflect the new space.
4. Delete unnecessary files using RMAN DELETE command. If an operating
   system command was used to delete files, then use RMAN CROSSCHECK and
   DELETE EXPIRED commands.
************************************************************************ 

Errors in file /u01/app/oracle/diag/rdbms/mdwdbs/mdwdbs1/trace/mdwdbs1_arc1_962.trc:
ORA-19809: limit exceeded for recovery files
ORA-19804: cannot reclaim 15389949952 bytes disk space from 4718592000000 limit
ARC1: Error 19809 Creating archive log file to '+RECO'

 

ASM DGÀÇ Free Disk °¡ ÃæºÐÇÔ¿¡µµ  °ø°£ÀÌ ºÎÁ·ÇÏ´Ù´Â  ¿¡·¯°¡ ¹ß»ýÇÒ ¼ö ÀÖ´Ù.

rman ÀÌ ¾Æ´Ñ, asmcmd Ä¿¸Çµå·Î Á÷Á¢ archive log ÆÄÀÏÀ» °­Á¦·Î »èÁ¦ÇÏ¿´À» °æ¿ì

DBÀÇ controlfileÀº ±×°ÍÀ» ÀÎ½ÄÇÏÁö ¸øÇÑ´Ù.  ¾Æ·¡ RMAN ¸í·ÉÀ» ÀÌ¿ëÇÏ¿© ASM °ú controlfile ÀÇ Á¤ÇÕ¼ºÀ» ¸ÂÃßµµ·Ï ÇÏ¸é µÈ´Ù.

 

connect target / ;
run
{
 crosscheck archivelog all;
 delete noprompt expired archivelog all;
} 



###################### profile change
alter profile default limit PASSWORD_REUSE_MAX 1 ;
alter profile NONEXPIRE limit PASSWORD_REUSE_MAX 1 ;
alter profile NONEXPIRE limit PASSWORD_REUSE_MAX 1800 ;

alter profile NONEXPIRE limit PASSWORD_REUSE_TIME unlimited       
alter profile default limit PASSWORD_REUSE_TIME unlimited      

ALTER PROFILE NONEXPIRE LIMIT PASSWORD_REUSE_TIME UNLIMITED ;
ALTER PROFILE NONEXPIRE LIMIT PASSWORD_REUSE_MAX UNLIMITED;





######################## SQL Tuning Advisor

--Grant advisor privilege to the user
grant advisor to dbaview;

For example, to use the SQL Tuning Advisor to optimize a specified SQL statement text, you need to create a tuning task with the SQL statement passed as a CLOB argument. For the following PL/SQL code, the user HR has been granted the ADVISOR privilege and the function is run as user HR on the employees table in the HR schema.

DECLARE
my_task_name VARCHAR2(30);
my_sqltext CLOB;
BEGIN
my_sqltext := 'SELECT COUNT(*) FROM IP_ADDRESS WHERE UPPER(IP_ADDRESS_TYPE)=''DATA IP ADDRESS'' ||
          AND (IP_ADDRESS=:B4 OR IP_ADDRESS=:B3 ) AND :B2 ||
         >=PROVISIONED_DATE AND ((UPPER(DECOMMISSIONED_STATUS)!=''Y'' OR ||
         DECOMMISSIONED_STATUS IS NULL) OR (UPPER(DECOMMISSIONED_STATUS)=''Y'' ||
         AND :B1 <DECOMMISSIONED_DATE))';

my_task_name := DBMS_SQLTUNE.CREATE_TUNING_TASK(
sql_text => my_sqltext,
bind_list => sql_binds(anydata.ConvertNumber(100)),
user_name => 'NCS',
scope => 'COMPREHENSIVE',
time_limit => 60,
task_name => 'my_sql_tuning_task',
description => 'Task to tune a query');
END;
/

Executing a SQL Tuning Task
After you have created a tuning task, you need to execute the task and start the tuning process. For example:

BEGIN
DBMS_SQLTUNE.EXECUTE_TUNING_TASK( task_name => 'my_sql_tuning_task' );
END;
/

Checking the Status of a SQL Tuning Task
You can check the status of the task by reviewing the information in the USER_ADVISOR_TASKS view or check execution progress of the task in the V$SESSION_LONGOPS view. For example:

SELECT status FROM USER_ADVISOR_TASKS WHERE task_name = 'my_sql_tuning_task';

Checking the Progress of the SQL Tuning Advisor
You can check the execution progress of the SQL Tuning Advisor in the V$ADVISOR_PROGRESS view. For example:

SELECT sofar, totalwork FROM V$ADVISOR_PROGRESS WHERE username = 'NCS' AND task_name = 'my_sql_tuning_task';

Displaying the Results of a SQL Tuning Task
After a task has been executed, you display a report of the results with the REPORT_TUNING_TASK function. For example:

SET LONG 1000
SET LONGCHUNKSIZE 1000
SET LINESIZE 100
SELECT DBMS_SQLTUNE.REPORT_TUNING_TASK( 'my_sql_tuning_task')
FROM DUAL;
The report contains all the findings and recommendations of Automatic SQL Tuning. For each proposed recommendation, the rationale and benefit is provided along with the SQL commands needed to implement the recommendation.




----------- SIMPLE EXAMPLE

declare

   l_task_id     varchar2(20);
   l_sql         varchar2(2000);
begin
   l_sql := 'SELECT * From Virtual_Machine';
   --dbms_sqltune.drop_tuning_task ('TEST1');
   l_task_id := dbms_sqltune.create_tuning_task (
      sql_text  => l_sql,
      user_name  => 'NCS',
      scope      => 'COMPREHENSIVE',
      time_limit => 120,
      task_name  => 'TEST1'
   );
   dbms_sqltune.execute_tuning_task ('TEST1');
end;
/


set serveroutput on size 999999
set long 999999
select dbms_sqltune.report_tuning_task ('TEST1') from dual;


-----------------------------------------------------------



°³³ä :
- Oracle 10g ÀÇ »õ±â´ÉÀÎ Automatic Workload Repository(AWR) ÀÇ Æ©´× ¼Ö·ç¼ÇÀÎ
Server-Based AdvisorsÀÇ ÄÞÆ÷³ÍÆ® ÁßÀÇ ÇÏ³ªÀÌ´Ù.
- Server-Based Advisors ´Â ´ÙÀ½°ú °°ÀÌ±¸¼ºµÈ´Ù.
Automatic Database Diagnostic Monitor (ADDM)
SQL Tuning Advisor
SQL Access Advisor
Shared Pool Advisor
MTTR Advisor
- SQL Tuning Advisor ´Â SQL ±¸¹®µéÀ» ºÐ¼®ÇÏ¿© Æ©´×¹æ¹ýÀ» Á¦¾ÈÇÑ´Ù.
- Æ©´×¹æ¹ýÀ» Á¦¾ÈÇÏ´Â °Í¿¡¼­ ±×Ä¡Áö ¾Ê°í ½±°ÔÀû¿ëÇÒ¼ö ÀÖµµ·Ï µµ¿ÍÁÖ±âµµ ÇÑ´Ù.


»ç¿ë¹æ¹ý:
-¿£ÅÍÇÁ¶óÀÌÁ® ¸Å´ÏÁ®¸¦ ÅëÇØ °ü¸®ÇÒ¼öµµ ÀÖÁö¸¸ ¿©±â¼­´Â DBMS_SQLTUNE ÆÐÅ°Áö¸¦
»ç¿ëÇÏ±â·Î ÇÑ´Ù.

1) Æ©´× Task »ý¼º

Declare
ret_val varchar2(2000);
Begin
ret_val:=dbms_sqltune.create_tuning_task(sql_text=>'SELECT * FROM EMP WHERE EMPNO=7934');

dbms_output.put_line('Output: 'ret_val);

end;/

OUTPUT: TASK_00004

2) Æ©´×°¡ÀÌµå »ý¼º

Exec Dbms_sqltune.execute_tuning_task('TASK_00004');


3) Æ©´× ¸®Æ÷Æ® »ý¼º
set serveroutput on size 999999
set long 999999
select dbms_sqltune.report_tuning_task ('TASK_00004') from dual;

4)°á°úºÐ¼®

GENERAL INFORMATION SECTION
----------------------------------------------------
Tuning Task Name : TASK_00004
Scope : COMPREHENSIVE
Time Limit(seconds): 1800
Completion Status : COMPLETED
Started at : 11/06/2003 01:47:38




############## VM Swap space swap file
My solution was to adding some temporary swap space to this system, which is really easy to do:

Step 1. Create an empty file called /swapfile from about 600MB

    root@bootux:~# dd if=/dev/zero of=/swapfile bs=1024000 count=600
    600+0 records in
    600+0 records out
    614400000 bytes (614 MB) copied, 5.85153 seconds, 105 MB/

Step 2. Format the new file to make it a swap file

    root@bootux:~# mkswap /swapfile
    Setting up swapspace version 1, size = 614395 kB

Step 3. Enable the new swapfile. Only the swapon command is needed, but with the free command you can clearly see the swap space is made available to the system.

    root@bootux:~# free -m | grep Swap
    Swap:          509          0        509
    root@bootux:~# swapon /swapfile
    root@bootux:~# free -m | grep Swap
    Swap:         1095          0       1095


to delete

swapoff /swapfile

and rm


##################### vm Swappiness

vi /etc/sysctl.conf add line
vm.swappiness=0

echo 0 > /proc/sys/vm/swappiness

default is 60
 
 
What does free -m give for swap file usage?
 
/etc/sysctl.conf is a linux boot file loaded before rc
To view settings
# sysctl -a
# sysctl -A

to reload settings
sysctl -p

What does vmstat -m show for si so?



#################### rac requirement

Neil informed me that we are looking for a new 2 node cluster Database environment for SVT testing. Are we looking for data guard as well, since production has got 2 node primary and 2 node standby arrangement.
If we do not require standby site, then I would be estimating 10 days of work to install the same. With Data-guard, I would estimate 15 days.

To make the installation smooth, Please see below the high level Hardware, Network and OS requirement for the same.

"	64 bit RHEL version 5.8 kernel 2.6.18-308.4.1.el5
"	2 Physical Machines with 40 core cpu, 250 GB Ram each.
"	250 GB of storage on each node for binaries
"	900 GB of shared storage of raw devices with each of device 40 GB .
"	750 GB of storage on first node for all backups.
"	Two network interface cards (NIC), or network adapters. (one for private and another one for public network between nodes)
"	2 free Ip's on private network for each node
"	On public network, 2 public IP, 2 Vitual IP and 3 SCAN IP's all resolving to one hostname using multicast Domain Name Server (mDNS)
"	X- display for GUI installation.


############################  Stopping the Oracle RAC 10g Environment

The first step is to stop the Oracle instance. When the instance (and related services) is down, then bring down the ASM instance. Finally, shut down the node applications (Virtual IP, GSD, TNS Listener, and ONS).

$ export ORACLE_SID=orcl1
$ emctl stop dbconsole
$ srvctl stop instance -d orcl -i orcl1
$ srvctl stop asm -n linux1
$ srvctl stop nodeapps -n linux1

Starting the Oracle RAC 10g Environment

The first step is to start the node applications (Virtual IP, GSD, TNS Listener, and ONS). When the node applications are successfully started, then bring up the ASM instance. Finally, bring up the Oracle instance (and related services) and the Enterprise Manager Database console.

$ export ORACLE_SID=orcl1
$ srvctl start nodeapps -n linux1
$ srvctl start asm -n linux1
$ srvctl start instance -d orcl -i orcl1
$ emctl start dbconsole

Start/Stop All Instances with SRVCTL

Start/stop all the instances and their enabled services. I have included this step just for fun as a way to bring down all instances!

$ srvctl start database -d orcl

$ srvctl stop database -d orcl



srvctl status database -d mercury

srvctl start database -d mercury


######################### RAC TROUBLESHOOTING
$GRID_HOME/log/rac1/cssd/ocssd.log


########################## Stopping RAC/Clusterware stack on 11.2



Stopping RAC and Cluster stack without use of force options.
1.Status before the shutdown

HA Resource                                   Target     State
-----------                                   ------     -----
ora.CLUSTERDG.dg                              ONLINE     ONLINE on hpc1
ora.DATA.dg                                   ONLINE     ONLINE on hpc1
ora.FLASH.dg                                  ONLINE     ONLINE on hpc1
ora.LISTENER.lsnr                             ONLINE     ONLINE on hpc1
ora.LISTENER_SCAN1.lsnr                       ONLINE     ONLINE on hpc1
ora.asm                                       ONLINE     ONLINE on hpc1
ora.clusdb.db                                 ONLINE     ONLINE on hpc1
ora.eons                                      ONLINE     ONLINE on hpc1
ora.gsd                                       OFFLINE    OFFLINE
ora.hpc1.vip                                  ONLINE     ONLINE on hpc1
ora.net1.network                              ONLINE     ONLINE on hpc1
ora.oc4j                                      OFFLINE    OFFLINE
ora.ons                                       ONLINE     ONLINE on hpc1
ora.registry.acfs                             ONLINE     ONLINE on hpc1
ora.scan1.vip                                 ONLINE     ONLINE on hpc1

2. Shutdown one RAC component at time. Some components have dependencies and using force option (appending -f) would resolve those issues. But here each dependent component is shutdown beforehand.

srvctl stop database -d clusdb
srvctl stop listener -n hpc1
srvctl stop vip -n hpc1
srvctl stop scan_listener -i 1
srvctl stop scan -i 1
srvctl stop diskgroup -g DATA -n hpc1
srvctl stop diskgroup -g flash -n hpc1
srvctl stop nodeapps -n hpc1
srvctl stop diskgroup -g clusterdg -n hpc1


-- stop all rac structure  at once
/crsctl stop cluster -n rac1
/crsctl stop cluster -n rac2


-- check high availability service
crsctl check has

crsctl start/stop has ( high availability service)

3. After this ora.registry.acfs and ora.asm would be the only components running and those cannot be stopped srvctl. Use crsctl as root to stop the acfs registry

crsctl stop resource ora.registry.acfs
CRS-2673: Attempting to stop 'ora.registry.acfs' on 'hpc1'
CRS-2677: Stop of 'ora.registry.acfs' on 'hpc1' succeeded

4. ora.asm cannot be stopped with either crsctl as root nor as srvctl even with force option.

srvctl stop asm -n hpc1 -f
PRCR-1014 : Failed to stop resource ora.asm
PRCR-1065 : Failed to stop resource ora.asm
CRS-2673: Attempting to stop 'ora.asm' on 'hpc1'
ORA-15097: cannot SHUTDOWN ASM instance with connected client
CRS-2675: Stop of 'ora.asm' on 'hpc1' failed

crsctl stop resource ora.asm
CRS-2673: Attempting to stop 'ora.asm' on 'hpc1'
CRS-2673: Attempting to stop 'ora.asm' on 'hpc1'
ORA-15097: cannot SHUTDOWN ASM instance with connected client
CRS-2675: Stop of 'ora.asm' on 'hpc1' failed
CRS-2675: Stop of 'ora.asm' on 'hpc1' failed
CRS-4000: Command Stop failed, or completed with errors.

After execution of these commands state of various rac components would be

HA Resource                                   Target     State
-----------                                   ------     -----
ora.CLUSTERDG.dg                              OFFLINE    OFFLINE
ora.DATA.dg                                   OFFLINE    OFFLINE
ora.FLASH.dg                                  OFFLINE    OFFLINE
ora.LISTENER.lsnr                             OFFLINE    OFFLINE
ora.LISTENER_SCAN1.lsnr                       OFFLINE    OFFLINE
ora.asm                                       OFFLINE    ONLINE on hpc1
ora.clusdb.db                                 OFFLINE    OFFLINE
ora.eons                                      OFFLINE    OFFLINE
ora.gsd                                       OFFLINE    OFFLINE
ora.hpc1.vip                                  OFFLINE    OFFLINE
ora.net1.network                              OFFLINE    OFFLINE
ora.oc4j                                      OFFLINE    OFFLINE
ora.ons                                       OFFLINE    OFFLINE
ora.registry.acfs                             OFFLINE    OFFLINE
ora.scan1.vip                                 OFFLINE    OFFLINE

Interestingly clusterdg is the asm diskgroup which has the ocr and vote disks. It seem diskgroup being in a mount or unmount state is irrelevant to access ocr and vote disk as long as ASM instnace is running cluster seem to function.

5. Stop the clusterware stack with

crsctl stop cluster
CRS-2673: Attempting to stop 'ora.crsd' on 'hpc1'
CRS-2790: Starting shutdown of Cluster Ready Services-managed resources on 'hpc1'
CRS-2673: Attempting to stop 'ora.asm' on 'hpc1'
CRS-2677: Stop of 'ora.asm' on 'hpc1' succeeded
CRS-2792: Shutdown of Cluster Ready Services-managed resources on 'hpc1' has completed
CRS-2677: Stop of 'ora.crsd' on 'hpc1' succeeded
CRS-2673: Attempting to stop 'ora.cssdmonitor' on 'hpc1'
CRS-2673: Attempting to stop 'ora.ctssd' on 'hpc1'
CRS-2673: Attempting to stop 'ora.evmd' on 'hpc1'
CRS-2673: Attempting to stop 'ora.asm' on 'hpc1'
CRS-2677: Stop of 'ora.cssdmonitor' on 'hpc1' succeeded
CRS-2677: Stop of 'ora.evmd' on 'hpc1' succeeded
CRS-2677: Stop of 'ora.asm' on 'hpc1' succeeded
CRS-2677: Stop of 'ora.ctssd' on 'hpc1' succeeded
CRS-2673: Attempting to stop 'ora.cssd' on 'hpc1'
CRS-2677: Stop of 'ora.cssd' on 'hpc1' succeeded
CRS-2673: Attempting to stop 'ora.diskmon' on 'hpc1'
CRS-2677: Stop of 'ora.diskmon' on 'hpc1' succeeded

6. Stop the oracle high availability services with

crsctl stop crs
CRS-2791: Starting shutdown of Oracle High Availability Services-managed resources on 'hpc1'
CRS-2673: Attempting to stop 'ora.mdnsd' on 'hpc1'
CRS-2673: Attempting to stop 'ora.drivers.acfs' on 'hpc1'
CRS-2673: Attempting to stop 'ora.gpnpd' on 'hpc1'
CRS-2677: Stop of 'ora.drivers.acfs' on 'hpc1' succeeded
CRS-2677: Stop of 'ora.mdnsd' on 'hpc1' succeeded
CRS-2677: Stop of 'ora.gpnpd' on 'hpc1' succeeded
CRS-2673: Attempting to stop 'ora.gipcd' on 'hpc1'
CRS-2677: Stop of 'ora.gipcd' on 'hpc1' succeeded
CRS-2793: Shutdown of Oracle High Availability Services-managed resources on 'hpc1' has completed
CRS-4133: Oracle High Availability Services has been stopped.


bsatest

################ RAC

-- database
./srvctl status database -d bnatest
./srvctl start database -d bnatest

-- cluster 
crsctl check cluster
crsctl start cluster
crsctl stop cluster
./crsctl status resource -t   --> root  grid directory¿¡¼­ (/opt/app/grid/11202/bin in telstra batmablab)

-- cluster db ¸ðµç °ÍÀ» start/stop ÇÏ·Á¸é (telstra)
crsctl start/stop has (-f) force Àß ³»·Á°¡Áö ¾ÊÀ» ¶§ °­Á¦ Á¾·á -f ¿É¼Ç


srvctl config scan
srvctl status scan
srvctl status scan_listener
srvctl stop/start scan


cluvfy comp nodeapp -n all -verbose

rootcrs.pl -deconfig -force  -- when root.sh fails, deconfig and rerun

    crsctl check cluster
    crsctl start cluster
    crsctl stop cluster

./crsctl status resource -t


crs_stat
	
crsctl check cluster -all

crsctl stat res -t

crs_register
	
crsctl add resource

crsctl add type

crsctl modify resource

crsctl modify type

crs_unregister
	
crsctl stop resource

crsctl modify resource resource_name -attr "AUTO_START=never"

crs_start
	
crsctl start resource

crsctl start crs

crsctl start cluster

crs_stop
	
crsctl stop resource

crsctl stop crs

crsctl stop cluster

crs_getperm
	
crsctl getperm resource

crsctl getperm type

crs_profile
	
crsctl add resource

crsctl add type

crsctl status resource

crsctl status type

crsctl modify resource

crsctl modify type

crs_relocate
	
crsctl relocate resource

crs_setperm
	
crsctl setperm resource

crsctl setperm type

crsctl check crsd
	
crsctl check crs

crsctl check cssd
	
crsctl check css

crsctl check evmd
	
crsctl check evm


crsctl debug res log resource_name:level
	
crsctl set log

crsctl set css votedisk
	
crsctl add css votedisk

crsctl delete css votedisk

crsctl query css votedisk

crsctl replace css votedisk

crsctl start resources
	
crsctl start resource -all

crsctl stop resources
	

crsctl stop resource -all


################ RAC INSTALL
RVF-4567 : Failed to check existence of VIP node application on nodes
In case of RAC database installation in 11g (11.2.0.2) vip service in case not created , during post installation steps using clufy if vip nodes not created

# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1 localhost.localdomain localhost

## RAC cluster nodes
168.40.171.120 test-poc-100.cisco.com test-poc-100
168.40.171.127 test-poc-101.cisco.com test-poc-101
168.40.171.165 test-poc-102.cisco.com test-poc-102

## VIPS
168.40.171.124 test-poc-100-vip.cisco.com test-poc-100-vip
168.40.171.154 test-poc-101-vip.cisco.com test-poc-101-vip
168.40.171.166 test-poc-102-vip.cisco.com test-poc-102-vip

## RAC IPS
10.101.176.116 test-poc-100-rac.cisco.com test-poc-100-rac
10.101.176.117 test-poc-101-rac.cisco.com test-poc-101-rac
10.101.176.118 test-poc-102-rac.cisco.com test-poc-102-rac
##SCAN IPS
#168.40.171.171 testpoc-scan.cisco.com testpoc-scan
#168.40.171.172 testpoc-scan.cisco.com testpoc-scan

# Single Client Access Name (SCAN) 

ERROR found
===============

Checking existence of VIP node application (required)
Node Name Required Running? Comment
------------ ------------------------ ------------------------ ----------
test-poc-102 yes no does not exist
test-poc-101 yes no does not exist
test-poc-100 yes yes passed
PRVF-4567 : Failed to check existence of VIP node application on nodes "test-poc-102,test-poc-101"


Steps to create vip nodes

srvctl add vip -n node7 -A 192.168.16.17/255.255.255.0 -k 2 a` just a sample command. Pls replace strings appropriately


Usage: srvctl add vip -n -k -A //[if1[if2...]] [-v]!
-n Node name
-A //[if1[if2...]] VIP address spec for node applications
-k VIP network number (default number is 1)


srvctl add vip -n test-poc-101 -A 168.40.171.154/255.255.255.0 -k 1
srvctl add vip -n test-poc-102 -A 168.40.171.166/255.255.255.0 -k 1

srvctl start vip -n test-poc-101
srvctl start vip -n test-poc-102 


######################## DBMS_AUTO_SQLTUNE
DBMS_AUTO_SQLTUNE

######################## local listener

alter system set local_listener='(DESCRIPTION=
(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.0.61)(PORT=1521))
(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.0.61)(PORT=2011))))' 
scope=BOTH SID='OCRL1';

local_listener                       string      (DESCRIPTION=(ADDRESS_LIST=(AD
                                                 DRESS=(PROTOCOL=TCP)(HOST=10.9
                                                 6.161.70)(PORT=1521))))
                                                 
Listener Parameter File   /opt/app/grid/11202/network/admin/listener.ora
Listener Log File         /opt/app/oracle/admin/diag/tnslsnr/fllxnpodb001/listener/alert/log.xml


######################## ASM

SELECT * FROM v$asm_file;

select * from rc_database;

select name from V$ASM_DISKGROUP;
select * from V$ASM_DISKGROUP;

select group_number, disk_number, name, mount_status, path, total_mb 2 from v$asm_disk;

################### 11g asm



srvctl stop asm


ASMÀÇ spfileÀ» pfile·Î ¸¸µé°í ´Ù½Ã ASM¿¡ spfile·Î ÀúÀåÇÏ±â.
ASM 2012/03/01 18:44 Posted by Å¸¿ï

¸ñÂ÷

Å×½ºÆ® È¯°æ
pfile »ý¼º
asm¿¡ spfile »ý¼º 
 

Å×½ºÆ® È¯°æ

ORACLE_HOME = /home/oracle/
SID = testdb
ASM SID = +ASM
DISK GROUP = +DATA


ASMÀ¸·Î ±¸ÃàµÇ¾î ÀÖ´Â parameter fileÀÇ parameter ¸¦ ¼öÁ¤ÇÏ·Á°í ÇÑ´Ù.
(¹°·Ð alter system set .. ÀÇ ¸í·ÉÀ¸·Î ¼öÁ¤ÀÌ °¡´ÉÇÏ´Ù.)

±âÁ¸ÀÇ ÆÄ¶ó¹ÌÅÍ ÆÄÀÏÀÇ À§Ä¡·Î °¡º¸¸é 10gÀÓ¿¡µµ ºÒ±¸ÇÏ°í spfileSID.ora ÆÄÀÏÀÌ Á¸Àç ÇÏÁö ¾Ê°í pfile¸¸ Á¸ÀçÇÑ´Ù. ¿­¾îº¸¸é ³»¿ëÀº ¾Æ·¡¿Í °°ÀÌ ASMÀÇ spfileSID.ora ÀÇ À§Ä¡¸¦ °¡¸®Å°°í ÀÖ´Ù.

$ vi /home/oracle/product/10g/dbs/inittestdb.ora

SPFILE='+DATA/testdb/spfiletestdb.ora' 

 
ÀÛ¾÷¼ø¼­

pfile »ý¼º
- pfile ÆÄ¶ó¹ÌÅÍ º¯°æ
spfile »ý¼º
asmcmd ½ÇÇà
±âÁ¸ spfile alias »èÁ¦
»õ·Î¿î spfile alias »ý¼º


pfile »ý¼º

create pfile[=path] from spfile; 

pfileÀ» ¼öÁ¤ÇÏ±â À§ÇØ ¾Æ·¡¿Í °°ÀÌ pfileÀ» »ý¼ºÇÑ´Ù.

(path´Â ¿É¼ÇÀÌÁö¸¸ ±âÁ¸ pfileÀ» µ¤¾î¾²±â ¶§¹®¿¡ spfileÀÇ À§Ä¡¸¦ °¡¸£Å°´Â ¿øº»À» ¹é¾÷ ¶Ç´Â ÀÌ·¸°Ô path ¿É¼ÇÀ¸·Î ´Ù¸¥ÀÌ¸§À¸·Î ¸¸µç´Ù.)

 »ý¼ºµÈ pfile ÀÇ ÆÄ¶ó¹ÌÅÍ °ªÀ» ¼öÁ¤ÇÑ´Ù.



spfile »ý¼º 
¼öÁ¤µÈ pfileÀ» ASM ¿¡ ÀúÀåÇÏ±â À§ÇØ¼­´Â ÀúÀå À§Ä¡·Î ASM ÀúÀå¼Ò¸¦ °¡¸®Å²´Ù. 
SQL> create spfile='+DATA' from pfile;



asmcmd ¸¦ ÀÌ¿ëÇÏ¿© alias  »ý¼º
$ export ORACLE_SID=+ASM
$ asmcmd

ASMCMD> cd +DATA/TESTDB
ASMCMD> ls

CONTROLFILE/
DATAFILE/
ONLINELOG/
PARAMETERFILE/
TEMPFILE/
spfiletestdb.ora


ASMCMD> ls parameterfile

spfile.265.776319301
spfile.266.776334803
spfile.267.776334921
spfile.268.776335521


ÃÖ±Ù¿¡ »ý¼ºÇÑ spfile ÀÌ °¡Àå ¾Æ·¡¿¡ ÀÖ´Â ÆÄÀÏÀÌ´Ù. +DATA/TESTDB/spfiledb.ora ÆÄÀÏÀÌ ÃÖ±Ù Ãß°¡ÇÑ spfileÀ» ´ëº¯ÇÏµµ·Ï ÇØ¾ßÇÑ´Ù.

ASMCMD> rmalias spfiletestdb.ora
ASMCMD> mkalias +DATA/TESTDB/spfile.268.776335521 spfiletestdb.ora

ASMCMD> ls -l

Type           Redund  Striped  Time             Sys  Name
                                                 Y    CONTROLFILE/
                                                 Y    DATAFILE/
                                                 Y    ONLINELOG/
                                                 Y    PARAMETERFILE/
                                                 Y    TEMPFILE/
                                                 N    spfiletestdb.ora => +DATA/TESTDB/PARAMETERFILE/spfile.267.776334921


ASMCMD> exit

ASMÀÇ spfiledb.ora·Î °æ·Î ÁöÁ¤
# vi /home/oracle/product/10g/dbs/inittestdb.ora

SPFILE='+DATA/testdb/spfiletestdb.ora'  

¼­¹ö Àç½ÃÀÛ
$ export ORACLE_SID=testdb
$ sqlplus / as sysdba
$ startup [pfile=path]



############# asmcmd
asmcmd ÀÌ¿ëÇÏ¿© asm µð½ºÅ© ¿µ¿ª ls, rm µî ¸í·É¾î·Î ºê¶ó¿ìÂ¡, »èÁ¦, Ä«ÇÇ µî °¡´É.

######################## RAC  CRS  °¡¿ë¼º

-- CRS ±âµ¿ ¸í·É¾î
root À¯Àú·Î

cd /oracle/product/10.2.0/crs/bin
 
./crsctl stop crs

./crsctl start crs

-- CRS »óÅÂ Á¶È¸
[nossdb2:PUOS2:/oracle] crs_stat -t
Name           Type           Target    State     Host
------------------------------------------------------------
ora....S1.inst application    ONLINE    OFFLINE
ora....S2.inst application    ONLINE    ONLINE    nossdb2
ora.PUOS.db    application    ONLINE    ONLINE    nossdb2
ora....B1.lsnr application    ONLINE    OFFLINE
ora....db1.gsd application    ONLINE    OFFLINE
ora....db1.ons application    ONLINE    OFFLINE
ora....db1.vip application    ONLINE    OFFLINE
ora....B2.lsnr application    ONLINE    ONLINE    nossdb2
ora....db2.gsd application    ONLINE    ONLINE    nossdb2
ora....db2.ons application    ONLINE    ONLINE    nossdb2
ora....db2.vip application    ONLINE    ONLINE    nossdb2
[nossdb2:PUOS2:/oracle] crs_stat -t
Name           Type           Target    State     Host
------------------------------------------------------------
ora....S1.inst application    ONLINE    ONLINE    nossdb1
ora....S2.inst application    ONLINE    ONLINE    nossdb2
ora.PUOS.db    application    ONLINE    ONLINE    nossdb2
ora....B1.lsnr application    ONLINE    ONLINE    nossdb1
ora....db1.gsd application    ONLINE    ONLINE    nossdb1
ora....db1.ons application    ONLINE    ONLINE    nossdb1
ora....db1.vip application    ONLINE    ONLINE    nossdb1
ora....B2.lsnr application    ONLINE    ONLINE    nossdb2
ora....db2.gsd application    ONLINE    ONLINE    nossdb2
ora....db2.ons application    ONLINE    ONLINE    nossdb2
ora....db2.vip application    ONLINE    ONLINE    nossdb2
you have mail in /var/mail/oracle
[nossdb2:PUOS2:/oracle]

-- pmon ¹é±×¶ó¿îµå ÇÁ·Î¼¼½º È®ÀÎ

[nossdb1:PUOS2:/oracle] ps -ef | grep ora_pmon | grep -v grep
  oracle 26091     1  0  Nov 27  ?         2:02 ora_pmon_PUOS1
  oracle  3274     1  0  Nov 26  ?         2:24 ora_pmon_MUOS1

-- alert log È®ÀÎ
egistered with NM - instance id 1 (internal mem no 0)
Mon Nov 28 21:59:13 KST 2011
Reconfiguration started (old inc 0, new inc 16)
Dynamic remastering is disabled
List of nodes:
 0 1
 Global Resource Directory frozen
* allocate domain 0, invalid = TRUE
 Communication channels reestablished
 * domain 0 valid according to instance 1
 * domain 0 valid = 1 according to instance 1
Mon Nov 28 21:59:13 KST 2011
 Master broadcasted resource hash value bitmaps
 Non-local Process blocks cleaned out
Mon Nov 28 21:59:13 KST 2011
 LMS 0: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 21:59:13 KST 2011
 LMS 3: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 21:59:13 KST 2011
 LMS 2: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 21:59:13 KST 2011
 LMS 1: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 21:59:13 KST 2011
 LMS 4: 0 GCS shadows cancelled, 0 closed
 Set master node info
 Submitted all remote-enqueue requests
 Dwn-cvts replayed, VALBLKs dubious
 All grantable enqueues granted
Mon Nov 28 21:59:16 KST 2011
 LMS 3: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 21:59:16 KST 2011
 LMS 0: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 21:59:16 KST 2011
 LMS 2: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 21:59:16 KST 2011
 LMS 1: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 21:59:16 KST 2011
 LMS 4: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 21:59:16 KST 2011
 Submitted all GCS remote-cache requests
 Post SMON to start 1st pass IR
 Fix write in gcs resources
Reconfiguration complete
LCK0 started with pid=25, OS id=25394
Mon Nov 28 21:59:20 KST 2011
ALTER DATABASE   MOUNT
Mon Nov 28 21:59:25 KST 2011
Setting recovery target incarnation to 2
Mon Nov 28 21:59:29 KST 2011
Successful mount of redo thread 1, with mount id 3341830175
Mon Nov 28 21:59:29 KST 2011
Database mounted in Shared Mode (CLUSTER_DATABASE=TRUE)
Completed: ALTER DATABASE   MOUNT
Mon Nov 28 21:59:29 KST 2011
ALTER DATABASE OPEN
Picked broadcast on commit scheme to generate SCNs
Mon Nov 28 21:59:30 KST 2011
Thread 1 opened at log sequence 14
  Current log# 7 seq# 14 mem# 0: /dev/dg_nossdb_redo1ar/rredo_puos1_07A
  Current log# 7 seq# 14 mem# 1: /dev/dg_nossdb_redo1br/rredo_puos1_07B
Successful open of redo thread 1
Mon Nov 28 21:59:30 KST 2011
MTTR advisory is disabled because FAST_START_MTTR_TARGET is not set
Mon Nov 28 21:59:30 KST 2011
SMON: enabling cache recovery
Mon Nov 28 21:59:30 KST 2011
Successfully onlined Undo Tablespace 1.
Mon Nov 28 21:59:30 KST 2011
SMON: enabling tx recovery
Mon Nov 28 21:59:30 KST 2011
Database Characterset is KO16MSWIN949
Opening with internal Resource Manager plan
replication_dependency_tracking turned off (no async multimaster replication found)
Starting background process QMNC
QMNC started with pid=67, OS id=25556
Mon Nov 28 21:59:32 KST 2011
Completed: ALTER DATABASE OPEN
you have mail in /var/mail/oracle
[nossdb1:PUOS1:/logs001/PUOS1/bdump]

-- PUOS2 node Å×½ºÆ®
Mon Nov 28 22:02:59 KST 2011
Shutting down instance (abort)
License high water mark = 192
Instance terminated by USER, pid = 8668
Mon Nov 28 22:03:10 KST 2011
Starting ORACLE instance (normal)
LICENSE_MAX_SESSION = 0
LICENSE_SESSIONS_WARNING = 0
Interface type 1 lan901 172.29.21.0 configured from OCR for use as a cluster interconnect
Interface type 1 lan900 172.21.251.0 configured from OCR for use as  a public interface
Picked latch-free SCN scheme 3
Autotune of undo retention is turned off.
LICENSE_MAX_USERS = 0
SYS auditing is disabled
kxfpnfy: Adjusting parallel execution message size to 32768 bytes to conform to IPC OSD message size limit
ksdpec: called for event 13740 prior to event group initialization
Starting up ORACLE RDBMS Version: 10.2.0.5.0.
System parameters with non-default values:
  processes                = 1000
  sessions                 = 1105
  instance_groups          = PUOS2
  sga_max_size             = 32212254720
  _enable_NUMA_optimization= FALSE
  shared_pool_size         = 3221225472
  large_pool_size          = 1073741824
  shared_pool_reserved_size= 419430400
  _first_spare_parameter   = 1
  _object_statistics       = TRUE
  sga_target               = 0
  control_files            = /dev/dg_nossdb_ctl01r/rctl_puos_01, /dev/dg_nossdb_ctl02r/rctl_puos_02, /dev/dg_no
ssdb_ctl03r/rctl_puos_03
  db_block_size            = 8192
  db_cache_size            = 16106127360
  _db_block_numa           = 1
  db_keep_cache_size       = 2147483648
  compatible               = 10.2.0.5.0
  log_archive_dest_1       = LOCATION=/logs002/PUOS2/archive
  log_archive_format       = PUOS_%t_%s_%r.arc
  log_buffer               = 30939136
  db_files                 = 4000
  db_file_multiblock_read_count= 32
  cluster_database         = TRUE
  cluster_database_instances= 2
  _gc_undo_affinity        = FALSE
  _gc_affinity_time        = 0
  _gc_integrity_checks     = 0
  thread                   = 2
  recovery_parallelism     = 8
  dml_locks                = 5000
  instance_number          = 2
  undo_management          = AUTO
  undo_tablespace          = UNDOTBS2
  _undo_autotune           = FALSE
  resumable_timeout        = 7200
  _kks_use_mutex_pin       = FALSE
  remote_login_passwordfile= EXCLUSIVE
  db_domain                =
  distributed_lock_timeout = 310
  dispatchers              = (PROTOCOL=TCP) (SERVICE=PUOSXDB)
  local_listener           = (ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=nossdb2-vip)(PORT=2521)))
  session_cached_cursors   = 100
  job_queue_processes      = 10
  parallel_min_servers     = 40
  parallel_max_servers     = 400
  parallel_instance_group  = PUOS2
  parallel_execution_message_size= 32768
  _PX_use_large_pool       = TRUE
  _parallel_min_message_pool= 64560
  _table_lookup_prefetch_size= 0
  _table_lookup_prefetch_thresh= 99999999
  _query_execution_cache_max_size= 4292608
  background_dump_dest     = /logs001/PUOS2/bdump
  user_dump_dest           = /logs001/PUOS2/udump
  core_dump_dest           = /logs001/PUOS2/cdump
  audit_file_dest          = /logs001/PUOS2/adump
  open_links               = 50
  optimizer_features_enable= 10.2.0.5
  db_name                  = PUOS
  open_cursors             = 300
  optimizer_mode           = first_rows_10
  _b_tree_bitmap_plans     = FALSE
  _fast_full_scan_enabled  = TRUE
  _optimizer_skip_scan_enabled= FALSE
  parallel_adaptive_multi_user= FALSE
  optimizer_index_cost_adj = 35
  optimizer_index_caching  = 90
  query_rewrite_enabled    = true
  _index_join_enabled      = FALSE
  _optim_peek_user_binds   = FALSE
  pga_aggregate_target     = 20971520000
  optimizer_dynamic_sampling= 0
  _b_tree_bitmap_plans     = FALSE
  _fast_full_scan_enabled  = TRUE
  _optimizer_skip_scan_enabled= FALSE
  parallel_adaptive_multi_user= FALSE
  optimizer_index_cost_adj = 35
  optimizer_index_caching  = 90
  query_rewrite_enabled    = true
  _index_join_enabled      = FALSE
  _optim_peek_user_binds   = FALSE
  pga_aggregate_target     = 20971520000
  optimizer_dynamic_sampling= 0
  _optimizer_push_pred_cost_based= FALSE
  _optimizer_sortmerge_join_enabled= TRUE
  _bloom_filter_enabled    = FALSE
  optimizer_secure_view_merging= FALSE
Cluster communication is configured to use the following interface(s) for this instance
  172.29.21.202
Mon Nov 28 22:03:14 KST 2011
cluster interconnect IPC version:Oracle UDP/IP (generic)
IPC Vendor 1 proto 2
PMON started with pid=2, OS id=9414
DIAG started with pid=3, OS id=9590
PSP0 started with pid=4, OS id=9592
LMON started with pid=5, OS id=9595
LMD0 started with pid=6, OS id=9602
LMS0 started with pid=7, OS id=9604
LMS1 started with pid=8, OS id=9606
LMS2 started with pid=9, OS id=9608
LMS3 started with pid=10, OS id=9610
LMS4 started with pid=11, OS id=9612
MMAN started with pid=12, OS id=9614
DBW0 started with pid=13, OS id=9616
DBW1 started with pid=14, OS id=9618
DBW2 started with pid=15, OS id=9620
LGWR started with pid=16, OS id=9627
CKPT started with pid=17, OS id=9629
SMON started with pid=18, OS id=9631
RECO started with pid=19, OS id=9633
CJQ0 started with pid=20, OS id=9635
MMON started with pid=21, OS id=9637
Mon Nov 28 22:03:39 KST 2011
starting up 1 dispatcher(s) for network address '(ADDRESS=(PARTIAL=YES)(PROTOCOL=TCP))'...
MMNL started with pid=22, OS id=9639
Mon Nov 28 22:03:39 KST 2011
starting up 1 shared server(s) ...
Mon Nov 28 22:03:41 KST 2011
lmon registered with NM - instance id 2 (internal mem no 1)
Mon Nov 28 22:03:42 KST 2011
Reconfiguration started (old inc 0, new inc 20)
Dynamic remastering is disabled
List of nodes:
 0 1
 Global Resource Directory frozen
* allocate domain 0, invalid = TRUE
 Communication channels reestablished
 * domain 0 valid = 1 according to instance 0
Mon Nov 28 22:03:42 KST 2011
 Master broadcasted resource hash value bitmaps
 Non-local Process blocks cleaned out
Mon Nov 28 22:03:42 KST 2011
 LMS 0: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:03:42 KST 2011
 LMS 3: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:03:42 KST 2011
 LMS 1: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:03:42 KST 2011
 LMS 2: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:03:42 KST 2011
 LMS 4: 0 GCS shadows cancelled, 0 closed
 Set master node info
 Submitted all remote-enqueue requests
 Dwn-cvts replayed, VALBLKs dubious
 All grantable enqueues granted
Mon Nov 28 22:03:42 KST 2011
 LMS 2: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:03:42 KST 2011
 LMS 4: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:03:42 KST 2011
 LMS 0: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:03:42 KST 2011
 LMS 3: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:03:42 KST 2011
 LMS 1: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:03:42 KST 2011
 Submitted all GCS remote-cache requests
 Fix write in gcs resources
Reconfiguration complete
LCK0 started with pid=25, OS id=9666
Mon Nov 28 22:03:43 KST 2011
ALTER DATABASE   MOUNT
Mon Nov 28 22:03:47 KST 2011
Setting recovery target incarnation to 2
Mon Nov 28 22:03:52 KST 2011
Successful mount of redo thread 2, with mount id 3341830175
Mon Nov 28 22:03:52 KST 2011
Database mounted in Shared Mode (CLUSTER_DATABASE=TRUE)
Completed: ALTER DATABASE   MOUNT
Mon Nov 28 22:03:52 KST 2011
ALTER DATABASE OPEN
Picked broadcast on commit scheme to generate SCNs
Mon Nov 28 22:03:52 KST 2011
Thread 2 opened at log sequence 16
  Current log# 9 seq# 16 mem# 0: /dev/dg_nossdb_redo2ar/rredo_puos2_02A
  Current log# 9 seq# 16 mem# 1: /dev/dg_nossdb_redo2br/rredo_puos2_02B
Successful open of redo thread 2
Mon Nov 28 22:03:52 KST 2011
MTTR advisory is disabled because FAST_START_MTTR_TARGET is not set
Mon Nov 28 22:03:52 KST 2011
SMON: enabling cache recovery
Mon Nov 28 22:03:53 KST 2011
Successfully onlined Undo Tablespace 4.
Mon Nov 28 22:03:53 KST 2011
SMON: enabling tx recovery
Mon Nov 28 22:03:53 KST 2011
Database Characterset is KO16MSWIN949
Opening with internal Resource Manager plan
replication_dependency_tracking turned off (no async multimaster replication found)
Starting background process QMNC
QMNC started with pid=68, OS id=9850
Mon Nov 28 22:03:55 KST 2011
Completed: ALTER DATABASE OPEN
Mon Nov 28 22:04:05 KST 2011
streams_pool_size defaulting to 322122547
streams_pool_size defaulting to 322122547. Trying to get it from Buffer Cache for process 10577.
Mon Nov 28 22:04:05 KST 2011
ALTER SYSTEM SET service_names='SYS$SYS.KUPC$S_2_20111128153240.PUOS' SCOPE=MEMORY SID='PUOS2';

  
-- listener ÇÁ·Î¼¼½º È®ÀÎ

[nossdb1:PUOS1:/oracle] ps -ef | grep tns | grep -v grep
  oracle 14133     1  0 20:33:20 ?         0:01 /oracle/product/10.2.0/db/bin/tnslsnr LISTENER_NOSSDB1 -inherit

  [nossdb1:PUOS1:/oracle] date
Mon Nov 28 22:46:25 KST 2011
[nossdb1:PUOS1:/oracle] ps -ef | grep tns | grep -v grep
  oracle 14133     1  0 20:33:20 ?         0:04 /oracle/product/10.2.0/db/bin/tnslsnr LISTENER_NOSSDB1 -inherit
[nossdb1:PUOS1:/oracle] kill -9 14133
[nossdb1:PUOS1:/oracle]

[nossdb1:PUOS1:/oracle] date < º¹±¸ ½Ã°£.
Mon Nov 28 22:51:17 KST 2011
[nossdb1:PUOS1:/oracle]


[nossdb2:PUOS2:/oracle] crs_stat -t
Name           Type           Target    State     Host
------------------------------------------------------------
ora....S1.inst application    ONLINE    ONLINE    nossdb1
ora....S2.inst application    ONLINE    ONLINE    nossdb2
ora.PUOS.db    application    ONLINE    ONLINE    nossdb2
ora....B1.lsnr application    ONLINE    OFFLINE
ora....db1.gsd application    ONLINE    ONLINE    nossdb1
ora....db1.ons application    ONLINE    ONLINE    nossdb1
ora....db1.vip application    ONLINE    ONLINE    nossdb1
ora....B2.lsnr application    ONLINE    ONLINE    nossdb2
ora....db2.gsd application    ONLINE    ONLINE    nossdb2
ora....db2.ons application    ONLINE    ONLINE    nossdb2
ora....db2.vip application    ONLINE    ONLINE    nossdb2
you have mail in /var/mail/oracle
[nossdb2:PUOS2:/oracle] netstat -in
Name      Mtu  Network         Address         Ipkts              Ierrs Opkts              Oerrs Coll
lo0      32808 127.0.0.0       127.0.0.1       163420             0     163421             0     0
lan903    1500 172.29.22.0     172.29.22.202   55                 0     94                 0     0
lan902    1500 172.21.240.0    172.21.240.212  22699              0     94                 0     0
lan901    9000 172.29.21.0     172.29.21.202   18314824           0     18813780           0     0
lan900    1500 172.21.251.0    172.21.251.28   51630              0     3658386            0     0
lan11     1500 10.250.4.0      10.250.4.120    1454               0     223                0     0
lan900:1  1500 172.21.251.0    172.21.251.27   5584954            0     710                0     0
[nossdb2:PUOS2:/oracle]

[nossdb1:PUOS1:/oracle] crs_stat -t
Name           Type           Target    State     Host
------------------------------------------------------------
ora....S1.inst application    ONLINE    ONLINE    nossdb1
ora....S2.inst application    ONLINE    ONLINE    nossdb2
ora.PUOS.db    application    ONLINE    ONLINE    nossdb2
ora....B1.lsnr application    ONLINE    ONLINE    nossdb1
ora....db1.gsd application    ONLINE    ONLINE    nossdb1
ora....db1.ons application    ONLINE    ONLINE    nossdb1
ora....db1.vip application    ONLINE    ONLINE    nossdb1
ora....B2.lsnr application    ONLINE    ONLINE    nossdb2
ora....db2.gsd application    ONLINE    ONLINE    nossdb2
ora....db2.ons application    ONLINE    ONLINE    nossdb2
ora....db2.vip application    ONLINE    ONLINE    nossdb2
[nossdb1:PUOS1:/oracle] netstat -in
Name      Mtu  Network         Address         Ipkts              Ierrs Opkts              Oerrs Coll
lo0      32808 127.0.0.0       127.0.0.1       134853             0     134853             0     0
lan903    1500 172.29.22.0     172.29.22.201   11                 0     11                 0     0
lan902    1500 172.21.240.0    172.21.240.211  17970              0     0                  0     0
lan901    9000 172.29.21.0     172.29.21.201   17625373           0     17101008           0     0
lan900    1500 172.21.251.0    172.21.251.26   58107              0     456571             0     0
lan11     1500 10.250.4.0      10.250.4.119    772                0     0                  0     0
lan900:1  1500 172.21.251.0    172.21.251.25   528973             0     1116               0     0
[nossdb1:PUOS1:/oracle]


-- CRS ÇÁ·Î¼¼½º È®ÀÎ
  
[nossdb1:PUOS1:/oracle] ps -ef | grep crs | grep -v grep
  oracle 13043 12962  0 20:32:51 ?         0:00 /bin/sh -c cd /oracle/product/10.2.0/crs/log/nossdb1/cssd/oclsvmon; ulimit -c unlimited; /oracle/product/10.2.0/crs/bin/oclsvmo
  oracle 13044 13043  0 20:32:51 ?         0:00 /oracle/product/10.2.0/crs/bin/oclsvmon.bin
  oracle 13099 12968  0 20:32:51 ?         0:00 /bin/sh -c cd /oracle/product/10.2.0/crs/log/nossdb1/cssd/oclsomon; ulimit -c unlimited; /oracle/product/10.2.0/crs/bin/oclsomo
    root 12918  5754  0 20:32:50 ?         0:11 /oracle/product/10.2.0/crs/bin/crsd.bin reboot
    root  5754     1  0 20:27:17 ?         0:00 /bin/sh /sbin/init.d/init.crsd run
  oracle 12877  5751  0 20:32:50 ?         0:00 /oracle/product/10.2.0/crs/bin/evmd.bin
  oracle 13129 12980  0 20:32:51 ?         0:12 /oracle/product/10.2.0/crs/bin/ocssd.bin
  oracle 13984 12877  0 20:33:10 ?         0:00 /oracle/product/10.2.0/crs/bin/evmlogger.bin -o /oracle/product/10.2.0/crs/evm/log/evmlogger.info -l /oracle/product/10.2.0/crs
  oracle 13104 13099  0 20:32:51 ?         0:00 /oracle/product/10.2.0/crs/bin/oclsomon.bin
  oracle 15784     1  0 20:34:13 ?         0:00 /oracle/product/10.2.0/crs/opmn/bin/ons -d
  oracle 15785 15784  0 20:34:13 ?         0:00 /oracle/product/10.2.0/crs/opmn/bin/ons -d
  oracle 15845     1  0 20:34:18 ?         0:03 /oracle/product/10.2.0/crs/jdk/jre/bin/IA64W/java -DPROGRAM=gsd -classpath /oracle/product/10.2.0/crs/jlib/netcfg.jar:/oracle/p
[nossdb1:PUOS1:/oracle]

-- Àå¾Ö¹ß»ý : ¿À¶óÅ¬ CRS (ocssd) ÇÁ·Î¼¼½º Á¾·á
[nossdb1:PUOS1:/oracle] ps -ef | grep ocssd | grep -v grep
  oracle 13129 12980  0 20:32:51 ?         0:12 /oracle/product/10.2.0/crs/bin/ocssd.bin
[nossdb1:PUOS1:/oracle]

-- PUOS1 alertlog Ã¼Å©
Mon Nov 28 22:13:33 KST 2011
Error: KGXGN aborts the instance (6)
Mon Nov 28 22:13:33 KST 2011
USER: terminating instance due to error 481
Mon Nov 28 22:13:33 KST 2011
Errors in file /logs001/PUOS1/bdump/puos1_lmon_25261.trc:
ORA-29702: error occurred in Cluster Group Service operation
Mon Nov 28 22:13:33 KST 2011
System state dump is made for local instance
System State dumped to trace file /logs001/PUOS1/bdump/puos1_diag_25257.trc
Mon Nov 28 22:13:39 KST 2011
Instance terminated by USER, pid = 29740
Mon Nov 28 22:37:49 KST 2011
Starting ORACLE instance (normal)
LICENSE_MAX_SESSION = 0
LICENSE_SESSIONS_WARNING = 0
Interface type 1 lan901 172.29.21.0 configured from OCR for use as a cluster interconnect
Interface type 1 lan900 172.21.251.0 configured from OCR for use as  a public interface
Picked latch-free SCN scheme 3
Autotune of undo retention is turned off.
LICENSE_MAX_USERS = 0
SYS auditing is disabled
kxfpnfy: Adjusting parallel execution message size to 32768 bytes to conform to IPC OSD message size limit
ksdpec: called for event 13740 prior to event group initialization
Starting up ORACLE RDBMS Version: 10.2.0.5.0.
System parameters with non-default values:
  processes                = 1000
  sessions                 = 1105
  instance_groups          = PUOS1
  sga_max_size             = 32212254720
  _enable_NUMA_optimization= FALSE
  shared_pool_size         = 3221225472
  large_pool_size          = 1073741824
  shared_pool_reserved_size= 419430400
  _first_spare_parameter   = 1
  _object_statistics       = TRUE
  sga_target               = 0
  control_files            = /dev/dg_nossdb_ctl01r/rctl_puos_01, /dev/dg_nossdb_ctl02r/rctl_puos_02, /dev/dg_nossdb_ctl03r/rctl_puos_03
  db_block_size            = 8192
  db_cache_size            = 16106127360
  _db_block_numa           = 1
  db_keep_cache_size       = 2147483648
  compatible               = 10.2.0.5.0
  log_archive_dest_1       = LOCATION=/logs002/PUOS1/archive
  log_archive_format       = PUOS_%t_%s_%r.arc
  log_buffer               = 30939136
  db_files                 = 4000
  db_file_multiblock_read_count= 32
  cluster_database         = TRUE
  cluster_database_instances= 2
  _gc_undo_affinity        = FALSE
  _gc_affinity_time        = 0
  _gc_integrity_checks     = 0
  thread                   = 1
  recovery_parallelism     = 8
  dml_locks                = 5000
  instance_number          = 1
  undo_management          = AUTO
  undo_tablespace          = UNDOTBS1
  _undo_autotune           = FALSE
  resumable_timeout        = 7200
  _kks_use_mutex_pin       = FALSE
  remote_login_passwordfile= EXCLUSIVE
  db_domain                =
  distributed_lock_timeout = 310
  dispatchers              = (PROTOCOL=TCP) (SERVICE=PUOSXDB)
  local_listener           = (ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=nossdb1-vip)(PORT=2521)))
  session_cached_cursors   = 100
  job_queue_processes      = 10
  parallel_min_servers     = 40
  parallel_max_servers     = 400
  parallel_instance_group  = PUOS1
  parallel_execution_message_size= 32768
  _PX_use_large_pool       = TRUE
  _parallel_min_message_pool= 64560
  _table_lookup_prefetch_size= 0
  _table_lookup_prefetch_thresh= 99999999
  _query_execution_cache_max_size= 4292608
  background_dump_dest     = /logs001/PUOS1/bdump
  user_dump_dest           = /logs001/PUOS1/udump
  core_dump_dest           = /logs001/PUOS1/cdump
  audit_file_dest          = /logs001/PUOS1/adump
  open_links               = 50
  optimizer_features_enable= 10.2.0.5
  db_name                  = PUOS
  open_cursors             = 300
  optimizer_mode           = first_rows_10
  _b_tree_bitmap_plans     = FALSE
  _fast_full_scan_enabled  = TRUE
  _optimizer_skip_scan_enabled= FALSE
  parallel_adaptive_multi_user= FALSE
  optimizer_index_cost_adj = 35
  optimizer_index_caching  = 90
  query_rewrite_enabled    = true
  _index_join_enabled      = FALSE
  _optim_peek_user_binds   = FALSE
  pga_aggregate_target     = 20971520000
  optimizer_dynamic_sampling= 0
  _optimizer_push_pred_cost_based= FALSE
  _optimizer_sortmerge_join_enabled= TRUE
  _bloom_filter_enabled    = FALSE
  optimizer_secure_view_merging= FALSE
Cluster communication is configured to use the following interface(s) for this instance
  172.29.21.201
Mon Nov 28 22:37:54 KST 2011
cluster interconnect IPC version:Oracle UDP/IP (generic)
IPC Vendor 1 proto 2
PMON started with pid=2, OS id=5868
DIAG started with pid=3, OS id=6817
PSP0 started with pid=4, OS id=6828
LMON started with pid=5, OS id=6833
LMD0 started with pid=6, OS id=6842
LMS0 started with pid=7, OS id=6855
LMS1 started with pid=8, OS id=6857
LMS2 started with pid=9, OS id=6864
LMS3 started with pid=10, OS id=6866
LMS4 started with pid=11, OS id=6871
MMAN started with pid=12, OS id=6873
DBW0 started with pid=13, OS id=6875
DBW1 started with pid=14, OS id=6877
DBW2 started with pid=15, OS id=6879
LGWR started with pid=16, OS id=6881
CKPT started with pid=17, OS id=6883
SMON started with pid=18, OS id=6885
RECO started with pid=19, OS id=6887
CJQ0 started with pid=20, OS id=6889
MMON started with pid=21, OS id=6891
Mon Nov 28 22:38:18 KST 2011
starting up 1 dispatcher(s) for network address '(ADDRESS=(PARTIAL=YES)(PROTOCOL=TCP))'...
MMNL started with pid=22, OS id=6893
Mon Nov 28 22:38:18 KST 2011
starting up 1 shared server(s) ...
Mon Nov 28 22:38:20 KST 2011
lmon registered with NM - instance id 1 (internal mem no 0)
Mon Nov 28 22:38:21 KST 2011
Reconfiguration started (old inc 0, new inc 24)
Dynamic remastering is disabled
List of nodes:
 0 1
 Global Resource Directory frozen
* allocate domain 0, invalid = TRUE
 Communication channels reestablished
 * domain 0 valid according to instance 1
 * domain 0 valid = 1 according to instance 1
Mon Nov 28 22:38:21 KST 2011
 Master broadcasted resource hash value bitmaps
 Non-local Process blocks cleaned out
Mon Nov 28 22:38:21 KST 2011
 LMS 0: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:38:21 KST 2011
 LMS 4: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:38:21 KST 2011
 LMS 2: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:38:21 KST 2011
 LMS 3: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:38:21 KST 2011
 LMS 1: 0 GCS shadows cancelled, 0 closed
 Set master node info
 Submitted all remote-enqueue requests
 Dwn-cvts replayed, VALBLKs dubious
 All grantable enqueues granted
Mon Nov 28 22:38:23 KST 2011
 LMS 0: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 LMS 1: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 LMS 3: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 LMS 4: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 LMS 2: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 Submitted all GCS remote-cache requests
 Post SMON to start 1st pass IR
 Fix write in gcs resources
Reconfiguration complete
LCK0 started with pid=25, OS id=6960
Mon Nov 28 22:38:26 KST 2011
ALTER DATABASE   MOUNT
Mon Nov 28 22:38:30 KST 2011
Setting recovery target incarnation to 2
Mon Nov 28 22:38:34 KST 2011
Successful mount of redo thread 1, with mount id 3341830175
Mon Nov 28 22:38:34 KST 2011
Database mounted in Shared Mode (CLUSTER_DATABASE=TRUE)
Completed: ALTER DATABASE   MOUNT
Mon Nov 28 22:38:35 KST 2011
ALTER DATABASE OPEN
Picked broadcast on commit scheme to generate SCNs
Mon Nov 28 22:38:35 KST 2011
Thread 1 opened at log sequence 15
  Current log# 1 seq# 15 mem# 0: /dev/dg_nossdb_redo1ar/rredo_puos1_01A
  Current log# 1 seq# 15 mem# 1: /dev/dg_nossdb_redo1br/rredo_puos1_01B
Successful open of redo thread 1
Mon Nov 28 22:38:35 KST 2011
MTTR advisory is disabled because FAST_START_MTTR_TARGET is not set
Mon Nov 28 22:38:35 KST 2011
SMON: enabling cache recovery
Mon Nov 28 22:38:36 KST 2011
Successfully onlined Undo Tablespace 1.
Mon Nov 28 22:38:36 KST 2011
SMON: enabling tx recovery
Mon Nov 28 22:38:36 KST 2011
Database Characterset is KO16MSWIN949
Opening with internal Resource Manager plan
replication_dependency_tracking turned off (no async multimaster replication found)
Starting background process QMNC
QMNC started with pid=67, OS id=7158
Mon Nov 28 22:38:37 KST 2011
Completed: ALTER DATABASE OPEN
Mon Nov 28 22:38:21 KST 2011
 Master broadcasted resource hash value bitmaps
 Non-local Process blocks cleaned out
Mon Nov 28 22:38:21 KST 2011
 LMS 0: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:38:21 KST 2011
 LMS 4: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:38:21 KST 2011
 LMS 2: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:38:21 KST 2011
 LMS 3: 0 GCS shadows cancelled, 0 closed
Mon Nov 28 22:38:21 KST 2011
 LMS 1: 0 GCS shadows cancelled, 0 closed
 Set master node info
 Submitted all remote-enqueue requests
 Dwn-cvts replayed, VALBLKs dubious
 All grantable enqueues granted
Mon Nov 28 22:38:23 KST 2011
 LMS 0: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 LMS 1: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 LMS 3: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 LMS 4: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 LMS 2: 0 GCS shadows traversed, 0 replayed
Mon Nov 28 22:38:23 KST 2011
 Submitted all GCS remote-cache requests
 Post SMON to start 1st pass IR
 Fix write in gcs resources
Reconfiguration complete
LCK0 started with pid=25, OS id=6960
Mon Nov 28 22:38:26 KST 2011
ALTER DATABASE   MOUNT
Mon Nov 28 22:38:30 KST 2011
Setting recovery target incarnation to 2
Mon Nov 28 22:38:34 KST 2011
Successful mount of redo thread 1, with mount id 3341830175
Mon Nov 28 22:38:34 KST 2011
Database mounted in Shared Mode (CLUSTER_DATABASE=TRUE)
Completed: ALTER DATABASE   MOUNT
Mon Nov 28 22:38:35 KST 2011
ALTER DATABASE OPEN
Picked broadcast on commit scheme to generate SCNs
Mon Nov 28 22:38:35 KST 2011
Thread 1 opened at log sequence 15
  Current log# 1 seq# 15 mem# 0: /dev/dg_nossdb_redo1ar/rredo_puos1_01A
  Current log# 1 seq# 15 mem# 1: /dev/dg_nossdb_redo1br/rredo_puos1_01B
Successful open of redo thread 1
Mon Nov 28 22:38:35 KST 2011
MTTR advisory is disabled because FAST_START_MTTR_TARGET is not set
Mon Nov 28 22:38:35 KST 2011
SMON: enabling cache recovery
Mon Nov 28 22:38:36 KST 2011
Successfully onlined Undo Tablespace 1.
Mon Nov 28 22:38:36 KST 2011
SMON: enabling tx recovery
Mon Nov 28 22:38:36 KST 2011
Database Characterset is KO16MSWIN949
Opening with internal Resource Manager plan
replication_dependency_tracking turned off (no async multimaster replication found)
Starting background process QMNC
QMNC started with pid=67, OS id=7158
Mon Nov 28 22:38:37 KST 2011
Completed: ALTER DATABASE OPEN

-- PUOS2 alertlog Ã¼Å©
Mon Nov 28 22:13:34 KST 2011
Trace dumping is performing id=[cdmp_20111128221333]
Mon Nov 28 22:15:38 KST 2011
Reconfiguration started (old inc 20, new inc 22)
List of nodes:
 1
 Global Resource Directory frozen
 * dead instance detected - domain 0 invalid = TRUE
 Communication channels reestablished
 Master broadcasted resource hash value bitmaps
 Non-local Process blocks cleaned out
Mon Nov 28 22:15:38 KST 2011
 LMS 0: 3 GCS shadows cancelled, 0 closed
Mon Nov 28 22:15:38 KST 2011
 LMS 1: 2 GCS shadows cancelled, 0 closed
Mon Nov 28 22:15:38 KST 2011
 LMS 3: 1 GCS shadows cancelled, 0 closed
Mon Nov 28 22:15:38 KST 2011
 LMS 4: 1 GCS shadows cancelled, 0 closed
Mon Nov 28 22:15:38 KST 2011
 LMS 2: 2 GCS shadows cancelled, 0 closed
 Set master node info
 Submitted all remote-enqueue requests
 Dwn-cvts replayed, VALBLKs dubious
 All grantable enqueues granted
 Post SMON to start 1st pass IR
Mon Nov 28 22:15:40 KST 2011
Instance recovery: looking for dead threads
Mon Nov 28 22:15:40 KST 2011
Beginning instance recovery of 1 threads
 parallel recovery started with 8 processes
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
 LMS 0: 2247 GCS shadows traversed, 0 replayed
Mon Nov 28 22:15:40 KST 2011
 LMS 4: 2261 GCS shadows traversed, 0 replayed
Mon Nov 28 22:15:40 KST 2011
 LMS 2: 2019 GCS shadows traversed, 0 replayed
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
 LMS 3: 2197 GCS shadows traversed, 0 replayed
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
 LMS 1: 2196 GCS shadows traversed, 0 replayed
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
 Submitted all GCS remote-cache requests
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
 Fix write in gcs resources
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
WARNING: inbound connection timed out (ORA-3136)
Mon Nov 28 22:15:40 KST 2011
Started redo scan
Reconfiguration complete
Mon Nov 28 22:15:40 KST 2011
Completed redo scan
 70714 redo blocks read, 28731 data blocks need recovery
Mon Nov 28 22:15:41 KST 2011
Started redo application at
 Thread 1: logseq 14, block 41926
Mon Nov 28 22:15:41 KST 2011
Recovery of Online Redo Log: Thread 1 Group 7 Seq 14 Reading mem 0
  Mem# 0: /dev/dg_nossdb_redo1ar/rredo_puos1_07A
  Mem# 1: /dev/dg_nossdb_redo1br/rredo_puos1_07B
Mon Nov 28 22:15:41 KST 2011
ALTER SYSTEM SET service_names='SYS$SYS.KUPC$S_2_20111128153240.PUOS','PUOS' SCOPE=MEMORY SID='PUOS2';
Mon Nov 28 22:15:43 KST 2011
Completed redo application
Mon Nov 28 22:15:43 KST 2011
Completed instance recovery at
 Thread 1: logseq 14, block 112640, scn 11930010439129
 28731 data blocks read, 28731 data blocks written, 70714 redo blocks read
Mon Nov 28 22:15:43 KST 2011
Thread 1 advanced to log sequence 15 (thread recovery)

-- crsd ·Î±× È®ÀÎ
011-11-28 22:20:16.901: [ COMMCRS][309]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:16.901: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:16.902: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:18.211: [ COMMCRS][310]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:18.211: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:18.212: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:19.521: [ COMMCRS][311]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:19.521: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:19.522: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:20.831: [ COMMCRS][312]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:20.831: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:20.832: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:22.141: [ COMMCRS][313]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:22.141: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:22.142: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:23.451: [ COMMCRS][314]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:23.451: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:23.452: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:24.763: [ COMMCRS][315]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:24.763: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:24.764: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:26.072: [ COMMCRS][316]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:26.072: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:26.073: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:27.382: [ COMMCRS][317]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:27.382: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:27.383: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:28.692: [ COMMCRS][318]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:28.692: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:28.693: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..

2011-11-28 22:20:30.002: [ COMMCRS][319]clsc_connect: (600000000033e070) no listener at (ADDRESS=(PROTOCOL=ipc)(KEY=OCSSD_LL_nossdb1_))

2011-11-28 22:20:30.002: [ CSSCLNT][1]clsssInitNative: connect failed, rc 9

2011-11-28 22:20:30.003: [  CRSRTI][1] CSS is not ready. Received status 3 from CSS. Waiting for good status ..


-- fail over È®ÀÎ Á¶È¸ Äõ¸®
col machine for a25
select inst_id, sid, machine, failover_type, failover_method, failed_over
  from gv$session
 where username='DPOSWAS' ;

INST_ID	SID	MACHINE	FAILOVER_TYPE	FAILOVER_METHOD	FAILED_OVER
1	1045	osswas5	NONE	NONE	NO
1	1046	osswas5	NONE	NONE	NO
1	1047	osswas6	NONE	NONE	NO
1	1048	osswas6	NONE	NONE	NO
1	1049	osswas5	NONE	NONE	NO
1	1050	osswas6	NONE	NONE	NO
1	1052	osswas6	NONE	NONE	NO
1	1053	osswas5	NONE	NONE	NO
1	1054	osswas6	NONE	NONE	NO
1	1055	osswas5	NONE	NONE	NO
1	1056	osswas6	NONE	NONE	NO
1	1061	osswas6	NONE	NONE	NO
1	1063	osswas5	NONE	NONE	NO
1	1064	osswas5	NONE	NONE	NO
1	1065	osswas6	NONE	NONE	NO
1	1066	osswas6	NONE	NONE	NO
1	1067	osswas6	NONE	NONE	NO
1	1078	osswas6	NONE	NONE	NO
2	891		osswas5	NONE	NONE	NO
2	895		osswas5	NONE	NONE	NO
2	896		osswas6	NONE	NONE	NO
2	897		osswas5	NONE	NONE	NO
2	898		osswas6	NONE	NONE	NO
2	899		osswas6	NONE	NONE	NO
2	900		osswas5	NONE	NONE	NO
2	901		osswas6	NONE	NONE	NO
2	902		osswas6	NONE	NONE	NO
2	903		osswas6	NONE	NONE	NO
2	904		WORKGROUP\ZOMBIE 	NONE	NONE	NO
2	905		osswas6	NONE	NONE	NO
2	918		WORKGROUP\ZOMBIE 	NONE	NONE	NO
2	927		osswas5	NONE	NONE	NO
2	928		osswas6	NONE	NONE	NO
2	929		osswas6	NONE	NONE	NO
2	931		osswas6	NONE	NONE	NO
2	932		osswas6	NONE	NONE	NO
2	933		osswas6	NONE	NONE	NO
2	934		osswas6	NONE	NONE	NO
2	937		osswas6	NONE	NONE	NO
2	938		osswas5	NONE	NONE	NO
2	939		osswas6	NONE	NONE	NO
2	940		osswas6	NONE	NONE	NO
2	941		osswas5	NONE	NONE	NO
2	943		osswas6	NONE	NONE	NO
2	944		osswas6	NONE	NONE	NO
2	945		osswas6	NONE	NONE	NO
2	946		osswas6	NONE	NONE	NO
2	947		osswas6	NONE	NONE	NO
2	948		osswas6	NONE	NONE	NO
2	949		osswas6	NONE	NONE	NO
2	950		osswas6	NONE	NONE	NO
2	951		osswas6	NONE	NONE	NO
2	952		osswas6	NONE	NONE	NO
2	953		osswas6	NONE	NONE	NO
2	954		osswas6	NONE	NONE	NO
2	957		osswas6	NONE	NONE	NO
2	958		osswas6	NONE	NONE	NO
2	961		osswas6	NONE	NONE	NO
2	964		osswas5	NONE	NONE	NO
2	965		osswas6	NONE	NONE	NO
2	966		osswas5	NONE	NONE	NO
2	967		osswas5	NONE	NONE	NO
2	968		osswas5	NONE	NONE	NO
2	969		osswas5	NONE	NONE	NO
2	970		osswas5	NONE	NONE	NO
2	971		osswas5	NONE	NONE	NO
2	972		osswas6	NONE	NONE	NO
2	974		osswas5	NONE	NONE	NO
2	978		osswas6	NONE	NONE	NO
2	979		osswas5	NONE	NONE	NO
2	980		osswas6	NONE	NONE	NO
2	981		osswas6	NONE	NONE	NO
2	982		osswas5	NONE	NONE	NO
2	983		osswas6	NONE	NONE	NO
2	984		osswas5	NONE	NONE	NO
2	985		osswas5	NONE	NONE	NO
2	988		osswas6	NONE	NONE	NO
2	990		osswas6	NONE	NONE	NO
2	997		osswas6	NONE	NONE	NO
2	998		osswas6	NONE	NONE	NO
2	1000	osswas6	NONE	NONE	NO
2	1002	osswas6	NONE	NONE	NO
2	1003	osswas5	NONE	NONE	NO
2	1018	osswas5	NONE	NONE	NO
2	1019	osswas6	NONE	NONE	NO
2	1020	osswas5	NONE	NONE	NO
2	1021	osswas5	NONE	NONE	NO
2	1024	osswas5	NONE	NONE	NO
2	1025	osswas5	NONE	NONE	NO
2	1028	osswas5	NONE	NONE	NO
2	1039	osswas5	NONE	NONE	NO
2	1041	osswas5	NONE	NONE	NO
2	1042	osswas5	NONE	NONE	NO
2	1043	osswas6	NONE	NONE	NO
2	1044	osswas6	NONE	NONE	NO
2	1045	osswas6	NONE	NONE	NO
2	1046	osswas6	NONE	NONE	NO
2	1047	osswas6	NONE	NONE	NO
2	1048	osswas5	NONE	NONE	NO
2	1049	osswas5	NONE	NONE	NO
2	1050	osswas6	NONE	NONE	NO
2	1051	osswas5	NONE	NONE	NO
2	1052	osswas6	NONE	NONE	NO
2	1056	osswas6	NONE	NONE	NO
2	1057	osswas6	NONE	NONE	NO
2	1058	osswas6	NONE	NONE	NO
2	1059	osswas5	NONE	NONE	NO
2	1060	osswas6	NONE	NONE	NO
2	1061	osswas6	NONE	NONE	NO
2	1062	osswas6	NONE	NONE	NO
2	1063	osswas6	NONE	NONE	NO
2	1064	osswas6	NONE	NONE	NO
2	1076	osswas5	NONE	NONE	NO
 
-- DB restart
[nossdb1:PUOS2:/oracle] cdful
[nossdb1:PUOS2:/oracle] ./start/startup.sh

-- CRS restart
[nossdb1:/#] $ORACLE_HOME/bin/crsctl start crs
[nossdb1:/#] tail $ORACLE_CRS_HOME/log/nossdb1/crsd/crsd.log
[nossdb1:/#] ps -ef | grep ocssd
[nossdb1:/#] crs_stat -t -v





######################## SEQ Áõ°¡½ÃÅ°¸é¼­ INSERT

INSERT INTO  TB_OSF_GIS_STADM_LINE
SELECT ROWNUM AS SEQ 
, A.*
,sysdate
,'99999'
,sysdate
,'99999'
FROM TB_OSF_GIS_STADM_LINE_111216 A;



############################ Autonomous transaction

Autonomous transaction ÀÇ ½¬¿î ¿¹Á¦°¡ ÀÖ¾î¼­ ÇÑ¹ø Àû¾î ³õ¾Ò½À´Ï´Ù. 
¸» ±×´ë·Î µ¶¸³ÀûÀÎ ÀÚÀ² Æ®·£Àè¼ÇÀ¸·Î, ºÎ¸ðÀÇ Æ®·¢Àè¼Ç°ú µ¶¸³ÀûÀ¸·Î »ç¿ëµÇ´Â Æ®·£Àè¼ÇÀÔ´Ï´Ù.  
 
-- Autonomous transaction (ÀÚÀ² Æ®·¢Àè¼Ç)
   : ºÎ¸ðÆ®·£Àè¼ÇÀÇ ½ÂÀÎ/·Ñ¹é ¿©ºÎ¿¡ °ü°è¾øÀÌ ÀÚÀ²ÀûÀÎ Ã³¸® 

DROP TABLE at_test PURGE;

CREATE TABLE at_test (
  id           NUMBER       NOT NULL,
  description  VARCHAR2(50) NOT NULL
);

INSERT INTO at_test (id, description) VALUES (1, 'Description for 1');
INSERT INTO at_test (id, description) VALUES (2, 'Description for 2');

SELECT * FROM at_test;

/*
        ID DESCRIPTION
---------- --------------------------------------------------
         1 Description for 1
         2 Description for 2

2 rows selected.
*/

 

 

DECLARE
  PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN
  FOR i IN 3 .. 10 LOOP
    INSERT INTO at_test (id, description)
    VALUES (i, 'Description for ' || i);
  END LOOP;
  COMMIT;
END;
/

SELECT * FROM at_test;

/*
        ID DESCRIPTION
---------- --------------------------------------------------
         1 Description for 1
         2 Description for 2
         3 Description for 3
         4 Description for 4
         5 Description for 5
         6 Description for 6
         7 Description for 7
         8 Description for 8
         9 Description for 9
        10 Description for 10

10 rows selected.
*/

ROLLBACK;
SELECT * FROM at_test;

/*
        ID DESCRIPTION
---------- --------------------------------------------------
         3 Description for 3
         4 Description for 4
         5 Description for 5
         6 Description for 6
         7 Description for 7
         8 Description for 8
         9 Description for 9
        10 Description for 10

8 rows selected.
*/

DROP TABLE error_logs PURGE;

CREATE TABLE error_logs (
  id             NUMBER(10)     NOT NULL,
  log_timestamp  TIMESTAMP      NOT NULL,
  error_message  VARCHAR2(4000),
  CONSTRAINT error_logs_pk PRIMARY KEY (id)
);

DROP SEQUENCE  error_logs_seq;
CREATE SEQUENCE error_logs_seq;

CREATE OR REPLACE PROCEDURE log_errors (p_error_message  IN  VARCHAR2) AS
  PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN
  INSERT INTO error_logs (id, log_timestamp, error_message)
  VALUES (error_logs_seq.NEXTVAL, SYSTIMESTAMP, p_error_message);
  COMMIT;
END;
/

BEGIN

  INSERT INTO at_test (id, description)
  VALUES (998, 'Description for 998');

  -- Force invalid insert.
  INSERT INTO at_test (id, description)
  VALUES (999, NULL);

  COMMIT;
EXCEPTION
  WHEN OTHERS THEN
    log_errors (p_error_message => SQLERRM);
    ROLLBACK;
END;
/

SELECT * FROM error_logs ;
SELECT * FROM at_test ;




#######################################  Explain Plan(¿¹Ãø ½ÇÇà °èÈ¹)

explain plan(¿¹Ãø ½ÇÇà °èÈ¹)À» Á¶È¸ÇÏ´Â °¡Àå ÀÏ¹ÝÀûÀÎ ¹æ¹ýÀº ¾Æ·¡¿Í °°´Ù.


explain plan for
select .....
;



select * 
from table(dbms_xplan.display);


¡Ø  ¿¹Ãø ½ÇÇà °èÈ¹À» º¼¶§´Â dbms_xplan.display¸¦ ÀÌ¿ëÇÒ °Í
     (sqlplus¿¡¼­ set autot onÀ¸·Î ÀÌ¿ëÇÏ´Â ¹æ¹ýµµ ÀÖÁö¸¸ 10gR2ÀÌÈÄ ¹öÀüºÎÅÍ´Â 
      µÑ´Ù(dbms_xplan.display, set autot on) °°Àº Äõ¸®¸¦ ÀÌ¿ëÇÏ±â ¶§¹®¿¡...)


Execution Plan(½ÇÇà°èÈ¹)

¿À¶óÅ¬¿¡¼­ Á¦°øÇÏ´Â ½ÇÇà °èÈ¹¿¡´Â ÃÑ 5°¡Áö°¡ Á¸ÀçÇÑ´Ù.

½ÇÇà °èÈ¹ÀÇ Á¾·ù

1. ¿¹Ãø ½ÇÇà °èÈ¹ : Plan Table»ó¿¡ Á¸Àç. explain plan ¸í·É ÀÌ¿ë
2. ½ÇÁ¦ ½ÇÇà °èÈ¹ : Shared Pool¿¡ Á¸Àç. v$sql_plan
3. °ú°Å ½ÇÇà °èÈ¹ : AWR¿¡ Á¸Àç. dba_hist_sql_plan
4. Tuning Set¿¡ ÀÖ´Â ½ÇÇà °èÈ¹ : Tuning Advisor¿¡ ÀÇÇØ »ý¼ºµÈ ½ÇÇà °èÈ¹
5. Baseline¿¡ ÀÖ´Â ½ÇÇà °èÈ¹ : SPM¿¡ ÀÇÇØ °ü¸®µÇ´Â ½ÇÇà °èÈ¹


½ÇÇà °èÈ¹ÀÇ ±¸¼º¿ä¼Ò

1. ´Ü°èº° Operation 
2. Predicate(Á¶°ÇÀý) Á¤º¸ 
3. Query Block Name Á¤º¸ 
4. Outline Á¤º¸ 
5. Column Projection Á¤º¸ 


############################ requirements Quick Reference
Oracle Database on Unix AIX,HP-UX,Linux,Mac OS X,Solaris,Tru64 Unix Operating Systems Installation and Configuration Requirements Quick Reference (8.0.5 to 11.2) [ID 169706.1]


############################ HIDDEN PARAMETER HINT Àû¿ë

/*+ opt_param('_b_tree_bitmap_plans','false')*/

opt_param('_gby_hash_aggregation_enabled','false')
############################ HIDDEN PARAMETER Á¶È¸ Äõ¸®¹®
sys¿¡¼­

select ksppinm, ksppstvl
from   x$ksppi x, x$ksppcv y
where  (x.indx = y.indx)
and    (translate(ksppinm,'_','#') like '%&1%')


############################ ÆÄÆ¼¼ÇÅ×ÀÌºí

Oracle Timestamp Å¸ÀÔÀ¸·Î Å×ÀÌºí ÆÄÆ¼¼Ç »ç¿ëÇÏ±â. ¿¡¼­ ÆÄÆ¼¼ÇÀ» ¸¸µé¾îº¸¾Ò½À´Ï´Ù.
ÀÌ¾î¼­ ÀÏ¹ÝÀûÀ¸·Î ÆÄÆ¼¼ÇÀ» Ãß°¡ÇÒ ¶§¿¡´Â ´ÙÀ½°ú °°ÀÌ ÇÏÁÒ.

    ALTER TABLE psample
     ADD PARTITION psample_200706 VALUES LESS THAN (TIMESTAMP'2007-07-01 00:00:00 +9:00')
     TABLESPACE USER PCTFREE 5 PCTUSED 80 INITRANS 1 MAXTRANS 255
     STORAGE ( INITIAL 500K NEXT 500K MINEXTENTS 1 MAXEXTENTS UNLIMITED PCTINCREASE 0)
     LOGGING;


±×·±µ¥ ±âÁ¸¿¡ MAXVALUE ¸¦ value ·Î °®´Â ÆÄÆ¼¼ÇÀ» ¸¸µé¾ú¾ú´Ù¸é ´ÙÀ½°ú °°Àº ¿À·ù¸¦ º¸°ÔµË´Ï´Ù.

    ORA-14074: ºÐÇÒ¿µ¿ª À¯Áö ÀÛ¾÷¿¡ ºÐÇÒ¿µ¿ª ¹üÀ§°¡ ³Ê¹« Àû½À´Ï´Ù


È¤Àº

    ORA-14074: partition bound must collate higher than that of the last partition


ÀÌ·² ¶§¿¡´Â add partition  ¸í·ÉÀ» ¾µ ¼ö´Â ¾ø°í split partition ¸í·ÉÀ» ½á¼­ ÆÄÆ¼¼ÇÀ» ºÐÇÒÇØÁÖ¾î¾ß ÇÕ´Ï´Ù.
´ÙÀ½°ú °°ÀÌ ºÐÇÒÇØÁÖ¸é µË´Ï´Ù.

    ALTER TABLE psample SPLIT PARTITION psample_MAX
     AT (TIMESTAMP'2007-07-01 00:00:00 +9:00')
     INTO (PARTITION psample_200706 TABLESPACE USER PCTFREE 5 PCTUSED 80 INITRANS 1 MAXTRANS 255
       STORAGE ( INITIAL 500K NEXT 500K MINEXTENTS 1 MAXEXTENTS UNLIMITED PCTINCREASE 0),
      PARTITION psample_MAX TABLESPACE USER PCTFREE 5 PCTUSED 80 INITRANS 1 MAXTRANS 255
       STORAGE ( INITIAL 500K NEXT 500K MINEXTENTS 1 MAXEXTENTS UNLIMITED PCTINCREASE 0));


À§ÀÇ ¸í·Éµé¿¡¼­ INITIAL, NEXT, PCTFREE, PCTUSED µîÀÇ °ªµéÀº Àû´çÈ÷ Á¶ÀýÀ» ÇØÁà¾ß°ÚÁÒ?
±×·±µ¥ À§ÀÇ STORAGE ¿É¼ÇÀ» ¾ÈÀû¾îÁÖ¸é ¾î¶»°Ô µÉ±î¿ä?
°£´ÜÇÏ°Ô Å×½ºÆ®ÇØº» °á°ú ¿É¼ÇÀÌ ¾øÀ¸¸é ³ª´²Áö´Â µÎ ÆÄÆ¼¼ÇÀº ¿ø·¡ ÀÖ´ø ÆÄÆ¼¼Ç°ú µ¿ÀÏÇÏ°Ô ¸¸µé¾îÁö³×¿ä.
³ª´²Áö´Â µÎ °¡Áö Áß¿¡¼­ ÇÏ³ª¿¡¸¸ STORAGE ¿É¼ÇÀ» Ãß°¡ÇØÁÖ¸é ´ç¿¬È÷ ¾ÈÀû¾îÁØ °ÍÀº ¿ø·¡ÀÖ´ø ÆÄÆ¼¼ÇÀÇ ¼Ó¼ºÀ» µû¶ó°¡´õ±º¿ä. 


ALTER TABLE sales DROP PARTITION 


VALUES LESS THAN (MAXVALUE) ºÎºÐÀÌ ÀÖÀ¸¸é maxvalue ÆÄÆ¼¼ÇÀÌ ÀÖ´Â °Ì´Ï´Ù.
MaxValue ÆÄÆ¼¼ÇÀÌ ¾øÀ» °æ¿ì´Â Ãß°¡ÇÏ½Ã¸é µË´Ï´Ù.
2010³â 7¿ù ÆÄÆ¼¼ÇÀ» ¸¸µé°æ¿ì
 
ALTER TABLE table_name
ADD PARTITION  table_name_201007  VALUES LESS THAN (TIMESTAMP '2010-08-01 00:00:00');

 
³ª¸ÓÁö ºÎºÐÀº ±âÁ¸ script ¸¦ º¸½Ã°í ±×´ë·Î ÇÏ½Ã´øÁö ¾Æ´Ï¸é »ý·«ÇÏ¼Åµµ ±¦Âú½À´Ï´Ù.
MaxValue ÆÄÆ¼¼ÇÀÌ ÀÖÀ» °æ¿ì´Â ÆÄÆ¼¼ÇÀ» ³ª´©¾î¾ß ÇÕ´Ï´Ù.
ALTER TABLE table_name
    SPLIT PARTITION table_name_max AT (TIMESTAMP '2010-08-01 00:00:00')
    INTO ( PARTITION table_name_201007, PARTITION table_name_max );
timestamp ¸¦ ±âÁØÀ¸·Î ÀÛÀº °ÍÀ» 201007 ÆÄÆ¼¼Ç¿¡ ³Ö´Â´Ù´Â ÀÇ¹ÌÀÔ´Ï´Ù.
 



#################### ÆÄÆ¼¼Ç Å×ÀÌºí »ý¼º

CREATE TABLE POW_OO.TB_OOSIPTVSPEEDDATA_STB_LOG_P
(
	NO                       NUMBER,
	SUBSNO                   VARCHAR2 (12),
	CHKDATE                  DATE DEFAULT sysdate,
	NICMAC                   VARCHAR2 (12),
	SETOP_IP                 VARCHAR2 (16),
	TARGETIPADDR             VARCHAR2 (16),
	IPTV_MODEL               VARCHAR2 (9),
	TYPE                     NUMBER,
	ITEM_TYPE                VARCHAR2 (2),
	DOWN_RES                 NUMBER,
	UP_RES                   NUMBER,
	UDP_RES                  NUMBER,
	TRACRT_RES               NUMBER,
	DOWN_SPEED               NUMBER,
	UP_SPEED                 NUMBER,
	UDP_RTT                  FLOAT (126),
	UDP_JITTER               FLOAT (126),
	UDP_LOSS                 FLOAT (126),
	TRACRT                   VARCHAR2 (1000),
	DOWN_GRAPH               VARCHAR2 (2000),
	MULTICASTIP              VARCHAR2 (16),
	MULTICASTPORT            NUMBER,
	DELAY                    FLOAT (126),
	LOSS                     FLOAT (126),
	JITTER                   FLOAT (126),
	JITTER_MIN               FLOAT (126),
	JITTER_MAX               FLOAT (126),
	TTL_AVG                  FLOAT (126),
	IGMP_COUNT               NUMBER,
	RTPTESTTIME              NUMBER,
	BUFFER_OVERFLOW          VARCHAR2 (128),
	BUFFER_UNDERFLOW         VARCHAR2 (128),
	PCR_LOCK_STATUS          VARCHAR2 (128),
	PTS_ADVANCED_ERROR       VARCHAR2 (128),
	IGMP_FAIL_RESULT         NUMBER,
	RTP_RESULT               NUMBER,
	IP_ADDR                  VARCHAR2 (16),
	CHANNEL_BITRATE          NUMBER,
	LOST_PACKET_COUNT        NUMBER (10),
	EXPECTED_PACKET_COUNT    NUMBER (10),
	PACKET_LOSS_PERIOD       NUMBER (10),
	STB_RTP_ERRCNT           VARCHAR2 (128),
	SITE_TYPE                NUMBER (10),
	RX_LOST_PACKET_COUNT     NUMBER (10),
	UPTIME                   NUMBER (10),
	RX_PACKETS               NUMBER (10),
	NO_STREAM_ERROR          VARCHAR2 (128),
	STB_FIRMWARE_VERSION     VARCHAR2 (16),
	NO_STREAM_ERROR_SUM      NUMBER (10),
	PCR_LOCK_STATUS_SUM      NUMBER (10),
	PTS_ADVANCED_ERROR_SUM   NUMBER (10),
	STB_RTP_ERRCNT_SUM       NUMBER (10),
	WAS_IP                   VARCHAR2 (10),
	APT_ID                   VARCHAR2 (10)
)
TABLESPACE POO_Q
PCTFREE 10
INITRANS 1
MAXTRANS 255
PARTITION BY RANGE (CHKDATE)
(
	PARTITION PT_OOSIPTVSPEEDDATA_0908 VALUES LESS THAN (TO_DATE('20090901','YYYYMMDD')) TABLESPACE POO_Q,
	PARTITION PT_OOSIPTVSPEEDDATA_0909 VALUES LESS THAN (TO_DATE('20091001','YYYYMMDD')) TABLESPACE POO_Q,
	PARTITION PT_OOSIPTVSPEEDDATA_0910 VALUES LESS THAN (TO_DATE('20091101','YYYYMMDD')) TABLESPACE POO_Q,
	PARTITION PT_OOSIPTVSPEEDDATA_0911 VALUES LESS THAN (TO_DATE('20091201','YYYYMMDD')) TABLESPACE POO_Q,
	PARTITION PT_OOSIPTVSPEEDDATA_0912 VALUES LESS THAN (TO_DATE('20100101','YYYYMMDD')) TABLESPACE POO_Q,
	PARTITION PT_OOSIPTVSPEEDDATA_1001 VALUES LESS THAN (TO_DATE('20100201','YYYYMMDD')) TABLESPACE POO_Q,
	PARTITION PT_OOSIPTVSPEEDDATA_1002 VALUES LESS THAN (TO_DATE('20100301','YYYYMMDD')) TABLESPACE POO_Q,
	PARTITION PT_OOSIPTVSPEEDDATA_1003 VALUES LESS THAN (TO_DATE('20100401','YYYYMMDD')) TABLESPACE POO_Q,
	PARTITION PT_OOSIPTVSPEEDDATA_1004 VALUES LESS THAN (TO_DATE('20100501','YYYYMMDD')) TABLESPACE POO_Q,					
	PARTITION PT_OOSIPTVSPEEDDATA_1005 VALUES LESS THAN (TO_DATE('20100601','YYYYMMDD')) TABLESPACE POO_Q,	
	PARTITION PT_OOSIPTVSPEEDDATA_1006 VALUES LESS THAN (TO_DATE('20100701','YYYYMMDD')) TABLESPACE POO_Q,	
	PARTITION PT_OOSIPTVSPEEDDATA_1007 VALUES LESS THAN (TO_DATE('20100801','YYYYMMDD')) TABLESPACE POO_Q,	
	PARTITION PT_OOSIPTVSPEEDDATA_1008 VALUES LESS THAN (TO_DATE('20100901','YYYYMMDD')) TABLESPACE POO_Q,	
	PARTITION PT_OOSIPTVSPEEDDATA_1009 VALUES LESS THAN (TO_DATE('20101001','YYYYMMDD')) TABLESPACE POO_Q,	
	PARTITION PT_OOSIPTVSPEEDDATA_1010 VALUES LESS THAN (TO_DATE('20101101','YYYYMMDD')) TABLESPACE POO_Q,	
	PARTITION PT_OOSIPTVSPEEDDATA_1011 VALUES LESS THAN (TO_DATE('20101201','YYYYMMDD')) TABLESPACE POO_Q,			
	PARTITION PT_OOSIPTVSPEEDDATA_1012 VALUES LESS THAN (TO_DATE('20110101','YYYYMMDD')) TABLESPACE POO_Q,										
	PARTITION PT_OOSIPTVSPEEDDATA_MAX VALUES LESS THAN (MAXVALUE)
	TABLESPACE POO_Q

)
DISABLE ROW MOVEMENT ;


CREATE INDEX POW_OO.IX_OOSIPTVSPEEDDATA_STB_LOG_01 
ON POW_OO.TB_OOSIPTVSPEEDDATA_STB_LOG
(
	SUBSNO ASC,
	CHKDATE ASC
)
TABLESPACE POO_S_IDX
LOCAL
PCTFREE 0
NOLOGGING PARALLEL 4
;



############################ ÆÄÆ¼¼Ç ¹«ºê  MOVE

ALTER TABLE CHUL  MOVE PARTITION P_200907 TABLESPACE SHIN_DATA_05;
ALTER TABLE CHUL  MOVE PARTITION P_200908 TABLESPACE SHIN_DATA_05;
ALTER TABLE CHUL  MOVE PARTITION P_200909 TABLESPACE SHIN_DATA_05;
ALTER TABLE CHUL  MOVE PARTITION P_200910 TABLESPACE SHIN_DATA_05;

 

ALTER INDEX CHUL_PK REBUILD PARTITION P_200907 TABLESPACE SHIN_DATA_05;
ALTER INDEX CHUL_PK REBUILD PARTITION P_200908 TABLESPACE SHIN_DATA_05;
ALTER INDEX CHUL_PK REBUILD PARTITION P_200909 TABLESPACE SHIN_DATA_05;
ALTER INDEX CHUL_PK REBUILD PARTITION P_200910 TABLESPACE SHIN_DATA_05;


ALTER TABLE DPOW_OSO.TB_OSO_OPN_WS_DLY_SUBS	MOVE PARTITION PT_OSO_OPN_WS_DLY_SUBS_MAX TABLESPACE TS_OSO;

alter index DPOW_OSO.IX_OSO_OPN_WS_DLY_SUBS_01 rebuild PARTITION PT_OSO_OPN_WS_DLY_SUBS_MAX tablespace TS_OSO_IDX;     
alter index DPOW_OSO.IX_OSO_OPN_WS_DLY_SUBS_02 rebuild PARTITION PT_OSO_OPN_WS_DLY_SUBS_MAX tablespace TS_OSO_IDX PARALLEL 32;     
alter index DPOW_OSO.PK_OSO_OPN_WS_DLY_SUBS rebuild PARTITION PT_OSO_OPN_WS_DLY_SUBS_MAX tablespace TS_OSO_IDX PARALLEL 32;        
 
######### Æ¯Á¤ ÆÄÆ¼¼ÇÀÇ µ¥ÀÌÅÍ °Ç¼ö
select count(1) from DPOW_OSO.TB_OSO_OPN_WS_DLY_SUBS partition (PT_OSO_OPN_WS_DLY_SUBS_MAX);


#################### ÆÄÆ¼¼Ç truncate partition

ALTER TABLE DPOW_OSO.TB_OSO_OPN_WS_DLY_SUBS	truncate PARTITION PT_OSO_OPN_WS_DLY_SUBS_MAX;

ÆÄÆ¼¼Ç»çÀÌÁî°¡ Å« °æ¿ì 5ºÐ ÀÌ»ó ¼Ò¿ä °¡´É.

OWNER	SEGMENT_NAME	PARTITION_NAME
DPTOW_OSO	TB_OSO_OPN_WS_DLY_SUBS	PT_OSO_OPN_WS_DLY_SUBS_MAX
######### MAX SCN Á¶»ç

SELECT current_scn,
       max_resonable_scn, 
       (max_resonable_scn - current_scn) "DIFF"
FROM   (SELECT current_scn, max_resonable_scn
        FROM   (SELECT (((((((To_number(To_char(SYSDATE,'YYYY')) - 1988) * 12
                               + (To_number(To_char(SYSDATE,'MM')) - 1)) * 31
                               + (To_number(To_char(SYSDATE,'DD')) - 1)) * 24
                             + (To_number(To_char(SYSDATE,'HH24'))))     * 60
                            + (To_number(To_char(SYSDATE,'MI'))))        * 60
                           + (To_number(To_char(SYSDATE,'SS')))))        * 16384 max_resonable_scn
                FROM   dual) a,
               (SELECT CHECKPOINT_CHANGE# current_scn
                FROM   v$database) b);


½Ã°£´ë º°

select a.*, round((a.first_change#/max_resonable_scn)*100,2) PCT from
(select first_time, first_change#, (((((((to_number(to_char(first_time, 'YYYY')) - 1988) * 12 +
                       (to_number(to_char(first_time, 'MM')) - 1)) * 31 +
                       (to_number(to_char(first_time, 'DD')) - 1)) * 24 +
                       (to_number(to_char(first_time, 'HH24')))) * 60 +
                       (to_number(to_char(first_time, 'MI')))) * 60 +
                       (to_number(to_char(first_time, 'SS'))))) * 16384 max_resonable_scn
                  from v$log_history) a order by 1 ;



############################ CONNECT BY °èÃþÀû Äõ¸®

Á÷¿ø   Á÷¼Ó»ó»ç  Á÷±Þ
---------------------------
Ã¶¼ö     ¼øÈñ    ´ë¸®
¼øÈñ     ¿µÈñ    °úÀå
±æµ¿     ¼øÈñ    ´ë¸®
¿µÈñ     °³¶Ë    ºÎÀå
°³¶Ë             »çÀå


select lpad(' ',(level-1)*2,' ')||Á÷¿ø Á÷¿ø, Á÷±Þ
  from Á÷¿ø
start with Á÷¿ø = '°³¶Ë' or Á÷¿ø ='¼øÈñ'
connect by Á÷¼Ó»ó»ç = prior Á÷¿ø    

Á÷¿ø         Á÷±Þ
--------------------
¼øÈñ         °úÀå
  Ã¶¼ö       ´ë¸®
  ±æµ¿       ´ë¸®
°³¶Ë         »çÀå
  ¿µÈñ       ºÎÀå
    ¼øÈñ     °úÀå
      Ã¶¼ö   ´ë¸®
      ±æµ¿   ´ë¸®
      
      
      
SELECT LPAD(LEVEL-1, 2, '0')||TO_CHAR(SYSDATE, 'MMDD') AS MMDD
FROM   DUAL CONNECT BY LEVEL <= 100;
 
SELECT LPAD(LEVEL-1, 2, '0')
FROM   DUAL CONNECT BY LEVEL <= 100;

##00ºÎÅÍ 99±îÁö Ãâ·Â




## UNION À» CONNECT BY ·Î º¯°æ

SELECT SVC_REQ_ITM_GRP_ID, 1 COL_NO, 'ITM_NM1' COL_NM, 'ITM_VAL1' COL_VAL, ITM_NM1 ITM_NM FROM TB_OSZ_DSV_RQ_DITM WHERE SVC_REQ_ITM_CNT >= 1
UNION ALL
SELECT SVC_REQ_ITM_GRP_ID, 2 COL_NO, 'ITM_NM2' COL_NM, 'ITM_VAL2' COL_VAL, ITM_NM2 ITM_NM FROM TB_OSZ_DSV_RQ_DITM WHERE SVC_REQ_ITM_CNT >= 2
UNION ALL
SELECT SVC_REQ_ITM_GRP_ID, 3 COL_NO, 'ITM_NM3' COL_NM, 'ITM_VAL3' COL_VAL, ITM_NM3 ITM_NM FROM TB_OSZ_DSV_RQ_DITM WHERE SVC_REQ_ITM_CNT >= 3
UNION ALL
SELECT SVC_REQ_ITM_GRP_ID, 4 COL_NO, 'ITM_NM4' COL_NM, 'ITM_VAL4' COL_VAL, ITM_NM4 ITM_NM FROM TB_OSZ_DSV_RQ_DITM WHERE SVC_REQ_ITM_CNT >= 4
UNION ALL
SELECT SVC_REQ_ITM_GRP_ID, 5 COL_NO, 'ITM_NM5' COL_NM, 'ITM_VAL5' COL_VAL, ITM_NM5 ITM_NM FROM TB_OSZ_DSV_RQ_DITM WHERE SVC_REQ_ITM_CNT >= 5


SELECT a.SVC_REQ_ITM_GRP_ID, b.lvl COL_NO, 'ITM_NM'||b.lvl COL_NM, 'ITM_VAL'||b.lvl COL_VAL, 
DECODE(b.lvl, 1, a.ITM_NM1,
2, a.ITM_NM2,
3, a.ITM_NM3,
4, a.ITM_NM4,
5, a.ITM_NM5
)
FROM TB_OSZ_DSV_RQ_DITM a, (select level lvl from dual connect by level <= 5) b
WHERE SVC_REQ_ITM_CNT >= b.lvl 




---- OUTER JOIN VIRTUAL TABLE TWO TYPE


select subsid, usageday, resname, sum(usage)
from
(
select iu.subscription_id as subsid, to_char(usage_date,'dd') as usageday, res.name as resname, iu.usage as usage--sum(iu.usage) as usage
from ncs.consolidated_daily_usage@dl_ptltstc1_ncsql iu, 
ncs.ip_address@dl_ptltstc1_ncsql ip, 
ncs.resources@dl_ptltstc1_ncsql res, 
ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, 
ncs_customer_mng ncm,
ncs_report_period_vw rp
where ncm.cust_name = ssp.attribute_value
and ssp.subscription_id=iu.subscription_id
and iu.resource_id=res.resource_id
and iu.ip_address_id=ip.ip_address_id
and ncm.cust_id=2
and to_char(rp.rptd_end_date, 'mm')=to_char(iu.usage_date,'mm')
and res.name<>'combined traffic'
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '01' as usageday,'incoming traffic' as resname,0  as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '01' as usageday,'outgoing traffic' as resname,0 as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '02' as usageday,'incoming traffic' as resname,0 as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '02' as usageday,'outgoing traffic' as resname,0 as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '03' as usageday,'incoming traffic' as resname,0 as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '03' as usageday,'outgoing traffic' as resname,0 as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '04' as usageday,'incoming traffic' as resname,0 as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '04' as usageday,'outgoing traffic' as resname,0 as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '05' as usageday,'incoming traffic' as resname,0 as usage from dual
union
select (select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2) as subsid, '05' as usageday,'outgoing traffic' as resname,0 as usage from dual
) a
group by subsid,usageday,resname
order by subsid,usageday,resname;
---

select nvl(a.subscription_id,(select ssp.subscription_id from ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, ncs_customer_mng ncm where ncm.cust_name = ssp.attribute_value and ncm.cust_id=2)) as subsid, 
       b.day, 
       b.res, 
       nvl(a.usage,0) 
from (
select iu.subscription_id, to_char(usage_date,'dd') as day, 
res.name, 
sum(iu.usage) as usage
from ncs.consolidated_daily_usage@dl_ptltstc1_ncsql iu, 
ncs.ip_address@dl_ptltstc1_ncsql ip, 
ncs.resources@dl_ptltstc1_ncsql res, 
ncs.subscription_service_parameter@dl_ptltstc1_ncsql ssp, 
ncs_customer_mng ncm,
ncs_report_period_vw rp
where ncm.cust_name = ssp.attribute_value
and ssp.subscription_id=iu.subscription_id
and iu.resource_id=res.resource_id
and iu.ip_address_id=ip.ip_address_id
and ncm.cust_id=2
and to_char(rp.rptd_end_date, 'mm')=to_char(iu.usage_date,'mm')
and res.name<>'Combined Traffic'
group by iu.subscription_id, to_char(usage_date,'dd'), res.name
) a,
(
select '01' as day,'Incoming Traffic' as res from dual
union
select '01' as day,'Outgoing Traffic' as res from dual
union
select '02' as day,'Incoming Traffic' as res from dual
union
select '02' as day,'Outgoing Traffic' as res from dual
union
select '03' as day,'Incoming Traffic' as res from dual
union
select '03' as day,'Outgoing Traffic' as res from dual
union
select '04' as day,'Incoming Traffic' as res from dual
union
select '04' as day,'Outgoing Traffic' as res from dual
union
select '05' as day,'Incoming Traffic' as res from dual
union
select '05' as day,'Outgoing Traffic' as res from dual
union
select '06' as day,'Incoming Traffic' as res from dual
union
select '06' as day,'Outgoing Traffic' as res from dual
union
select '07' as day,'Incoming Traffic' as res from dual
union
select '07' as day,'Outgoing Traffic' as res from dual
union
select '08' as day,'Incoming Traffic' as res from dual
union
select '08' as day,'Outgoing Traffic' as res from dual
union
select '09' as day,'Incoming Traffic' as res from dual
union
select '09' as day,'Outgoing Traffic' as res from dual
union
select '10' as day,'Incoming Traffic' as res from dual
union
select '10' as day,'Outgoing Traffic' as res from dual
union
select '11' as day,'Incoming Traffic' as res from dual
union
select '11' as day,'Outgoing Traffic' as res from dual
union
select '12' as day,'Incoming Traffic' as res from dual
union
select '12' as day,'Outgoing Traffic' as res from dual
union
select '13' as day,'Incoming Traffic' as res from dual
union
select '13' as day,'Outgoing Traffic' as res from dual
union
select '14' as day,'Incoming Traffic' as res from dual
union
select '14' as day,'Outgoing Traffic' as res from dual
union
select '15' as day,'Incoming Traffic' as res from dual
union
select '15' as day,'Outgoing Traffic' as res from dual
union
select '16' as day,'Incoming Traffic' as res from dual
union
select '16' as day,'Outgoing Traffic' as res from dual
union
select '17' as day,'Incoming Traffic' as res from dual
union
select '17' as day,'Outgoing Traffic' as res from dual
union
select '18' as day,'Incoming Traffic' as res from dual
union
select '18' as day,'Outgoing Traffic' as res from dual
union
select '19' as day,'Incoming Traffic' as res from dual
union
select '19' as day,'Outgoing Traffic' as res from dual
union
select '20' as day,'Incoming Traffic' as res from dual
union
select '20' as day,'Outgoing Traffic' as res from dual
union
select '21' as day,'Incoming Traffic' as res from dual
union
select '21' as day,'Outgoing Traffic' as res from dual
union
select '22' as day,'Incoming Traffic' as res from dual
union
select '22' as day,'Outgoing Traffic' as res from dual
union
select '23' as day,'Incoming Traffic' as res from dual
union
select '23' as day,'Outgoing Traffic' as res from dual
union
select '24' as day,'Incoming Traffic' as res from dual
union
select '24' as day,'Outgoing Traffic' as res from dual
union
select '25' as day,'Incoming Traffic' as res from dual
union
select '25' as day,'Outgoing Traffic' as res from dual
union
select '26' as day,'Incoming Traffic' as res from dual
union
select '26' as day,'Outgoing Traffic' as res from dual
union
select '27' as day,'Incoming Traffic' as res from dual
union
select '27' as day,'Outgoing Traffic' as res from dual
union
select '28' as day,'Incoming Traffic' as res from dual
union
select '28' as day,'Outgoing Traffic' as res from dual
union
select '29' as day,'Incoming Traffic' as res from dual
union
select '29' as day,'Outgoing Traffic' as res from dual
union
select '30' as day,'Incoming Traffic' as res from dual
union
select '30' as day,'Outgoing Traffic' as res from dual
union
select '31' as day,'Incoming Traffic' as res from dual
union
select '31' as day,'Outgoing Traffic' as res from dual
) b
where 1=1
and a.day(+) = b.day
and a.name(+) = b.res
and b.day between 
(select to_char(rptd_start_date,'dd') from ncs_report_period_vw) 
and (select to_char(rptd_end_date,'dd') from ncs_report_period_vw)
order by subsid, b.day, b.res, a.usage
;


############################ ÀÎ½ºÅÏ½º ±âµ¿ ÀÌÈÄ °¢ ÀÚ¿ø»ç¿ëÀ² ´©ÀûÇöÈ²

SQL> select * from v$resource_limit;

RESOURCE_NAME                  CURRENT_UTI MAX_UTILIZA INITIAL_ALLOCATION   LIMIT_VALUE         
------------------------------ ----------- ----------- -------------------- --------------------
processes                             1357        1700 1700                 1700                
sessions                              1267        1853 1875                 1875                
enqueue_locks                          144         495 22680                22680               
enqueue_resources                      429         548 8768                 UNLIMITED           
ges_procs                                0           0 0                    0                   
ges_ress                                 0           0 0                    UNLIMITED           
ges_locks                                0           0 0                    UNLIMITED           
ges_cache_ress                           0           0 0                    UNLIMITED           
ges_reg_msgs                             0           0 0                    UNLIMITED           
ges_big_msgs                             0           0 0                    UNLIMITED           
ges_rsv_msgs                             0           0 0                    0                   
gcs_resources                            0           0 281671               281671              
gcs_shadows                              0           0 281671               281671              
dml_locks                                8         316 8248                 UNLIMITED           
temporary_table_locks                    0          16 UNLIMITED            UNLIMITED           
transactions                          4354        4450 2062                 UNLIMITED           
branches                               371         551 2062                 UNLIMITED           
cmtcallbk                                0           3 2062                 UNLIMITED           
sort_segment_locks                       0         129 UNLIMITED            UNLIMITED           
max_rollback_segments                  340         413 413                  413                 
max_shared_servers                       0           0 20                   20                  
parallel_max_servers                     1           6 6                    6                   

22 rows selected.


############################  (V8.X ~ V9.X) UNDO/REDO ¸¦ ¸¹ÀÌ »ý¼º½ÃÅ°´Â SESSIONÀ» Ã£¾ÆÁÖ´Â SQL ¹® 

     
        
No. 17480

(V8.X ~ V9.X) UNDO/REDO ¸¦ ¸¹ÀÌ »ý¼º½ÃÅ°´Â SESSIONÀ» Ã£¾ÆÁÖ´Â SQL ¹®
====================================================================

PURPOSE
-------

   ÀÌ ÀÚ·á´Â ¿î¿µ ÁßÀÎ Oracle µ¥ÀÌÅ¸º£ÀÌ½º¿¡¼­ Redo¸¦ ¸¹ÀÌ »ý¼º½ÃÅ°´Â  
   session Á¤º¸¸¦ ¼ø¼­ ´ë·Î Ãâ·ÂÇØÁÖ´Â SQL ¹®¿¡ ´ëÇÑ ÀÚ·áÀÌ´Ù. 


Explanation
-----------

   ´ÙÀ½ µÎ °¡Áö SQL ¹®À» ÀÌ¿ëÇÏ¸é Redo¿Í Undo¸¦ ¸¹ÀÌ »ý¼º½ÃÅ°´Â 
   session, transaction Á¤º¸¸¦ ¾Ë ¼ö ÀÖ´Ù. 

   1) V$SESS_IO ºä¿Í V$SESSION view¸¦ Á¶ÀÎÇÑ´Ù. V$SESS_IO ºäÀÇ 
      BLOCK_CHANGES ¶ó´Â ÄÃ·³Àº ¾ó¸¶³ª ¸¹Àº blockµéÀÌ ±× session¿¡ 
      ÀÇÇØ¼­ º¯È­µÇ¾ú´ÂÁö¸¦ º¸¿©ÁØ´Ù. ÀÌ °ªÀÌ ³ôÀ¸¸é sessionÀÌ 
      ¸¹Àº ¾çÀÇ redo¸¦ »ý¼º½ÃÄ×À½À» ¾Ë ¼ö ÀÖ´Ù. 

      SQL> SELECT s.sid, s.serial#, s.username, s.program,
           i.block_changes
           FROM v$session s, v$sess_io i
           WHERE s.sid = i.sid
           ORDER BY 5 desc, 1, 2, 3, 4;

      À§ SQL ¹®À» ¿©·¯¹ø ¼öÇàÇØ¼­ BLOCK_CHANGES °ªÀÇ °¢ ¹ß»ý »çÀÌÀÇ 
      delta °ªÀ» ºñ±³ÇØº¸¸é, ±× °ªÀÌ Å¬ ¼ö·Ï ±× sessionÀÌ ¸¹Àº ¾çÀÇ 
      redo¸¦ »ý¼º½ÃÄ×À½À» ¾Ë ¼ö ÀÖ´Ù. 

   2) V$TRANSACTION ºä¸¦ Á¶È¸ÇÏ¸é ÇØ´ç transaction¿¡ ÀÇÇÏ¿© ¾×¼¼½ºµÈ 
      undo block°ú undo recordµéÀÇ ¾ç¿¡ ´ëÇÑ Á¤º¸¸¦ ¾Ë ¼ö ÀÖ´Ù.
      ±× Á¤º¸´Â USED_UBLK ÄÃ·³°ú USED_UREC ÄÃ·³À» º¸°í ¾Ë ¼ö ÀÖ´Ù. 

      SQL> SELECT s.sid, s.serial#, s.username, s.program, 
           t.used_ublk, t.used_urec
           FROM v$session s, v$transaction t
           WHERE s.taddr = t.addr
           ORDER BY 5 desc, 6 desc, 1, 2, 3, 4;


      À§ SQL ¹®À» ¿©·¯¹ø ¼öÇàÇØ¼­ USED_UBLK ÄÃ·³°ú USED_UREC ÄÃ·³ÀÇ 
      °¢ ¹ß»ý »çÀÌÀÇ delta °ªÀ» ºñ±³ÇØº¸¸é, ±× °ªÀÌ Å¬ ¼ö·Ï ±× 
      sessionÀÌ ¸¹Àº ¾çÀÇ redo¸¦ »ý¼º½ÃÄ×À½À» ¾Ë ¼ö ÀÖ´Ù. 

      À§ÀÇ query¿¡¼­ Ã¹¹ø Â° query´Â ¸¹Àº ¾çÀÇ redo¸¦ generateÇÑ 
      programÀ» checkÇÒ ÇÊ¿ä°¡ ÀÖÀ» ¶§ »ç¿ëÇÏ°í, µÎ¹ø Â° query´Â 
      ¸¹Àº ¾çÀÇ redo¸¦ generateÇÑ Æ¯Á¤ transactionÀ» Ã£À» ÇÊ¿ä°¡ 
      ÀÖÀ» ¶§ »ç¿ëÇÏ¸é µµ¿òÀÌ µÈ´Ù. 


Example
-------
none


Reference Documents
-------------------
<Note:167492.1> 



############################ Æ¯Á¤ sqlÀÇ sql_id¸¸ ¾Ë°í aging outµÇ¾î v$sql¿¡¼­ Ã£À»¼ö ¾øÀ»°æ¿ì

ÇÔ¼ö¸¦ ÀÌ¿ëÇÏ¿© hash_value¸¦ ±¸ÇÏ´Â ¹æ¹ýÀÔ´Ï´Ù.

(¿¹Á¦)

select sql_id, hash_value, dbms_utility.sqlid_to_sqlhash (sql_id) tosqlhash  ,  ora_hash (sql_id)  toora_hash
  from v$sql
 where rownum <= 3;

 sql_id            hash_value  tosqlhash  toora_hash
------------- ----------- ---------- ------------
417pz6fqg8004 2901671940 2901671940 1591261794
417pz6fqg8004 2901671940 2901671940 1591261794
a8vnwcvk30004 3828350980 3828350980 493111963



############################  SQL ID ¸¦ ¾Ë ¶§ ÇÃ·£ ÃßÃâ¹ý

select  /*+ NO_MERGE */ rownum  || 
decode(access_predicates,NULL,decode(filter_predicates,NULL,'','*'),'*') "I",
        substr(lpad(' ',2*(depth-1)) || operation,1,20) || 
        decode(options,NULL,'',' (' || options || ')') "Operation",
        substr(object_name,1,30) "Object Name",
        cardinality "# Rows",
        bytes,
        cost,
        partition_start "PStart",
        partition_stop "PStop"
  from (select * from v$sql_plan where SQL_ID IN ('2pdjvmfkaq0d8')) a  --,'5wvzjkgm1cx23'
  start with id = 0
  connect by prior id = parent_id
      and prior nvl(hash_value, 0 ) = nvl(hash_value, 0 )
  order by id, position
/

or

select * from table(dbms_xplan.display_cursor('6z3pw0rbrad4r'));
  

############################ xplan 

EXPLAIN PLAN SET STATEMENT_ID='SQL1' FOR
select *
  from (select last_load_time ,
               inst_id as i_id ,
               sql_id ,
               round(RATIO_TO_REPORT(buffer_gets) OVER (PARTITION BY module), 4)*100 AS RATIO,
               round(elapsed_time / 1000000 / executions, 3) as avgtime,
               buffer_gets,
               round(buffer_gets / executions, 0) avgbuffer,
               rank() over (partition by inst_id
                 order by buffer_gets desc, executions desc) rnk,
               executions as exec ,
               substr(sql_text, 1, 100) as sql_text
          FROM gV$sqlarea a
         WHERE executions > 1 )
 order by i_id,
       rnk ;
       
       
       
select * from table(dbms_xplan.display('plan_table','SQL1','all'));
       
select * from table(dbms_xplan.display('plan_table','SQL1','aDVANCED'));     

allstats last -rows

gather_plan_statistics

allstats last -rows


-- dbms_xplan.display_cursor ÇÔ¼ö´Â ±ò²ûÇÏ°Ô Æ÷¸ËÆÃÇØ ÁÖ´Â ±â´ÉÀ» Á¦°øÇÑ´Ù. 
-- Ã¹¹øÂ° ÀÎÀÚ, µÎ¹øÂ° ÀÎÀÚ°¡ NULL ÀÌ¸é °¡Àå ÃÖ±Ù ¼öÇàÇÑ SQL 

select * from table( dbms_xplan.display_cursor( '02hcvpc03nvtj', 0, 
'IOSTATS')); 

select * from table( dbms_xplan.display_cursor( '02hcvpc03nvtj', 0, 
'MEMSTATS')); 

select * from table( dbms_xplan.display_cursor( '02hcvpc03nvtj', 0, 
'IOSTATS MEMSTATS')); 

select * from table( dbms_xplan.display_cursor( '0qn5ng396n5r3', 0, 'ALLSTATS')); 

select * from table( dbms_xplan.display_cursor( '02hcvpc03nvtj', 0, 'allstats last -rows')); 
select * from table( dbms_xplan.display_cursor( '0qn5ng396n5r3', 0, 'allstats last -rows')); 


d2uup6w49pv8n
----------------------------------------------
select /*+ gather_plan_statistics*/ * from dpow_osz.TB_OSZ_PTY where rownum < 10;
select  * from table( dbms_xplan.display_cursor( null,null, 'ALLSTATS LAST')); 


SQL> select /*+ gather_plan_statistics*/ * from dpow_osz.TB_OSZ_PTY where rownum < 10;

PTY_ID               PTY_DV_CD  PTY_KOR_NM                                                                                           PTY_ENM                                                                                              PTY_ABV_NM                                                                                           PTY_DESC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         CO_DV_CD   DPT_DV_CD  DPT_DTL_DV UP_PTY_ID            CO_BY_PTY_ID         SORT_O IM_CODE                                                          CHG_DATE            CHGR_EMPNO           CNVG_EMPNO           CNVG_LGN_ID          DACOM_CO_PTY_ID      PWC_CO_PTY_ID       
-------------------- ---------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- ---------- ---------- -------------------- -------------------- ------ ---------------------------------------------------------------- ------------------- -------------------- -------------------- -------------------- -------------------- --------------------
100397               A          T090216-000168                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000168                                                                               2009/02/16 23:30:49 SYS020                                                                                                  
100404               A          T090216-000175                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000175                                                                               2009/02/16 23:30:51 SYS020                                                                                                  
100405               A          T090216-000176                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000176                                                                               2009/02/16 23:30:52 SYS020                                                                                                  
100406               A          T090216-000177                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000177                                                                               2009/02/16 23:30:52 SYS020                                                                                                  
100407               A          T090216-000178                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000178                                                                               2009/02/16 23:30:52 SYS020                                                                                                  
100408               A          T090216-000179                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000179                                                                               2009/02/16 23:30:52 SYS020                                                                                                  
100409               A          T090216-000180                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000180                                                                               2009/02/16 23:30:53 SYS020                                                                                                  
100410               A          T090216-000181                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000181                                                                               2009/02/16 23:30:53 SYS020                                                                                                  
100411               A          T090216-000182                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        T090216-000182                                                                               2009/02/16 23:30:54 SYS020                                                                                                  

9 rows selected.

SQL> select  * from table( dbms_xplan.display_cursor( null,null, 'ALLSTATS LAST'));

PLAN_TABLE_OUTPUT                                                                                                                                                                                                                                                                                           
----------------------------------------------------------------------------------------
SQL_ID  1uzmm0qkspnhn, child number 0                                                                                                                                                                                                                                                                       
-------------------------------------                                                                                                                                                                                                                                                                       
select /*+ gather_plan_statistics*/ * from dpow_osz.TB_OSZ_PTY where rownum < 10                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                            
Plan hash value: 2346565504                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                            
-------------------------------------------------------------------------------------------                                                                                                                                                                                                                 
| Id  | Operation          | Name       | Starts | E-Rows | A-Rows |   A-Time   | Buffers |                                                                                                                                                                                                                 
-------------------------------------------------------------------------------------------                                                                                                                                                                                                                 
|   0 | SELECT STATEMENT   |            |      1 |        |      9 |00:00:00.01 |       7 |                                                                                                                                                                                                                 
|*  1 |  COUNT STOPKEY     |            |      1 |        |      9 |00:00:00.01 |       7 |                                                                                                                                                                                                                 
|   2 |   TABLE ACCESS FULL| TB_OSZ_PTY |      1 |    100 |      9 |00:00:00.01 |       7 |                                                                                                                                                                                                                 
-------------------------------------------------------------------------------------------                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                            
Predicate Information (identified by operation id):                                                                                                                                                                                                                                                         
---------------------------------------------------                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                            
1 - filter(ROWNUM<10)                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                            

19 rows selected.


select  * from table( dbms_xplan.display_cursor( null,null, 'ALLSTATS LAST -ROWS'));

######################  Æ¯Á¤ USER¿¡¼­ DDL µîÀÇ COMMAND ½ÇÇàÀ» Á¦ÇÑÇÏ´Â ¹æ¹ý - DDL EVENT TRIGGER
=======================================================================
Purpose

User¿¡ ÀÖ´Â tableµî¿¡ DDL ¹®ÀåÀÌ ½ÇÇàµÇÁö ¾Êµµ·Ï ¸·°í ½ÍÀº °æ¿ì°¡ ÀÖ´Ù.
Oracle8.1.6 ºÎÅÍ »ç¿ë°¡´ÉÇÑ system trigger¿¡ ÀÇÇØ ÀÌ·± ±â´ÉÀ» ±¸ÇöÇØ º¸ÀÚ.

ÃâÃ³ : http://kr.forums.oracle.com/forums/thread.jspa?threadID=477235&tstart=15

Explanation
--------------------------------------------------------------------------------
Oracle8.1.6 ÀÇ new featureÀÎ DDL event trigger¸¦ ÀÌ¿ëÇÏ¿© Æ¯Á¤ user¿¡¼­
Æ¯Á¤ DDL(¿¹¸¦ µé¾î create, drop, truncate µî)ÀÌ³ª ¸ðµç DDLÀÌ ½ÇÇàÇÒ ¶§
¿¡·¯¸¦ ¹ß»ý½ÃÅ²´Ù°Å³ª Æ¯Á¤ÇÑ actionÀ» ÇÏµµ·Ï ¼³Á¤ÇÒ ¼ö ÀÖ´Ù.
DML ÀÇ °æ¿ì´Â ±âÁ¸ÀÇ trigger ´ë·Î °¢ object¿¡ ´ëÇØ °¢°¢ »ý¼ºÇÏ¿©¾ß ÇÑ´Ù.

ÀÌ ÀÚ·á¿¡¼­´Â ÁÖ·Î DDL ÀÌ³ª DML ÀÌ ½ÇÇàµÉ ¶§ ¿¡·¯¸¦ ¹ß»ýÇÏµµ·Ï ÇÏ¿© ÇØ´ç
¹®ÀåÀÌ ½ÇÇàµÇÁö ¾Êµµ·Ï ÇÏ´Â ¹æ¹ýÀ» ±â¼úÇÏ¿´´Ù.
(system or ddl event trigger¿¡ ´ëÇÑ ´Ù¸¥ ÀÚ·á·Î Bulletin 11903,11848 Âü°í)

DDL event trigger ¸¦ ÀÌ¿ëÇÏ±â À§ÇØ¼­´Â $ORACLE_HOME/dbs/initSID.ora
file¿¡¼­ COMPATIBLE parameterÀÇ °ªÀÌ "8.1.6" ÀÌ»óÀ¸·Î ¼³Á¤µÇ¾î ÀÖ¾î¾ß ÇÑ´Ù.

DDL event trigger ´Â °¢ DDLÀÌ ¹ß»ýÇÒ ¶§¿¡ ½ÇÇàµÇ´Â trigger·Î
´ÙÀ½°ú °°Àº ½ÃÁ¡¿¡¼­ ½ÇÇàµÇµµ·Ï ¸¸µé ¼ö ÀÖ´Ù.

BEFORE ALTER, AFTER ALTER, BEFORE DROP, AFTER DROP,
BEFORE ANALYZE, AFTER ANALYZE, BEFORE ASSOCIATE STATISTICS,
AFTER ASSOCIATE STATISTICS, BEFORE AUDIT, AFTER AUDIT,
BEFORE NOAUDIT, AFTER NOAUDIT, BEFORE COMMENT, AFTER COMMENT,
BEFORE CREATE, AFTER CREATE, BEFORE DDL, AFTER DDL,
BEFORE DISASSOCIATE STATISTICS, AFTER DISASSOCIATE STATISTICS,
BEFORE GRANT, AFTER GRANT, BEFORE RENAME, AFTER RENAME,
BEFORE REVOKE, AFTER REVOKE, BEFORE TRUNCATE, AFTER TRUNCATE

Example
--------------------------------------------------------------------------------
* ¾Æ·¡ÀÇ trigger ¸¦ system µîÀÇ º°µµ·Î °ü¸®ÇÏ´Â dba user¿¡¼­ »ý¼ºÇÑ´Ù.

¿¹Á¦1 EJ user¿¡¼­ table°ú index¿¡ ÇØ´çÇÏ´Â DDLÀÇ ½ÇÇàÀ» ¸·´Â °æ¿ì

$ sqlplus system/manager

CREATE OR REPLACE TRIGGER ej_no_ddl
before DDL ON ej.schema
WHEN (ora_dict_obj_type = 'TABLE' or
ora_dict_obj_type = 'INDEX')
begin
raise_application_error (-20101, 'Cannot execute any DDL !!');
end;
/

-> À§ÀÇ trigger´Â ej userÀÇ schema ¿¡¼­ Table°ú Index ¿¡ ´ëÇÑ DDLÀÌ
½ÇÇàµÉ ¶§ user-defined error ora-20101 ÀÌ ¹ß»ýÇÏµµ·Ï ÇÑ °ÍÀÌ´Ù.

¿¹Á¦2 EJ user¿¡¼­ ½ÇÇàµÇ´Â ¸ðµç DDLÀ» ¸·´Â °æ¿ì

$ sqlplus system/manager

CREATE OR REPLACE TRIGGER ej_no_ddl
before DDL ON ej.schema
begin
raise_application_error (-20101, 'Cannot execute any DDL !!');
end;
/

-> À§ÀÇ ¿¹Á¦´Â ¸ðµç DDL ÀÌ ½ÇÇàµÉ ¶§ ¿¡·¯¸¦ ¹ß»ý½ÃÅ°°Ô µÈ´Ù.


¿¹Á¦1°ú 2ÀÇ °æ¿ì EJ user¿¡¼­ DDL ½ÇÇà½Ã ¾Æ·¡¿Í °°Àº ¿¡·¯°¡ ¹ß»ýÇÑ´Ù.


$ sqlplus ej/ej

SQL> create table test ( a number );
create table test ( a number )
*
ERROR at line 1:
ORA-00604: error occurred at recursive SQL level 1
ORA-20101: Cannot execute any DDL !!
ORA-06512: at line 2

SQL> drop table dept;
drop table dept
*
ERROR at line 1:
ORA-00604: error occurred at recursive SQL level 1
ORA-20101: Cannot execute any DDL !!
ORA-06512: at line 2

 

¿¹Á¦3 EJ user¿¡¼­ ½ÇÇàµÇ´Â drop°ú truncate ¹®ÀåÀ» ¸·´Â °æ¿ì

$ sqlplus system/manager

CREATE OR REPLACE TRIGGER ej_no_ddl
before drop or truncate ON ej.schema
begin
raise_application_error (-20102, 'Cannot execute DROP or TRUNCATE !!');
end;
/

À§¿Í °°ÀÌ trigger¸¦ »ý¼ºÇÑ °æ¿ì EJ user¿¡¼­ tableÀÇ »ý¼ºÀº µÇÁö¸¸ dropÀº ÇÒ ¼ö
¾ø´Ù.

$ sqlplus ej/ej

SQL> create table test2 ( a number );

Table created.

SQL> drop table test2;
drop table test2
*
ERROR at line 1:
ORA-00604: error occurred at recursive SQL level 1
ORA-20102: Cannot execute DROP or TRUNCATE !!
ORA-06512: at line 2

 

¿¹Á¦4 EJ userÀÇ docu2 table¿¡ ´ëÇÑ dmlÀ» ¸·´Â °æ¿ì

$ sqlplus system/manager

CREATE OR REPLACE TRIGGER ej_no_dml_docu2
before insert or update or delete on ej.docu2
begin
raise_application_error (-20103, 'Cannot execute DML');
end;
/


$ sqlplus ej/ej

SQL> delete from docu2 where docu_id=2;
delete from docu2 where docu_id=2
*
ERROR at line 1:
ORA-20103: Cannot execute DML
ORA-06512: at "SYSTEM.EJ_NO_DML_DOCU2", line 2
ORA-04088: error during execution of trigger 'SYSTEM.EJ_NO_DML_DOCU2'


* tableÀÇ ÀÛ¾÷À» À§ÇØ ÀÏ½ÃÀûÀ¸·Î triggerÀÇ ±â´ÉÀ»
disable ¶Ç´Â enable½ÃÅ³ ¼ö ÀÖ´Ù.

$ sqlplus system/manager

SQL> alter trigger ej_no_ddl disable;

or

SQL> alter trigger ej_no_ddl enable;



############################ awr °ú°Å ÇÃ·£ ÃßÃâ

select * from table(dbms_xplan.display_awr('78v968su1ypr4'));

############################  »ó¼¼ ÇÃ·£ ÃßÃâ¹ý
explain plan for
<sql>

select * from table(dbms_xplan.display('plan_table',null,'all'));

¡Ø ¼¼¼Ç ½ºÅ°¸¶ º¯°æ
alter session set current_schema=PBC;
alter session set current_schema=SYSTEM;


ex)

select * from table(dbms_xplan.display('plan_table',null,'all'));


ex2)

TONG:SQL> EXPLAIN PLAN FOR
  2  @101020_OSP_ÇÑÁøÈñ.sql

Explained.

TONG:SQL> select * from table(dbms_xplan.display);


--¡Ø ¼¼¼Ç ½ºÅ°¸¶ º¯°æ
alter session set current_schema=PBC;
alter session set current_schema=POW;

explain plan for
  SELECT
    FC_BZZZGET_UP_ORG_NM(E.MNG_ORG_CD)                    BRANCH_NM
   ,FC_BZZZGET_ORG_NM(E.MNG_ORG_CD)                       TEAM_NM
   ,C.AGCY_NM                                             AGCY_NM
   ,C.AGCY_CD                                             AGCY_CD
   ,FC_BZZZGET_COMM_CD_VAL('AGCY_TYP', C.AGCY_TYP)        AGCY_TYP
   ,''                                                    TASK_RCP_TYP_NM
   ,FC_BBPMGET_SVC_NM(A.SVC_CD)                           SVC_CD_NM                  
   ,''                                                    SEL_CHNL_TYP_NM
   ,SUM(TOT_OPEN_USED_TM_HH)                              TOT_OPEN_LEAD_TIME
   ,SUM(OPEN_CMPLT_CNT)                                   OPEN_CMPLT_CNT
   ,ROUND(SUM(TOT_OPEN_USED_TM_HH)/ DECODE(SUM(OPEN_CMPLT_CNT),0,1,SUM(OPEN_CMPLT_CNT))) AVG_OPEN_LEAD_TIME
  FROM TB_BMRSDW_OPEN   A
  ,    TB_BMRSCSALES_CD B
  ,    TB_BMISAGCY      C
  ,    TB_BMRSINDC_PATH D
  ,    TB_BMRSCSALES_CD E  
  WHERE A.RST_FIND_TERM_TYP = :61                              --rstFindTermTypData
   AND   A.CSALES_CD         = B.CSALES_CD
   AND   E.SALES_PNT_NO      = C.AGCY_CD
   AND   E.CSALES_CD         = A.OPEN_CSALES_CD     
   AND   B.SEL_PATH_CD       = D.SEL_PATH_CD
   AND   A.RST_BASIS_YMD  BETWEEN  :62 AND :63                    --emstartTxData emEndTxData
   AND   C.AGCY_CD                          LIKE :64||'%'       --agencyComboData
   AND   C.AGCY_TYP                         = NVL( :65, C.AGCY_TYP )  -- 08.01.10 ´ë¸®Á¡À¯Çü Á¶°Ç Ãß°¡
   AND   D.SEL_CHNL_TYP                     LIKE :66||'%'       --selChnlTypData
   AND   A.RCP_TYP                          LIKE :67||'%'       --taskRcpTypData
   AND   B.MNG_ORG_CD                       LIKE :68||'%'       --teamComboData
   AND   FC_BZZZGET_UP_ORG_CD(B.MNG_ORG_CD) LIKE :69||'%'       --orgComboData
   AND   'ASS' = :70                                            --ioTyp ¼­ºñ½º À¯Ä¡Ã¤³Î Å¸½ºÅ©Å¸ÀÔ
  GROUP BY 
    FC_BZZZGET_UP_ORG_NM(E.MNG_ORG_CD)                   
   ,FC_BZZZGET_ORG_NM(E.MNG_ORG_CD)                      
   ,C.AGCY_NM 
   ,C.AGCY_CD
   ,C.AGCY_TYP                                           
   ,FC_BBPMGET_SVC_NM(A.SVC_CD)         







#################################### OWI



############# PX Deq Credit: send blkd
º´·ÄÄõ¸®½Ã ÀÌ ÀÌº¥Æ®°¡ ³ª¿À¸é, 

ÀÌ db¿¡¼­´Â µ¥ÀÌÅÍ ´Ù ³ª¿Ô°í
client¿¡¼­ fetch call¸¸ ±â´Ù¸®°í ÀÖ´Ù´Â ´ë±â°Åµç
°á°úÀûÀ¸·Î fetch callÀº ³¡³µ´Ù´Â°ÅÁö..
 
############## log file sync
from Practical OWI | exem | exem

log file sync Á¤ÀÇ
 
Server Process°¡ Commit , Rollback ¼öÇà ÈÄ LGWR process°¡ °ü·Ã Redo Record¸¦ Redo Buffer¿¡¼­ Redo Log ÆÄÀÏ·Î ±â·ÏÇÒ ¶§±îÁö ´ë±âÇÏ´Â event 

log file sync ¹ß»ýÀÇ ¿äÀÎ


ÀæÀº Commit È½¼ö
I/O ½Ã½ºÅÛÀÇ ¼º´É
REDO BUFFERÀÇ Áö³ªÄ£ Å©±â
¸®µÎµ¥ÀÌÅÍÀÇ ¾ç


log file sync ´Â À§ÀÇ ¿äÀÎÀ» º¸¸é °á°úÀûÀ¸·Î REDO LOG BUFFER ÀÇ ³»¿ë (DIRTY BUFFER) À» REDO LOG FILE ·Î ³»·Á¾²´Âµ¥ »ç¿ëµÇ´Â ½Ã°£°ú °ü·ÃÀÖ´Ù. 
DIRTY BUFFER´Â DML ÀÛ¾÷À¸·Î »ý°Ü³ª±â ¶§¹®¿¡ DMLÀÇ ¾çÀÌ ¸¹¾ÆÁö¸é ³»·Á¾²´Âµ¥ ÇÊ¿äÇÑ ½Ã°£ ¿ª½Ã ´Ã¾î³­´Ù. ÀÌ¿Í °°Àº Â÷¿øÀÇ ÀÌ¾ß±â·Î REDO BUFFERÀÇ Å©±âµµ ¿¬°üµÇ¾îÀÖ´Ù. 
LGWR°¡ µ¥ÀÌÅÍ¸¦ ±â·ÏÇÏ´Âµ¥ Å©°Ô ÁÂ¿ìµÇ´Â ºÎºÐÀ¸·Î I/O ½Ã½ºÅÛÀÇ ¼º´É ¿ª½Ã ¹«½ÃÇÒ ¼ö ¾ø´Ù. 

·ÎÄÃÈ¯°æ¿¡¼­ LOG FILE SYNC ÀÌº¥Æ®¸¦ º¸±â À§ÇØ¼­´Â ´ë·®ÀÇ DMLÀ» ¸¸µç ÈÄ ÇÑ²¨¹ø¿¡ ³»·Á¾²±â ( COMMIT ) ¸¦ ÇØ¾ßµÈ´Ù. 

 log file sync ¿¹Á¦ /*+ ¸¸µé¾î º¼ °Í¡¦ */

¹æ¹ý 1 : ´ë·®ÀÇ DML »ý¼º ÈÄ COMMIT

SQL> begin
  2     for i in 1..10 loop
  3             insert into test2 select * from test;
  4     end loop;
  5  end;
6  /
 

¹æ¹ý 2 : ÀæÀº COMMIT

¹æ¹ý 1Àº Áß°£¿¡ ROLLBACKÀ» ½ÃÇàÇØ Á¦´ë·Î È®ÀÎÇÏÁö ¸øÇÏ¿´´Ù. ÁøÇàÁß¿¡µµ REDO LOG BUFFER ÀÇ ³»¿ëÀÌ 1M ¿¡ ´ÞÇßÀ» ¶§ 3ÃÊ¿¡ ÇÑ¹ø¾¿ REDO BUFFERÀÇ 1/3À» Â÷ÁöÇÒ ¶§ µî ´Ù¾çÇÑ Á¶°ÇÀÌ ÀÖ¾î »óÈ²¸¸µé±â°¡ ¾î·ÆÁö ¾Ê¾Ò³ª ½Í´Ù. 

¹æ¹ý2ÀÇ °æ¿ì¿£ EVENT¸¦ È®ÀÎÇÏ±â´Â ÇÏ¿´´Ù. EVENT¸¦ º¸±â À§ÇØ ¾Æ·¡¿Í °°Àº ½ºÅ©¸³Æ®¸¦ »ç¿ëÇÏ¿´´Ù. 


select event, p1, p1text, wait_time
from v$session_wait
where event like '%log file sync%'
/
log file sync event¸¦ ¸¸µé¾î³»±â À§ÇØ ¾Æ·¡¿Í °°Àº ½ºÅ©¸³Æ®¸¦ ¼¼°³ÀÇ ¼¼¼Ç¿¡¼­ µ¿½Ã¼öÇàÇÏ¿´´Ù. 
´Ù¸¸ update À§Ä¡ empno À» Á¦°¢°¢ ´Ù¸£°Ô ÇÏ¿´´Ù. ( ÀÌ °úÁ¤À» ¼öÇàÇÏÁö ¾ÊÀ¸¸é ¼­·Î ¶ôÀ» °É°í ´ë±â»óÅÂ¿¡ ºüÁú ¼ö ÀÖ´Ù. )


begin
        for i in 1..100000 loop
                update emp set sal = 1111 where empno=7788;
                execute immediate 'commit';
                update emp set sal = 9999 where empno=7788;
        end loop;
end;

/


À§ ½ºÅ©¸³Æ®¸¦ µ¹¸®¸é¼­ ¿øÇÏ´Â event¸¦ Àâ¾Æ³ÂÁö¸¸ Á¤¸» ¼ø°£ÀÌ¶ó°í ÇÒ ¸¸Å­ ÂªÀº wait Å¸ÀÓÀÌ´Ù. ·ÎÄÃ¿¡¼­ ±ä wait ¸¦ ¸¸µé±â À§ÇØ¼­´Â Á» ´õ »ý°¢ÇÒ ÇÊ¿ä°¡ ÀÖ´Â µí ÇÏ´Ù.







######### AWR ºä·ÎºÎÅÍ db ¼º´É ÁöÇ¥º¸±â

"select TO_CHAR(BEGIN_INTERVAL_TIME, 'YYYY-MM-DD_HH24:MI') DT,
               ROUND(SUM(DECODE(V.STAT_NAME,'DB CPU', V.value2,0))/1000000,0) AS DB_CPU_SEC,
               SUM(DECODE(V.STAT_NAME,'session logical reads'   , V.value2,0)) AS LReads,
               SUM(DECODE(V.STAT_NAME,'physical reads'          , V.value2,0)) AS PReads,
               SUM(DECODE(V.STAT_NAME,'parse count (hard)'      , V.value2,0)) AS HardParsing,    
               SUM(DECODE(V.STAT_NAME,'execute count'           , V.value2,0)) AS Exec,    
               SUM(DECODE(V.STAT_NAME,'user commits'            , V.value2,'user rollbacks',V.value2,0)) AS TX
        FROM 
        (
        SELECT  /*+ PUSH_PRED(T) */ S.BEGIN_INTERVAL_TIME,                         
                T.STAT_NAME,
               NVL(ROUND(DECODE(SIGN(T.value - LAG(T.value, 1) over (Partition by T.STAT_NAME Order by S.BEGIN_INTERVAL_TIME)), -1, 0, 
                                           T.value - LAG(T.value, 1) over (Partition by T.STAT_NAME Order by S.BEGIN_INTERVAL_TIME)), 0),0) AS value2
                
        from   dba_hist_sys_time_model T,
               DBA_HIST_SNAPSHOT S,
               (SELECT INSTANCE_NUMBER,
                       MAX(SNAP_ID) MAX_SNAP_ID,
                       MIN(SNAP_ID) MIN_SNAP_ID
                FROM   DBA_HIST_SNAPSHOT
                WHERE  BEGIN_INTERVAL_TIME >= TO_DATE(TO_CHAR(sysdate -31,'YYYYMMDD')||'090000','YYYYMMDD HH24:MI:SS') -- Begin 
                  AND  BEGIN_INTERVAL_TIME <= TO_DATE(TO_CHAR(sysdate -1,'YYYYMMDD')||'195959','YYYYMMDD HH24:MI:SS')-- End 
                AND    INSTANCE_NUMBER = (select instance_number from   v$instance)
                GROUP BY INSTANCE_NUMBER ) V
        WHERE  T.SNAP_ID = S.SNAP_ID
        AND    S.SNAP_ID BETWEEN V.MIN_SNAP_ID AND V.MAX_SNAP_ID
        and    T.INSTANCE_NUMBER = S.INSTANCE_NUMBER
        AND    S.INSTANCE_NUMBER = V.INSTANCE_NUMBER
        AND    T.STAT_NAME = 'DB CPU'
        UNION ALL                               
        SELECT  /*+ PUSH_PRED(T) */ S.BEGIN_INTERVAL_TIME,                        
                T.STAT_NAME,
               NVL(ROUND(DECODE(SIGN(T.value - LAG(T.value, 1) over (Partition by T.STAT_NAME Order by S.BEGIN_INTERVAL_TIME)), -1, 0, 
                                           T.value - LAG(T.value, 1) over (Partition by T.STAT_NAME Order by S.BEGIN_INTERVAL_TIME)), 0),0) AS value2
                
        from   dba_hist_sysstat T,
               DBA_HIST_SNAPSHOT S,
               (SELECT INSTANCE_NUMBER,
                       MAX(SNAP_ID) MAX_SNAP_ID,
                       MIN(SNAP_ID) MIN_SNAP_ID
                FROM   DBA_HIST_SNAPSHOT
                WHERE  BEGIN_INTERVAL_TIME >= TO_DATE(TO_CHAR(sysdate -31,'YYYYMMDD')||'090000','YYYYMMDD HH24:MI:SS') -- Begin 
                  AND  BEGIN_INTERVAL_TIME <= TO_DATE(TO_CHAR(sysdate -1,'YYYYMMDD')||'195959','YYYYMMDD HH24:MI:SS')-- End 
                AND    INSTANCE_NUMBER = (select instance_number from   v$instance)
                GROUP BY INSTANCE_NUMBER ) V
        WHERE  T.SNAP_ID = S.SNAP_ID
        AND    S.SNAP_ID BETWEEN V.MIN_SNAP_ID AND V.MAX_SNAP_ID
        and    T.INSTANCE_NUMBER = S.INSTANCE_NUMBER
        AND    S.INSTANCE_NUMBER = V.INSTANCE_NUMBER
        AND    T.STAT_NAME in ('session logical reads','physical reads',
                               'parse count (hard)','execute count','user commits','user rollbacks')
        ) V
WHERE TO_CHAR(BEGIN_INTERVAL_TIME,'HH24') >= '08'
  AND TO_CHAR(BEGIN_INTERVAL_TIME,'HH24') < '20'
GROUP BY TO_CHAR(BEGIN_INTERVAL_TIME, 'YYYY-MM-DD_HH24:MI')
ORDER BY 1"


######### hash_value ·ÎºÎÅÍ sql_id ÃßÃâÇÏ¿© dba_hist ºä·ÎºÎÅÍ ±â°£º° ½º³Àº° sqlstat ÃßÃâ

SELECT *
FROM   V$SQL
WHERE  HASH_VALUE='2387646750';
 
SELECT *
FROM   DBA_HIST_SQLSTAT H,
       (SELECT INSTANCE_NUMBER,
               MAX(SNAP_ID) MAX_SNAP_ID,
               MIN(SNAP_ID) MIN_SNAP_ID
        FROM   DBA_HIST_SNAPSHOT
        WHERE  BEGIN_INTERVAL_TIME >= TO_DATE(TO_CHAR(sysdate, 'YYYYMMDD')||'100000', 'YYYYMMDD HH24:MI:SS') -- Begin 
        AND    BEGIN_INTERVAL_TIME <= TO_DATE(TO_CHAR(sysdate, 'YYYYMMDD')||'115959', 'YYYYMMDD HH24:MI:SS') -- End 
        AND    INSTANCE_NUMBER = (select instance_number
                from   v$instance)
        GROUP BY INSTANCE_NUMBER ) V
WHERE  1=1
AND    H.SNAP_ID BETWEEN V.MIN_SNAP_ID AND V.MAX_SNAP_ID
AND    H.INSTANCE_NUMBER = V.INSTANCE_NUMBER
AND    H.SQL_ID = ('aqnn7sk75168y')
ORDER BY SNAP_ID DESC;



######### AWR ºä·ÎºÎÅÍ,  Æ¯Á¤ ½º³À±¸°£ÀÇ °¢ ÁöÇ¥ º°  top sql ÃßÃâ
select x.sql_id,x.PARSING_SCHEMA_NAME,y.sql_text,y.COMMAND_TYPE,x.SUM_Bget,SUM_EXEC
from
(
SELECT  SQL_ID,PARSING_SCHEMA_NAME, SUM(buffer_gets_DELTA) SUM_Bget, SUM(executions_DELTA) SUM_EXEC
FROM    DBA_HIST_SQLSTAT
WHERE   
     (SNAP_ID BETWEEN 67335 AND 67340 ) -- 07/04 67335 67340
  OR (SNAP_ID BETWEEN 68343 AND 68348 ) -- 07/11 68343 68348
  OR (SNAP_ID BETWEEN 69351 AND 69356 ) -- 07/18 69351 69356
  OR (SNAP_ID BETWEEN 70359 AND 70364 ) -- 07/25 70359 70364
  OR (SNAP_ID BETWEEN 71367 AND 71372 ) -- 08/01 71367 71372

GROUP BY SQL_ID,PARSING_SCHEMA_NAME
) x,
dba_hist_sqltext y
where x.sql_id = y.sql_id(+)

ORDER BY 5 DESC



######### AWR ºä·ÎºÎÅÍ, SQL_ID º° SNAP_ID º° STAT º¸±â

SELECT * FROM DBA_HIST_SQLSTAT WHERE SQL_ID = ('26fxj5qbwf6jz')
ORDER BY SNAP_ID DESC;


######### AWR REPORT ÃßÃâ ¹æ¹ý

$ORACLE_HOME/rdbms/admin/awrrpt.sql

Specify the Begin and End Snapshot Ids
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Enter value for begin_snap:  
½Ã°£°£°ÝÀ» º¸°í ½ÃÀÛ, ³¡ ½º³À¾ÆÀÌµð ÀÔ·Â

report ÆÄÀÏ¸í ÀÔ·Â

SQL> !ll awr*
-rw-r--r--   1 ora10g     dba          38923 2007.12.17   awrinfo.sql
-rw-r--r--   1 ora10g     dba          11226 2005.08.04   awrinput.sql
-rw-r--r--   1 ora10g     dba           1999 2007.12.17   awrrpt.sql
-rw-rw-r--   1 ora10g     dba         265693 8¿ù 20ÀÏ 08:54 awrrpt_1_5944_5947.html
-rw-r--r--   1 ora10g     dba           7861 2007.12.17   awrrpti.sql


-- snapshot Âï±â
EXECUTE DBMS_WORKLOAD_REPOSITORY.CREATE_SNAPSHOT();

select snap_interval, retention from dba_hist_wr_control;

--====================================
-- ÇÑ½Ã°£ ÁÖ±â·Î, 28ÀÏ°£ º¸°ü º¯°æ
begin
   dbms_workload_repository.modify_snapshot_settings (
      interval => 60, 
      retention => 28*24*60
   );
end;
/
commit;

select snap_interval, retention from dba_hist_wr_control;



######### AWR REPORT ÃßÃâ ¹æ¹ý #2 (dbms ÆÐÅ°Áö ÀÌ¿ë)
select * from (
select output from table(dbms_workload_repository.awr_report_text( :dbid,
                                                            :inst_num,
                                                            :bid, :eid,
                                                            :rpt_options ))
)
--where output like '%Begin Snap%' or output like '%End Snap%' 
;
/*
581337314
1
27416
27417
0
*/

dba_hist_snapshot º¸¸é dbid, snapid µî ÂüÁ¶




################## BEGIN/ENG BACKUP
-- µ¥ÀÌÅÍº£ÀÌ½º ·¹º§ (SCN¼ø¼­´ë·Î WRITE)
ALTER DATABASE BEGIN BACKUP;

-- Å×ÀÌºí½ºÆäÀÌ½º ·¹º§ (¹«ÀÛÀ§¼ø¼­ WRITE)
alter tablespace UNDOTBS2 BEGIN backup;
alter tablespace UNDOTBS2 end backup;



select 'ALTER TABLESPACE ' || TABLESPACE_NAME || ' BEGIN BACKUP ;' , 
'ALTER TABLESPACE ' || TABLESPACE_NAME || ' END BACKUP ;'
FROM DBA_TABLESPACES;




################## ÀÎ½ºÅÏ½º 2°³ ¶ç¿ì±â CREATE DATABASE




¿¹Àü¿¡ ¿À¶óÅ¬ ¼öµ¿ »ý¼ºÀÌ¶ó´Â ¸í·É¾î·Î À§¿Í °°Àº ±ÛÀ» ¿Ã¸° ÀûÀÌ ÀÖ¾ú´Ù.
Çåµ¥ ¿À´Ã ÀÌ¹Ì ¿À¶óÅ¬ÀÌ ¼³Ä¡ µÇ¾î ÀÖ´Â ¼­¹ö¿¡ ÀÎ½ºÅÏ½º¸¦ ÇÏ³ª ´õ ¶ç¿ì¶ó´Â Áö½Ã°¡ ÀÖ¾î ±ë°¡¹Ö°¡ ÇÏ¸é¼­ ÀÛ¾÷À» ÇØº¸´Ï¼º°øÇß´Ù.
ÀÏ´Ü À§ÀÇ ³»¿ëÀ» Âü°í ÇßÀ¸¸ç ORACLE_SID ¸¸À» º¯°æ ÇÔÀ¸·Î½á µ¥ÀÌÅÍ º£ÀÌ½ºÀÇ ÀÎ½ºÅÏ½º¸¦ °è¼Ó Ãß°¡ ÇÒ ¼ö ÀÖ´Ù´Â °ÍÀ»°æÇèÇß´Ù.

±âÁ¸¿¡ ORACLE_SID °¡ À§¿Í °°ÀÌ ORA10G ÀÌ°í »õ·Î ¸¸µé ORACLE_SID °¡ STAR ¶ó¸é ¸®´ª½º ÅÍ¹Ì³Î È¯°æ¿¡¼­

ORACLE_SID ¸¸ º¯°æ ¹× Àû¿ëÇÏ¿© »õ·Î µ¥ÀÌÅÍ º£ÀÌ½º¸¦ create ÇÒ ¼ö ÀÖ¾ú´Ù.

# setenv ORACLE_SID STAR

# sqlplus '/as sysdba'

SQL> create database STAR

         ........

         ........


ÀÏ´Ü ÀÛ¾÷Àº À§¿¡ °Ô½ÃµÈ ³»¿ë°ú °°ÀÌ initSTAR.ora ÆÄÀÏÀ» »ý¼º(º¹»ç) ÇÏ°í initSTAR.ora ÆÄÀÏ ³»¿¡ ±âÀçµÈ ³»¿ë ´ë·ÎÆú´õµîÀ» ¸¸µé¾îÁØ´Ù. adump, bdump, cdump, udump µî..

¸¶Âù°¡Áö·Î system01, sysaux01, temp01, redo01a.rdo, redo02a.rdo, ¹× »ý¼ºÇÒ Å×ÀÌºí ½ºÆäÀÌ½ºÀÇ dbf µ¥ÀÌÅÍ ÆÄÀÏÀÌ»ý¼ºµÉ µð·ºÅä¸®µµ ¸¸µé¾î ÁØ´Ù.

±× ÈÄ ÀÛ¾÷ ³»¿ëÀº ¾Æ·¡¿Í °°´Ù.


# setenv ORACLE_SID START

# sqlplus '/as sysdba'

SQL> startup nomount pfile="/oracle/app/product/10.2/dbs/initSTAR.ora";
ORACLE instance started.

Total System Global Area  683671552 bytes
Fixed Size                  1221252 bytes
Variable Size             180358524 bytes
Database Buffers          494927872 bytes
Redo Buffers                7163904 bytes
SQL> create database STAR
  2   controlfile reuse
  3    logfile
  4     group 1 ('/data/STAR/redo01a.rdo') size 10m reuse,
  5     group 2 ('/data/STAR/redo02a.rdo') size 10m reuse
  6    datafile '/data/STAR/system01.dbf' size 1024M reuse
  7     autoextend on
  8    sysaux
  9    datafile '/data/STAR/sysaux01.dbf' size 50m reuse
 10     autoextend on
 11    undo tablespace UNDOTBS2
 12    datafile '/data/STAR/UNDOTBS101.dbf' size 50m reuse
 13     autoextend on
 14    default temporary tablespace temp
 15    tempfile '/data/STAR/temp01.dbf' size 50m reuse
 16     autoextend on;

Database created.

SQL> shutdown immediate
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL>
SQL> startup
ORACLE instance started.
Total System Global Area  683671552 bytes
Fixed Size                  1221252 bytes
Variable Size             180358524 bytes
Database Buffers          494927872 bytes
Redo Buffers                7163904 bytes
Database mounted.
Database opened.
SQL>

 

=================================================================================================

 

´ÙÀ½Àº tnsnames.ora ¼³Á¤ ³»¿ë ÀÌ´Ù.

# tnsnames.ora Network Configuration File: /oracle/app/product/10.2/network/admin/tnsnames.ora
# Generated by Oracle configuration tools.

LISTENER =
   (DESCRIPTION_LIST =
        (DESCRIPTION =
                (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1))
        )
        (DESCRIPTION =
                (ADDRESS = (PROTOCOL = TCP)(HOST = RIANDB)(PORT = 1521))
   )
        (DESCRIPTION =
                (ADDRESS = (PROTOCOL = TCP)(HOST = RIANDB)(PORT = 2481))
                (PROTOCOL_STACK =
                (PRESENTATION = GIOP)
                (SESSION = RAW)
                )
         )
   )
SID_LIST_LISTENER =
(SID_LIST =
  (SID_DESC =
     (SID_NAME = PLSExtProc)
     (ORACLE_HOME = /oracle/app/product/10.2)
     (PROGRAM = extproc)
  )
  (SID_DESC =
     (GLOBAL_DBNAME = ORA10G)
     (ORACLE_HOME = /oracle/app/product/10.2)
     (SID_NAME = ORA10G)
  )
)
SID_LIST_LISTENER1 =
  (SID_LIST =
    (SID_DESC =
      (SID_NAME = PLSExtProc)
      (ORACLE_HOME = /oracle/app/product/10.2)
      (PROGRAM = extproc)
    )
    (SID_DESC =
      (GLOBAL_DBNAME = STAR)
      (ORACLE_HOME = /oracle/app/product/10.2)
      (SID_NAME = STAR)
    )
  )
  
LISTENER1 =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
  #    (ADDRESS = (PROTOCOL = TCP)(HOST = localhost.localdomain)(PORT = 1521))
      (ADDRESS = (PROTOCOL = TCP)(HOST = RIANDB)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC0))
    )
   )

=============================================================================================================

Âü°í·Î ÇÑ°¡Áö ´õ ¾ê±â ÇÏÀÚ¸é À§¿Í °°ÀÌ µ¥ÀÌÅÍº£ÀÌ½º »ý¼º ÈÄ¿¡ Åäµå³ª DBA2009 °°Àº
Å¬¶óÀÌ¾ðÆ® ÇÁ·Î±×·¥À¸·Î Á¢¼Ó½Ã ¾Ö·¯°¡ ¹ß»ý ÇÒ ¼ö ÀÖ´Ù
¾Ö·¯ÇØ?¹æ¹ýÀº ÆÐÄ¡¸¦ °¡Áö¸¸ ÇØÁÖ¸é µÇ´Âµ¥ ´ÙÀ½ ÆäÀÌÁö¸¦ ÂüÁ¶ÇÏµµ·Ï ÇÏÀÚ

/oracle/app/product/10.2/rdbms/admin ¹Ø¿¡¼­
   catalog.sql catproc.sql utlrp.sql 
/oracle/app/product/10.2/javavm/install ¹Ø¿¡ rmjvm.sql ½ÇÇàÇÑ´Ù


SQL> startup nomount pfile="/oracle/app/product/10.2/dbs/initSTAR.ora";
ORACLE instance started.

SQL> create database STAR
  2   controlfile reuse
  3    logfile
  4     group 1 ('/data/STAR/redo01a.rdo') size 10m reuse,
  5     group 2 ('/data/STAR/redo02a.rdo') size 10m reuse
  6    datafile '/data/STAR/system01.dbf' size 1024M reuse
  7     autoextend on
  8    sysaux
  9    datafile '/data/STAR/sysaux01.dbf' size 50m reuse
 10     autoextend on
 11    undo tablespace UNDOTBS2
 12    datafile '/data/STAR/UNDOTBS101.dbf' size 50m reuse
 13     autoextend on
 14    default temporary tablespace temp
 15    tempfile '/data/STAR/temp01.dbf' size 50m reuse
 16     autoextend on;



startup nomount pfile="/sw/oracle/product/10.2.0/dbs/initLGDPOSJ.ora";



STARTUP NOMOUNT
CREATE CONTROLFILE REUSE DATABASE "LGDPOSJ" NORESETLOGS  NOARCHIVELOG
    MAXLOGFILES 16
    MAXLOGMEMBERS 3
    MAXDATAFILES 100
    MAXINSTANCES 8
    MAXLOGHISTORY 4672
LOGFILE
  GROUP 1 (
    '/data004/LGDPOSJ/rl_dposj11.log',
    '/data005/LGDPOSJ/rl_dposj12.log'
  ) SIZE 100M,
  GROUP 2 (
    '/data004/LGDPOSJ/rl_dposj21.log',
    '/data005/LGDPOSJ/rl_dposj22.log'
  ) SIZE 100M,
  GROUP 3 (
    '/data004/LGDPOSJ/rl_dposj31.log',
    '/data005/LGDPOSJ/rl_dposj32.log'
  ) SIZE 100M
-- STANDBY LOGFILE

  DATAFILE '/data001/LGDPOSJ/system01.dbf' size 1024M reuse
  sysaux
  datafile '/data001/LGDPOSJ/sysaux01.dbf' size 1024m reuse
  undo tablespace UNDOTBS2
  datafile '/data001/LGDPOSJ/undotbs01.dbf' size 1024M reuse
  default temporary tablespace temp
  tempfile '/data001/LGDPOSJ/temp01.dbf' size 1024M reuse

CHARACTER SET KO16MSWIN949
;
-- Commands to re-create incarnation table
-- Below log names MUST be changed to existing filenames on
-- disk. Any one log file from each branch can be used to
-- re-create incarnation records.
-- ALTER DATABASE REGISTER LOGFILE '/data004/LGDPOSJ/flash_recovery_area/LGDPOSJ/archivelog/2010_09_06/o1_mf_1_1_%u_.arc
';
-- ALTER DATABASE REGISTER LOGFILE '/data004/LGDPOSJ/flash_recovery_area/LGDPOSJ/archivelog/2010_09_06/o1_mf_1_1_%u_.arc
';
-- Recovery is required if any of the datafiles are restored backups,
-- or if the last shutdown was not normal or immediate.
RECOVER DATABASE
-- Database can now be opened normally.
ALTER DATABASE OPEN;
-- Commands to add tempfiles to temporary tablespaces.
-- Online tempfiles have complete space information.
-- Other tempfiles may require adjustment.
ALTER TABLESPACE TEMP ADD TEMPFILE '/data005/LGDPOSJ/temp1_01.dbf'
     SIZE 10000M REUSE AUTOEXTEND ON NEXT 104857600  MAXSIZE 10000M;
     
     
     
------------------------------------------     
     
CREATE DATABASE POWEREM
controlfile reuse
LOGFILE
GROUP 5 '/oracle/oradata/POWEREM/redolog/redo01.log' SIZE 500M,
GROUP 3 '/oracle/oradata/POWEREM/redolog/redo02.log' SIZE 500M,
GROUP 2 '/oracle/oradata/POWEREM/redolog/redo03.log' SIZE 500M,
GROUP 1 '/oracle/oradata/POWEREM/redolog/redo04.log' SIZE 500M,
GROUP 4 '/oracle/oradata/POWEREM/redolog/redo05.log' SIZE 500M
MAXLOGFILES 16
MAXLOGMEMBERS 3
MAXDATAFILES 100
MAXINSTANCES 1
MAXLOGHISTORY 292
NOARCHIVELOG
CHARACTER SET KO16KSC5601
NATIONAL CHARACTER SET AL16UTF16
DATAFILE
'/oracle/oradata/POWEREM/data/system01.dbf' SIZE 1500m reuse
sysaux
datafile '/oracle/oradata/POWEREM/data/sysaux01.dbf' size 1000m reuse
undo tablespace UNDOTBS1
datafile '/oracle/oradata/POWEREM/data/UNDOTBS101.dbf' size 2000m reuse
default temporary tablespace temp
tempfile '/oracle/oradata/POWEREM/data/temp01.dbf' size 1000m reuse
;

     
######## Áßº¹µ¥ÀÌÅÍÆÄÀÏ¸í °Ë»ö     
SELECT SUBSTR(FILE_NAME, INSTR(FILE_NAME,'/',-1)+1 ), COUNT(SUBSTR(FILE_NAME, INSTR(FILE_NAME,'/',-1)+1 )) FROM DBA_DATA_FILES
GROUP BY SUBSTR(FILE_NAME, INSTR(FILE_NAME,'/',-1)+1 )
HAVING COUNT(SUBSTR(FILE_NAME, INSTR(FILE_NAME,'/',-1)+1 )) > 1;
     
     
     
######### NID ¸í·ÉÀ» ÀÌ¿ëÇÏ¿© DB¸í º¯°æÇÏ±â
µðÇÃ¿ÍÇÃ(DBA+ Middleware+) > ¡¡¡Ý¡¡±â¼úÀÚ·á > DB > Oracle  



######### db_name, database ¸í ¼öÁ¤ÇÏ¿© ÄÁÆ®·ÑÆÄÀÏ Àç»ý¼º controlfile Àç»ý¼º

(V7.X ~ V9.X) Modifying a database to run under a new ORACLE_SID 
================================================================

1. Shutdown instance 

2. Backup all control, redo and data files. 

3. Go thru the .profile, .cshrc, .login, oratab, tnsnames.ora(for net v2)
, and redefine the environment variable ORACLE_SID to a new value. 
ie search thru disks and do a grep ORACLE_SID * 

4. cd $ORACLE_HOME/dbs and rename the following files: 

o init<sid>.ora (or use pfile to point to the init file.) 
o control file(s) This is optional if you don't rename any of
the controlfiles, and the control_files parameter is used.
control_files would be set in the initSID.ora file or in a file
it references with the ifile parameter. Make sure control_files
doesn't point to any old file names, if you renamed them.

o crdb<sid>.sql & crdb2<sid>.sql This is optional. These are 
only used at database creation.

5. cd $ORACLE_HOME/rdbms/admin and rename the file: 
o startup<sid>.sql This is optional.
(On some platforms, this file may be in $ORACLE_HOME/rdbms/install.)
Make sure the contents of this file do not reference old initSID.ora
files that have been renamed. This file simplifies the process to
"startup exclusive" your database.

6. To rename the database files and redo log files, you would follow
the instructions in the bulletin: 98863.723. 

7. Change the ORACLE_SID environment variable to the new value. 

8. start up database and verify it works. Once you have done this,
shutdown the database and take a final backup of all control, redo
and data files. 

9. When the instance is started, the control file gets updated with
the current ORACLE_SID. 


Changing the dbname for a database 
---------------------------------- 

1. sqldba 

2. connect internal 

3. alter database backup controlfile to trace; 
This will write in a trace file, the CREATE CONTROLFILE command that 
would recreate the controlfile as it currently exists. 

4. Exit and go to the directory where your trace files are located. 
They are usually in the $ORACLE_HOME/rdbms/log directory. 
If user_dump_dest is set in the initSID.ora, then go to the directory
listed in the user_dump_dest variable. 
The trace file will have the form "ora_NNNN.trc with NNNN being a
number. 

5. Get the CREATE CONTROLFILE command from the trace file and put it in
a new file called something like ccf.sql. 

6. Edit the ccf.sql file and modify the CREATE CONTROLFILE command. 
Just change the word "REUSE" to "SET",and "NORESETLOGS" to
"RESETLOGS", and modify the dbname.
Old line:
CREATE CONTROLFILE REUSE DATABASE "olddbname" NORESETLOGS ...
New line: 
CREATE CONTROLFILE set DATABASE "newdbname" RESETLOGS ...
Then save the ccf.sql file. 

7. Rename the old control files for backup purposes and so they are not
in the way of creating the new ones. 

8. Edit initSID.ora so that db_name="newdbname". 

9. sqldba 

10. connect internal 

11. startup nomount 

12. @ccf 

13. alter database open resetlogs; 

14. Make sure the database is working. Shutdown and backup the database. 


Reference Documents
-------------------
<Note:15390.1>

========================================================================================

# UNIX È¯°æ
# ´Ü¼ø SID º¯°æÀº .profile º¯°æ ¹× dbs ÀÇ init<¿øÇÑ´ÂSID> ·Î¸¸ º¯°æ ÇÏ¸é µÈ´Ù.
# °á°úÀûÀ¸·Î ´Ü¼ø SID º¯°æÀº Process ¸¸ º¯°æ µÈ´Ù.
# °£¸¸¿¡ SID º¯°æÇÒ ÀÏÀÌ ÀÖ¾î¼­ Å×½ºÆ® ÇÑ¹ø ÇØºÃÀ½ ¤·_¤·;
# ´Ã ±×·¸Áö¸¸ ¾öÃ» »õ·Ó´Ù.

TESTTG ==> TESTTGB ·Î º¯°æÇÑ´Ù°í °¡Á¤ 
1. vi .profile ¿¡¼­ ORACLE_SID ¸¦ ¿øÇÏ´Â SID ·Î º¯°æ
   export ORACLE_SID=TESTTGB
2. dbs ¿¡¼­ init<SID>.ora À» init<¿øÇÏ´ÂSID>.ora ·Î copy ÇÑ´Ù.
    cd /app/oracle/product/10.2.0/dbs
    cp initTESTTG.ora initTESTTGB.ora
# ÀÛ¾÷ ÇÏ½Ã ÆíÇÏ°Ô pfile È¯°æ¿¡¼­ ÇÑ´Ù. pfile »ý¼ºÀº
   SQL> create pfile from spfile ;

3.  2¹ø¿¡¼­ »ý¼ºÇÑ, initTESTTGB.ora ¿¡¼­ db_name À» ¼öÁ¤ÇÑ´Ù.
     *.db_name='TESTTGB'

     ÁÖÀÇ »çÇ× : 

     1.Control File Path ¿¡ ÁÖÀÇ ÇÏÀÚ  ( ¿ø·¡ DB °¡ ¶° ÀÖ´Â µ¿ÀÏ Machine ¿¡¼­ ÇÏ¸é Overwrite µÈ´Ù ¤·_¤·;)

         #*.control_files='/an01/TEST/TESTTG/control01.ctl'              -- ¿øº»
         *.control_files='/an01/TEST/TESTTG/TESTTGB_control01.ctl' -- Å×½ºÆ®


     2. SGA , PGA ¸¦ Àû´çÈ÷ Edit ÇÏÀÚ 

     3. ÇÊ¿äÇÏ´Ù¸é ÇÊ¿äÇÑ Tablespace ÀÇ Datafile ¸¸ ¼±ÅÃ ÇÏÀÚ Control file À» »ý¼ºÇÏÀÚ.

     4. Archive Dest ¸¦ Edit ÇÏÀÚ ( Mount ÀÌÈÄ¿¡ alter system À¸·Î º¯°æ °¡´ÉÇÏ´Ù ) 

4. controlfile Àç»ý¼º ( ¾Æ·¡¿Í °°ÀÌ ) 
È­ÀÏ »ý¼ºÀ» ¾Æ·¡¿Í °°ÀÌ TRACE ¶³±º ÈÄ¿¡ Editing 
SQL> alter database backup controlfile to trace  ;
Database altered.
STARTUP NOMOUNT
CREATE CONTROLFILE SET DATABASE "TESTTGB" RESETLOGS  NOARCHIVELOG
    MAXLOGFILES 16
    MAXLOGMEMBERS 3
    MAXDATAFILES 100
    MAXINSTANCES 8
    MAXLOGHISTORY 292
LOGFILE
  GROUP 1 '/an01/TEST/TESTTG/redo01.log'  SIZE 10M,
  GROUP 2 '/an01/TEST/TESTTG/redo02.log'  SIZE 10M,
  GROUP 3 '/an01/TEST/TESTTG/redo03.log'  SIZE 10M
-- STANDBY LOGFILE
DATAFILE
  '/an01/TEST/TESTTG/system01.dbf',
  '/an01/TEST/TESTTG/undotbs01.dbf',
  '/an01/TEST/TESTTG/sysaux01.dbf',
  '/an01/TEST/TESTTG/users01.dbf'
CHARACTER SET UTF8
;

5. controlfile Àç¼º¼º ÈÄ Recover Database ÁøÇà
(  »õ·Î »ý¼ºÇÑ control file À» ÅëÇÑ º¹±¸ÀÌ±â ¶§¹®¿¡ using backup control »ç¿ë

   Å×½ºÆ®¿ëÀÌ¶ó until cancel ·Î ÇÏ°í ¹Ù·Î cancel Àû¿ë

   SID º¯°æ ÈÄ recovery µµ µÇ°í, recovery ÈÄ SID º¯°æÀÌ °¡´ÉÇÏ´Ù.

   °³ÀÎÀûÀ¸·Î, ÀÛ¾÷ ÇÏ±â ½¬¿î°Ç Recovery ÈÄ SID º¯°æ À» ´õ ÆíÇÏ´Ù

   ¾ÆÁÖ °¡²û ¹é¾÷ º»ÀÌ ÀÌ»óÇÏ´øÁö, archive file ÀÌ»óÇØ¼­, º¹±¸°¡ ¾ÈµÇ´Â ÄÉÀÌ½º°¡ ¹ß»ýÇÑ´Ù. ) 
SQL> RECOVER DATABASE using backup controlfile until cancel ;
ORA-00279: change 9151408584711 generated at 11/19/2009 23:56:21 needed for
thread 1
ORA-00289: suggestion : /app/oracle/product/10.2.0/dbs/arch1_12_703375834.dbf
ORA-00280: change 9151408584711 for thread 1 is in sequence #12
  
Specify log: {<RET>=suggested | filename | AUTO | CANCEL}
Cancel
Media recovery cancelled.

6. RESETLOGS ·Î OPEN ÇÑ´Ù.
SQL> alter database open resetlogs ;

Database altered.

7. DB NAME º¯°æµÈ°ÍÀ» È®ÀÎ ÇÑ´Ù.
SQL>  select dbid,name, to_char(created,'YYYY/MM/DD HH24:MI:SS') from v$database ;

      DBID NAME      TO_CHAR(CREATED,'YY
---------- --------- -------------------
3876231960 TESTTGB   2009/11/20 00:26:00

8. Local Listenr º¯°æ ¹× Remote tnsnames.ora ¿¡¼­ TESTTG ==> TESTTGB ·Î º¯°æ 

EM Àº SID º¯°æ¿¡ µû¶ó¼­ ´ç±Ù Àç»ý¼º ÇØ¾ß ÇÑ´Ù.

´Ü¼ø SID ¸¸ º¯°æÇØµµ, EM CONFIGÁ¤º¸´Â HOSTNAME_SID ¶ó´Â µð·ºÅä¸®¿¡ ÀúÀåµÈ´Ù. 

[ÃâÃ³] SID º¯°æ(DB NAME º¯°æ)|ÀÛ¼ºÀÚ Å¸¶ôÃµ»ç


     
######### µ¥ÀÌÅÍÆÄÀÏ º¹»ç¸¦ ÅëÇÑ µ¥ÀÌÅÍ ÀÌ°ü ÀýÂ÷ (ÇÖ¹é¾÷º»)


CREATE CONTROLFILE REUSE DATABASE "POWEROO" RESETLOGS  ARCHIVELOG
    MAXLOGFILES 16
    MAXLOGMEMBERS 3
    MAXDATAFILES 200
    MAXINSTANCES 8
    MAXLOGHISTORY 4672
LOGFILE
  GROUP 6 (
    '/oradata4/POO/redo61.dbf',
    '/oradata5/POO/redo62.dbf'
  ) SIZE 1000M,
  GROUP 7 (
    '/oradata4/POO/redo71.dbf',
    '/oradata5/POO/redo72.dbf'
  ) SIZE 1000M,
  GROUP 8 (
    '/oradata2/POWEROO/DBF/redo81.dbf',
    '/oradata3/POWEROO/DBF/redo82.dbf'
  ) SIZE 1000M,
  GROUP 9 (
    '/oradata2/POWEROO/DBF/redo91.dbf',
    '/oradata3/POWEROO/DBF/redo92.dbf'
  ) SIZE 1000M
-- STANDBY LOGFILE
DATAFILE
  '/oradata1/system01.dbf',
  '/oradata2/POO/POO_W_02.dbf',
  '/oradata1/sysaux01.dbf',
  '/oradata5/POO/POO_Q_IDX02.dbf',
  '/oradata2/POO/POO_Q_01.dbf',f',
  '/oradata2/POO/POO_STAT_01.dbf',
  ..... Áß·«
  '/oradata5/POO/POO_STAT_IDX01.dbf',
  '/oradata3/POO/POO_STAT_P1_01.dbf',
  '/oradata5/POO/POO_STAT_P1_IDX01.dbf',
  '/oradata5/POO/POO_STAT_IDX03.dbf',
  '/oradata2/POO/POO_WORK_02.dbf',
  '/oradata6/POO/POO_S_06.dbf',
  '/oradata6/POO/POO_STAT_09.dbf',
  '/oradata11/POO/POO_Q_31.dbf',
  '/oradata11/POO/POO_Q_32.dbf'
CHARACTER SET KO16KSC5601
;
-- Commands to re-create incarnation table
-- Below log names MUST be changed to existing filenames on
-- disk. Any one log file from each branch can be used to
-- re-create incarnation records.
-- ALTER DATABASE REGISTER LOGFILE '/arc/arch_1_1_584383173.arc';
-- Recovery is required if any of the datafiles are restored backups,
-- or if the last shutdown was not normal or immediate.
RECOVER DATABASE USING BACKUP CONTROLFILE (or recover database using backup controlfile until cancel)

¹é¾÷ ½ÃÁ¡ÀÇ ¾ÆÄ«ÀÌºê ÆÄÀÏµéµµ Å¸°Ù½Ã½ºÅÛ¿¡ Ä«ÇÇÇÑ µÚ ÇÑ°³¾¿ Àû¿ë

Àû¿ëÇÒ¶§¸¶´Ù ¾Æ·¡ ºä È®ÀÎÇÏ¿© º¹±¸ »óÈ²À» È®ÀÎ

SQL> select status , count(*) from v$backup group by status ;

STATUS               COUNT(*)
------------------ ----------
ACTIVE                     60
NOT ACTIVE                 67


SQL> select count(*) from v$recover_file ;

  COUNT(*)
----------
       127
       

-- Database can now be opened zeroing the online logs.
ALTER DATABASE OPEN RESETLOGS;
-- Commands to add tempfiles to temporary tablespaces.
-- Online tempfiles have complete space information.
-- Other tempfiles may require adjustment.
ALTER TABLESPACE TEMP1 ADD TEMPFILE '/oradata8/POO/temp1_01.dbf'
     SIZE 8000M REUSE AUTOEXTEND OFF;
-- End of tempfile additions.




######### º¹±¸½Ã end backup ½ºÅ©¸³Æ®


set head off
set feedback off
set verify off
set lines 150
set pages 0
set echo on

spool end_backup.sql
prompt spool end_backup.lst
prompt echo on
select 'ALTER TABLESPACE '||NAME||' END BACKUP ;' from v$tablespace where tablespace_name not in ('TEMPTBS1') ;
prompt spool off
spool off

@end_backup.sql

select status, count(*) from v$backup group by status ;


       
################ begin/end backup »óÅÂ È®ÀÎ

select a.file#,a.name,b.status,to_char(b.time,'YYYY-MM-DD:HH24:MI:SS') as time
from v$datafile a, v$backup b
where a.file#=b.file#;


       
            
######### µ¥ÀÌÅÍÆÄÀÏ º¹»ç¸¦ ÅëÇÑ µ¥ÀÌÅÍ ÀÌ°ü ÀýÂ÷ (ÄÝµå¹é¾÷º»)

1. °³Å×Àåºñ¿¡ 10g ÀÎ½ºÅÏ½º ±¸¼º ÆÐÄ¡

2. °³¹ßdb cold backup (shutdown-> cp datafile(system,user,undo,temp), redolog, controlfile, parameter, passwd)

3. °³Å×db ·Î ftp Àü¼Û(Àû´çÇÑ°÷¿¡ Ä«ÇÇ)

4. °³¹ß¿¡¼­ÀÇ µ¥ÀÌÅÍÆÄÀÏ Ç®ÆÐ½º¸®½ºÆ®¸¦ È®º¸ (±âÁ¸¼­¹ö¿¡¼­ alter database backup controlfile to trace; ¹®À¸·Î ÅØ½ºÆ®ÇüÅÂ·Î ¶³¾î¶ß¸± ¼ö ÀÖÀ½)

5. shutdown »óÅÂ innit ¼öÁ¤ -> control, udump path µî

6.. startup nomount  -> alter database rename dbfile, redofile   ddddd to  dddddd;    create control (¼Ò½ºÀÇ Ç®ÆÐ½º´ÂÇÊ¿ä¾ø°í)
    È¤Àº CREATE CONTROLFILE REUSE ¹®À¸·Î ÄÁÆ®·ÑÆÄÀÏ ½Å±Ô»ý¼º
7. open



Áï

- ½Å±Ô¼­¹ö¿¡ ORACLE À» ±âÁ¸ ÀÎ½ºÅÏ½º ¼¼ÆÃ°ú µ¿ÀÏÇÏ°Ô ¼³Ä¡ÇÑ´Ù: 
VERSION, SID, PORT, TNS, NLS ¼¼ÆÃ µî

- ¿øÃµ DB¸¦ COLD ¹é¾÷ÇÑ´Ù:
datafile(system,user,undo,temp), redolog, controlfile, parameter, passwd ÆÄÀÏ µî

- °³¹ß¿¡¼­ÀÇ µ¥ÀÌÅÍÆÄÀÏ Ç®ÆÐ½º ¸®½ºÆ®¸¦ È®º¸ÇÑ´Ù:
¿øÃµ DB¿¡¼­ backup controlfile to trace ¹®À¸·Î ÅØ½ºÆ®ÇüÅÂ·Î ÀúÀå

- COLD ¹é¾÷ÇÑ ¿øÃµ ÆÄÀÏµéÀ» ½Å±Ô¼­¹öÀÇ ÀûÀýÇÑ À§Ä¡¸¦ ¼±Á¤ÇÏ¿© º¹»çÇÑ´Ù.

- ½Å±Ô ÀÎ½ºÅÏ½º shutdown »óÅÂ¿¡¼­ ¿øÃµ ÆÄÀÏµéÀÇ Ç®ÆÐ½º¸¦ È®ÀÎÇÏ¿© ½Å±Ô ¼­¹ö¿¡ ¸Â°Ô init.ora ¼³Á¤ÆÄÀÏÀ» ¼öÁ¤ÇÑ´Ù. (control, dump path µî)

- ½Å±Ô ÀÎ½ºÅÏ½º startup nomount »óÅÂ¿¡¼­ ÄÁÆ®·Ñ ÆÄÀÏÀ» Àç»ý¼ºÇÑ´Ù:
alter database rename datafile ¿øÃµÆÐ½º to ½Å±ÔÆÐ½º;
alter database rename redofile ¿øÃµÆÐ½º to ½Å±ÔÆÐ½º;
CREATE CONTROLFILE REUSE;

- ½Å±Ô ÀÎ½ºÅÏ½º db ¸¦ ¿ÀÇÂÇÑ´Ù.



alter database backup controlfile to trace; ¹®À¸·Î ÄÁÆ®·ÑÆÄÀÏÀÌ udump µð·ºÅä¸®¿¡ ¶³¾îÁöÁö ¾Ê´Â °æ¿ì ?/rdbms/log ¿¡ ¶³¾îÁö´Â °æ¿ì°¡ ÀÖÀ¸¸ç

ÀÌ·²¶§ ¾Æ·¡¿Í °°ÀÌ ¼öÇàÇÏ¿© udump ·Î ¶³¾îÁöµµ·Ï ¼öÁ¤

> /usr/bin/getprivgrp dba
   dba <= °á°ú
> /usr/sbin/setprivgrp dba MLOCK
> /usr/bin/getprivgrp dba
   dba MLOCK <=°á°ú
   


###########################################################* MLOCK Privilege ºÎ¿©¹æ¹ý
To allow Oracle9i to execute asynchronous I/O operations, the group that
the Oracle software owner belongs to (dba) must have the MLOCK
privilege. To give the dba group the MLOCK privilege:

	As the root user, enter the following command:
	==> # setprivgrp dba MLOCK
             	==> È®ÀÎ¹æ¹ý : #getprivgrp dba

To retain the MLOCK privilege after rebooting, create the /etc/privgroup
file, if it does not exist on your system, and add the following line to
it:
dba MLOCK  (¼­¹ö rebooting ÈÄ¿¡µµ Àû¿ëµÇµµ·Ï µî·ÏÇØµÎÀÚ!!)

######### instr ÇÔ¼ö »ç¿ë¹ý 
    SELECT '2' NO,
      TABLESPACE_NAME,
      '!cp ' || FILE_NAME || ' /down/online/'||FILE_ID||'.'||SUBSTR(FILE_NAME, INSTR(FILE_NAME,'/',-1)+1 ) QUERY
    from dba_data_files


SELECT  SUBSTR(MSG, 1, INSTR(MSG, '|', 1, 1) - 1) MSG_1,
        SUBSTR(MSG, INSTR(MSG, '|', 1, 1) + 1, INSTR(MSG, '|', 1, 2) - INSTR(MSG, '|', 1, 1) - 1) MSG_2,
        SUBSTR(MSG, INSTR(MSG, '|', 1, 2) + 1, INSTR(MSG, '|', 1, 3) - INSTR(MSG, '|', 1, 2) - 1) MSG_3,
        SUBSTR(MSG, INSTR(MSG, '|', 1, 3) + 1, INSTR(MSG, '|', 1, 4) - INSTR(MSG, '|', 1, 3) - 1) MSG_4,
        SUBSTR(MSG, INSTR(MSG, '|', 1, 4) + 1) MSG_5
FROM (SELECT '111|222|333|444|555' MSG FROM DUAL) 

    
######### alter system register

REGISTER Clause

Specify REGISTER to instruct the PMON background process to register the instance with the listeners immediately. If you do not specify this clause, then registration of the instance does not occur until the next time PMON executes the discovery routine. As a result, clients may not be able to access the services for as long as 60 seconds after the listener is started.


######### Ä³¸¯ÅÍ™V º¯È¯
http://cafe.naver.com/mudong.cafe?iframe_url=/ArticleRead.nhn%3Farticleid=548


######### °¢ Å×ÀÌºí º° FK·Î °ü·ÃµÈ ÀÚ½Ä Å×ÀÌºí Á¶È¸
SELECT R_CONS.TABLE_NAME AS "PARENT TABLE", CONS.TABLE_NAME AS "CHILD TABLE", CONS.CONSTRAINT_NAME AS "FK NAME"
FROM USER_CONSTRAINTS CONS, USER_CONSTRAINTS R_CONS
WHERE CONS.R_CONSTRAINT_NAME  IS NOT NULL
AND CONS.R_CONSTRAINT_NAME = R_CONS.CONSTRAINT_NAME
AND CONS.CONSTRAINT_TYPE='R'
ORDER BY 1, 2;


######### Æ¯Á¤±â°£ ARCHIVE ¾ç Á¶»ç Äõ¸®¹®


select a.*, a.redolog_size*b.sum "ARCHIVE_SUM[MB]", c.log_mode "ºñ°í" from 
(select avg(round(bytes/1024/1024)) redolog_size, count(group#) redolog_num from v$log) a,
(select sum(day*log_num) sum from
(select to_char(first_time,'yyyymmdd') log_date, decode(to_char(first_time,'D'),6,0.1,7,0.1,1) DAY, count(1) log_num
from v$log_history 
where to_char(first_time,'yyyymmdd') > to_char((sysdate-8),'yyyymmdd')
and to_char(first_time,'yyyymmdd') != to_char((sysdate),'yyyymmdd')
group by to_char(first_time,'yyyymmdd'), decode(to_char(first_time,'D'),6,0.1,7,0.1,1)
order by to_char(first_time,'yyyymmdd'))) b,
(select log_mode from v$database) c ;




######### ARCHIVE MODE ¼³Á¤

archive log mode´Â DB HOT backupÀ» À§ÇØ¼­ ±âº»ÀûÀ¸·Î ¼³Á¤µÇ¾î¾ß ÇÏ¸ç
noarchive log mode ¿î¿µ½Ã º¸´Ù ¾à 20~30% ¼º´É ÀúÇÏ¸¦ °¡Á®¿Ã ¼ö ÀÖ°í, 
archive ÆÄÀÏÀ» À§ÇÑ º°µµÀÇ °ø°£ÀÌ ÇÊ¿äÇÏ¹Ç·Î ¼­ºñ½ºÀÇ Áß¿äµµ¸¦ °í·ÁÇÏ¿© ¹é¾÷ÀÌ ÇÊ¿äÇÏ´Ù¸é ¹Ýµå½Ã ¼³Á¤ÇØ¾ß ÇÕ´Ï´Ù. 


---------- ¼³Á¤ Àü È®ÀÎ ÇÒ °Í µé -

1. ¸ÕÀú ¾î¶² mode ·Î ¿î¿µÁßÀÎÁö È®ÀÎÇÑ´Ù.

   epsdb1:/oracle/app/oracle/product/9.2.0] sqlplus "/as sysdba" (OS °èÁ¤ÀÌ sys°èÁ¤¿¡ mapping µÇ¾î ÀÖ´Â °æ¿ì)

   Á¢¼ÓµÇ¸é

   SQL> select log_mode from v$database ;

        LOG_MODE
        ------------
        NOARCHIVE

   ¶Ç´Â °£´ÜÇÑ ¸í·É¾î·Î È®ÀÎ°¡´É

   SQL> archive log list ;
        Database log mode              No Archive Mode
        .......


2. DB°¡ µ¿ÀûÀ¸·Î(spfileÀ» ÀÌ¿ëÇÏ¿©) ¶Ç´Â Á¤ÀûÀ¸·Î(pfileÀ» ÀÌ¿ëÇÏ¿©) ±âµ¿µÇ¾ú´ÂÁö È®ÀÎ

SQL> show parameter spfile ;
¶Ç´Â
SQL> select name, value from v$paramenter where name like '%spfile%' ;


create spfile from pfile ;

-------------- º»°ÝÀûÀÎ ¼³Á¤ °úÁ¤ -------

1. DB°¡ spfileÀ» ÀÌ¿ëÇÏ¿© µ¿Àû ±âµ¿ µÇ¾ú´Ù¸é µ¿ÀûÀ¸·Î º¯°æ °¡´É

   a. ¸¸¾àÀ» ´ëºñÇØ ÇöÀç spfileÀ» pfile·Î ¹é¾÷ ¹Þ¾Æ ³õ´Â´Ù

   SQL> create pfile='/oracle/app/oracle/product/9.2.0/dbs/initPEPS.ora' from spfile ;
   
   (spfileÀ» bin ÆÄÀÏ·Î vi ¼öÁ¤ÀÌ ºÒ°¡´É ÇÏ¸ç, ¸¸¾àÀÇ °æ¿ì pfile ¹é¾÷º»À¸·Î ±âÁ¸È¯°æ´ë·Î DB¸¦ ±âµ¿ÇÒ ¼ö ÀÖÀ½)

   
   b. sql ¸í·É¾î¸¦ ÅëÇØ ÆÄ¶ó¹ÌÅÍ ¼öÁ¤

   SQL> alter system set log_archive_start=true scope=spfile ;
   SQL> alter system set log_archive_dest='location=/oracle/app/oracle/oradata/PEPS_Arc/' scope=spfile ;
   SQL> alter system set log_archive_format='SID_%S.ARC' scope=spfile ;


   ** Ä¡È¯¹®ÀÚ 
     - %s : ORCL_120.arc 
     - %S : ORCL_000000120.arc 
     - %t : ORCL_1.arc  //  instance °¹¼ö -> ±×·¡¼­ t  ´Â Àß ¾È¾¸ 
     - %T : ORCL_0001.rc 
 

   c. DB shutdown

   SQL> shutdown immediate 
   
   (parameter °ªÀº º¯°æµÇ¾úÁö¸¸ archive log mode·Î ±âµ¿µÈ °ÍÀÌ ¾Æ´Ï¹Ç·Î ÀÏ´Ü shutdown ÇØ¾ßÇÔ)


   c. COLD ¹é¾÷ ¹Þ´Â´Ù


   e. mount ¸ðµå·Î DB ±âµ¿

   SQL> startup mount; 
        ORACLE instance started.



   f. archive log mode ·Î º¯°æ 

   SQL> alter database archivelog; 

        Database altered. 


   g. archive log mode ·Î º¯°æµÇ¾ú´ÂÁö È®ÀÎ 

   SQL> archive log list; 
        Database log mode              Archive Mode 
        Automatic archival            Enabled 
        Archive destination            /arc 
        ....


   h. µ¥ÀÌÅÍº£ÀÌ½º open 

   SQL> alter database open; 

        Database altered. 


   i. log switch¸¦ ¸î¹ø °­Á¦·Î ½ÃÄÑ¼­ archive fileÀÌ »ý¼ºµÇµµ·Ï ÇÏ°í 
      ÁöÁ¤µÈ À§Ä¡¿¡ archive log file ÀÌ ½×ÀÌ´ÂÁö È®ÀÎ 
      
      alter system switch logfile; 

   SQL> r s
        System altered.
 
   SQL> alter system switch logfile 
        System altered.

   SQL> alter system switch logfile 
        System altered.


   [oracle@cent211 arc]$ cd /arc/ 
   [oracle@cent211 arc]$ ls -al 
   -rw-r-----    1 oracle  dba          1024 Sep 20 20:32 0000000053.arc 
   -rw-r-----    1 oracle  dba          1024 Sep 20 20:32 0000000054.arc 
   -rw-r-----    1 oracle  dba          1024 Sep 20 20:32 0000000055.arc 
   -rw-r-----    1 oracle  dba          1024 Sep 20 20:32 0000000056.arc 

 


2. DB°¡ pfileÀ» ÀÌ¿ëÇÏ¿© Á¤Àû ±âµ¿ µÇ¾ú´Ù¸é

   a. DB shutdown 
   SQL> shutdown immediate

   
   b. DB COLD ¹é¾÷ ¼öÇà
   
   
   c. os ¸í·ÉÀ¸·Î pfile ¿­¾î¼­ ´ÙÀ½ Ç×¸ñ Ãß°¡
   
   # vi /oracle/app/oracle/product/9.2.0/dbs/initSID.ora
     ...
     log_archive_start=true 
     log_archive_dest_format=SID¸í_%s.arc 
     log_archive_dest='Archive log °¡ ¶³±ÅÁö´Â °æ·Î '
     ...
     
     

     
   d. mount ¸ðµå·Î DB ±âµ¿

   SQL> startup pfile=ÆÄÀÏ°æ·Î mount ; 
        ORACLE instance started. 
        ....

   ** pfile °æ·Î¸¦ ÁöÁ¤ÇØÁÖÁö ¾ÊÀ¸¸é
      DB±âµ¿½Ã ´ÙÀ½ ¼ø¼­¿¡ µû¶ó ÆÄ¶ó¹ÌÅÍ ÆÄÀÏÀ» ÂüÁ¶ÇÑ´Ù.
      spfileSID.ora(µ¿Àû) -> initSID.ora(Á¤Àû) -> initdw.ora
      ±âº»ÀûÀ¸·Î 9i ÀÌ»ó ºÎÅÍ´Â µ¿ÀûÀ¸·Î DB±âµ¿ ÇÏ´Â°Ô default
      

   ´ÙÀ½ °úÁ¤Àº 1¹øÀÇ f ~ i °úÁ¤°ú µ¿ÀÏ ÇÔ


-----------------------------------------
-
¶ÇÇÏ³ª Âü°í·Î... 

10gºÎÅÍ´Â log_archive_format ÆÄ¶ó¹ÌÅÍ ¼³Á¤½Ã¿¡ %t_%r_%s °¡ ÇÊ¼ö¶ó°í ÇÕ´Ï´Ù. 
==> log_archive_format = ORACLE_SID_%t_%r_%s.ARC

±×¸®°í °¡²û log_archive_dest ÆÄ¸®¹ÌÅÍ°¡ ¾È¸Ô´Â DB°¡ ÀÖÀ» ¼öµµ ÀÖ´Âµ¥ ÀÌ°æ¿ì´Â 
==> log_archive_dest_1='location=/oracle/app/oracle/admin/ARCH2/' ·Î ÇÏ½Ã¸é Àß µË´Ï´Ù.

     10g
     
     *.log_archive_dest_1='LOCATION=/logs002/LGDPOSP/archive'
     *.log_archive_format='%t_%s_%r.arc'
     
     
     
#################### ¿À¶óÅ¬ ¼³Ä¡½Ã Ä¿³Î ÆÄ¶ó¹ÌÅÍ ¼³Á¤
Note:169706.1 

#################### SET TRANSACTION ¸í·ÉÀº °í¸³¼öÁØ°ú ÀÏ±âÀü¿ë ¶Ç´Â ÀÐ±â¾²±â¿Í °°Àº Æ®·£Àè¼ÇÀÇ ´Ù¾çÇÑ ¼Ó¼ºÀ» ¼³Á¤ °¡´É ÇÏ°Ô ÇÑ´Ù. 
SET TRANSACTION READ ONLY : ÇöÀçÀÇ Æ®·£Àè¼ÇÀ» ReadOnly·Î ¼³Á¤ ÇÑ´Ù. 
SET TRANSACTION READ WRITE : ÇöÀçÀÇ Æ®·£Àè¼ÇÀ» Read Write·Î ¼³Á¤ ÇÑ´Ù. ÀÌ °ªÀº default ÀÌ´Ù. 


Æ®·£Àè¼ÇÀÇ µ¶¸³¼º ·¹º§ ÁöÁ¤Àº ¾Æ·¡ÀÇ µÎ°® ¹æ¹ýÀ» ÀÌ¿ëÇÑ´Ù. READ COMMITTED °ªÀÌ ±âº»°ªÀÌ´Ù. 

1. SET TRANSACTION   ISOLATION LEVEL SERIALIZABLE : Æ®·£Àè¼Ç ³»ÀÇ ¸ðµç ¹®ÀåÀ» ¼öÇàÇÒ ¶§, Æ®·£Àè¼Ç ½ÃÀÛ ½ÃÁ¡ÀÇ µ¥ÀÌÅÍº£ÀÌ½º ½º³À¼¦À» º¸¿©ÁØ´Ù. 

SQL> set transaction isolation level serializable;  
SQL> select sum(sal) from emp; 
SQL> ¡¦¡¦ 
SQL> select sum(sal) from emp; 
SQL> commit; 

ÀÌ °æ¿ì´Â Ã¹ ¹øÂ° select ¹®ÀÇ ¼öÇà ½ÃÀÛ ½ÃÁ¡ÀÇ µ¥ÀÌÅÍº£ÀÌ½º ½º³À¼¦ °ªÀ» ±âÁØÀ¸·Î µÎ ¹®Àå ¸ðµÎ °°Àº sum() °ªÀ» ±¸ÇÏ°Ô µÈ´Ù. Áï ´Ù¸¥ »ç¿ëÀÚ°¡ empÀÇ salÀ» º¯µ¿ ½ÃÄÑµµ ±× °ªÀº ¹Ý¿µµÇÁö ¾Ê´Â ´Ù´Â ÀÇ¹ÌÀÌ´Ù. 


2. SET TRANSACTION   ISOLATION LEVEL READ COMMITTED : read committed ·¹º§ÀÇ °æ¿ì ÀÐ±â ÀÏ°ü¼ºÀÌ ¹®Àå ´ÜÀ§·Î ÇØ´ç ¹®ÀåÀÇ ¼öÇà ½ÃÀÛ ½ÃÁ¡À» ±âÁØÀ¸·Î Á¦°øµÈ´Ù. ¿¹¸¦ µé¾î, ´ÙÀ½°ú °°ÀÌ ÇÑ Æ®·£Àè¼Ç ³»¿¡¼­ ¶È °°Àº SELECT ¹®À» µÎ ¹ø ¼öÇàÇÏ°Ô µÇ¸é ¼­·Î ´Ù¸¥ sum() °ªÀÌ ³ª¿Ã ¼ö°¡ ÀÖ´Ù. 

SQL> set transaction isolation read committed; 
SQL> select sum(sal) from emp; 
SQL> ¡¦¡¦ 
SQL> select sum(sal) from emp; 
SQL> commit; 
Áï, read commit ·¹º§Àº Æ®·£Àè¼Ç °³º° ¹®ÀåÀÇ ¼öÇà ½ÃÀÛ ½ÃÁ¡ÀÇ ½º³À¼¦À» º¸¿©ÁØ´Ù.  

############################  SGA »êÁ¤¹ý

  SGA »êÁ¤¹ý ( 8i ~ 9i)
     
   ((db_block_buffers * block size) +
   (shared_pool_size + large_pool_size + java_pool_size + log_buffers) + 1MB
 
 db_block_buffers * block size
 SQL> select sum(bytes) from v$sgastat where name = 'db_block_buffers'
      and pool is null  ;
 81920000
 
 shared_pool_size
 SQL> SELECT SUM(bytes) FROM v$sgastat WHERE pool = 'shared pool';
 110449740
 
 large_pool_size
 SQL> SELECT SUM(bytes) FROM v$sgastat  WHERE pool = 'large pool'; 
 3145728
 
 select name,bytes from v$sgastat where pool = 'large pool';
 
 java_pool_size
 SQL> SELECT SUM(bytes) FROM v$sgastat where pool ='java pool'
 314572800
 
 log_buffer
 SQL> select sum(bytes) from v$sgastat  where name = 'log_buffer' and pool is null
 5242880
 Total = 515331148 + 1048576 = 516379724 - by SQL
                               515432340 - show sga
 SQL> show sga
  Total System Global Area  515432340 bytes
  Fixed Size                    73620 bytes
  Variable Size             428187648 bytes
  Database Buffers           81920000 bytes
  Redo Buffers                5251072 bytes
 
  
 SGA »êÁ¤¹ý ( 10G - SGA_TARGET ÀÌ ¼ÂÆÃ µÈ °æ¿ì )
 SELECT component, current_size/1024/1024
 FROM v$sga_dynamic_components;

[ÃâÃ³] Shared_pool_size OverHead ¿Í SGA SIZE »êÁ¤¹ý|ÀÛ¼ºÀÚ Å¸¶ôÃµ»ç

---- Ç®º° »ç¿ë·®
select pool,  sum(bytes)/1024/1024/1024 from v$sgastat 
where name <> 'free memory'
group by pool;




############################### Shared Pool Æ©´× 

- ¸ñÇ¥ 
> °´Ã¼ Å©±â °áÁ¤ ¹× Shared Pool ¿¡ Pin 
> Shared Pool ¿¹¾à °ø°£ Æ©´× 
> UGA ¹× ¼¼¼Ç ¸Þ¸ð¸® °í·Á»çÇ× 
> ¶óÀÌºê·¯¸® Ä³½Ã ÀûÁßÀ² ÃøÁ¤ 
> Shared Pool °ú °ü·ÃµÈ ±âÅ¸ Æ©´× ¹®Á¦ ³ª¿­ 
> µñ¼Å³Ê¸® Ä³½Ã ÀûÁß·ü ÃøÁ¤ 
> Large Pool ¼³Á¤ 

- Shared Pool ÀÇ ³»¿ë 
> ¶óÀÌºê·¯¸® Ä³½Ã 
> µ¥ÀÌÅÍ µñ¼Å³Ê¸® Ä³½Ã 
> Shared Server ¼¼¼ÇÀ» À§ÇÑ UGA : Large Pool ÀÌ ±¸¼ºµÇÁö ¾ÊÀº °æ¿ì 
Shared Server ¿¬°á Á¤º¸ À¯Áö 

- Shared Pool Æ©´×½Ã °í·Á»çÇ× 
> µ¥ÀÌÅÍ µñ¼Å³Ê¸® Ä³½Ã ¶Ç´Â ¶óÀÌºê·¯¸® Ä³½Ã¿¡¼­ ¹ß»ýÇÑ Ä³½Ã miss ´Â ´ëºÎ 
ºÐÀÇ ´Ù¸¥ SGA ¸Þ¸ð¸® ±¸Á¶¿¡¼­ ¹ß»õÇÑ Ä³½Ã miss º¸´Ù ¸¹Àº ºñ¿ëÀÌ ¼Ò¿äµÇ¹Ç 
·Î Shared Pool À» °¡Àå ¸ÕÀú Æ©´×ÇØÇá ÇÑ´Ù. 
> Shared Pool Æ©´×½Ã´Â ¶óÀÌºê·¯¸® Ä³½Ã¿¡ ÃÊÁ¡À» ¸ÂÃá´Ù. ÀÌ´Â Shared Pool 
¿¡¼­´Â µ¥ÀÌÅÍ µñ¼Å³Ê¸® µ¥ÀÌÅÍ¸¦ ¸Þ¸ð¸®¿¡¼­ ¿À·¡ À¯ÁöÇÏ´Â °æÇâÀÌ ÀÖ±â ¶§ 
¹®ÀÌ´Ù. 
> Shared Pool ÀÌ Áö³ªÄ¡°Ô ÀÛÀº °æ¿ì ¼­¹ö´Â Á¦ÇÑµÈ »ç¿ë °¡´É ¿µ¿ªÀ» °ü¸® 
ÇÏ´Â µ¥ ÀÚ¿øÀ» ¸ðµÎ »ç¿ëÇØ¾ß ÇÏ¹Ç·Î CPU ÀÚ¿øÀ» ¼Ò¸ðÇÏ°Ô µÇ°í °æÇÕÀÌ ¹ß»ý 
ÇÑ´Ù. 
> Shared Pool ÀÌ ³Ê¹« Å©¸é ´ÙÀ½ÀÇ ¿øÀÎÀ¸·Î ¼º´ÉÀÌ ÀúÇÏµÈ´Ù. 
>> ´Ù¸¥ ¸Þ¸ð¸® ±¸Á¶¿¡ ´ëÇÑ ¸Þ¸ð¸®°¡ ÀÛ´Ù. 
>> ¸¹Àº Ç×¸ñÀÌ Ç®ÀÌ ÀÛÀº °æ¿ìº¸´Ù Ç®ÀÌ Å« °æ¿ì ÇöÀç ³»¿ë °Ë»öÀ» ´À¸®°Ô 
ÇÒ ¼ö ÀÖ´Ù. 
> shared_pool_size ·Î Å©±â Á¤ÀÇ, ±âº»°ªÀº 8MB 
> ¶óÀÌºê·¯¸® Ä³½Ã : ¸í·É¹® ÅØ½ºÆ®, ±¸¹®ºÐ¼®µÈ ÄÚµå ¹× ½ÇÇà°èÈ¹ÀÌ Æ÷ÇÔ. 
> µ¥ÀÌÅÍ µñ¼Å³Ê¸® Ä³½Ã : µ¥ÀÌÅÍ µñ¼Å³Ê¸® Å×ÀÌºí¿¡ ´ëÇÑ Å×ÀÌºí, ¿­ ¹× ±Ç 
ÇÑ¿¡ ´ëÇÑ Á¤ÀÇ Æ÷ÇÔ 

- ¶óÀÌºê·¯¸® Ä³½Ã 
> À¯Àú°¡ °øÀ¯ÇÒ SQL ¹®°ú PL/SQL ºí·Ï ÀúÀå 
> LRU ¾Ë°í¸®Áò¿¡ ÀÇÇØ °ü¸®µÊ. 
> Shared Pool ¿¡¼­ »ç¿ë °¡´ÉÇÑ ¸Þ¸ð¸®°¡ ºÎÁ·ÇÑ °æ¿ì ORA-04031 ¹ß»ý 

- Áß¿äÇÑ Shared Pool ·¡Ä¡ 
> shared pool : Shared Pool ¿¡ ÀÖ´Â ¸Þ¸ð¸® ÇÒ´ç º¸È£ 
> library cache : Shared Pool ¿¡ ÀÖ´Â ÇØ´ç SQL Ã£±â 
> ¿øÀÎ 
>> SQL ¹®ÀÌ °øÀ¯µÇÁö ¾ÊÀ½, ´ÙÀ½ Äõ¸®·Î È®ÀÎ 
select sql_text 
from v$sqlarea 
where executions < 5 
order by UPPER(sql_text); 
>> °øÀ¯°¡´ÉÇÑ SQL ±¸¹®ÀÌ ÀçºÐ¼®µÊ. ´ÙÀ½ Äõ¸®·Î parse_calls °ªÀÌ 
executions °ª¿¡ °¡±î¿î ¸í·É¹®À» Ã£´Â´Ù. 
½ºÅ°¸¶ °´Ã¼°¡ ¼öÁ¤µÇ¸é ÀÌÀü¿¡ ±¸¹®ºÐ¼®µÈ °ü·Ã SQL Àº ¹«È¿È­µÈ´Ù. 
select sql_text, parse_calls, executions 
from v$sqlarea 
order by parse_calls; 
>> ¶óÀÌºê·¯¸® Ä³½Ã Å©±â°¡ ºÒÃæºÐÇÏ°Ô Á¶Á¤µÊ. 
> ÇØ°áÃ¥ 
>> SQL ¹® Æ©´× : bind º¯¼ö »ç¿ë µî 
>> CURSOR_SHARING ¼³Á¤ 
>> Shared Pool Å©±â Áõ°¡ 
>> Shared Pool ¿µ¿ª¿¡ ¿¹¾à °ø°£À» ÇÒ´çÇÏ¿© ´ë¿ë·® ¸Þ¸ð¸® ¿ä±¸ »çÇ×¿¡ ´ë 
ºñÇÑ ÃæºÐÇÑ ¿¬¼Ó °ø°£À» È®º¸ÇÑ´Ù. 
>> ÀÍ¸íÀÇ ´ëÇü PL/SQL ºí·Ï Á¦°Å 
>> Large Pool ±¸¼º : Large Pool ¾øÀÌ Oracle Shared Server À» »ç¿ëÇÏ¸é 
shared pool ·¡Ä¡ °æÇÕÀÌ ¹ß»ýÇÒ ¼ö ÀÖ´Ù. 

- v$librarycache 
> SQL AREA, TABLE/PROCEDURE, BODY, TRIGGER ¿Í °°Àº NAMESPACE °ªÀ» °¡Áö´Â 
ÇàÀº SQL ¹® ¹× PL/SQL ºí·Ï¿¡ ´ëÇÑ ¶óÀÌºê·¯¸® Ä³½Ã ÀÛ¾÷ ¹Ý¿µ 
> INDEX, CLUSTER, OBJECT, PIPE, JAVA SOURCE, JAVA RESOURCE, JAVA DATA ¿Í 
°°Àº NAMESPACE °ªÀ» °¡Áö´Â ÇàÀº ¼­¹ö¿¡¼­ Á¾¼Ó¼º À¯Áö °ü¸®¸¦ À§ÇØ »ç¿ëÇÏ 
´Â °´Ã¼ Á¤ÀÇ¿¡ ´ëÇÑ ¶óÀÌºê·¯¸® Ä³½Ã ÀÛ¾÷À» ¹Ý¿µ 
> GETS : ÇØ´ç Ç×¸ñ¿¡ °üÇÑ Á¤º¸¸¦ ¿äÃ»ÇÑ ÃÑ È½¼ö 
> PINS : SQL ¹® ¶Ç´Â ÇÁ·Î½ÃÀúÀÇ ½ÇÇà È½¼ö 
> RELOADS : ½ÇÇà ´Ü°è Áß¿¡ ¸í·É¹®ÀÇ ±¸¹®ºÐ¼®µÈ ÇüÅÂ¸¦ Æ÷ÇÔÇÏ´Â °øÀ¯ SQL 
¿µ¿ªÀÌ ´Ù¸¥ ¸í·É¹®¿¡ ´ëÇÑ °ø°£À» ¸¸µé¾î ÁÖ±â À§ÇØ ¶óÀÌºê·¯¸® Ä³½Ã¿¡¼­ »è 
Á¦µÇ´Â È½¼ö 
> INVALIDATIONS : Á¾¼Ó °´Ã¼ÀÇ ¼öÁ¤À¸·Î ÀÎÇØ ¹«È¿È­µÈ ¸í·É¹®ÀÇ ¼ö, ¹«È¿È­ 
µµ Àç·Îµå¸¦ À¯¹ßÇÑ´Ù. 

- v$sqlstat 
> ¸ðµç SGA ±¸Á¶ÀÇ Å©±â Ç¥½Ã 

- v$sqlarea 
> SQL ¹®ÀÇ Ã³À½ 1,000 °³ ¹®ÀÚ¿Í ¸ðµç °øÀ¯ Ä¿¼­¿¡ ´ëÇÑ ÀüÃ¼ Åë°è 

- v$sql 
> °øÀ¯ SQL ¿µ¿ªÀÇ Åë°è ³ª¿­ 
> ÀÔ·ÂµÈ °¢ ÇÏÀ§ÀÇ ¿ø·¡ SQL ÅØ½ºÆ®º°·Î ÇÑ ÇàÀ» Æ÷ÇÔ 
> v$sqlarea ¿Í À¯»çÇÏÁö¸¸ group by ÀýÀ» Æ÷ÇÔÇÏÁö ¾Ê´Â´Ù. 

- v$sqltext 
> Àß¸®Áö ¾Ê°í ¿©·¯ Çà¿¡ °ÉÃÄ ÀÖ´Â ÀüÃ¼ SQL ÅØ½ºÆ® 

- v$db_object_cache 
> Ä³½ÃµÈ µ¥ÀÌÅÍº£ÀÌ½º °´Ã¼(ÆÐÅ°Áö Æ÷ÇÔ), SQL ¹®¿¡¼­ ÂüÁ¶ÇÏ´Â Å×ÀÌºí ¹× 
µ¿ÀÇ¾î µîÀÇ °´Ã¼ 

- Shared Pool ±¸¼º¿ä¼Ò¿¡ ¿µÇâÀ» ÁÖ´Â ÆÄ¶ó¹ÌÅÍ 
shared_pool_size 
shared_pool_reserved_size 
open_cursors 
session_cache_cursors 
cursor_space_for_time 
cursor_sharing 

- Ä¿¼­ÀÇ °øÀ¯ ¿©ºÎ 
> v$librarycache : gethitratio(gethits/gets) °¡ 90% ÈÄ¹Ý´ë °ªÀÌ¾î¾ß ÇÑ´Ù. 
select gethitratio 
from v$librarycache 
where namespace = 'SQL AREA'; 
> À¯Àú°¡ ½ÇÇà ÁßÀÎ ¸í·É¹® È®ÀÎ 
select sql_text, user_executing, executions, loads 
from v$sqlarea; 

select * 
from v$sqltext 
where sql_text like 'select * from hr.emp where %' 

- cursor_sharing 
> exact : SQL ¹®ÀÌ µ¿ÀÏÇØ¾ß Ä¿¼­ °øÀ¯ 
> similar : À¯»çÇÑ SQL ¹®ÀÌ Ä¿¼­ °øÀ¯, ½ÇÇà°èÈ¹ÀÌ µÎ SQL¹® ¸ðµÎ¿¡ ´ëÇØ 
ÃÖÀûÀÌ ¾Æ´Ï¸é Ä¿¼­¸¦ °øÀ¯ÇÏÁö ¾Ê´Â´Ù. 
> force : ½ÇÇà°èÈ¹¿¡ ´ëÇÑ ¿µÇâ¿¡ °ü°è¾øÀÌ À¯»çÇÑ SQL ¹®ÀÌ Ä¿¼­ °øÀ¯ 
> ÀÏºÎ ¸®ÅÍ·² °ªÀ» Á¦¿ÜÇÏ°í ¸ðµÎ µ¿ÀÏÇÑ ¸í·É¹®À» À¯»çÇÑ SQL ¹®ÀÌ¶ó ÇÑ´Ù. 

- ¶óÀÌºê·¯¸® Ä³½Ã Àç·Îµå 
> Àç·Îµå´Â Pins ÀÇ 1% ¹Ì¸¸ÀÌ¾î¾ß ÇÑ´Ù. 
select sum(pins) executions, 
sum(reloads) cache_misses, 
sum(reloads)/sum(pins) 
from v$librarycache; 
> Reloads ´ë Pins ÀÇ ºñÀ²ÀÌ 1% ¸¦ ÃÊ°úÇÏ¸é shared_pool_size ÆÄ¶ó¹ÌÅÍ °ª 
À» Áõ°¡½ÃÅ²´Ù. 
> Statspack º¸°í¼­ÀÇ Library Cache Activity ¼½¼Ç¿¡´Â Instacne ¿¡ ´ëÇÑ ¿ä 
¾à Á¤º¸°¡ Æ÷ÇÔµÇ¾î ÀÖ°í, Instance Activity Stats ¼½¼Ç¿¡´Â ÀÛ¾÷ÀÇ ÀÚ¼¼ÇÑ 
Åë°è°¡ Æ÷ÇÔµÇ¾î ÀÖ´Ù. 
Parse count(hard) : ½ÃÀÛ ÀÌÈÄ ¹ß»ýÇÑ ±¸¹® ÀçºÐ¼® È½¼ö 
Parse count(soft) : °´Ã¼°¡ Shared Pool ¿¡¼­ ÀÌ¹Ì ¹ß°ßµÈ È½¼ö 
Parse count(total) : hard ¹× soft ±¸¹® ºÐ¼®ÀÇ ÇÕ°è 

- ¹«È¿È­ 
> ½ºÅ°¸¶ °´Ã¼°¡ SQL ¹®¿¡¼­ ÂüÁ¶µÇ¾ú´Âµ¥, ³ªÁß¿¡ ¾î¶°ÇÑ ÀÌÀ¯·Îµç ÇØ´ç °´ 
Ã¼°¡ ¼öÁ¤µÈ °æ¿ì, °øÀ¯ SQL ¿µ¿ªÀº ¹«È¿È­µÇ¸ç ÇØ´ç ¸í·É¹®Àº ´Ù½Ã ±¸¹® ºÐ 
¼®ÀÌ µÇ¾î¾ß ÇÏ¹Ç·Î ´ÙÀ½¿¡ ½ÇÇàµÉ ¶§ Àç·ÎµåµÇ¾î¾ß ÇÑ´Ù. 

- Shared Pool ±Ç°í 
> v$shared_pool_advice 
select shared_pool_size_for_estimate as pool_size, 
estd_lc_size, 
estd_lc_time_saved 
from v$shared_pool_advice; 
> 50% ¿¡¼­ 200% ±îÁöÀÌ¸ç, ¼³Á¤ÀÌ ºÒ°¡´ÉÇÏ´Ù. 
> v$library_cache_memory 
°¢ ³×ÀÓ½ºÆäÀÌ½ºÀÇ ¶óÀÌºê·¯¸® Ä³½Ã ¸Þ¸ð¸® °´Ã¼¿¡ ÇÒ´çµÈ ¸Þ¸ð¸® Á¤º¸ Ç¥½Ã 

- Ä³½ÃµÈ ½ÇÇà°èÈ¹ 
> SQL ¹®ÀÌ ±¸¹®ºÐ¼®µÇ¸é °á°ú´Â ½ÇÇà°èÈ¹ ¹× ÄÄÆÄÀÏµÈ ÄÚµå°¡ µÈ´Ù. 
> v$sql_plan À» »ç¿ëÇÏ¿© Ä³½ÃµÈ ½ÇÇà °èÈ¹À» º¼ ¼ö ÀÖ´Ù. 
> v$sql ÀÇ plan_hash_value ¿­À» hash_value ¿­°ú Á¶ÀÎÇÏ¿© »ç¿ëÇÒ ¼ö ÀÖ´Ù. 

- ±Û·Î¹ú ¿µ¿ª ÇÒ´ç 
> ÆÐÅ°Áö, ºä¿Í °°Àº ³»Àå °´Ã¼ 
select sum(sharable_mem) 
from v$db_object_cache 
where type= 'PACKAGE' 
or type= 'PACKAGE BODY' 
or type= 'FUNCTION' 
or type= 'PROCEDURE'; 
> SQL ¹® 
select sum(sharable_mem) 
from v$sqlarea; 
> Shared Pool ¿¡ À¯Àú´ç ¿­¸° Ä¿¼­º°·Î ¾à 250¹ÙÀÌÆ®¸¦ Çã¿ëÇØ¾ß ÇÑ´Ù. 
select sum(250 * users_opening) 
from v$sqlarea; 

- ´ë¿ë·® ¸Þ¸ð¸® ¿ä±¸¿¡ ´ëÇØ shared_pool_reserved_size ¼³Á¤ 
> ÃÊ±â¿¡´Â shared_pool_reserved_size ¸¦ shared_pool_size ÀÇ 10% ·Î ¼³Á¤ 
> shared_pool_reserved_size °¡ shared_pool_size ÀÇ Àý¹ÝÀÌ ³ÑÀ¸¸é ¿À·ù°¡ 
¹ß»ýÇÑ´Ù. 
> v$shared_pool_reserved 
free_space : »ç¿ë°¡´ÉÇÑ °ø°£ ÇÕ°è 
avg_free_size : »ç¿ë°¡´ÉÇÑ ¸Þ¸ð¸®ÀÇ Æò±Õ Å©±â 
max_free_size : »ç¿ë°¡´ÉÇÑ ÃÖ´ë ¸Þ¸ð¸® Á¶°¢ÀÇ Å©±â 
request_misses : ¿äÃ»À» ¸¸Á·ÇÏ´Â »ç¿ë°¡´ÉÇÑ ¸Þ¸ð¸® Á¶°¢ÀÌ ¾ø¾î LRU ¸®½º 
Æ®¿¡¼­ °´Ã¼¸¦ ºñ¿ì´Â ÀÛ¾÷À» ½ÃÀÛÇÑ È½¼ö 
request_failures : ¿äÃ»À» ¸¸Á·ÇÏ´Â ¸Þ¸ð¸®¸¦ Ã£Áö ¸øÇÑ È½¼ö 
last_failure_size : ¸¶Áö¸·À¸·Î ½ÇÆÐÇÑ ¿äÃ»ÀÇ Å©±â 
> request_misses ¸¦ 0À¸·Î À¯ÁöÇÏ°Å³ª, Àû¾îµµ ÀÌ °ªÀÌ Áõ°¡ÇÏ´Â °ÍÀ» ¹æÁö 
ÇÏµµ·Ï À¯ÁöÇØ¾ß ÇÑ´Ù. 
> dbms_shared_pool.abort_request_threshold ÇÁ·Î½ÃÀú¸¦ »ç¿ëÇÏ¿© ´ëÇü°´Ã¼ 
·Î ÀÎÇØ ºñ¿öÁö´Â Shared Pool ÀÇ ¾çÀ» Á¦ÇÑÇÒ ¼ö ÀÖ´Ù. 
> free_memory °¡ shared_pool_reserved_size ÀÇ 50% º¸´Ù Å©°Å³ª °°Àº °æ¿ì 
shared_pool_reserved_size ¸¦ ÁÙÀÎ´Ù. 
> request_failures °¡ 0À» ÃÊ°úÇÏ¿© Áõ°¡ÇÏ´Â °æ¿ì´Â shared_pool_size °¡ 
Áö³ªÄ¡°Ô ÀÛÀº °æ¿ìÀÌ¹Ç·Î ¿¹¾à¸®½ºÆ®¸¦ È°¼ºÈ­ÇÑ °æ¿ì¿¡´Â shared_pool_size 
°ªÀ» ÁÙÀÌ°í, ¿¹¾à¸®½ºÆ®¸¦ È°¼ºÈ­ÇÏÁö ¾ÊÀº °æ¿ì¿¡´Â shared_pool_size ¸¦ 
´Ã¸°´Ù. 

- ´ëÇü °´Ã¼ À¯Áö 
> ¶óÀÌºê·¯¸® Ä³½Ã¿¡ À¯ÁöµÇÁö ¾Ê´Â PL/SQL °´Ã¼¸¦ Ã£´Â´Ù. 
select * 
from v$db_object_cache 
where sharable_mem > 10000 
and (type = 'PACKAGE' 
or type = 'PACKAGE BODY' 
or type = 'FUNCTION' 
or type = 'PROCEDURE') 
and kept = 'NO'; 
> ´ëÇü ÆÐÅ°Áö¸¦ ¶óÀÌºê·¯¸® Ä³½Ã¿¡ Pin ÇÑ´Ù. 
execute dbms_shared_pool.keep('package_name'); 
> À¯ÁöµÇ¾î¾ß ÇÒ °´Ã¼ 
>> standard, diutil ÆÐÅ°Áö¿Í °°ÀÌ ÀÚÀ¯ ¿ä±¸µÇ´Â ´ëÇü ÇÁ·Î½ÃÀú °´Ã¼ ¹× ÇØ 
´ç °øÀ¯¸Þ¸ð¸®°¡ Á¤ÀÇµÈ ÀÓ°è°ªÀ» ÃÊ°úÇÏ´Â °´Ã¼ 
>> ÀÚÁÖ »ç¿ëµÇ´Â Å×ÀÌºí¿¡¼­ Á¾Á¾ ½ÇÇàµÇ´Â ÄÄÆÄÀÏµÈ Æ®¸®°Å 
>> ½ÃÄö½º(Shared Pool ¿¡¼­ ½ÃÄö½º°¡ »èÁ¦µÇ¸é ½ÃÄö½º ¹øÈ£°¡ »ó½ÇµÇ¹Ç·Î) 
> ´ÙÀ½ ¸í·ÉÀ» »ç¿ëÇÏ¿© Shared Pool À» ºñ¿ï ¶§¿¡µµ kept ·Î Ç¥½ÃµÈ °´Ã¼´Â 
Á¦°ÅµÇÁö ¾Ê´Â´Ù. 
ALTER SYSTEM FLUSH SHARED_POOL; 
> dbms_shared_pool ÆÐÅ°Áö¸¦ »ý¼ºÇÏ·Á¸é dbmspool.sql ½ºÅ©¸³Æ®¸¦ ½ÇÇàÇÑ´Ù. 
dbmspool.sql ½ºÅ©¸³Æ®°¡ Á¾·áµÉ ¶§ prvtpool.plb ½ºÅ©¸³Æ®°¡ ÀÚµ¿À¸·Î ½ÇÇàµÈ´Ù. 
> Shared Pool ¿¡¼­ °íÁ¤µÈ °´Ã¼¸¦ Á¦°ÅÇÏ·Á¸é unkeep ÇÁ·Î½ÃÀú¸¦ »ç¿ëÇÑ´Ù. 
> ÀÍ¸íÀÇ ´ëÇü PL/SQL ºí·Ï Á¦°Å 
>> ÀÌ·¯ÇÑ ºí·ÏÀ» Ã£¾Æ ÆÐÅ°ÁöÇÔ¼ö¸¦ È£ÃâÇÏ´Â ÀÛÀº PL/SQL ºí·ÏÀ¸·Î º¯È¯ÇÑ´Ù. 
>> À§ÀÇ ¹æ¹ýÀ» Àû¿ëÇÒ ¼ö ¾ø´Â °æ¿ì ÇØ´ç ¸í·É¹®À» keep ÇÑ´Ù. À§ÀÇ ¹æ¹ýÀ» 
º¸´Ù ±Ç°íÇÑ´Ù. 
declare x number; 
begin x := 5; 
end; 

declare /* keep_me */ x number; 
begin x := 5; 
end; 

select address, hash_value 
from v$sqlarea 
where command_type = 47 
and sql_text like '%keep_me%'; 

execute dbms_shared_pool.keep('address, hash_value'); 

- ¶óÀÌºê·¯¸® Ä³½Ã¿¡ ¿µÇâÀ» ÁÖ´Â ´Ù¸¥ ÆÄ¶ó¹ÌÅÍ 
> open_cursors 
> cursor_space_for_time 
> session_cached_cursors 
> cursor_sharing 

- µ¥ÀÌÅÍ µñ¼Å³Ê¸® Ä³½Ã Æ©´× 
> v$rowcache : gets ÇÕ°è¿¡ ´ëÇÑ getmisses ÇÕ°èÀÇ ºñÀ²À» 15% ¹Ì¸¸À¸·Î À¯Áö 
parameter : º¸°í ÁßÀÎ µ¥ÀÌÅÍ µñ¼Å³Ê¸® Ä³½Ã ÀÌ¸§ Á¦°ø 
gets : °´Ã¼¿¡ ´ëÇÑ ¿äÃ» È½¼ö 
getmisses : Ä³½Ã ½ÇÆÐ°¡ ¹ß»ýÇÑ ¿äÃ» È½¼ö 
> shared_pool_size ÆÄ¶ó¹ÌÅÍ¸¦ »ç¿ëÇÏ¿© °£Á¢ÀûÀ¸·Î¸¸ Á¶Á¤ÇÒ ¼ö ÀÖ´Ù. 
> Shared Pool °ø°£À» ÇÒ´çÇÏ´Â ¾Ë°í¸®ÁòÀº µñ¼Å³Ê¸® Ä³½Ã¿¡ ¿ì¼±±ÇÀ» ºÎ¿©ÇÑ´Ù. 
> Statspack ÀÇ Dictionary Cache Stats ¼½¼Ç¿¡¼­ ½ÇÆÐºñÀ²ÀÌ ¾ÆÁÖ ³·¾Æ¾ß ÇÑ´Ù. 
´ëºÎºÐÀÇ µ¥ÀÌÅÍ µñ¼Å³Ê¸® °´Ã¼´Â 2% ¹Ì¸¸ 
ÀüÃ¼ µ¥ÀÌÅÍ µñ¼Å³Ê¸® Ä³½Ã´Â 15% ¹Ì¸¸ 

- UGA ¹× Oracle Shared Server 
> Dedicated Server ±¸¼ºÀ» »ç¿ëÇÏ´Â °æ¿ì UGA ´Â SGA ³»ÀÇ ¸Þ¸ð¸®¸¦ »ç¿ëÇÏ 
Áö ¾Ê´Â´Ù. 
> Shared Server ±¸¼ºÀ» »ç¿ëÇÏ´Â °æ¿ì À¯Àú ¼¼¼Ç µ¥ÀÌÅÍ ¹× Ä¿¼­ »óÅÂ Á¤º¸ 
¸¦ Æ÷ÇÔÇÏ´Â UGA ´Â Shared Pool ¿¡ ÀúÀåµÈ´Ù. 
> Shared Server ±¸¼ºÀ» »ç¿ëÇÏ´Â °æ¿ì Large Pool À» ¼³Á¤ÇÏ¸é UGA ´Â Large 
Pool ¿¡ Á¸ÀçÇÑ´Ù. 
> ¸ðµç Oracle Shared Server À¯Àú°¡ »ç¿ëÇÏ´Â UGA °ø°£ 
select sum(value) || 'bytes' as "Total session memory" 
from v$sessstat, v$statname 
where name = 'session uga memory' 
and v$sessstat.statistic# = v$statname.statistic#; 
> ¸ðµç À¯Àú°¡ »ç¿ëÇÏ´Â ÃÖ´ë UGA °ø°£ 
select sum(value) || 'bytes' as "Total max memory" 
from v$sessstat, v$statname 
where name = 'session uga memory max' 
and v$sessstat.statistic# = v$statname.statistic#; 

- Large Pool 
> ´ÙÀ½ ÀÛ¾÷À» À§ÇÑ ¸Þ¸ð¸®·Î »ç¿ë 
I/O ¼­¹ö ÇÁ·Î¼¼½º : dbwr_io_slaves 
¹é¾÷ ¹× º¹¿ø ÀÛ¾÷ 
Shared Server ¿¡ ´ëÇÑ ¼¼¼Ç ¸Þ¸ð¸® 
Parallel Query ¸Þ¼¼Áö Ã³¸® 
> °øÀ¯ SQL Ä³½Ã Ãà¼Ò·Î ÀÎÇØ ¹ß»ýÇÏ´Â ¼º´É ¿À¹öÇìµå¸¦ ¸·±â À§ÇØ »ç¿ëµÊ. 
> large_pool_size ·Î Å©±â Á¶Á¤ 





###################### ¼¼¼Çº°, CPU Time, Memory 

SELECT s.sid, s.serial#, p.spid as "OS PID",s.username, 
s.module,s.sql_id,EVENT,SECONDS_IN_WAIT, 
st.value/100 as "CPU sec",round(PGA_USED_MEM/1024/1024)||' MB' PGA_Tot, 
round(PGA_USED_MEM/1024/1024)|| ' MB' PGA_PER_SESS 
FROM v$sesstat st, v$statname sn, v$session s, v$process p 
WHERE sn.name = 'CPU used by this session' -- CPU 
AND st.statistic# = sn.statistic# 
AND st.sid = s.sid 
AND s.paddr = p.addr 
AND s.last_call_et < 1800 -- active within last 1/2 hour 
AND s.logon_time > (SYSDATE - 240/1440) -- sessions logged on within 4 hours 
ORDER BY st.value; 

######################  Clientº° Memory »ç¿ë·® 

select MACHINE,status,count(*) CNT, 
round(sum(PGA_USED_MEM)/1024/1024)||' MB' PGA_Tot, 
round(sum(PGA_USED_MEM)/count(*)/1024/1024)|| ' MB' PGA_PER_SESS 
from v$session s, v$process p 
where 1=1 
--and s.status='ACTIVE' 
and s.paddr=p.addr 
and TYPE <> 'BACKGROUND' 
group by MACHINE,status 
ORDER BY 1 



################### PGA »ç¿ë·®

SELECT 
SUM(PGA_USED_MEM/1024/1024)||' MB' PGA_Tot
FROM v$session s, v$process p 
WHERE s.paddr = p.addr ;

################################## fga sql º¯¼ö Ä¸ÃÄ
exec dbms_fga.add_policy(
object_schema => '||OWNER||',
 object_name => '||OBJECT_NAME||',
 policy_name => '||PNAME||',
 audit_trail => DBMS_FGA.DB + DBMS_FGA.EXTENDED,
 statement_types => 'insert,update,delete,select'
);

begin
dbms_fga.add_policy(object_schema => 'DPOW_OSF',object_name => 'TB_OSF_PEQP',policy_name => 'POLICY1',audit_trail => DBMS_FGA.DB_EXTENDED,statement_types => 'insert,update,delete,select');
end;

begin
dbms_fga.disable_policy(object_schema => 'DPOW_OSF',object_name => 'TB_OSF_PEQP',policy_name => 'POLICY1');
end;

begin
dbms_fga.enable_policy(object_schema => 'DPOW_OSF',object_name => 'TB_OSF_PEQP',policy_name => 'POLICY1');
end;
SELECT * FROM DPOW_OSF.TB_OSF_PEQP;

select *
from dba_fga_audit_trail;

BEGIN
DBMS_FGA.DROP_POLICY('DPOW_OSF','TB_OSF_PEQP','POLICY1' );
END; 


[ÃâÃ³] WS1-1-ch10. Advanced Audit FGA by 10g (OCMKOREA ... Power of OCM and ORACLE) |ÀÛ¼ºÀÚ ¿À¾ßºØ

http://www.oracle.com/technology/global/kr/pub/articles/project_lockdown/phase4.html#4.1
  http://download.oracle.com/docs/cd/B19306_01/network.102/b14266/cfgaudit.htm#sthref1771
  
  http://blog.naver.com/gosu250?Redirect=Log&logNo=150000006623



############################### ORACLE AUDIT À¸·Î ÀÎÇÑ SYSTEM Å×ÀÌºí½ºÆäÀÌ½º ³× LOB SEGMENT °¡ ºñ´ëÇØÁú ½Ã ¾Æ·¡¿Í °°ÀÌ TRUNCATE


AUDIT INSERT, UPDATE, DELETE ON sys.aud$ BY ACCESS;\

TONG:SQL> TRUNCATE TABLE sys.aud$;

Table truncated.


TONG:SQL> SHOW PARAMETER AUDIT

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
audit_file_dest                      string      /logs001/LGDPOST/adump
audit_sys_operations                 boolean     FALSE
audit_syslog_level                   string
audit_trail                          string      NONE

AUDIT ±â´É È°¼ºÈ­ ¿©ºÎ Ã¼Å©





############################### SQL Æ©´× °ü·Ã Á¶È¸Äõ¸®

############ Æ©´× ´ë»ó ÃßÃâ

select *
  from (select last_load_time ,
               inst_id as i_id ,
               sql_id ,
               round(RATIO_TO_REPORT(buffer_gets) OVER (PARTITION BY module), 4)*100 AS RATIO,
               round(elapsed_time / 1000000 / executions, 3) as avgtime,
               buffer_gets,
               round(buffer_gets / executions, 0) avgbuffer,
               rank() over (partition by inst_id
                 order by buffer_gets desc, executions desc) rnk,
               executions as exec ,
               substr(sql_text, 1, 100) as sql_text
          FROM gV$sqlarea a
         WHERE executions > 1 )
 order by i_id,
       rnk ;
       
       
       
       
1. DB Time ºÐ¼®ÇÏ±â

SQL> desc v$sys_time_model
 ÀÌ¸§                      ³Î?      À¯Çü
 ------------------------- -------- ------------
 STAT_ID                            NUMBER
 STAT_NAME                          VARCHAR2(64)
 VALUE                              NUMBER

SELECT stat_name ,
       ROUND( value/(
               SELECT value
               FROM   v$sys_time_model
               WHERE  stat_name='DB time'
              ) *100 , 1 ) time_ratio
FROM v$sys_time_model
WHERE stat_name IN (
    'DB time',
    'DB CPU',
    'parse time elapsed',
    'PL/SQL execution elapsed time',
    'Java execution elapsed time',
    'sql execute elapsed time'
)
ORDER BY time_ratio DESC ;


2. SQL Åë°è Á¤º¸È®ÀÎÇÏ±â

- Moduleº° Åë°è

select *
from (
  select module 
        ,count(*) sql_cnt1
        ,count(distinct substr(sql_text,1,100)) sql_cnt2
        ,sum(executions) executions
        ,round(avg(buffer_gets/executions)) "lio(avg)"
        ,round(avg(disk_reads/executions)) "pio(avg)"
        ,round(avg(rows_processed/executions)) "rows(avg)"
        ,round(avg(elapsed_time/executions/1000000),2) "elapsed(avg)"
        ,count(case when elapsed_time/executions/1000000>=10 then 1 end) bad_sql
        ,round(max(elapsed_time/executions/1000000),2) "elapsed(max)"
  from v$sql
  where executions > 0
  group by module
)
order by "lio(avg)" * executions desc ;

- Schemaº° Åë°è

select *
from (
  select parsing_schema_name
        ,count(*) sql_cnt1
        ,count(distinct substr(sql_text,1,100)) sql_cnt2
        ,sum(executions) executions
        ,round(avg(buffer_gets/executions)) "lio(avg)"
        ,round(avg(disk_reads/executions)) "pio(avg)"
        ,round(avg(rows_processed/executions)) "rows(avg)"
        ,round(avg(elapsed_time/executions/1000000),2) "elapsed(avg)"
        ,count(case when elapsed_time/executions/1000000>=10 then 1 end) bad_sql
        ,round(max(elapsed_time/executions/1000000),2) "elapsed(max)"
  from v$sqlarea
  where executions > 0
  group by parsing_schema_name
)
order by "lio(avg)" * executions desc ;

- SQLº° Åë°è (elapsed_time TOP »óÀ§ 10)

    select t1.*
    from (
          select parsing_schema_name,
                 module,
                 sql_id,
                 substr(sql_text,1,100) substr_sqltext,
                 executions,
                 buffer_gets,
                 disk_reads,
                 rows_processed,
                 round(elapsed_time/1000000,1) elapsed_sec,
                 round(cpu_time/1000000,1) cpu_sec,
                 round(elapsed_time/tot_elapsed*100,1) ratio_elapsed,
                 round(cpu_time/tot_cpu*100,1) ratio_cpu
          from v$sqlarea s,
               (select sum(elapsed_time) tot_elapsed,
                       sum(cpu_time) tot_cpu
                  from v$sqlarea) t
          where executions > 0
          order by elapsed_time desc
    ) t1
    where rownum <= 10



-- SQL ÃßÃâÇÏ±â (10g) : order by º¯°æÇÏ¸é¼­ Á¶È¸

select *
from (
    select rownum cnt,
           t1.*
    from (
          select parsing_schema_name,
                 module,
                 sql_id,
                 hash_value,
                 substr(sql_text,1,100) substr_sqltext,
                 executions,
                 buffer_gets,
                 disk_reads,
                 rows_processed,
                 round(buffer_gets/executions,1) lio,
                 round(elapsed_time/executions/1000000,1) elapsed_sec,
                 round(cpu_time/executions/1000000,1) cpu_sec,
                 round(elapsed_time/tot_elapsed*100,1) ratio_elapsed,
                 round(cpu_time/tot_cpu*100,1) ratio_cpu
          from v$sqlarea s,
               (select sum(elapsed_time) tot_elapsed,
                       sum(cpu_time) tot_cpu
                  from v$sqlarea) t
          where executions > 0
          order by 7 desc
    ) t1
    where rownum <= 50
)
where cnt >= 1


-- SQL TEXT

select module,sql_fulltext from v$sqlarea where hash_value = :hash_value

-- ¼öÇà³»¿ª

SELECT  EXECUTIONS "Executions(total)",
        round(DISK_READS/executions,2) "Disk_reads(one)",
        round(BUFFER_GETS/executions,0) "Buffer_gets(one)",
        round(ROWS_PROCESSED/EXECUTIONS,0) "Rows(one)",
        round((ELAPSED_TIME/EXECUTIONS)/1000000,2) "Elapsed_time(one)",
        round((CPU_TIME/EXECUTIONS)/1000000,2) "Cpu_time(one)"
FROM v$sqlarea sa
WHERE hash_value = :hash_value


-- ¹ÙÀÎµå º¯¼ö°ª

select name,  to_char(LAST_CAPTURED,'yyyymmdd hh24:mi:ss') LAST_CAPTURED,datatype, VALUE_STRING
from v$sql_bind_capture
where hash_value = :hash_value

select name,  to_char(LAST_CAPTURED,'yyyymmdd hh24:mi:ss') LAST_CAPTURED,datatype, VALUE_STRING
from dba_hist_sqlbind
where sql_id = :sql_id



-- PLAN

select   --cardinality , cost,
        LPAD('.', 1*(level-1),'.')||        OPERATION
	      || decode(options,null,null,' (') || options || decode(options,null,null,')')
	      || decode(object_owner,null,null,' :')||object_owner
        || decode(object_name,null,null,'.')  || OBJECT_NAME
        || decode(other_tag,null,null,'(')||other_tag||decode(other_tag,null,null,')')
        || DECODE(ACCESS_PREDICATES,null,null,' [AP] '||ACCESS_PREDICATES) ||DECODE(FILTER_PREDICATES,null,null,' [FP] '||FILTER_PREDICATES)
        "operation"
from (SELECT /*+ NO_MERGE */ *
FROM V$SQL_PLAN
WHERE HASH_VALUE = :hash_value
AND CHILD_NUMBER = 0
)
connect by prior id = parent_id
start with id=0
order by ID


-- Function-based Index ÄÃ·³ Ã£±â

select table_owner,table_name,index_name,COLUMN_EXPRESSION
from dba_ind_expressions
where table_owner like upper(ltrim(rtrim(:owner)))
  and table_name like upper(ltrim(rtrim(:table))) ;


-- ÇÏµåÆÄ½Ì Ã£±â(10g)

SELECT *
FROM   (
        SELECT (
                SELECT parsing_schema_name
                FROM   v$sqlarea
                WHERE  sql_id=a.max_sql_id
               ) SCHEMA ,
               (
                SELECT MODULE
                FROM   v$sqlarea
                WHERE  sql_id=a.max_sql_id
               ) MODULE ,
               a.literal_sql_cnt ,
               a.execution_cnt ,
               a.plan_cnt ,
               (
                SELECT sql_fulltext
                FROM   v$sqlarea
                WHERE  sql_id = a.max_sql_id
               ) sql_text
        FROM   (
                SELECT s.force_matching_signature ,
                       COUNT( s.exact_matching_signature ) literal_sql_cnt ,
                       SUM( s.executions ) execution_cnt ,
                       MIN( s.sql_id ) max_sql_id ,
                       COUNT( DISTINCT s.plan_hash_value ) plan_cnt
                FROM   v$sql s
                GROUP  BY s.force_matching_signature
                HAVING COUNT( s.exact_matching_signature ) > 2
               ) a
        ORDER  BY 3 DESC
       )
WHERE  ROWNUM <= 50



-- »èÁ¦ ´ë»ó ÀÎµ¦½º ÃßÃâÇÏ±â

select
	di.table_owner "OWNER"
	,di.table_name
	,dic1.index_name || chr(10) || ' (' || replace(dic1.index_cols,' ',',') || decode(sign(dic1.cnt-6),1,'...') || ')' "»èÁ¦´ë»ó INDEX"
	,dic2.index_name || chr(10) || ' (' || replace(dic2.index_cols,' ',',') || decode(sign(dic1.cnt-7),1,'...') || ')' "»èÁ¦¿øÀÎ INDEX"
from
	dba_indexes di
	,(
	select
		table_owner,table_name,index_owner,index_name,
		TRIM(MAX(DECODE(column_position, 1, column_name)) || ' ' ||
		MAX(DECODE(column_position, 2, column_name)) || ' ' ||
		MAX(DECODE(column_position, 3, column_name)) || ' ' ||
		MAX(DECODE(column_position, 4, column_name)) || ' ' ||
		MAX(DECODE(column_position, 5, column_name)) || ' ' ||
		MAX(DECODE(column_position, 6, column_name))) INDEX_COLS,count(*) cnt
	from dba_ind_columns dic
	where table_owner not in ('SYS','SYSTEM','MDSYS','SYSMAN')
	group by
		table_owner,table_name,index_owner,index_name
	) dic1
	,(
	select
		table_owner,table_name,index_owner,index_name,
		TRIM(MAX(DECODE(column_position, 1, column_name)) || ' ' ||
		MAX(DECODE(column_position, 2, column_name)) || ' ' ||
		MAX(DECODE(column_position, 3, column_name)) || ' ' ||
		MAX(DECODE(column_position, 4, column_name)) || ' ' ||
		MAX(DECODE(column_position, 5, column_name)) || ' ' ||
		MAX(DECODE(column_position, 6, column_name)) || ' ' ||
		MAX(DECODE(column_position, 7, column_name))) INDEX_COLS,count(*) cnt
	from dba_ind_columns dic
	where table_owner not in ('SYS','SYSTEM','MDSYS','SYSMAN')
	group by
		table_owner,table_name,index_owner,index_name
	) dic2
where
	di.table_owner not in ('SYS','SYSTEM','MDSYS','SYSMAN')
	and di.owner=dic1.index_owner
	and di.index_name=dic1.index_name
	and di.table_owner=dic1.table_owner
	and di.table_name=dic1.table_name
	and dic1.table_owner=dic2.table_owner
	and dic1.table_name=dic2.table_name
	and dic1.index_name<>dic2.index_name
	and dic2.index_cols like dic1.index_cols || '%'
	and dic2.cnt>dic1.cnt






################################## bind º¯¼ö»ç¿ë°ú ¿ÉÆ¼¸¶ÀÌÀú µ¿ÀÛ¹æ½Ä

# cursor_sharing       EXACT/SIMILAR

EXACT ÀÌ¸é, °ø¹é, ´ë¼Ò¹®ÀÚµî ½ÅÅÃ½ºÀÇ ¹Ì¼¼ÇÑ Â÷ÀÌ³ª, ÄÃ·³ºñ±³ »ó¼ö°ªÀÇ Â÷ÀÌ±îÁöµµ ¹Ý¿µÇÏ¿© ÆÄ½ÌÀ» ´Ù½ÃÇÑ´Ù.
SIMILAR ÀÌ¸é À§ÀÇ Â÷ÀÌ¸¦ ¹«½ÃÇÏ°í ÇÃ·£À» °øÀ¯ÇÑ´Ù.
ÄÃ·³À» ¹ÙÀÎµåº¯¼ö¿Í ºñ±³ÇÑ °æ¿ì¿¡´Â °°Àº SQL ·Î ÀÎ½ÄÇÏ¿© ÀçÆÄ½ÌÇÏÁö ¾ÊÀ¸¸ç,
AP °èÃþ¿¡¼­ SQL ÀÚÃ¼¸¦ ÆíÁýÇÏ¿© ´Ù¸¥ »ó¼ö°ªÀ» ºñ±³ÇÏ´Â ´ÙÀÌ³ª¹Í SQL ¿¡ ´ëÇØ¼­´Â, EXACT ÀÏ¶§ ÀçÆÄ½ÌÇÏ¸ç, SIMILAR ÀÏ¶§ ÆÄ½ÌÇÏÁö ¾Ê´Â´Ù.

# _optim_peek_user_binds     TRUE/FALSE

¿ÉÆ¼¸¶ÀÌÀú°¡ ¹ÙÀÎµå º¯¼ö¿¡ µé¾î¿À´Â »ó¼ö°ªÀ» ¿³º¸°Ô(PEEK) µÇ¸é(TRUE) °¢°¢ÀÇ °æ¿ì¿¡ µû¶ó Åë°èÁ¤º¸(È÷½ºÅä±×·¥)¸¦ Âü°íÇÏ¿© 
°¢ °ª¿¡ ÃÖÀûÈ­µÈ ÇÃ·£À» »ý¼ºÇÑ´Ù. ÃÖÃÊ·Î ÆÄ½ÌÇÏ¿© ÇÃ·£À» »ý¼ºÇÏ°í ÇØ´ç ÇÃ·£ÀÌ ¶óÀÌºê·¯¸®Ä³½Ã¿¡¼­ ¹Ð·Á³ª°¡°Ô µÇ¸é ´Ù½ÃÇÑ¹ø 
º¯¼ö¸¦ peek ÇÏ¿© È÷½ºÅä±×·¥À» Âü°íÇÏ¿© ±× °ª¿¡ ÃÖÀûÈ­µÈ ÇÃ·£À» Àç»ý¼ºÇÑ´Ù.

¿³º¸Áö ¾Ê´Â °æ¿ì(FALSE) ¿ÉÆ¼¸¶ÀÌÀú´Â µé¾î¿À´Â »ó¼ö°ª¿¡ »ó°ü¾øÀÌ ÇÑ°³ÀÇ ÇÃ·£À» À¯ÁöÇÏ¸ç ÀÌ°ÍÀº È÷½ºÅä±×·¥ÀÌ ¾Æ´Ñ Æò±Õ ºÐÆ÷µµ¸¦ 
±âÃÊ·Î »ý¼ºµÈ °ÍÀÌ´Ù.
, µû¶ó¼­ DBA °¡ BAD SQL À» ½Äº°ÇÏ¿© ±× °æ¿ìÀÇ ¹ÙÀÎµå º¯¼ö¿¡ µé¾î¿Â »ó¼ö°ªÀ» ÃëÇÕÇÏ¿© BAD ÀÎ °æ¿ì¿¡µµ, 
Áï ¾ÈÁÁÀº »ó¼ö°ªÀÌ µé¾î¿Ã ¶§¿¡µµ ÁÁÀº ¼º´ÉÀÌ ³ª¿Ã ¼ö ÀÖµµ·Ï ÇÏ´Â °ÍÀÌ Æ©´×ÀÇ °ü°ÇÀÌ´Ù.

Áï BIND PEEK ÀÇ °³³äÀÇ ÃëÁö´Â ÁÁ¾ÒÀ¸³ª, ¿ÉÆ¼¸¶ÀÌÀúÀÇ ÀÎ°øÁö´ÉÀ» ¹ÏÁö ¸øÇÏ¹Ç·Î FALSE·Î ¼³Á¤ÇÏ°í DBA °¡ ¾ÈÁÁÀº »ó¼ö¿¡ 
´ëÇØ¼­ Á÷Á¢ Æ©´×ÇÏ´Â °ÍÀÌ ±ÇÀåµÈ´Ù.


¹ÙÀÎµå°¡ ¾Æ´Ñ ¸®ÅÍ·²Ã³¸®°¡ µÈ »ó¼öÀÇ °æ¿ì¿¡´Â bind_peep ÆÄ¶ó¸ÞÅÍ °ª°ú »ó°ü¾øÀÌ È÷½ºÅä±×·¥À» Âü°íÇÏ¿© ÇÃ·£»ý¼ºÇÏ¹Ç·Î
È÷½ºÅä±×·¥À» »ý¼ºÇÒ °¡Ä¡´Â ¿©ÀüÈ÷ ÀÖ´Ù.

################################## sqlplus ¿¡¼­ Æ®·¹ÀÌ½º ¶ã ¶§ ¹ÙÀÎµåº¯¼ö ¸ÊÇÎ

number¿Í varchar2 µÎ°¡Áö¸¸ °¡´É

set term off

var b1 number
var b2 number
var b3 number
var b4 number
var b5 number
var b6 varchar2(100)

exec :b1 := 1988124954
exec :b2 := 1988124954
exec :b3 := 1988124954
exec :b4 := 1988124954
exec :b5 := 1988124954
exec :b6 := '1988124954'



/

select 1 from dual
/

set term on



################################## sqlplus ¿¡¼­ Æ®·¹ÀÌ½º ¶ã ¶§ ¹ÙÀÎµåº¯¼ö ¸ÊÇÎ



number¿Í varchar2 µÎ°¡Áö¸¸ °¡´É

alter session set sql_trace=true;

set term off

var b1 varchar2
var b2 varchar2
var b3 varchar2

exec :b1 := EAIAPP
exec :b2 := TB_CC_CUST_RSPN_DTL_ABAS_SDW
exec :b3 := %
/

SELECT  NULL AS table_cat,
       t.owner AS table_schem,
       t.table_name AS table_name,
       t.column_name AS column_name,
       DECODE (t.data_type, 'CHAR', 1, 'VARCHAR2', 12, 'NUMBER', 3,
               'LONG', -1, 'DATE', 91, 'RAW', -3, 'LONG RAW', -4,  
               'BLOB', 2004, 'CLOB', 2005, 'BFILE', -13, 'FLOAT', 6, 
               'TIMESTAMP(6)', 93, 'TIMESTAMP(6) WITH TIME ZONE', -101, 
               'TIMESTAMP(6) WITH LOCAL TIME ZONE', -102, 
               'INTERVAL YEAR(2) TO MONTH', -103, 
               'INTERVAL DAY(2) TO SECOND(6)', -104, 
               'BINARY_FLOAT', 100, 'BINARY_DOUBLE', 101, 
               1111)
              AS data_type,
       t.data_type AS type_name,
       DECODE (t.data_precision, null,          DECODE (t.data_type, 'CHAR', t.char_length,                   'VARCHAR', t.char_length,                   'VARCHAR2', t.char_length,                   'NVARCHAR2', t.char_length,                   'NCHAR', t.char_length,           t.data_length),         t.data_precision)
              AS column_size,
       0 AS buffer_length,
       t.data_scale AS decimal_digits,
       10 AS num_prec_radix,
       DECODE (t.nullable, 'N', 0, 1) AS nullable,
       NULL AS remarks,
       t.data_default AS column_def,
       0 AS sql_data_type,
       0 AS sql_datetime_sub,
       t.data_length AS char_octet_length,
       t.column_id AS ordinal_position,
       DECODE (t.nullable, 'N', 'NO', 'YES') AS is_nullable
FROM all_tab_columns t
WHERE t.owner LIKE :b1 ESCAPE '/'
  AND t.table_name LIKE :b2 ESCAPE '/'
  AND t.column_name LIKE :b3 ESCAPE '/'
ORDER BY table_schem, table_name, ordinal_position
/

set term on
alter session set sql_trace=false;     




################################## ÇöÀç ½ÇÇàÁßÀÎ SQLÀÇ ¹ÙÀÎµå Bind°ª ¾Ë¾Æ³»´Â ¹æ¹ýÀÔ´Ï´Ù.

È¤½Ã, ¸ð¸£´ø ºÐÀº ¾÷¹«¿¡ Âü°íÇÏ¼¼¿ä. ¸ÕÀú ÀÇ½É½º·¯¿î ¼¼¼ÇÀÇ spid¸¦ ¾Ë¾Æ³À´Ï´Ù.

PROD:SQL> oradebug setospid 27163;  <-- spid
Oracle pid: 274, Unix process pid: 21942, image: oracle@xoncdb2

PROD:SQL> oradebug dump errorstack 3
Statement processed.

PROD:SQL> vi powerbc2_ora_21942.trc
 
*** 2011-06-10 13:42:23.972
*** ACTION NAME:() 2011-06-10 13:42:23.961
*** MODULE NAME:(java@xonwas04 (TNS V1-V3)) 2011-06-10 13:42:23.961
*** SERVICE NAME:(POWERBC) 2011-06-10 13:42:23.961
*** SESSION ID:(595.40474) 2011-06-10 13:42:23.961
Received ORADEBUG command 'dump errorstack 3' from process Unix process pid: 27323, image:
*** 2011-06-10 13:42:23.973
ksedmp: internal or fatal error
Current SQL statement for this session:
  SELECT /*+ /xcion/xmlquery/cxfsc/counsel/regmng/CXFSCBA01.xml<022> */
         NVL(COUNT(DISTINCT SBC_CONT_NO), '0') AS ANINOTCNT
  FROM   TB_BFSCCNSL
  WHERE  CTI_CALL_NO = :1
  AND    (CNSL_LRG_CLS_TYP = '070000' OR CNSL_MDL_CLS_TYP='050300')

----- Call Stack Trace -----
 

******************** Session Cursor Dump **********************
Current cursor: 2, pgadep: 0
Open cursors(pls, sys, hwm, max): 61(60, 0, 256, 300)
 NULL 0 SYNTAX 0 PARSE 0 BOUND 60 FETCH 1 ROW 0
Cached frame pages(total, free):
 4k(1017, 818), 8k(107, 107), 16k(4, 4), 32k(3, 3)
  pgactx: c00000067b2f8d48 ctxcbk: 0000000000000000 ctxqbc: 0000000000000000 ctxrws: c0000006426d23c8
Explain plan:
...
 


 

Session Cursor Dump ºÎºÐÀ» Ã£¾Æ¼­

Current cursor ¹øÈ£¸¦ È®ÀÎÇÑ´Ù (¿©±â¼­´Â 2)

 

============
Plan Table
============
-------------------------------------------------------------+-----------------------------------+---------------+
| Id  | Operation                            | Name          | Rows  | Bytes | Cost  | Time      | Pstart| Pstop |
-------------------------------------------------------------+-----------------------------------+---------------+
| 0   | SELECT STATEMENT                     |               |       |       |     1 |           |       |       |
| 1   |  SORT GROUP BY                       |               |     1 |    31 |       |           |       |       |
| 2   |   TABLE ACCESS BY GLOBAL INDEX ROWID | TB_BFSCCNSL   |     1 |    31 |     1 |  00:00:01 | ROW LOCATION| ROW LOCATION|
| 3   |    INDEX RANGE SCAN                  | IX_BFSCCNSL_09|     3 |       |     1 |  00:00:01 |       |       |
-------------------------------------------------------------+-----------------------------------+---------------+

Content of other_xml column
===========================
  db_version     : 10.2.0.4
  parse_schema   : PBC
  plan_hash      : 2828979832
  Outline Data:
  /*+
    BEGIN_OUTLINE_DATA
      IGNORE_OPTIM_EMBEDDED_HINTS
      OPTIMIZER_FEATURES_ENABLE('10.2.0.4')
      OPT_PARAM('_b_tree_bitmap_plans' 'false')
      OPT_PARAM('_index_join_enabled' 'false')
      OPT_PARAM('_optim_peek_user_binds' 'false')
      OPT_PARAM('_optimizer_skip_scan_enabled' 'false')
      OPT_PARAM('optimizer_index_cost_adj' 10)
      OPT_PARAM('optimizer_index_caching' 90)
      FIRST_ROWS(100)
      OUTLINE_LEAF(@"SEL$1")
      INDEX_RS_ASC(@"SEL$1" "TB_BFSCCNSL"@"SEL$1" ("TB_BFSCCNSL"."CTI_CALL_NO"))
    END_OUTLINE_DATA
  */
 


 

PLAN, Outline Á¤º¸µµ È®ÀÎ °¡´ÉÇÏ´Ù

 

 

...

----------------------------------------
Cursor#2(9fffffff7fbc1778) state=FETCH curiob=9fffffff7f7418d0
 curflg=46 fl2=0 par=0000000000000000 ses=c0000006fb7bc768
 sqltxt(c00000069b4d8420)=
  SELECT /*+ /xcion/xmlquery/cxfsc/counsel/regmng/CXFSCBA01.xml<022> */
         NVL(COUNT(DISTINCT SBC_CONT_NO), '0') AS ANINOTCNT
  FROM   TB_BFSCCNSL
  WHERE  CTI_CALL_NO = :1
  AND    (CNSL_LRG_CLS_TYP = '070000' OR CNSL_MDL_CLS_TYP='050300')

  hash=75047e0f4bb617642016502f74d58999
  parent=c00000069b4d8068 maxchild=06 plk=c0000006dd08b078 ppn=n
cursor instantiation=9fffffff7f7418d0 used=1307680895
 child#0(c00000069b4d74f0) pcs=c00000069b4d7c78
  clk=c0000006921f3478 ci=c000000671fd2e60 pn=c000000644f14860 ctx=c00000067b2f8d48
 kgsccflg=0 llk[9fffffff7f7418d8,9fffffff7f7418d8] idx=0
 xscflg=c0110476 fl2=5200009 fl3=42222008 fl4=100
 sharing failure(s)=12010
 Bind bytecodes
  Opcode = 2   Bind Twotask Scalar Sql In (may be out) Copy
  oacdef = c00000065458b318   Offsi = 48, Offsi = 0
kkscoacd
 Bind#0
  oacdty=01 mxl=32(24) mxlc=00 mal=00 scl=00 pre=00
  oacflg=03 fl2=1000000 frm=01 csi=840 siz=32 off=0
  kxsbbbfp=9fffffff7f743ac0  bln=32  avl=12  flg=05
  value="000215440001"
 Frames pfr 9fffffff7f7bdd48 siz=3672 efr 9fffffff7f7bdc88 siz=3648
 Cursor frame dump
  enxt: 4.0x00000010  enxt: 3.0x00000140  enxt: 2.0x00000020  enxt: 1.0x00000ce0
  pnxt: 2.0x00000008  pnxt: 1.0x00000010
 kxscphp  9fffffff7f766638 siz=984 inu=504 nps=456
 kxscdfhp 9fffffff7fb37598 siz=984 inu=88 nps=0
 kxscbhp  9fffffff7f83f510 siz=984 inu=176 nps=56
 kxscwhp  9fffffff7f150528 siz=49888 inu=49888 nps=41272
Session cached cursors
-----------------------------------------------------------
 


 

Cursor#2 ºÎºÐÀ» Ã£¾Æ¼­, Bind °ªÀ» È®ÀÎ.

"02-1544-0001" µ¥ÀÌÄÞ °í°´¹®ÀÇ ¹øÈ£ÀÎ°¡º¸³×¿ä

 

À§ °ªÀ¸·Î Trace ¶°º¸¸é...ÇØ´ç °Ç¼ö°¡ ¸¹¾Æ¼­ ¿À·¡°É¸®³×¿ä

 

Call     Count CPU Time Elapsed Time       Disk      Query    Current       Rows
------- ------ -------- ------------ ---------- ---------- ---------- ----------
Parse        1    0.000        0.000          0          0          0          0
Execute      1    0.000        0.000          0          0          0          0
Fetch        2    2.590      171.947      18628      22645          0          1
------- ------ -------- ------------ ---------- ---------- ---------- ----------
Total        4    2.590      171.947      18628      22645          0          1

 

Rows     Row Source Operation
-------  ---------------------------------------------------
      0  STATEMENT
      1   SORT GROUP BY (cr=22645 pr=18628 pw=0 time=171946637 us)
   2925    TABLE ACCESS BY GLOBAL INDEX ROWID TB_BFSCCNSL PARTITION: ROW LOCATION ROW LOCATION (cr=22645 pr=18628 pw=0 time=269631731 us)
  23101     INDEX RANGE SCAN IX_BFSCCNSL_09 (cr=127 pr=116 pw=0 time=987471 us)OF IX_BFSCCNSL_09 (NONUNIQUE)
 


 

 

¼öÇàÁßÀÎ SQLÀÇ Bind°ª È®ÀÎÀº

¿¢¼À [¿À¶óÅ¬ ¼º´É Q/A] Ã¥ÀÌ³ª http://wiki.ex-em.com/index.php/Oracle_Dump ¿¡ ³ª¿Í ÀÖ½À´Ï´Ù.
 



################################## sql ¹ÙÀÎµå º¯¼ö Ã£±â
v$sql_bind_capture


################################## sql ¹ÙÀÎµå º¯¼ö Ã£±â
/* curent executeing sql bind variable */
select /*+ LEADING(sesion)*/
       sesion.sid
     , sesion.serial#
     , sesion.username
     , sesion.sql_id
     , sesion.sql_child_number
     , sql_bind_capture.name
     , sql_bind_capture.value_string
     , sql_bind_capture.DATATYPE
     , sqlarea.sql_fulltext  
     , sesion.status
  from v$sql_bind_capture sql_bind_capture, v$session sesion
     , v$sqlarea sqlarea
 where sesion.sql_hash_value = sql_bind_capture.hash_value
   and sesion.sql_address    = sql_bind_capture.address
   and sesion.sql_id = sqlarea.sql_id
   and sesion.username = 'PBBBH'
   and sesion.status = 'ACTIVE'
   and sqlarea.sql_fulltext  like '%'||'CXBBII' ||'%'
 order by sql_bind_capture.LAST_CAPTURED, sesion.sid, sesion.serial#, sql_bind_capture.name
;

v$session sesion ¸¦ Á¶ÀÎ´ë»ó¿¡¼­ Á¦°ÅÇÏ°í statspack µî¿¡¼­ ½Äº°µÈ °ú°Å sql_id ¸¦ Á¶°ÇÀ¸·Î Ãß°¡ÇÏ¸é °ú°Å Æ¯Á¤ ¹ÙÀÎµå°ªÃßÃâ °¡´É

################################## sql ¹ÙÀÎµå°ª ¾Ë¾Æ³»´Â Äõ¸®
select b.username
     , c.name bind_name
     , c.value_string bind_var
     , sql_text 
from v$sqlarea a
   , dba_users b
   , v$sql_bind_capture c 
where b.user_id=a.parsing_user_id 
and c.address=a.address 
and a.sql_text like '%CXCORBD01.xml <007>%'
order by 2;



################################## ÇöÀç ¼öÇàÁßÀÎ SQLÀÇ Bind°ª ¾Ë¾Æ³»´Â ¹æ¹ýÀÔ´Ï´Ù.

¸ÕÀú ÀÇ½É½º·¯¿î ¼¼¼ÇÀÇ spid¸¦ ¾Ë¾Æ³À´Ï´Ù.
 
PROD:SQL> oradebug setospid 21942;  <-- spid
Oracle pid: 274, Unix process pid: 21942, image: oracle@xoncdb2

PROD:SQL> oradebug dump errorstack 3
Statement processed.

PROD:SQL> vi powerbc2_ora_21942.trc

*** 2011-06-10 13:42:23.972
*** ACTION NAME:() 2011-06-10 13:42:23.961
*** MODULE NAME:(java@xonwas04 (TNS V1-V3)) 2011-06-10 13:42:23.961
*** SERVICE NAME:(POWERBC) 2011-06-10 13:42:23.961
*** SESSION ID:(595.40474) 2011-06-10 13:42:23.961
Received ORADEBUG command 'dump errorstack 3' from process Unix process pid: 27323, image:
*** 2011-06-10 13:42:23.973
ksedmp: internal or fatal error
Current SQL statement for this session:
  SELECT /*+ /xcion/xmlquery/cxfsc/counsel/regmng/CXFSCBA01.xml<022> */
         NVL(COUNT(DISTINCT SBC_CONT_NO), '0') AS ANINOTCNT
  FROM   TB_BFSCCNSL
  WHERE  CTI_CALL_NO = :1
  AND    (CNSL_LRG_CLS_TYP = '070000' OR CNSL_MDL_CLS_TYP='050300')

----- Call Stack Trace -----
 

******************** Session Cursor Dump **********************
Current cursor: 2, pgadep: 0
Open cursors(pls, sys, hwm, max): 61(60, 0, 256, 300)
 NULL 0 SYNTAX 0 PARSE 0 BOUND 60 FETCH 1 ROW 0
Cached frame pages(total, free):
 4k(1017, 818), 8k(107, 107), 16k(4, 4), 32k(3, 3)
  pgactx: c00000067b2f8d48 ctxcbk: 0000000000000000 ctxqbc: 0000000000000000 ctxrws: c0000006426d23c8
Explain plan:
...


Session Cursor Dump ºÎºÐÀ» Ã£¾Æ¼­ Current cursor ¹øÈ£¸¦ È®ÀÎÇÑ´Ù (¿©±â¼­´Â 2)

============
Plan Table
============
-------------------------------------------------------------+-----------------------------------+---------------+
| Id  | Operation                            | Name          | Rows  | Bytes | Cost  | Time      | Pstart| Pstop |
-------------------------------------------------------------+-----------------------------------+---------------+
| 0   | SELECT STATEMENT                     |               |       |       |     1 |           |       |       |
| 1   |  SORT GROUP BY                       |               |     1 |    31 |       |           |       |       |
| 2   |   TABLE ACCESS BY GLOBAL INDEX ROWID | TB_BFSCCNSL   |     1 |    31 |     1 |  00:00:01 | ROW LOCATION| ROW LOCATION|
| 3   |    INDEX RANGE SCAN                  | IX_BFSCCNSL_09|     3 |       |     1 |  00:00:01 |       |       |
-------------------------------------------------------------+-----------------------------------+---------------+

Content of other_xml column
===========================
  db_version     : 10.2.0.4
  parse_schema   : PBC
  plan_hash      : 2828979832
  Outline Data:
  /*+
    BEGIN_OUTLINE_DATA
      IGNORE_OPTIM_EMBEDDED_HINTS
      OPTIMIZER_FEATURES_ENABLE('10.2.0.4')
      OPT_PARAM('_b_tree_bitmap_plans' 'false')
      OPT_PARAM('_index_join_enabled' 'false')
      OPT_PARAM('_optim_peek_user_binds' 'false')
      OPT_PARAM('_optimizer_skip_scan_enabled' 'false')
      OPT_PARAM('optimizer_index_cost_adj' 10)
      OPT_PARAM('optimizer_index_caching' 90)
      FIRST_ROWS(100)
      OUTLINE_LEAF(@"SEL$1")
      INDEX_RS_ASC(@"SEL$1" "TB_BFSCCNSL"@"SEL$1" ("TB_BFSCCNSL"."CTI_CALL_NO"))
    END_OUTLINE_DATA
  */
 


PLAN, Outline Á¤º¸µµ È®ÀÎ °¡´ÉÇÏ´Ù



...

----------------------------------------
Cursor#2(9fffffff7fbc1778) state=FETCH curiob=9fffffff7f7418d0
 curflg=46 fl2=0 par=0000000000000000 ses=c0000006fb7bc768
 sqltxt(c00000069b4d8420)=
  SELECT /*+ /xcion/xmlquery/cxfsc/counsel/regmng/CXFSCBA01.xml<022> */
         NVL(COUNT(DISTINCT SBC_CONT_NO), '0') AS ANINOTCNT
  FROM   TB_BFSCCNSL
  WHERE  CTI_CALL_NO = :1
  AND    (CNSL_LRG_CLS_TYP = '070000' OR CNSL_MDL_CLS_TYP='050300')

  hash=75047e0f4bb617642016502f74d58999
  parent=c00000069b4d8068 maxchild=06 plk=c0000006dd08b078 ppn=n
cursor instantiation=9fffffff7f7418d0 used=1307680895
 child#0(c00000069b4d74f0) pcs=c00000069b4d7c78
  clk=c0000006921f3478 ci=c000000671fd2e60 pn=c000000644f14860 ctx=c00000067b2f8d48
 kgsccflg=0 llk[9fffffff7f7418d8,9fffffff7f7418d8] idx=0
 xscflg=c0110476 fl2=5200009 fl3=42222008 fl4=100
 sharing failure(s)=12010
 Bind bytecodes
  Opcode = 2   Bind Twotask Scalar Sql In (may be out) Copy
  oacdef = c00000065458b318   Offsi = 48, Offsi = 0
kkscoacd
 Bind#0
  oacdty=01 mxl=32(24) mxlc=00 mal=00 scl=00 pre=00
  oacflg=03 fl2=1000000 frm=01 csi=840 siz=32 off=0
  kxsbbbfp=9fffffff7f743ac0  bln=32  avl=12  flg=05
  value="000215440001"
 Frames pfr 9fffffff7f7bdd48 siz=3672 efr 9fffffff7f7bdc88 siz=3648
 Cursor frame dump
  enxt: 4.0x00000010  enxt: 3.0x00000140  enxt: 2.0x00000020  enxt: 1.0x00000ce0
  pnxt: 2.0x00000008  pnxt: 1.0x00000010
 kxscphp  9fffffff7f766638 siz=984 inu=504 nps=456
 kxscdfhp 9fffffff7fb37598 siz=984 inu=88 nps=0
 kxscbhp  9fffffff7f83f510 siz=984 inu=176 nps=56
 kxscwhp  9fffffff7f150528 siz=49888 inu=49888 nps=41272
Session cached cursors
-----------------------------------------------------------


Cursor#2 ºÎºÐÀ» Ã£¾Æ¼­, Bind °ªÀ» È®ÀÎ.

"02-1544-0001" µ¥ÀÌÄÞ °í°´¹®ÀÇ ¹øÈ£ÀÎ°¡º¸³×¿ä

 

À§ °ªÀ¸·Î Trace ¶°º¸¸é...ÇØ´ç °Ç¼ö°¡ ¸¹¾Æ¼­ ¿À·¡°É¸®³×¿ä


Call     Count CPU Time Elapsed Time       Disk      Query    Current       Rows
------- ------ -------- ------------ ---------- ---------- ---------- ----------
Parse        1    0.000        0.000          0          0          0          0
Execute      1    0.000        0.000          0          0          0          0
Fetch        2    2.590      171.947      18628      22645          0          1
------- ------ -------- ------------ ---------- ---------- ---------- ----------
Total        4    2.590      171.947      18628      22645          0          1

 

Rows     Row Source Operation
-------  ---------------------------------------------------
      0  STATEMENT
      1   SORT GROUP BY (cr=22645 pr=18628 pw=0 time=171946637 us)
   2925    TABLE ACCESS BY GLOBAL INDEX ROWID TB_BFSCCNSL PARTITION: ROW LOCATION ROW LOCATION (cr=22645 pr=18628 pw=0 time=269631731 us)
  23101     INDEX RANGE SCAN IX_BFSCCNSL_09 (cr=127 pr=116 pw=0 time=987471 us)OF IX_BFSCCNSL_09 (NONUNIQUE)
 


¼öÇàÁßÀÎ SQLÀÇ Bind°ª È®ÀÎÀº

¿¢¼À [¿À¶óÅ¬ ¼º´É Q/A] Ã¥ÀÌ³ª http://wiki.ex-em.com/index.php/Oracle_Dump ¿¡ ³ª¿Í ÀÖ½À´Ï´Ù.




################################ sql_id ¸¦ ¾Ë ¶§ sqltext full text  full_text

select sql_text from v$sqltext where sql_id = '7jk9gas8abjfd' order by piece; 
select sql_text from dba_hist_sqltext where sql_id = '7jk9gas8abjfd';


################################## [Oracle 10g] sql bind È®ÀÎ ÇÏ±â    

 
1. ÀÌ½´ 

    DataBase Performance Slow°¡ ¹ß»ýÇÏ°Ô µÇ¸é DBA¿¡°Ô ¿ä±¸µÇ´Â Ã¹¹øÂ° Áú¹®Àº ¾î¶² sqlÀÌ ¹®Á¦³Ä? µÎ¹øÂ°´Â bindº¯¼ö°¡ ¹¹³Ä? 
    Ã¹¹øÂ° Áú¹®¿¡´Â v$session°ú v$session_wait À» ÀûÀýÈ÷ Á¶ÀÎÀ» ÇÏ°Ô µÇ¸é ±Ý¹æ ¾Ë¼ö ÀÖ´Ù. 
    µÎ¹øÂ° Áú¹®¿¡´Â sqlÀÇ bind º¯¼öÀÇ °ªÀ» ¾Ë±â À§ÇØ¼­´Â 9iÀÇ °æ¿ì´Â 10046 event(trace ºÐ¼® ¹æ¹ýÀº ÃßÈÄ Àç°³½Ã ÇÏ°ÚÀ½)¸¦ ÅëÇØ¼­¸¸ °¡´ÉÇß´Ù. 
 
    µÎ¹øÂ°ÀÇ °æ¿ì¿¡´Â ½Ã°£ÀÌ ¼Ò¿äµÈ´Ù´Â °áÁ¡ÀÌ ÀÖ°í, ÀÇ»ç¼ÒÅë¿¡ ÇÑ°è°¡ ÀÖ±â¸¶·ÃÀÌ´Ù.
    Oracle¿¡¼­´Â ÀÌ¸¦ À§ÇØ 10g¿¡¼­ ºÎÅÍ V$SQL_BIND_CAPTURE¸¦ ¼Ò°³Çß´Ù. 

    V$SQL_BIND_CAPTURE¿¡¼­ÀÇ bind º¯¼ö°ªÀº samplingµÈ °ÍÀÌ¸ç, ¾Æ·¡ÀÇ µÎ°³ÀÇ È÷µç parameter°¡ °ü·ÃµÇ¾î ÀÖ´Ù.

    * _cursor_bind_capture_area_size 
    * _cursor_bind_capture_interval 

    ¾Æ·¡ Å×½ºÆ®¸¦ ÅëÇØ »ç¿ë¹ýÀ» È®ÀÎ ÇÏ±â ¹Ù¶õ´Ù.

2. Å×½ºÆ®

-    v$session¿¡¼­ °ü½É´ë»óÀÇ sqlÀÇ sql_id È¤Àº sql_hash_value¸¦ ÃßÃâÇÑ´Ù.

     SQL> select SQL_ID, SQL_HASH_VALUE from v$session where rownum < 10;

     SQL_ID        SQL_HASH_VALUE
     ------------- --------------
     4tyyygpbz8f7a     1475623146

-    v$sql_text¸¦ ÅëÇØ¼­ sql text¸¦ È®ÀÎ´Ù. 

       select sql_text
       from v$sqltext  -- v$sqltext_with_newlines
       where hash_value = '&v_hash_value'
       order by piece
       /

Enter value for v_hash_value: 1475623146

SQL_TEXT
--------------------------------------------------------------------------------
SELECT         HJGU_SIGU name,      HJGU_SIGU_CD code,
HJGU_SIGU value     FROM (      SELECT DISTINCT HJGU_SIGU,
HJGU_SIGU_CD      FROM TAC004 A      WHERE REAL_ADDR_YN='Y'
AND HJGU_DONG_CD ='ZZZ'        AND HJGU_DONG_CD <>'999'
AND HJGU_SIGU_CD <> 'ZZZ'           AND UPD_VER = (SELECT MAX(UP
D_VER) FROM TAC004                      WHERE REAL_ADDR_YN='Y'
AND REAL_USE_YN = 'Y'
AND HJGU_SIDO_CD=A.HJGU_SIDO_CD                        AND HJ
GU_SIGU_CD=A.HJGU_SIGU_CD                        AND HJGU_DONG_C
D=A.HJGU_DONG_CD                        AND HJGU_RD_CD=A.HJGU_RD
_CD )             AND HJGU_SIDO_CD=:1       UNION      SELECT DI
STINCT HJGU_SIGU,      HJGU_SIGU_CD      FROM TAC129      WHERE
1=1          AND HJGU_SIDO_CD=:2      ) ORDER BY HJGU_SIGU

-    v$sql_bind_capture¸¦ ÅëÇØ¼­ bind º¯¼ö¸¦ È®ÀÎ´Ù.


SQL> select NAME, POSITION, VALUE_STRING , WAS_CAPTURED 
from  v$sql_bind_capture 
where SQL_ID = '4tyyygpbz8f7a'

NAME         POSITION VALUE_STRI WAS LAST_CAPTURE
---------- ---------- ---------- --- ------------
:1                  1 48         YES 05-APR-09
:2                  2 48         YES 05-APR-09
:1                  1 41         YES 07-APR-09
:2                  2 41         YES 07-APR-09

3. Reference
    - Doc ID:  273121.1 : How To Find The Value of a Bind Variable Without Tracing
    - Á¶µ¿¿íÀú < Optimizing Oracle Optimizer >


select NAME, POSITION, VALUE_STRING , WAS_CAPTURED 
from  v$sql_bind_capture 
where SQL_ID = '7jm8kjhbwt7ww'


###################### ÇÁ·Î½ÃÀú PROCEDURE ¼öÇà  OUT º¯¼ö 

SQL> VARIABLE P_RETURN_CODE NUMBER;
SQL> EXEC NCS_TRANSFORM_PKG.ncs_bprf_availability_proc(1,16,:p_return_code);


###################### ÇÁ·Î½ÃÀú PROCEDURE/FUNCTION/PACKAGE/TRIGGER ¼Ò½º ¹é¾÷

SELECT TEXT FROM (
SELECT LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' ' || SUBSTR(REPLACE(TEXT,'"',''), INSTR(UPPER(REPLACE(TEXT,'"','')),NAME)+LENGTH(NAME)) , TEXT) AS "TEXT"
FROM DBA_SOURCE
WHERE NAME = UPPER('${object_name}')
AND OWNER = UPPER('${local_owner}')
AND TYPE IN ('TRIGGER')
UNION ALL
SELECT 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = UPPER('${object_name}')
        AND    OWNER = UPPER('${local_owner}')
        AND    OBJECT_TYPE IN ('TRIGGER')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
UNION ALL
SELECT LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' ' || SUBSTR(REPLACE(TEXT,'"',''), INSTR(UPPER(REPLACE(TEXT,'"','')),NAME)+LENGTH(NAME)) , TEXT) AS "TEXT"
FROM DBA_SOURCE
WHERE NAME = UPPER('${object_name}')
AND OWNER = UPPER('${local_owner}')
AND TYPE IN ('PROCEDURE')
UNION ALL
SELECT 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = UPPER('${object_name}')
        AND    OWNER = UPPER('${local_owner}')
        AND    OBJECT_TYPE IN ('PROCEDURE')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
UNION ALL
SELECT LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' ' || SUBSTR(REPLACE(TEXT,'"',''), INSTR(UPPER(REPLACE(TEXT,'"','')),NAME)+LENGTH(NAME)) , TEXT) AS "TEXT"
FROM DBA_SOURCE
WHERE NAME = UPPER('${object_name}')
AND OWNER = UPPER('${local_owner}')
AND TYPE IN ('FUNCTION')
UNION ALL
SELECT 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = UPPER('${object_name}')
        AND    OWNER = UPPER('${local_owner}')
        AND    OBJECT_TYPE IN ('FUNCTION')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
UNION ALL
SELECT LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' ' || SUBSTR(REPLACE(TEXT,'"',''), INSTR(UPPER(REPLACE(TEXT,'"','')),NAME)+LENGTH(NAME)) , TEXT) AS "TEXT"
FROM DBA_SOURCE
WHERE NAME = UPPER('${object_name}')
AND OWNER = UPPER('${local_owner}')
AND TYPE IN ('PACKAGE')
UNION ALL
SELECT 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = UPPER('${object_name}')
        AND    OWNER = UPPER('${local_owner}')
        AND    OBJECT_TYPE IN ('PACKAGE')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
UNION ALL
SELECT LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' ' || SUBSTR(REPLACE(TEXT,'"',''), INSTR(UPPER(REPLACE(TEXT,'"','')),NAME)+LENGTH(NAME)) , TEXT) AS "TEXT"
FROM DBA_SOURCE
WHERE NAME = UPPER('${object_name}')
AND OWNER = UPPER('${local_owner}')
AND TYPE IN ('PACKAGE BODY')
UNION ALL
SELECT 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = UPPER('${object_name}')
        AND    OWNER = UPPER('${local_owner}')
        AND    OBJECT_TYPE IN ('PACKAGE BODY')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
);


################################## sql hash value, sql_text µîÀ» ¾Ë ¶§ ±×¸¦ Æ÷ÇÔÇÑ ÆÐÅ°Áö ÇÁ·Î½ÃÀú Á¶È¸

sys·Î ¼öÇà

SYS#LGDPOSP1> ;
  1  select kglnacnm
  2  from x$kglrd
  3* where kglnadhv = 2615138481
  
KGLNACNM
--------------------------------------------------------------------------------
PG_OSOSO_XPDBIZ_CERT




################################## hard parsing ÇÏµåÆÄ½Ì °úÀ¯¹ß Äõ¸®¹®

TOSS HARD PARSING QUERY CAPTURE
SELECT substr(sql_text,1,30) sql ,  count(*)
FROM v$sqlarea
GROUP BY substr(sql_text,1,30)
HAVING count(*) > 200

  SELECT substr(sql_text,1,60) sql , count(1)
FROM v$sqlarea
where EXECUTIONS <= 1
GROUP BY substr(sql_text,1,60)
HAVING count(1)  > 50


SELECT substr(sql_text,1,60) sql
FROM v$sqlarea
where EXECUTIONS <= 1
GROUP BY substr(sql_text,1,60)
HAVING count(1)  > 1;

À§ Äõ¸® ´ë»ó¿¡ ¾Æ·¡¸¦ ºÙÀÓ

SELECT DISTINCT SQL_ID FROM V$SQL_TEXT WHERE SQL_TEXT LIKE '%

select substr(sql_text, 1, 100), count(*)
from   v$sqlarea
having count(*) > 4
group by substr(sql_text, 1, 100)
order by count(1) desc;


full text ÃßÃâ (½Ã°£ ¿À·¡ °É¸²)
select hash_value, substr(sql_text, 1, 80)
   from v$sqlarea
where substr(sql_text,1,40) in (select substr(sql_text,1,40)
                                               from v$sqlarea
                                            having count(*) > 4
                                            group by substr(sql_text,1,40))
order by sql_text;



######### ¸®ÅÍ·² SQL ÃßÃâ Äõ¸®¹® (10G)
SELECT *
FROM   (
        SELECT (
                SELECT parsing_schema_name
                FROM   v$sqlarea
                WHERE  sql_id=a.max_sql_id
               ) SCHEMA ,
               (
                SELECT MODULE
                FROM   v$sqlarea
                WHERE  sql_id=a.max_sql_id
               ) MODULE ,
               a.literal_sql_cnt ,
               a.execution_cnt ,
               a.plan_cnt ,
               (
                SELECT sql_fulltext
                FROM   v$sqlarea
                WHERE  sql_id = a.max_sql_id
               ) sql_text
        FROM   (
                SELECT s.force_matching_signature ,
                       COUNT( s.exact_matching_signature ) literal_sql_cnt ,
                       SUM( s.executions ) execution_cnt ,
                       MIN( s.sql_id ) max_sql_id ,
                       COUNT( DISTINCT s.plan_hash_value ) plan_cnt
                FROM   v$sql s
                GROUP  BY s.force_matching_signature
                HAVING COUNT( s.exact_matching_signature ) > 2
               ) a
        ORDER  BY 3 DESC
       )
WHERE  ROWNUM <= 50




############## ÆÄµåÆÄ½Ì À¯¹ß ¼øÀ¸·Î ÃßÃâ

select a.sid,
       c.username,
       b.name,
       a.value,
       round((sysdate - c.logon_time) * 24) hours_connected
from   v$sesstat a,
       v$statname b,
       v$session c
where  c.sid = a.sid
and    a.statistic# = b.statistic#
and    a.value > 0
and    b.name = 'parse count (hard)'
order by a.value desc;


À§ °á°ú sid ¸¦ ±âÁØÀ¸·Î ±âÅ¸ Á¤º¸ ÃßÃâ

select s.sid,
       s.serial#,
       p.spid,
       s.program,
       s.osuser os_user,
       s.username,
       q.sql_text
from   v$process p,
       v$session s,
       v$sqltext q
where  p.addr(+) = s.paddr
and    s.sid=2780
and    s.sql_hash_value= q.hash_value;



##################### sid ·Î spid ÃßÃâ

select s.sid,
       s.serial#,
       p.spid,
       s.program,
       s.osuser os_user,
       s.username
from   v$process p,
       v$session s,
       v$sqltext q
where  p.addr(+) = s.paddr
and    s.sid=2780;


select s.sid,
       s.serial#,
       s.status,
       p.spid,
       s.program,
       s.osuser os_user,
       s.username
from   v$process p,
       v$session s
where  p.addr(+) = s.paddr
and    s.username='PSLYR';

 
 ################################# oradebug ¸¦ ÀÌ¿ëÇÑ sql trace
 
 oradebug setospid OS_PROCESS_ID
 oradebug event 10046 trace name context forever, level4
 
 ... few minutes
 
 oradebug event 10046 trace name context off
 
 --> udump 
 tkprof trace_file_name outpit_file_name explain=user/pass sort=fchqry
 



oradebug setospid 12345
oradebug unlimit
oradebug event 10046 trace name context forever, level 8;
 ±è¹ÌÇö[°úÀå] ´ÔÀÇ ¸» :  
oradebug event 10046 trace name context off


################################## 10046 Æ®·¹ÀÌ½º

oradebug »Ó ¾Æ´Ï¶ó session·¹º§¿¡¼­µµ ¼öÇà °¡´É.

    alter session set events '10046 trace name context forever, level 12';
¹®Á¦°¡ µÇ´Â package ¼öÇà

udump ¾Æ·¡ »ý¼ºµÈ tracefile À» upload ÇÏ¿© ÁÖ½Ã±â ¹Ù¶ø´Ï´Ù.

alter session set events '10046 trace name context off';

½Ã½ºÅÛ ·¹º§ÀÇ 10046
alter system set events '10046 trace name context forever, level 12';
alter system set events '10046 trace name context off';

################################## ½ÇÇàÁßÀÎ sql kill

/* curent executeing sql kill */
select /*+ LEADING(sqlarea)*/
       distinct sesion.sid
     , sesion.serial#
     , sesion.username
     , sesion.sql_id
     , process.spid
     , 'kill -9 ' || process.spid kill_command
  from v$sql_bind_capture sql_bind_capture
     , v$session sesion
     , v$sqlarea sqlarea
     , v$process process
 where sesion.sql_hash_value = sql_bind_capture.hash_value
   and sesion.sql_address    = sql_bind_capture.address
   and sesion.sql_id = sqlarea.sql_id
   and sesion.paddr = process.addr
   and sesion.username = 'PBC'
   and sqlarea.sql_fulltext  like '%'||:sql_piece ||'%'
 order by sesion.sid, sesion.serial#
;




#################### exp data pump
OS/DB ´Ü¿¡ ¹Ì¸® directory¸¦ ¸¸µé¾î³ö¾ß ÇÑ´Ù.(¾øÀ» ½Ã ¿¡·¯¹ß»ý)

For the examples to work we must first unlock the SCOTT account and create a directory object it can access:

CONN sys/password@db10g AS SYSDBA
ALTER USER scott IDENTIFIED BY tiger ACCOUNT UNLOCK;
GRANT CREATE ANY DIRECTORY TO scott;
CREATE OR REPLACE DIRECTORY test_dir AS '/u01/app/oracle/oradata/';
GRANT READ, WRITE ON DIRECTORY test_dir TO scott;

select * from dba_directories;

expdp scrjco2/scrjco2 directory=pump dumpfile=expdp_co2.dmp logfile=expdp_co2.log tables=TB_RN333

Table Exports/Imports

The TABLES parameter is used to specify the tables that are to be exported. The following is an example of the table export and import syntax:
expdp scott/tiger@db10g tables=EMP,DEPT directory=TEST_DIR dumpfile=EMP_DEPT.dmp logfile=expdpEMP_DEPT.log
impdp scott/tiger@db10g tables=EMP,DEPT directory=TEST_DIR dumpfile=EMP_DEPT.dmp logfile=impdpEMP_DEPT.log

For example output files see expdpEMP_DEPT.log and impdpEMP_DEPT.log.
The TABLE_EXISTS_ACTION=APPEND parameter allows data to be imported into existing tables.

¿É¼Ç)TABLE_EXISTS_ACTION={SKIP | APPEND | TRUNCATE | REPLACE}


CREATE OR REPLACE DIRECTORY TRUNC_LOG_FILE_DIR AS '/sw/oracle/DBA_JOBS/trunc_log';
GRANT READ, WRITE ON DIRECTORY TRUNC_LOG_FILE_DIR TO POW,POW_OO;


################### impdp
#userid=NCRDEV05/NCRDEV05
directory=DATA_PUMP_DIR
CONTENT=DATA_ONLY
INCLUDE=TABLE
#include=index
#include=constraint
#SCHEMAS=NCS
REMAP_SCHEMA=NCS:NCRDEV05
REMAP_TABLESPACE=NCS_DATA:NCS_DATA
REMAP_TABLE=NCS.account:R_account
,NCS.consolidated_daily_usage:R_consolidated_daily_usage
,NCS.subscriptions:R_subscriptions
,NCS.service_plan:R_service_plan
,NCS.service_plan_sales_category:R_service_plan_sales_category
,NCS.sales_category:R_sales_category
,NCS.ip_address:R_ip_address
,NCS.resources:R_resources
dumpfile=ncs_121017.dmp
#parallel=4
LOGFILE=imp_ncrdev05_copy_tables_121017.log



##################### impdp ·Î sql ÆÄÀÏ ¶³¾î¶ß¸®±â
parfile

DIRECTORY=tosspump
DUMPFILE=puos2_meta_full_expdp.pump
LOGFILE=dposeai.log
JOB_NAME=META_ONLY
SCHEMAS=DPOSEAI
SQLFILE=dposeai_bak.sql



[nossdb2:PUOS2:/logs002/PUOS2/dba/tosspump] vi dposeai.log
"dposeai.log" 28 lines, 1663 characters
;;;
Import: Release 10.2.0.5.0 - 64bit Production on Friday, 20 January, 2012 22:25:01

Copyright (c) 2003, 2007, Oracle.  All rights reserved.
;;;
Connected to: Oracle Database 10g Enterprise Edition Release 10.2.0.5.0 - 64bit Production
With the Partitioning, Real Application Clusters, OLAP, Data Mining
and Real Application Testing options
Master table "SYSTEM"."META_ONLY" successfully loaded/unloaded
Starting "SYSTEM"."META_ONLY":  system/******** parfile=dposeai.par
Processing object type DATABASE_EXPORT/SCHEMA/USER
Processing object type DATABASE_EXPORT/SCHEMA/GRANT/SYSTEM_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/ROLE_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/DEFAULT_ROLE
Processing object type DATABASE_EXPORT/SCHEMA/TABLESPACE_QUOTA
Processing object type DATABASE_EXPORT/SCHEMA/SEQUENCE/SEQUENCE
Processing object type DATABASE_EXPORT/SCHEMA/SEQUENCE/GRANT/OWNER_GRANT/OBJECT_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/SYNONYM
Processing object type DATABASE_EXPORT/SCHEMA/PROCACT_SCHEMA
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/TABLE
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/GRANT/OWNER_GRANT/OBJECT_GRANT
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/INDEX/INDEX
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/CONSTRAINT/CONSTRAINT
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/INDEX/STATISTICS/INDEX_STATISTICS
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/COMMENT
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/STATISTICS/TABLE_STATISTICS
Processing object type DATABASE_EXPORT/SCHEMA/TABLE/TRIGGER
Job "SYSTEM"."META_ONLY" successfully completed at 22:27:01
~


##################### expdp
expdp parfile=osf.par

osf.par

 USERID=SYSTEM/MWNR4POS
directory=TOBE_DIR
dumpfile=OSF_110107_%U.dmp
LOGFILE=OSF_110107_%U.log
TABLES=
DPOW_OSF.TB_OSF_DSGNREQ
DPOW_OSF.TB_OSF_AFFL_EQP
DPOW_OSF.TB_OSF_CRCOR
DPOW_OSF.TB_OSF_CRCOR_DEL_H




 USERID=ospdba/rlqksakstp0413
directory=TOBE_DIR
parallel=4
dumpfile=OSS_CFMT_100531_%U.dmp
SCHEMAS=DPOW_OSC,DPOW_OST,DPOW_OSF,DPOW_OSM
LOGFILE=expOSS_CFMT_100531.log

#### /as sysdba °èÁ¤À¸·Î expdp
expdp "'/ as sysdba'" parfile=ncs_120628.par
expdp "'/ as sysdba'" parfile=exp_ncs_121017.par
directory=DATA_PUMP_DIR
parallel=4
dumpfile=ncs_120628_%U.dmp
SCHEMAS=NCSBOBJU,NCSREPU
LOGFILE=expOSS_CFMT_100531.log


impdp "'/ as sysdba'" parfile=imp_ncrprod2_121026.par


impdp parfile

 USERID=system/mwnr4tos
directory=TOBE_DIR
#CONTENT=METADATA_ONLY
#include=index
#include=constraint
SCHEMAS=DPOW_OSZ,DPOW_OSO,DPOW_OSP,DPOW_OSW
REMAP_SCHEMA=DPOW_OSO:DPTOW_OSO,DPOW_OSZ:DPTOW_OSZ,DPOW_OSP:DPTOW_OSP,DPOW_OSW:DPTOW_OSW
dumpfile=OSS_OZPW_100702_01.dmp,OSS_OZPW_100702_02.dmp,OSS_OZPW_100702_03.dmp,OSS_OZPW_100702_04.dmp
parallel=4
LOGFILE=impOSS_OZPW_100702.log






####################### impdp with new tablespace
Please find the details of the proposed approach below: 

Details of existing Pre-Prod environment.

DATABASE SERVER HOSTNAME --> psltestclu-orasvip.ncs-model.corp.telstra.com
Database Server IP --> 10.96.161.73
Database port --> 1521
DATABASE SCHEMA   -->  BSATEST
DATABASE USER NAME  --> bl_user_4

1.            Take a database backup of Pre-prod including the BSATEST database instance.
2.       Extract DB dump from Production BBSA database instance.
details '
"         DB Name (Production) ' NCSBSACP1
"         DB Schema ' BL_USER
We already have an extracted  dump of Production database schema named "expdp_NCSBSACP1_BL_USER_20140509_165424_01.dmp" [Laura had provided this yesterday to us].
3.        create a tablespace telstra_812_test_may2014 for their data. Example:
--------------------------------------------------------------------
CREATE TABLESPACE telstra_812_test_may2014 LOGGING  DATAFILE 'D:\oracle\databases\ora112db\telstra_812_test_may2014\telstra_812_test_may2014_1.ora' 
 SIZE 32767M DEFAULT
STORAGE ( INITIAL 50K NEXT 50K MAXEXTENTS UNLIMITED PCTINCREASE 0);


4.        create a tablespace telstra_812_test_may2014_index for their index data. Example:
--------------------------------------------------------------------------------
CREATE TABLESPACE adp_822_aug2013_INDEX LOGGING DATAFILE 'D:\oracle\databases\ora112db\telstra_812_test_may2014\telstra_812_test_may2014_index_1.ora' 
SIZE 32767M
DEFAULT
STORAGE ( INITIAL 50K NEXT 50K MAXEXTENTS UNLIMITED PCTINCREASE 0);


5.        Create a new user for 'telstra_812_test_may2014' to prevent confusion. For example:
----------------------------------------------------------------------------
CREATE USER telstra_812_test_may2014
PROFILE DEFAULT IDENTIFIED BY sa
DEFAULT TABLESPACE telstra_812_test_may2014 TEMPORARY TABLESPACE TEMP ACCOUNT UNLOCK; GRANT CONNECT TO telstra_812_test_may2014;

GRANT RESOURCE TO telstra_812_test_may2014;

GRANT CREATE VIEW TO telstra_812_test_may2014;

GRANT UNLIMITED TABLESPACE TO telstra_812_test_may2014;

6.        Use the following 'impdp' import statement. Replace all instances of items in '<>' with actual data:
----------------------------------------------------------------------------
impdp <username>/<password>@<SID>                        note ' User Id and password would be same which is in use for production (username ->BL_USER,   Password ' blade123)
dumpfile=expdp_NCSBSACP1_BL_USER_20140509_165424_01.dmp
logfile=telstra_812_may2014.log
transform=oid:n
full=n
schemas=BL_USER
directory=<export_import_directory_name>
remap_tablespace=<bl_user_data>:telstra_812_test_may2014,<bl_user_data_index>:telstra_812_test_may2014_index
remap_schema=BL_USER:telstra_812_test_may2014


7. Please provide the schema details to us so that  we can continue with the BMC configurations.





##################### SCOTT SCHEMA ÀÇ DDL ¹®Àå¸¸ »ý¼º ÇÏ±â


SQL ¿É¼Ç ÁÖ¸é, DDL À» SQL ·Î ¶³¾î¶ß¸²


A. ¿ì¼± SCOTT SCHEMA EXPDP

expdp scott/tiger directory=my_dir dumpfile=expscott.dmp

B. DDL ¹®Àå¸¸ »Ì±â

# impdp scott/tiger directory=my_dir dumpfile=expscott.dmp sqlfile=scott.sql



##################### ÀÎµ¦½º Ã¼Å©
select * 
  from dba_indexes
 where owner IN ('POW_BC', 'POW_BB')
   and status not in ('VALID', 'N/A')
 order by index_name desc;

select * 
  from dba_ind_partitions
 where index_owner IN ('POW_BC' , 'POW_BB')
   and status <> 'USABLE'
 order by index_name, partition_name desc;
 
 
##################### ÀÎµ¦½º º´·Ä»ý¼º

CONN WSD/WSD

SET ECHO ON
SET LINESIZE 120
SET PAGESIZE 30
SET TIME ON
SET TIMING ON

alter session set workarea_size_policy=manual;
alter session set sort_area_size=500000000;

CREATE INDEX WSD.I_TSD01_03 ON WSD.TSD01
(
	BUB_CD ASC,
	SYS_CD ASC,
	JP_CD ASC,
	SA_NO ASC
)
TABLESPACE TSWSDINDX1
nologging parallel 16;


ÀÎµ¦½º º´·Ä»ý¼º ÈÄ¿¡´Â ÀÎµ¦½º Á¤ÀÇ¸¦ NOPARALLEL ·Î ´Ù½Ã º¯°æÇØ¾ß ÇÔ.

select 'ALTER INDEX ' || OWNER || '.' || INDEX_NAME || ' NOPARALLEL;' from dba_indexes
where owner like 'DPOW%'
AND DEGREE > '1';




##################### FK »ý¼º
ALTER TABLE DPTOW_OSC.TB_OSC_COMN_CD_VAL ADD(
	CONSTRAINT FK_OSC_COMN_CD_VAL_01 FOREIGN KEY (COMN_ID)
	REFERENCES DPTOW_OSC.TB_OSC_COMN_CD_DEFN(COMN_ID) );
	




#####################  Å×ÀÌºí/ÀÎµ¦½º ¼Ó¼º º¯°æ

1. ÀÎµ¦½º INITRANS º¯°æ

select DISTINCT 'ALTER INDEX ' || owner ||'.'|| index_name || ' INITRANS 10;'
from dba_indexes
where (owner, index_name) in
(
    SELECT owner, object_name FROM V$SEGMENT_STATISTICS
    WHERE STATISTIC_NAME = 'ITL waits'
    and owner != 'SYS'
    and value > 100
)
;

ALTER INDEX CBADM.SB_ADDR_CHNG_HIST_01 INITRANS 10;
ALTER INDEX CBADM.SB_ADDR_CHNG_HIST_02 INITRANS 10;
ALTER INDEX CBADM.SB_BILL_ACNT_PK INITRANS 10;
ALTER INDEX CBADM.SB_ENTR_CNTC_03 INITRANS 10;
ALTER INDEX CBADM.SB_ENTR_CNTC_PK INITRANS 10;
ALTER INDEX CBADM.SB_ENTR_PK INITRANS 10;

 

2. Å×ÀÌºí INITRANS º¯°æ

select DISTINCT 'ALTER TABLE ' || owner ||'.'|| table_name || ' INITRANS 10;'
from dba_indexes
where (owner, index_name) in
(
    SELECT owner, object_name FROM V$SEGMENT_STATISTICS
    WHERE STATISTIC_NAME = 'ITL waits'
    and owner != 'SYS'
    and value > 100
)
;

ALTER TABLE CBADM.TB_SB_ADDR_CHNG_HIST INITRANS 10;
ALTER TABLE CBADM.TB_SB_BILL_ACNT INITRANS 10;
ALTER TABLE CBADM.TB_SB_ENTR INITRANS 10;
ALTER TABLE CBADM.TB_SB_ENTR_CNTC INITRANS 10;


3. ÀÎµ¦½º PCTFREE º¯°æ

select DISTINCT 'ALTER INDEX ' || owner ||'.'|| index_name || ' PCTFREE 40;'
from dba_indexes
where (owner, index_name) in
(
    SELECT owner, object_name FROM V$SEGMENT_STATISTICS
    WHERE STATISTIC_NAME = 'ITL waits'
    and owner != 'SYS'
    and value > 100
)
;


ALTER INDEX CBADM.SB_ADDR_CHNG_HIST_01 PCTFREE 40;
ALTER INDEX CBADM.SB_ADDR_CHNG_HIST_02 PCTFREE 40;
ALTER INDEX CBADM.SB_BILL_ACNT_PK PCTFREE 40;
ALTER INDEX CBADM.SB_ENTR_CNTC_03 PCTFREE 40;
ALTER INDEX CBADM.SB_ENTR_CNTC_PK PCTFREE 40;
ALTER INDEX CBADM.SB_ENTR_PK PCTFREE 40;


4. Å×ÀÌºí PCTFREE º¯°æ 

select DISTINCT 'ALTER TABLE ' || owner ||'.'|| table_name || ' PCTFREE 40;'
from dba_indexes
where (owner, index_name) in
(
    SELECT owner, object_name FROM V$SEGMENT_STATISTICS
    WHERE STATISTIC_NAME = 'ITL waits'
    and owner != 'SYS'
    and value > 100
)
;

ALTER TABLE CBADM.TB_SB_ADDR_CHNG_HIST PCTFREE 40;
ALTER TABLE CBADM.TB_SB_BILL_ACNT PCTFREE 40;
ALTER TABLE CBADM.TB_SB_ENTR PCTFREE 40;
ALTER TABLE CBADM.TB_SB_ENTR_CNTC PCTFREE 40;

################################### TX - allocate ITL entry ÀÌº¥Æ®¿¡ Àç¿¬

¾È³çÇÏ¼¼¿ä. ÇÑ±¹ ¿À¶óÅ¬ Á¤Ã¶¿ì ÀÔ´Ï´Ù.

Ãß°¡ÀûÀ¸·Î 10.2.0.4¿¡¼­ enq: TX - allocate ITL entry ÀÌº¥Æ®¿¡ ´ëÇÑ °ü·ÃµÈ Á¦Ç° ÀÌ½´¿¡ ´ëÇØ È®ÀÎÇØ º¸¾Ò½À´Ï´Ù.
Çö»óÀ¸·Î ºÁ¼± ¾Æ·¡ Bug 6782434ÀÌ ¹®Á¦°¡ µÉ µí ÇÕ´Ï´Ù.

6782434 - TX ENQUEUE WAIT FOR ITL ALLOCATION NOT ENDED WHEN OTHER TRANSACTION COMMIT

ÇØ´ç ½ÃÁ¡ÀÇ Call stackÀÌ ¾ø´Â »óÅÂ¿©¼­, Á¤È®ÇÑ ÀÏÄ¡ ¿©ºÎ´Â È®ÀÎÇÏ±â ¾î·Æ½À´Ï´Ù.
BugÀÇ ³»¿ëÀº ITLÀÌ ¸ðµÎ »ç¿ëµÈ »óÅÂÀÌ°í, Block¿¡ free space°¡ ¾ø´Â »óÅÂÀÏ ¶§, ITL °³¼ö¸¦ ÃÊ°úÇÏ´Â TXÀÌ µ¿½Ã¿¡ µé¾î¿À¸é, 
ITL¸¦ Àâ°í ÀÖ´Â ¼¼¼Ç¿¡¼­ Commit/rollbackÀÌ µÇ¾îµµ ½Å±Ô ¼¼¼Ç¿¡¼­ ITL WaitÀÌ Ç®¸®Áö ¾Ê´Â Çö»ó ÀÔ´Ï´Ù.
ITL WaitÀÌ Ç®¸®´Â ½ÃÁ¡Àº, ÇØ´ç BlockÀÇ ¸ðµç TXÀÌ Commit/rollbackÀÌ µÇ¾î¾ß ÇÕ´Ï´Ù.
´Ù¸¸, ÀÌ¹ø °æ¿ì ÇØ´ç INDEXÀÇ Initrans°¡ 100ÀÌ°í, PCT Free°¡ 10%ÀÌ±â ¶§¹®¿¡, 
ÀÌ BugÀ¸·Î ÀÎÇØ ¹®Á¦°¡ µÇ·Á¸é µ¿½Ã¿¡ ÇØ´ç block¿¡ ¾à 130¿©°³ (initrans 100 +  PCT Free 800byte / 24) TXÀÌ CommitÇÏÁö ¾ÊÀº »óÅÂ¿¡¼­ Á¸ÀçÇØ¾ß ÇÕ´Ï´Ù.
BugÀÇ ÀçÇöÀº ¾Æ·¡ Å×½ºÆ® ÄÉÀÌ½º¸¦ ¼öÇàÇØ º¸½Ã¸é µË´Ï´Ù. 

¾Æ·¡¿Í °°ÀÌ Å×½ºÆ® ÇßÀ» ¶§, 4¹øÂ° ¼¼¼Ç¿¡¼­ Update ¼öÇà½Ã ITL WaitÀÌ ¹ß»ýÇÏ´Âµ¥, 

ÀÌ¶§ ÇÏ³ªÀÇ ¼¼¼Ç¿¡¼­ commit/rollbackÀ» ÇØµµ ITL WaitÀÌ Ç®¸®Áö ¾Ê´Â´Ù¸é ÇØ´ç BugÀÇ ¿µÇâÀ» ¹Þ´Â °Í ÀÔ´Ï´Ù.

! drop table test_itl;

create table test_itl (
        id number,
        data varchar2(20)
    )
    pctfree 0
    initrans 3;

create index test_itl_idx
on  test_itl ( id , data )
    pctfree 0
    initrans 2;

insert into test_itl select rownum,'a' from all_objects where rownum < 2000;
commit;


-----
Session 1:
SELECT s.username, s.sid, p.spid, p.pid
  FROM v$session s, v$process p
  WHERE audsid=userenv('sessionid')
    AND s.paddr = p.addr;        
update test_itl set data=data w! here id=1;

Session 2:
SELECT s.username, s.sid, p.spid, p.pid
  FROM v$session s, v$process p
  WHERE audsid=userenv('sessionid')
    AND s.paddr = p.addr;        
update test_itl set data=data where id=2;

Session 3:
SELECT s.username, s.sid, p.spid, p.pid
  FROM v$session s, v$process p
  WHERE audsid=userenv('sessionid')
    AND s.paddr = p.addr;        
update test_itl set data=data where id=3;

Session 4:
SELECT s.username, s.sid, p.spid, p.pid
  FROM v$session s, v$process p
  WHERE audsid=userenv('sessionid')
    AND s.paddr = p.addr;        
update test_itl set data=data where id=4;
-->> Session wil hang waiting on ITL

Session 5: (connected as sysdba)
select s.sid, p.pid, p.spid, l.block, l.type, l.id1, l.id2from v$lock l, v$session s, v$process p
where (l.type, l.id1, l.id2) in (select type, id1, id2 from v$lock where type 
= 'TX' and block > 0)
and l.sid = s.sid
and s.paddr = p.addr;


-->> Commit / rollback the sessions not blocking the pending transaction.

 
À§ bug¿¡ ´ëÇÑ patch´Â PA-! RISC ¹öÀü¿¡¼­´Â Single Patch´Â ¾ø°í 10.2.0.4.4 PSU¿¡ Àû¿ëÇÒ ¼ö ÀÖ´Â Merge Patch(12818968)°¡ Á¸ÀçÇÕ´Ï´Ù.
¸¸¾à Patch¸¦ Àû¿ëÇÏ½Å´Ù¸é, 9352164 (10.2.0.4.4 PSU) Àû¿ë ÈÄ 12818968 (Merge Patch)¸¦ Àû¿ëÇÏ¼Å¾ß ÇÕ´Ï´Ù.
±âÁ¸ ÆÐÄ¡¿ÍÀÇ conflict check´Â SRÀ» ÅëÇØ È®ÀÎ ºÎÅ¹ µå¸³´Ï´Ù.
9352164 - 10.2.0.4.4 Patch Set Update (PSU) [ID 9352164.8] - HP-UX PA-RISC 64
12818968: MERGE REQUEST ON TOP OF 10.2.0.4.4 FOR BUGS 12636230 9949948



¾È³çÇÏ¼¼! ¿ä. ÇÑ±¹ ¿À¶óÅ¬ Á¤Ã¶¿ì ÀÔ´Ï´Ù.

l  TB_SB_ADDR_CHNG_HIST Å×ÀÌºíÀÇ ÀÎµ¦½º¿¡¼­ ¹ß»ýÇÑ enq: TX - allocate ITL entryÀÌº¥Æ®¿¡ ´ëÇÑ Ãß°¡ ºÐ¼® °á°ú ÀÔ´Ï´Ù.

1. ÇØ´ç Å×ÀÌºíÀÇ ÀÎµ¦½º¿¡ ´ëÇÑ allocate ITL entry ¹ß»ýÀº, È®ÀÎµÈ °Í¸¸ 1¿ù 03ÀÏ, 10¿ù 04?! Ï¿? µ¿ÀÏÇÏ°Ô ¹ß»ýÇÏ¿´½À´Ï´Ù.
   (1¿ù 3ÀÏ ADDM REPORT¿¡ º¸¸é 19% Á¤µµÀÇ Impact·Î 11¿ù 14ÀÏ°ú ºñ½ÁÇÑ ¼öÄ¡¸¦ º¸ÀÔ´Ï´Ù.)

2. allocate ITL entry ÀÌº¥Æ®°¡ ¹ß»ýÇÏ´Â °æ¿ì´Â ´ÙÀ½°ú °°½À´Ï´Ù.

   - Æ¯Á¤ BLOCK¿¡ ´ëÇØ TXÀÌ ¹ß»ýÇÏ¸é, ¸ÕÀú ITL SlotÀ» ÇÒ´ç ¹Þ¾Æ¾ß ÇÕ´Ï´Ù. 
   - ÀÌ¶§ ÇØ´ç Å×ÀÌºí ¹× ÀÎµ¦½º¿¡ ¼³Á¤µÈ initrans °ª¸¸Å­ÀÇ ITL SlotÀ» ÇÒ´çÇÏ¿© µ¿½Ã TXÀÌ °¡´ÉÇÕ´Ï´Ù.
   - ¸¸¾à ITL SlotÀÌ ºÎÁ·ÇÏ¸é, maxtrans °ª¸¸Å­ ITL SlotÀÌ Á¡Â÷ÀûÀ¸·Î Áõ°¡ÇÒ ¼ö ÀÖ½À´Ï´Ù.
   - ´Ù¸¸ ÇØ´ç BLOCK¿¡ FREE Space°¡ ÀÖ¾î¾ß ITL SlotÀ» Ãß°¡ ÇÒ´çÇÒ ¼ö ÀÖ½À´Ï´Ù. (°³´ç 24byte Á¤µµ)
   - ÇØ´ç ÀÎµ¦½ºÀÇ Leaf blockÀÇ PCT FREE°¡ (8k blockÀÏ °æ¿ì) 10%¶ó¸é ¾à 30°³ Á¤µµÀÇ ITL SlotÀ» Ãß°¡ ÇÒ´ç ÇÒ ¼ö ÀÖ½À´Ï´Ù. 
   - Áï ÇÑ Block¿¡ µ¿½Ã Á¢±Ù °¡´ÉÇÑ TX¼ö´Â initrans + pct free + block free space¸¸Å­ÀÌ¶ó°í º¸½Ã¸é µË´Ï´Ù.
   - ÀÌ·¸°Ô ÇÑ BLOCK¿¡ ´ëÇØ µ¿½Ã TXÀÌ ´Ù¼ö ¹ß»ýÇÏ¿© ITL SlotÀ» ÇÒ´ç¹Þ±â À§ÇØ ´ë±âÇÏ´Â ÀÌº¥Æ®°¡ allocate ITL entryÀÔ´Ï´Ù.

3.   TB_SB_ADDR_CHNG_HIST

   - TB_SB_ADDR_CHNG_HISTÀÇ °æ¿ì, Àå¾Ö½ÃÁ¡¿¡ 1500°Ç Á¤µµÀÇ insert°¡ ¼öÇàµÇ¾ú´Âµ¥, 1¹ø insert ÇÏ´Âµ¥ ¾à 100ÃÊ Á¤µµ°¡ ¼Ò¿äµÇ¾ú½À´Ï´Ù. 
     Áï ´ëºÎºÐÀÇ ½Ã°£À» ITL SlotÀ» È¹µæÇÏ±â À§ÇØ ´ë±âÇÏ´Âµ¥ º¸³Â´Ù´Â ¶æ ÀÔ´Ï´Ù. 
   - ÀÌ´Â Insert ´ë»ó indexÀÇ ±¸Á¶(initrans, pct free, partition ¿©ºÎµî)µµ Áß¿äÇÏÁö¸¸, Ãß°¡ÀûÀ¸·Î InsertµÇ´Â SQLÀÌ ¼ÓÇÑ ÀüÃ¼ TX¿¡ ¹®Á¦°¡ ÀÖ±â ¶§¹®ÀÌ¶ó°í º¸¿©Áý´Ï´Ù. 
     Áï ÀüÃ¼ Ã³¸® °Ç¼ö°¡ Áõ°¡ÇÏÁö ¾Ê¾Ò´Âµ¥ ¹®Á¦°¡ ¹ß»ýÇÏ¿´´Ù¸é, ÈÄÇà TXÀÌ Áö¿¬µÇ¾úÀ» °¡´É¼ºÀÌ Å®´Ï´Ù. 
   - ÀÌ´Â AP´Ü¿¡¼­ ÀüÃ¼ ÇØ´ç TXÀÇ ·ÎÁ÷À» °ËÅäÇÒ ÇÊ¿ä°¡ ÀÖÀ½À» ÀÇ¹ÌÇÕ´Ï´Ù. Áï ¹®Á¦°¡ ¹ß»ýÇÑ INSERT¹®ÀÇ ÈÄÇà Ã³¸® ÀÛ¾÷ÀÌ ¾î¶»°Ô ÀÌ·ç¾îÁö´ÂÁö È®ÀÎÀ» ÇØºÁ¾ß ÇÕ´Ï´Ù.
   - ¶ÇÇÑ index¿¡¼­ SEQUENCE¸¦ KEY·Î ¾²´Â °æ¿ì RAC¿¡¼­ ORDER¸¦ ¾²°Ô µÇ¸é, index leaf block¿¡ ´ëÇÑ °æÇÕÀÌ ¹ß»ýÇÏ±â ¶§¹®¿¡, 

¾÷¹« ·ÎÁ÷»ó¿¡¼­ ORDER¸¦ Á¦°Å ÇÒ ¼ö ÀÖ´ÂÁö °ËÅä°¡ ÇÊ¿äÇÕ´Ï´Ù.


l  ITL Entry ´ë±â ÀÌº¥Æ® Test Scenario´Â Ã·ºÎÆÄÀÏ Âü°í

l  LAN Card Driver Update ±Ç°í ¹®Á¦
NIC Drvier¿Í °ü·ÃÇÏ¿© SYS CPU°¡ Áõ°¡ÇÏ´Â ¹®Á¦
ÇØ´ç ÀÌ½´´Â LG U+°Ç°ú µ¿ÀÏÇÑ °ÇÀº ¾Æ´ÏÁö¸¸, ºñ½ÁÇÑ »ç·Ê°¡ ÀÖÀ¸¹Ç·Î, ÃÖ½ÅÀÇ NIC Driver VersionÀ¸·Î Update ÇÒ °ÍÀ» ±Ç°íÇÑ °Í ÀÔ´Ï´Ù.




#################### ¿ø°ÝÁö db ¿¡ ´ëÇÑ exp - 10g µðºñ¸¦ 9i ¹ÙÀÌ³Ê¸®·Î ¹Þ°íÀÚ ÇÒ ¶§ »ç¿ë compress=y·Î ÇØ¾ß ÇÔ.

if [ -r expipe1.dmp ]
then
    echo "expipe1.dmp exists!!"
else
    mkfifo expipe1.dmp
    chmod 770 expipe1.dmp
    echo "Pipe File (expipe1.dmp) created...!!"
fi

cat expipe1.dmp | compress > exp_ORATS6.dmp.Z &
exp system/dnjsaudhp6@ORATS6 file=expipe1.dmp buffer=6000000 compress=y \
log=exp.log owner=CM,JH,BG consistent=y statistics=none


#################### where Á¶°ÇÀý ÁöÁ¤ÇÏ¿© export

exp scott/tiger tables=emp,dept query='"where deptno = 10"' file='d:\deptno10.dmp'

È¤Àº

if [ -r expipe1.dmp ]
then
    echo "expipe1.dmp exists!!"
else
    mkfifo expipe1.dmp
    chmod 770 expipe1.dmp
    echo "Pipe File (expipe1.dmp) created...!!"
fi

cat expipe1.dmp | compress > exp_systest1.dmp.Z &
exp scrjappt/didqoappt file=expipe1.dmp buffer=6000000 compress=n consistent=y \
log=exp_systest1_`hostname`.log constraints=n indexes=n grants=n rows=y \
parfile=/aros1/oracle1/SQL/dba/khs/050708/1/parfile1 \
tables= \
tb_ra134, \
tb_ra334, \
tb_ra335

parfile1 ³»¿ë
query = "where regt_ver = '01' \
           and regt_no in ('1102','1103','1112','1113','1114','1115','1116','1141','1142','1144','1145','1146')"
           

#################### EXP-00091: Exporting questionable statistics ¸Þ¼¼Áö ¶ã¶§
EXP-00091: ºÒ¿ÏÀüÇÑ Åë°è¸¦ ¿¢½ºÆ÷Æ® ÁßÀÔ´Ï´Ù.
Example: 

$exp scott/tiger file=emp1.dmp tables=emp STATISTICS=NONE 

b) In case, the statistics are need to be included can use S
TATISTICS=ESTIMATE or 
COMPUTE (default is Estimate).

À§¿Í °°ÀÌ STATISTICS°¡ NONE·Î µÇ¸é ¿À·ù¾øÀÌ ÀÎÆ÷Æ® ÇÑ´Ù.



#################### ÂüÁ¶°èÁ¤ »ý¼º ÈÄ ±ÇÇÑºÎ¿© Ç×¸ñ
grant select any table to choco;
grant select any dictionary to choco;
grant select any sequence to choco;
grant select_catalog_role to choco


#################### revoke
revoke DELETE on TB_RY101 from SCRJARE1;
revoke INSERT on TB_RY101 from SCRJARE1;
revoke SELECT on TB_RY101 from SCRJARE1;
revoke UPDATE on TB_RY101 from SCRJARE1;
revoke REFERENCES on TB_RY101 from SCRJARE1 cascade constraints;


#################### SQL LOADER

file_list=`ls ./publno/*.txt`


for cur_file in $file_list

do

echo "==================================================================================="
echo $cur_file
echo "==================================================================================="

sqlldr userid=scrjco21/scrjco21 control='./tb_rn105.ctl' data='./'$cur_file bad=$cur_file'.bad' log=$cur_file'.log' errors=10000000

echo "=================================================================================== "

done

Load data
Append
Into table tb_rn105
Fields terminated by ' '
Trailing nullcols
(
USE_CLS,
CREATE_DATE,
PUBL_ATTRIBUTE_NO,
PIN,
ADMIN_REGN1_CD,
ADMIN_REGN2_CD,
ADMIN_REGN3_CD,
ADMIN_REGN4_CD,
LOT_NO,
ADMIN_REGION_CD
)


sqlldr userid=scrjdw/scrjdw control='./kap.ctl' data=kap bad=kap.bad log=kap.log' errors=10000000

Load data
Append
Into table tb_kap
Fields terminated by ' '
Trailing nullcols
(
PIN
)

################ sqlldr with constant value null value

OPTIONS (SKIP=1)
load data
append into table ncs.avamar_staging
fields terminated by "," optionally enclosed by '"'
(client_hostname,
DOMAIN_NAME,
END_DATE  "to_date(rtrim(:END_DATE,'.0'),'DD-MM-YY HH24:MI:SS')",
DURATION_MINUTE,
SERVER_GROUP,
PLUGIN_NAME,
RETENTION_TYPE,
status,
SIZE_SCANNED_GB,
BYTES_MODIFIED_SENT_GB,
MANAGEMENT_IP_ADDRESS,
BACKUP_TYPE,
SERVER,
subscription_id "DECODE(:subscription_id,'NA',null,:subscription_id)",
MODIFIED_BY CONSTANT "NCSBATCHU",
USER_ACTION CONSTANT "INSERT",
MODIFIED_DT sysdate)



sqlldr userid=ncs/ncs1234 control='./sla_server_performance.ctl' data='performanceYYYYMM.csv' bad='sla_server_performance.bad' log='sla_server_performance.log' errors=10000000

<sla_server_performance.ctl>

OPTIONS (ERRORS=500)
LOAD DATA
        TRUNCATE
INTO TABLE ZENOSS_SERVER_PERFORM_STG
        FIELDS TERMINATED BY ","
	OPTIONALLY ENCLOSED BY '"'
	TRAILING NULLCOLS
(
DEVICE_NAME            
,SERVER_HOSTNAME        
,SERVICE_NAME           
,CRITICAL               
,WARNING                
,OK                     
,SLA_REPORT_PERIOD_ID       
)               


OPTIONS (SKIP=1)
load data
append into table NCS.ZENOSS_SERVER_PERFORM_STG
fields terminated by "," optionally enclosed by '"'
(
DEVICE_NAME,
SERVER_HOSTNAME,
SERVICE_NAME,
EVENT_COUNT,
DURATION,
CRITICAL,
WARNING,
OK,
SLA_REPORT_PERIOD_ID,
IS_PROCESSED NULL,
MODIFIED_BY CONSTANT "NCSBATCHU",
USER_ACTION CONSTANT "INSERT",
MODIFIED_DT sysdate
)



sqlldr userid=ncs/ncs1234 control='./sla_server_premium_stat.ctl' data='statisticsYYYYMM.csv' bad='sla_server_premium_stat.bad' log='sla_server_premium_stat.log' errors=10000000

<sla_server_premium_stat.ctl>

OPTIONS (ERRORS=500)
LOAD DATA
        TRUNCATE
INTO TABLE ZENOSS_SERVER_PREM_STAT_STG
        FIELDS TERMINATED BY ","
	OPTIONALLY ENCLOSED BY '"'
	TRAILING NULLCOLS
(
DEVICE_NAME            
,SERVER_HOSTNAME        
,SERVICE_NAME           
,AVERAGE                
,MAX                    
,SLA_REPORT_PERIOD_ID   
)               

OPTIONS (SKIP=1)
load data
append into table NCS.ZENOSS_SERVER_PREM_STAT_STG
fields terminated by "," optionally enclosed by '"'
(
DEVICE_NAME,
SERVER_HOSTNAME,
SERVICE_NAME,
AVERAGE,
MAX,
SLA_REPORT_PERIOD_ID,
IS_PROCESSED NULL,
MODIFIED_BY CONSTANT "NCSBATCHU",
USER_ACTION CONSTANT "INSERT",
MODIFIED_DT sysdate
)


sqlldr userid=ncs/ncs1234 control='./sla_server_availability.ctl' data='availabilityYYYYMM.csv' bad='sla_server_availability.bad' log='sla_server_availability.log' errors=10000000

<sla_server_availability.ctl>

OPTIONS (ERRORS=500)
LOAD DATA
        TRUNCATE
INTO TABLE ZENOSS_SERVER_AVA_STG
        FIELDS TERMINATED BY ","
	OPTIONALLY ENCLOSED BY '"'
	TRAILING NULLCOLS
(
	DEVICE_NAME           
,	SERVER_HOSTNAME       
,	AVAILABILITY          
,	SLA_REPORT_PERIOD_ID  
)               


OPTIONS (SKIP=1)
load data
append into table NCS.ZENOSS_SERVER_AVA_STG
fields terminated by "," optionally enclosed by '"'
(
DEVICE_NAME,
SERVER_HOSTNAME,
AVAILABILITY,
SLA_REPORT_PERIOD_ID,
IS_PROCESSED NULL,
MODIFIED_BY CONSTANT "NCSBATCHU",
USER_ACTION CONSTANT "INSERT",
MODIFIED_DT sysdate
)



<sla_closed_mac.ctl>

OPTIONS (SKIP=1)
load data
append into table NCS.SLA_CLOSED_MAC_STG
fields terminated by "," optionally enclosed by '"'
(
CUST_DUH_NAME,
MAC_REQUEST_ID,
SUMMARY,
REQUEST_DATE,
CLOSED_DATE,
NOTES,
IS_PROCESSED NULL,
MODIFIED_BY CONSTANT "NCSBATCHU",
USER_ACTION CONSTANT "INSERT",
MODIFIED_DT sysdate
)



################  BEGINDATA CTL ÆÄÀÏ ¾È¿¡ µ¥ÀÌÅÍ Æ÷ÇÔÇÏ´Â °æ¿ì, SPATIAL µ¥ÀÌÅÍ

LOAD DATA
 INFILE *
 TRUNCATE
 CONTINUEIF NEXT(1:1) = '#'
 INTO TABLE TB_OSF_GIS_STADM_LINE
 FIELDS TERMINATED BY '|'
 TRAILING NULLCOLS (
   LVL1,
   LVL2,
   LVL3,
   LVL4,
   LVL5,
   BGR_CD,
   GIS_AREA COLUMN OBJECT
   (
     SDO_GTYPE       INTEGER EXTERNAL,
     SDO_SRID        INTEGER EXTERNAL,
     SDO_ELEM_INFO   VARRAY TERMINATED BY '|/'
       (X            FLOAT EXTERNAL),
     SDO_ORDINATES   VARRAY TERMINATED BY '|/'
       (X            FLOAT EXTERNAL)
   )
)
BEGINDATA
 1|0|0|0|5|41|
#2002|8307|
#1|2|1|/
#126.509341|33.245178|126.508885|33.245256|126.508498|33.245482|/
 1|0|0|0|5|41|
#2002|8307|
#1|2|1|/
#126.509341|33.245178|126.508965|33.245429|126.508878|33.245531|/
#################### ºÐ»êÆ®·£Àè¼Ç 2PC ºñÁ¤»ó ¶ô ÇØÁ¦¹æ¹ý

ERROR at line 1:
ORA-01591: lock held by in-doubt distributed transaction 6.1.4720

conn /as sysdba
SQL> rollback force '6.1.4720';

Rollback complete.

SQL> conn scrjv2t05/scrjv2t05
Connected.
SQL> update tb_ra191 set trans_cls='Y' where doc_no='44428';

1 row updated.

SQL> rollback;

Rollback complete.



#################### FILE I/O ÇöÈ² º¸±â

--µ¥ÀÌÅÍÆÄÀÏº°·Î º¸±â
SELECT  PHYRDS,         /* ¼öÇàµÈ ¹°¸®Àû ÀÐ±â ¼ö */ 
             PHYWRTS,      /* ¼öÇàµÈ ¹°¸®Àû ¾²±â ¼ö */
             PHYBLKRD,     /* ¹°¸®Àû ºí·° ÀÐ±â ¼ö */
             PHYBLKWRT,  /* ¹°¸®Àû ºí·° ¾²±â ¼ö */
             READTIM,       /* ÀÐ±â¿¡ »ç¿ëµÈ ½Ã°£ */
             WRITETIM,      /* ¾²±â¿¡ »ç¿ëµÈ ½Ã°£ */
             NAME
  FROM  v$datafile T1, 
            v$filestat T2
WHERE  T1.FILE# = T2.FILE#
;

--Å×ÀÌºí ½ºÆäÀÌ½ºº°·Î º¸±â
SELECT TABLESPACE_NAME,
            FILE_NAME,
            PHYRDS,
            PHYWRTS
  FROM  DBA_DATA_FILES T1, 
            v$filestat T2
WHERE T1.FILE_ID = T2.FILE#
;

#################### ¸¶Áö¸· ±âµ¿ ÀÌÈÄ ÃÊ´ç ¸®µå ¹ÙÀÌÆ® ¼ö ÃßÃâ

select case when instr(ts.name, '_IDX') > 0 then 'INDEX'
            else 'DATA'
       end ts_type, ts.name tbs_name, fs.name dbf_name, f.phyblkrd pbr, f.phyblkwrt pbw, 
f.readtim, f.writetim,
f.phyblkrd/f.readtim*8/1024*100 MperS
from v$filestat f, v$datafile fs, v$tablespace ts 
where f.file# = fs.file#
and fs.ts# = ts.ts#
order by ts_type, ts.name, fs.name ;

#################### »ç¿ëÀÚ º° ºÎ¿©¹ÞÀº ROLE Á¶È¸
select GRANTEE,GRANTED_ROLE from dba_role_privs



#################### »ç¿ëÀÚ autotrace ±â´É È°¼ºÈ­
SQL> set autotrace on
Error ORA-942 while gathering statistics
SP2-0611: Error enabling STATISTICS report
SQL> 

È°¼ºÈ­¹æ¹ý
1. PLUSTRACE role »ý¼º
@?/sqlplus/admin/plustrce.sql

2. PLUSTRACE role ´ë»ó »ç¿ëÀÚ¿¡°Ô ºÎ¿©
GRANT plustrace TO <username>; 

+ ÇÃ·£Å×ÀÌºí »ý¼º
@?/rdbms/admin/utlxplan


################### INDEX UNUSABLE CHECK

select 'ALTER INDEX '||OWNER||'.'||index_name||' REBUILD PARALLEL 2;' from dba_indexes
where OWNER != 'SYSTEM'
AND STATUS NOT IN('N/A','VALID')
union all
select 'ALTER INDEX '||index_OWNER||'.'||index_NAME||' REBUILD PARTITION '||PARTITION_name||';''' from Dba_Ind_Partitions
where INDEX_OWNER != 'SYSTEM'
and STATUS NOT IN('N/A','USABLE')
union all
select 'alter index '||index_owner||'.'||index_name||' REBUILD subPARTITION '||subPARTITION_name||';' from Dba_Ind_subPartitions
where INDEX_OWNER != 'SYSTEM'
and STATUS NOT IN('N/A','USABLE')



#################### INDEX DISABLE

SQL> alter index i_dept unusable;
Index altered.

SQL> select index_name, table_name, status from user_indexes;

INDEX_NAME      TABLE_NAME        STATUS
--------------- ----------------- --------
I_DEPT          DEPT              UNUSABLE

3. index °¡ unusable ÀÎ »óÅÂ¿¡¼­´Â insertÇÒ ¼ö ¾øÀ¸¸ç ´ÙÀ½°ú
°°Àº ¸í·É¾î¸¦ ½ÇÇàÇÏ¿©¾ß insert°¡ °¡´ÉÇÏ´Ù

SQL> alter session set skip_unusable_indexes = true;
Session altered.

SQL> insert into dept values(50,'aaa','aaa');
1 row created.

4.  insert¸¦ ÇÏ´Â ÀÛ¾÷ÀÌ ¸ðµÎ ³¡³ª¸é ´ÙÀ½°ú °°ÀÌ index¸¦ rebuildÇØ ÁØ´Ù.

SQL> alter index i_dept rebuild;
Index altered.

SQL> select index_name, table_name, status from user_indexes;

INDEX_NAME       TABLE_NAME        STATUS
---------------- ----------------- --------
I_DEPT           DEPT              VALID



#################### ENABLE/DISABLE CONSTRAINT
select 'ALTER TABLE ' || OWNER || '.' || TABLE_NAME || ' ENABLE CONSTRAINT ' || constraint_name || ';'
from   DBA_constraints
where  status='DISABLED'
and    constraint_type='R' 
AND OWNER LIKE 'DPOW_%';


select 'ALTER TABLE ' || OWNER || '.' || TABLE_NAME || ' DISABLE CONSTRAINT ' || constraint_name || ';'
from   DBA_constraints
where  status='ENABLED'
and    constraint_type='R' 
AND OWNER LIKE 'DPOW_%';

ALTER TABLE TB_RE606 ENABLE CONSTRAINT RE606_RE001_FK;

select 'ALTER TABLE ' || TABLE_NAME || ' DISABLE CONSTRAINT ' || constraint_name || ';' from user_constraints where status='ENABLED' and constraint_type='R' AND CONSTRAINT_NAME LIKE '%RA%RA%FK';


#################### alert.log

Alert.log¿¡ ±â·ÏµÇ´Â Á¤º¸´Â ´ÙÀ½°ú °°´Ù.

¡ß DBMS ¿ÀÇÂ/ ¼Ë´Ù¿î

¡ß º¯°æµÈ DBMS ÀÌ´Ï¼È ÆÄ¶ó¹ÌÅÍ¿Í ÇöÀç ÁöÁ¤ °ª

¡ß ½Ã½ºÅÛ ÀÛ¾÷ Ã³¸® ³»¿ª(Å×ÀÌºí½ºÆäÀÌ½º, ·Ñ¹é »ý¼º?»èÁ¦?º¯°æ)

¡ß À¯ÀúÀÇ Ä¡¸íÀûÀÎ ¿¡·¯

¡ß ¹é±×¶ó¿îµå ÇÁ·Î¼¼½ºÀÇ ¿¡·¯ ¸¹Àº °æ¿ìÀÇ µ¥ÀÌÅÍº£ÀÌ½º ÀÌ»ó Çö»óÀÌ³ª ¿¡·¯ÀÇ ³»¿ëÀº ÀÌ alert.log¿¡ ±â·ÏµÇ¹Ç·Î ¹®Á¦ ¹ß»ý ÈÄÀÇ ¿øÀÎ ºÐ¼® ½Ã¿¡´Â ²À ÀÌ ÆÄÀÏÀ» ÂüÁ¶ÇØ ºÁ¾ß ÇÑ´Ù.

Ãß°¡ÀûÀ¸·Î »ç¿ëÀÚ ÇÁ·Î±×·¥ÀÇ ¿¡·¯´Â Æ¯º°È÷ alert.log¿¡ ±â·ÏµÇÁö ¾Ê´Â´Ù.

ÀÌ·¯ÇÑ Á¤º¸´Â user_dump_dest¶ó´Â ÆÄ¶ó¹ÌÅÍ¿¡ ÁöÁ¤µÈ µñ¼Å³Ê¸®¿¡ ora_ xxxxx.trc¶ó´Â ÆÄÀÏ·Î ±â·ÏµÈ´Ù. ±×·¯¹Ç·Î alert.log¿Í ´õºÒ¾î user_dump_dest¿¡ ÀÓÀÇÀÇ trc fileÀÌ »ý¼ºµÅ ÀÖ°í ¾î¶² ¿¡·¯°¡ ¹ß»ýÇß´ÂÁö È®ÀÎÇØ¾ß ÇÑ´Ù.

#################### alter session, alter system ¸í·É °¡´É ¿©ºÎ
select * from v$parameter;

select name,value from v$parameter
where name in ('optimizer_index_caching','optimizer_index_cost_adj');


#################### db ÀÎ½ºÅÏ½º »èÁ¦

shutdown
ÄÁÆ®·ÑÆÄÀÏ, ¸®µÎ·Î±×ÆÄÀÏ, µ¥ÀÌÅÍÆÄÀÏ, ÅÛÇÁÆÄÀÏÀ» rm À¸·Î »èÁ¦
ÁýÇà°ü°³¹ß:SQL>select name from v$controlfile;

NAME
--------------------------------------------------------------------------------
/aros2/oracle/oradata/control/ctrl1DBSTIS.ora
/aros3/oracle/oradata/control/ctrl2DBSTIS.ora
/aros2/oracle/oradata/control/ctrl3DBSTIS.ora


ÁýÇà°ü°³¹ß:SQL>select member from v$logfile;

MEMBER
--------------------------------------------------------------------------------
/aros2/oracle/oradata/redo/log11DBSTIS.ora
/aros3/oracle/oradata/redo/log21DBSTIS.ora
/aros2/oracle/oradata/redo/log12DBSTIS.ora
/aros3/oracle/oradata/redo/log22DBSTIS.ora
/aros2/oracle/oradata/redo/log13DBSTIS.ora
/aros3/oracle/oradata/redo/log23DBSTIS.ora

6 rows selected.

ÁýÇà°ü°³¹ß:SQL>select file_name from dba_data_files;

FILE_NAME
--------------------------------------------------------------------------------
/aros2/oracle/oradata/sysDBSTIS_01
/aros2/oracle/oradata/rbsDB_STIS_01
/aros2/oracle/oradata/toolsDBSTIS_01
/aros2/oracle/oradata/usersDBSTIS_01
+ datafiles

ÁýÇà°ü°³¹ß:SQL>select file_name from dba_temp_files;

FILE_NAME
--------------------------------------------------------------------------------
/aros2/oracle/oradata/tempDBSTIS_01

oracle µð·ºÅä¸® »èÁ¦
os °èÁ¤ »èÁ¦


################### ÀüÁÖ ³¯Â¥ ¹ÝÈ¯

         WHERE CALL_DD BETWEEN TO_CHAR(TO_DATE('2011-06-11','YYYY-MM-DD') - TO_CHAR(TO_DATE('2011-06-11','YYYY-MM-DD'),'D') - 5,'YYYY-MM-DD')
                           AND TO_CHAR(TO_DATE('2011-06-11','YYYY-MM-DD') - TO_CHAR(TO_DATE('2011-06-11','YYYY-MM-DD'),'D') + 1,'YYYY-MM-DD') 
select TRUNC(TO_DATE('2011-06-11','YYYY-MM-DD'),'iw')-7,
       TRUNC(TO_DATE('2011-06-11','YYYY-MM-DD'),'iw')-1
from dual

iw : ÁÖÃÊ ¿ù¿äÀÏ ÀÏÀÚ¸¦ ¹ÝÈ¯



##################### ¿À¶óÅ¬ ³¯Â¥ Ã³¸®

SELECT 
TRUNC(TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS'))||' Days '||
LPAD(TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24),2,'0')||':'||
LPAD(TRUNC((((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24) - (TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24)))*60),2,'0') AS "FINAL FORMAT",

TRUNC(TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS'))||' Days '||
LPAD(MOD(TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS'))*24),24),2,'0')||':'||
LPAD(MOD(TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS'))*24*60),60),2,'0') AS "FINAL FORMAT2",

--TRUNC D
TRUNC(TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')) AS "TRUNC D",
--TRUNC H
MOD(TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS'))*24),24) AS "TRUNC H",
--TRUNC M
MOD(TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS'))*24*60),60) AS "TRUNC M",
--FULL
TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') AS FULL,
--FULL - TRUNC DAYS
TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')) AS "FULL - TRUNC DAYS",
--FULL - TRUNC DAYS(D)
(TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24 AS "FULL - TRUNC DAYS(H)",
--TRUNC HOURS(H)
TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24) AS "TRUNC HOURS",
--REMAINING - TRUNC HOURS(H)
((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24) - (TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24)) AS "REMAINING - TRUNC HOURS(H)",
--REMAINING - TRUNC HOURS(M)
(((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24) - (TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24)))*60 AS "REMAINING - TRUNC HOURS(M)",
--TRUNC MINUTES(M)
TRUNC((((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24) - (TRUNC((TO_DATE('2012-01-02 140725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS') - TRUNC(TO_DATE('2012-01-02 030725','YYYY-MM-DD HH24MISS') - TO_DATE('2012-01-01 010101','YYYY-MM-DD HH24MISS')))*24)))*60) AS "RND REMAINING - TRUNC HOURS(M)"
FROM DUAL;



1 Days 13:06	
1.54611111111111111111111111111111111111	
1	0.54611111111111111111111111111111111111	
13.10666666666666666666666666666666666664	
13	
0.10666666666666666666666666666666666664


--
--
--- Æ¯Á¤ÀÏÀÇ ´Þ¼ö ´õÇÑ ³¯
--SELECT ADD_MONTHS(SYSDATE, 10)  FROM DUAL;
--
---- Æ¯Á¤ÀÏÀÇ ´ÙÀ½ÁÖ ¿äÀÏ
--SELECT NEXT_DAY(SYSDATE,'FRIDAY')  FROM DUAL;
--
---- Æ¯Á¤ÀÏÀÇ ÇØ´ç ¿ùÀÇ ¸¶Áö¸· ³¯
--SELECT LAST_DAY(SYSDATE)  FROM DUAL;
-- 
---- Æ¯Á¤ÀÏÀÇ ¹Ý¿Ã¸²(¿ÀÈÄ¸é ´ÙÀ½³¯..)
--SELECT ROUND(SYSDATE,'DD')  FROM DUAL;
--
---- Æ¯Á¤ÀÏÀÇ ÀüÁÖ Åä¿äÀÏ(ÇØ´ç ÀüÁÖÀÇ ¸¶Áö¸· ³¯)¿¡ÇØ´çÇÏ´Â ³¯Â¥
--SELECT TRUNC(SYSDATE,'WW')  FROM DUAL;
-- 
---- Æ¯Á¤ÀÏÀÇ ÁÖ ÀÏ¿äÀÏ(ÇØ´ç ÁÖÀÇ Ã¹Â° ³¯)¿¡ÇØ´çÇÏ´Â ³¯Â¥
--SELECT TRUNC(SYSDATE,'D')  FROM DUAL;


#################### lob segment ÀÇ Å×ÀÌºí½ºÆäÀÌ½º ÀÌµ¿


Å×ÀÌºíÀ» Move [ ¼ø¼ö Å×ÀÌºí¸¸ ]

alter table lob_tab move tablespace tools ;



Move °á°ú Á¶È¸

select segment_name, segment_type, bytes , tablespace_name 
from user_segments
where segment_name = 'LOB_TAB' or
segment_name in ( select segment_name from user_lobs

where table_name='LOB_TAB') or 
segment_name in ( select index_name from user_lobs

where table_name='LOB_TAB')  ;


 

SEGMENT_NAME                 SEGMENT_TYPE    SIZE      TABLESPACE
SYS_IL0000067809C00001$$    LOBINDEX             131072      USERS
SYS_IL0000067809C00002$$    LOBINDEX             131072      USERS
LOB_TAB_COL2_LOB            LOBSEGMENT        2097152    USERS
LOB_TAB_COL1_LOB            LOBSEGMENT        2097152    USERS
LOB_TAB                             TABLE                   2097152    TOOLS


 

LOB Type column ÀÇ Move

     alter table lob_tab move
     lob(col1,col2) store as (tablespace tools)
     tablespace tools ;

LOB Type column ÀÇ Move °á°ú È®ÀÎ

      select segment_name, segment_type, bytes , tablespace_name
      from user_segments
      where segment_name = 'LOB_TAB' or
      segment_name in ( select segment_name from user_lobs

      where table_name='LOB_TAB') or
      segment_name in ( select index_name from user_lobs

      where table_name='LOB_TAB')  ;




SEGMENT_NAME                 SEGMENT_TYPE    SIZE      TABLESPACE
SYS_IL0000067809C00001$$    LOBINDEX             131072      TOOLS
SYS_IL0000067809C00002$$    LOBINDEX             131072      TOOLS
LOB_TAB_COL2_LOB            LOBSEGMENT        2097152    TOOLS
LOB_TAB_COL1_LOB            LOBSEGMENT        2097152    TOOLS
LOB_TAB                             TABLE                   2097152    TOOLS




!! LOB Type À» Move ÇÏ¸é Lob type Column ¿¡ ´ëÇÑ Index µµ ÀÚµ¿À¸·Î

  ÀÌµ¿ µÈ´Ù. !!

[ÃâÃ³] LOB DATA ¿Å±â±â|ÀÛ¼ºÀÚ humanang

#################### Å¸°Ù¿¡ ¿À¶óÅ¬ ¿£Áø¸¸ ¼³Ä¡ ÈÄ, ÀÎ½ºÅÏ½º ¹× µ¥ÀÌÅÍÆÄÀÏ ÀÌ°ü

1. Å¸°Ù¿¡ ¿À¶óÅ¬ ¼ÒÇÁÆ®¿þ¾î¸¸ ¼³Ä¡


------------------------------------------------------
1. °³Å×Àåºñ¿¡ 10g ÀÎ½ºÅÏ½º ±¸¼º ÆÐÄ¡

2. °³¹ßdb cold backup (shutdown-> cp datafile(system,user,undo,temp), redolog, controlfile, parameter, passwd)

3. °³Å×db ·Î ftp Àü¼Û(Àû´çÇÑ°÷¿¡ Ä«ÇÇ)

4. °³¹ß¿¡¼­ÀÇ µ¥ÀÌÅÍÆÄÀÏ Ç®ÆÐ½º¸®½ºÆ®¸¦ È®º¸ (±âÁ¸¼­¹ö¿¡¼­ backup controlfile to trace ¹®À¸·Î ÅØ½ºÆ®ÇüÅÂ·Î ¶³¾î¶ß¸± ¼ö ÀÖÀ½)

5. shutdown »óÅÂ innit ¼öÁ¤ -> control, udump path µî

6.. startup nomount  -> alter database rename dbfile, redofile   ddddd to  dddddd;    create control (¼Ò½ºÀÇ Ç®ÆÐ½º´ÂÇÊ¿ä¾ø°í)
    È¤Àº CREATE CONTROLFILE REUSE ¹®À¸·Î ÄÁÆ®·ÑÆÄÀÏ ½Å±Ô»ý¼º
7. open





####################  ÇÁ·Î½ÃÀú µð¹ö±ë ±ÇÇÑ

SQL> GRANT DEBUG CONNECT SESSION TO DPOSO;

Grant succeeded.




#################### µ¥ÀÌÅÍ ÀÌ°ü ½Ã Ä³¸¯ÅÍ™V º¯°æ

imcsm1@oracle:/work/temp/oracle/users/khs/Char_Conv >



##################### ¿Â¶óÀÎ Å×ÀÌºí reorg, column rename
No. 12279

======================================
(9i) DBMS_REDEFINITION (COLUMN RENAME)
======================================

PURPOSE
--------

TableÀ» online»óÀ¸·Î reorganizationÇÒ ¼ö ÀÖ´Â ÀÖ´Â DBMS_REDEFINITION package°¡
Oracle9i¿¡¼­ ¼Ò°³µÇ¾ú´Ù. ÀÌ packageÀ» ÀÌ¿ëÇÏ¸é column renameÀÌ³ª table»óÀÇ
columnÀÇ À§Ä¡¸¦ ¹Ù²Ù°íÀÚ ÇÒ¶§ À¯¿ëÇÏ´Ù.

Explanation
----------

#################### Å¸ ½ºÅ°¸¶ÀÇ ÇÁ·Î½ÃÀú¸¦ »èÁ¦ÇÒ ¼ö ÀÖµµ·Ï ÇÁ·Î½ÃÀú ¸¸µé¾î Á¦°ø
CREATE OR REPLACE PROCEDURE POW.SP_TABLE_TRUNCATE(
    i_table_nm       IN VARCHAR2
    ) IS
BEGIN
    EXECUTE IMMEDIATE 'TRUNCATE TABLE ' || i_table_nm ;
END;
/

GRANT EXECUTE ON POW.SP_TABLE_TRUNCATE TO POO;

CREATE SYNONYM POO.SP_TABLE_TRUNCATE FOR POW.SP_TABLE_TRUNCATE;





CREATE OR REPLACE PROCEDURE POW_CB."SP_TRUNC_CBBTMONSUBSLIST"  
IS 
 
  v_sql  VARCHAR2(100) :=''; 
 
BEGIN 
 
    v_sql := 'TRUNCATE TABLE POW_CB.TB_CBBTMONSUBSLIST' ; 
    EXECUTE IMMEDIATE v_sql; 
 
END SP_TRUNC_CBBTMONSUBSLIST;
/

GRANT EXECUTE ON POW_CB.SP_TRUNC_CBBTMONSUBSLIST TO TCB;

CREATE SYNONYM TCB.SP_TRUNC_CBBTMONSUBSLIST FOR POW_CB.SP_TRUNC_CBBTMONSUBSLIST;






#################### segment ÀÇ Å×ÀÌºí½ºÆäÀÌ½º ÀÌµ¿
aler table Å×ÀÌºí¸í move tablespace Å×ÀÌºí½ºÆäÀÌ½º¸í;
alter index ÀÎµ¦½º¸í rebuild tablespace Å×ÀÌºí½ºÆäÀÌ½º¸í;
select 'alter table ' || segment_name || ' move tablespace ' || tablespace_name from 
user_segments
where segment_type='TABLE';


select 'alter index ' || segment_name || ' rebuild tablespace TS_KHPTGJ_DATA;' from 
user_segments
where segment_type='INDEX';


long Å¸ÀÔÀº ¾ÈµÊ -> exp/imp


alter table Å×ÀÌºí¸í move (tablespace Å×ÀÌºí ½ºÆäÀÌ½º¸í) nologging parallel 4;



#################### Å×ÀÌºí MOVE, REORG

HWM À» Àç¼³Á¤ÇÏ±â À§ÇÑ ÀÎÅÍÆäÀÌ½º Å×ÀÌºí REORG, ±×·¸Áö ¾ÊÀ¸¸é BUFFER GET ÀÌ ºñÈ¿À²ÀûÀ¸·Î ³ôÀ½.

--Shadow Å×ÀÌºí ÇöÈ²
select a.owner, a.segment_name, a.cnt, b.ind_cnt, mb
from   
(select owner, segment_name, count(*) cnt, sum(bytes)/1024/1024 mb
from   dba_segments 
--where  owner in ('CSSADM', 'DPOW_OSO') 
where segment_name like 'TB_%SDW'  or segment_name like 'TB_%IF'
group by owner, segment_name) a, 
(select owner, table_name, count(*) ind_cnt
from dba_indexes
--where  owner in ('CSSADM', 'DPOW_OSO') 
where table_name like 'TB_%SDW' or table_name like 'TB_%IF'
group by owner, table_name) b
where a.owner = b.owner
and a.segment_name = b.table_name
order by 5 desc;



--OWNER	SEGMENT_NAME
alter table DPOW_OSM.TB_OSM_NAT_HSNO_SDW move;
alter table DPOSEAI.TB_OSO_HSPD_CERT_CONF_INFO_IF move;
alter table DPOW_OSO.TB_OSO_TSK_SDW move;
alter table DPOSEAI.TB_OSF_CRPATH_IF move;
alter table DPOSEAI.TB_OSO_UPLUS_ZNE_AP_INFO2_IF move;


select 'ALTER INDEX '||OWNER||'.'||index_name||' REBUILD PARALLEL 2;' from dba_indexes
where OWNER != 'SYSTEM'
AND STATUS NOT IN('N/A','VALID')
union all
select 'ALTER INDEX '||index_OWNER||'.'||index_NAME||' REBUILD PARTITION '||PARTITION_name||';''' from Dba_Ind_Partitions
where INDEX_OWNER != 'SYSTEM'
and STATUS NOT IN('N/A','USABLE')
union all
select 'alter index '||index_owner||'.'||index_name||' REBUILD subPARTITION '||subPARTITION_name||';' from Dba_Ind_subPartitions
where INDEX_OWNER != 'SYSTEM'
and STATUS NOT IN('N/A','USABLE');

ALTER INDEX DPOSEAI.PK_OSO_UZONE_CNSRT_INFO_IF REBUILD;



#################### INDEX ONLINE REBUILD

select 'alter index DPOW_OSO.' || INDEX_NAME || ' rebuild tablespace TS_OSO_IDX;' from 
DBA_INDEXES
where TABLE_NAME='TB_OSO_MNG_CPG_STAT'
AND STATUS <> 'VALID';


select 'alter index ' || INDEX_name || ' rebuild ONLINE PARALLEL(DEGREE 4);'
from DBA_INDEXES
where OWNER='POW'
AND TABLE_NAME='TB_OPLMLN';

alter index IX_OPLMLN_ASTGBASTID rebuild ONLINE PARALLEL(DEGREE 4);
alter index IX_OPLMLN_ASTID rebuild ONLINE PARALLEL(DEGREE 4);
alter index IX_OPLMLN_BRNCD rebuild ONLINE PARALLEL(DEGREE 4);
alter index IX_OPLMLN_BRNCDID rebuild ONLINE PARALLEL(DEGREE 4);
alter index IX_OPLMLN_CELLID rebuild ONLINE PARALLEL(DEGREE 4);

#################### ¾ð¾î lang Ä³¸¯ÅÍ™V È®ÀÎ
select * from props$ where name ='NLS_CHARACTERSET';

select * From nls_database_parameters;

select * from v$nls_parameters;

SELECT PARAMETER, VALUE FROM NLS_DATABASE_PARAMETERS WHERE PARAMETER LIKE '%CHAR%';

KO16MSWIN949 ´Â  KO16KSC5601ÀÇ SUPERSET

#################### ¹öÀüÁ¤º¸ È®ÀÎ
select * from v$version;
SELECT comp_name, version, status FROM dba_registry;

#################### µ¥ÀÌÅÍº£ÀÌ½º ¼³Á¤°ª È®ÀÎ
set lines 200
set pages 200
col name for a30
col val for a30

select 'instance' name , name val from v$database
union all
select 'created' name,TO_CHAR(CREATED,'YYYY-MM-DD') val from v$database 
union all
SELECT name, to_char(value) val FROM V$PARAMETER 
WHERE NAME in ('optimizer_mode','processes','db_files','db_block_size','log_archive_dest_1','log_archive_dest')
union all
SELECT name, to_char(value/1024/1024) val FROM V$PARAMETER where name='sga_max_size'
union all
select parameter, value from nls_database_parameters  where parameter in ('NLS_CHARACTERSET','NLS_NCHAR_CHARACTERSET')
union all
select 'controlfile',to_char(count(*)) from v$controlfile
union all
select 'log file',to_char(count(*)) from v$log
union all
select 'log file size',to_char(bytes/1024/1024) from v$log where rownum=1;



#################### view ddl ÃßÃâ
select view_name, text from dba_views
where owner ='xxx'

#################### not null ÄÃ·³°Ë»ö
  1  select 'alter table '||table_name || ' modify ('||column_name ||' NOT NULL);' from user_tab_columns
  2* where nullable ='N'


#################### Áßº¹ÀÎµ¦½º ÃßÃâ SQL ¹®
?	Áßº¹ ÀÎµ¦½º´Â ±âÁ¸¿¡ ÀÎµ¦½º ÄÃ·³À¸·Î ¼³Á¤µÇ¾î ÀÖÀ½¿¡µµ º°µµ ÀÎµ¦½º·Î »ý¼ºÇÑ ÀÎµ¦½º·Î¼­ ÁÖ±âÀûÀ¸·Î ¸ð´ÏÅÍ¸µÇÏ¿© »èÁ¦ÇÏµµ·Ï ÇÔ
?	Áßº¹ ÀÎµ¦½º »èÁ¦ ½Ã¿¡´Â »çÀü¿¡ ÀÎµ¦½º¸íÀ» ÇÁ·Î±×·¥¿¡¼­ hint ·Î »ç¿ëÇÏ¿´´ÂÁö ¿©ºÎ¸¦ È®ÀÎÇÏ¿©¾ß ÇÔ
?	EX) Áßº¹ ÀÎµ¦½º
-	Å×ÀÌºí¸í : DUP_TAB
-	±âÁ¸ÀÎµ¦½º : DUP_INDEX_01 (COL1 + COL2)
-	Áßº¹ÀÎµ¦½º : DUP_INDEX_02 (COL1) -> »èÁ¦ ´ë»ó
-	Áßº¹ÀÎµ¦½º ÃßÃâ SQL ¹®

select  o1.name||'.'||n1.name  redundant_index,  
o2.name||'.'||n2.name  sufficient_index
from  sys.icol$  ic1,  sys.icol$  ic2,  sys.ind$  i1,  sys.obj$  n1,
      sys.obj$  n2,  sys.user$  o1,  sys.user$  o2
where  ic1.pos# = 1 and  ic2.bo# = ic1.bo# and  ic2.obj# != ic1.obj# 
  and  ic2.pos# = 1 and  ic2.intcol# = ic1.intcol# and  i1.obj# = ic1.obj# 
  and  bitand(i1.property, 1) = 0 and
  ( select max(pos#) * (max(pos#) + 1) / 2
    from sys.icol$
    where obj# = ic1.obj#
  ) =
  ( select sum(xc1.pos#)
    From sys.icol$ xc1,
      sys.icol$ xc2
    where
      xc1.obj# = ic1.obj# and
      xc2.obj# = ic2.obj# and
      xc1.pos# = xc2.pos# and
      xc1.intcol# = xc2.intcol#
  ) and
  n1.obj# = ic1.obj# and
  n2.obj# = ic2.obj# and
  o1.user# = n1.owner# and
  o2.user# = n2.owner#

#################### °ú´Ù ÀÎµ¦½º ÃßÃâ SQL¹®

?	Å×ÀÌºí 1°³´ç ÀûÁ¤ ÀÎµ¦½º °³¼ö´Â N °³·Î °¡ÀÌµå ÇÔ
?	N °³ ÀÌ»óÀÎ Å×ÀÌºí¿¡ ´ëÇØ¼­ ÁÖ±âÀûÀ¸·Î Á¡°ËÇÏ¿© ÀÎµ¦½º »ç¿ë¿©ºÎ µîÀ» È®ÀÎÇÏ¿© Á¤¸®
?	°ú´Ù ÀÎµ¦½º ÃßÃâ SQL¹®

select table_name  
                      from dba_indexes 
                      where table_owner like 'POW%'
                      group by table_name having count(*) >= 3;


#################### Å×ÀÌºí½ºÆäÀÌ½º ´ÜÆíÈ­ ºÐ¼®

select tablespace_name , total_extents,percent_extents_coalesced
from dba_free_space_coalesced
where percent_extents_coalesced <> 100;

defragmentation

ALTER TABLESPACE [tablespace_name]  COALESCE;

ALTER TABLESPACE TS_SCRJGIS1_DATA1  COALESCE;



#################### Áßº¹µ¥ÀÌÅÍ »èÁ¦ Áßº¹ µ¥ÀÌÅÍ Áßº¹ ·¹ÄÚµå

ERROR at line 1:
ORA-02437: cannot validate (SCRJGIS1.TX_RG171_PK) - primary key violated


DELETE FROM tb_ci101 A
WHERE rowid > (SELECT min(rowid) 
FROM tb_ci101 B
WHERE A.user_id =B.USER_ID 
AND A.enr_appl_year=B.enr_appl_year
AND A.enr_recev_no=B.enr_recev_no);


SELECT * FROM TB_MRCB015 A
WHERE rowid > (SELECT min(rowid) 
FROM TB_MRCB015 B
WHERE A.COURT_CD =B.COURT_CD 
AND A.REGT_VER=B.REGT_VER
AND A.REGT_NO=B.REGT_NO
AND A.DAT=B.DAT
AND A.KIND_CLS=B.KIND_CLS
);


SELECT BUB_CD, SA_NO, WOO_NO, COUNT(*) 
FROM TSD72
GROUP BY BUB_CD, SA_NO, WOO_NO
HAVING COUNT(*) > 1


SELECT * FROM SMS02.TRAP_OID A
WHERE rowid > (SELECT min(rowid) 
FROM SMS02.TRAP_OID B
WHERE A.SEQUENCE_ID =B.SEQUENCE_ID 
);


DELETE FROM SMS02.TRAP_OID A
WHERE rowid > (SELECT min(rowid) 
FROM SMS02.TRAP_OID B
WHERE A.SEQUENCE_ID =B.SEQUENCE_ID 
);

####################### system À¸·Î ·Î±×ÀÎÇÏ¿© Å¸ ½ºÅ°¸¶ ÀÚ°ÝÀ¸·Î ¼öÇàÇÏ°íÀÚ ÇÒ¶§. 
alter session set current_schema=pow;


#######################  µ¥ÀÌÅÍ°¡ ÀÌ¹Ì µé¾î°¡ ÀÖ´Â Å×ÀÌºíÀÇ ÄÃ·³Å¸ÀÔ º¯°æ (´ë»óÄÃ·³ÀÌ °¡Àå ¸¶Áö¸· ¼ø¹øÀÎ°æ¿ì¿¡¸¸ È°¿ë)

alter table dpow_oso.TB_OSO_MNG_CIR_STAT_SUB add  TRMT_CIR_CNT_new1		NUMBER(10,2);

update dpow_oso.TB_OSO_MNG_CIR_STAT_SUB set TRMT_CIR_CNT_new1=TRMT_CIR_CNT;
alter table dpow_oso.TB_OSO_MNG_CIR_STAT_SUB drop column  TRMT_CIR_CNT;
alter table dpow_oso.TB_OSO_MNG_CIR_STAT_SUB rename column TRMT_CIR_CNT_new1 to TRMT_CIR_CNT;
select TRMT_CIR_CNT from dpow_oso.TB_OSO_MNG_CIR_STAT_SUB;



DBA_VIEWS µñ¼Å³Ê¸®ÀÇ TEXT ÄÃ·³Àº LONG µ¥ÀÌÅÍÅ¸ÀÔÀÌÁÒ. µû¶ó¼­ ¹®ÀÚ¿­ °Ë»öÀÌ µÇÁö ¾Ê½À´Ï´Ù. ÀÌ¿Í °°ÀÌ LONG Å¸ÀÔ¿¡ ÀúÀåµÈ ÅØ½ºÆ® µ¥ÀÌÅÍ¸¦ ´ë»óÀ¸·Î ¹®ÀÚ¿­ °Ë»öÀ» ÇØ¾ßÇÏ´Â ¿ä°ÇÀÌ ÀÖÀ» ¼ö ÀÖ½À´Ï´Ù.

 

SQL> SELECT * FROM DBA_VIEWS WHERE TEXT LIKE '%SELECT%'
ORA-00932: µ¥ÀÌÅÍ À¯ÇüÀÌ ÀÏÄ¡ÇÏÁö ¾Ê½À´Ï´Ù

 

 

¾î¶»°Ôµç µ¥ÀÌÅÍ º¯È¯À» ÇØ¾ß ¹®ÀÚ¿­ °Ë»öÀÌ °¡´ÉÇÒÅÙµ¥, LONG Å¸ÀÔÀº ¾î¶² ´Ù¸¥ Å¸ÀÔÀ¸·Î º¯È¯ÀÌ °¡´ÉÇÒ±î¿ä? ¾Æ·¡ SQL Reference ÀÇ Table 2-12 Explicit Type Conversions ¸¦ Âü°íÇÏ½Ã¸é ¿À·ÎÁö LOB Å¸ÀÔÀ¸·Î¸¸ º¯È¯ÀÌ °¡´ÉÇÑ °ÍÀ» ¾Ë ¼ö ÀÖ½À´Ï´Ù.

 

http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements002.htm#g195600

 

 
#######################  ORACLE LONG TYPE ÄÃ·³¿¡ ¹®ÀÚ¿­ °Ë»ö ÇÏ´Â ¹æ¹ý
ÀÌ¿¡ Âø¾ÈÇÏ¿© ¾Æ·¡¿Í °°ÀÌ Å×½ºÆ®¸¦ ÇØº¸¾Ò½À´Ï´Ù. 
TEXT ÄÃ·³À» ÀÐ¾î TO_LOB ÇÔ¼ö¸¦ ÀÌ¿ë ¸í½ÃÀûÀ¸·Î Å¸ÀÔº¯È¯À» ÇÏ¿© ÀÓ½Ã Å×ÀÌºíÀ» 
»ý¼ºÇÑ µÚ¿¡ ¹®ÀÚ¿­ °Ë»öÀ» ÇØº» °á°ú Àß µÇ´Â±º¿ä.

 

DROP TABLE PCP.TEST_VIEW_CLOB;
CREATE TABLE PCP.TEST_VIEW_CLOB AS 
SELECT T.OWNER,
       T.VIEW_NAME,
       T.TEXT_LENGTH,
       TO_LOB( T.TEXT ) TEXT
FROM   DBA_VIEWS T
WHERE  T.OWNER = 'PCP';

SQL> SELECT * FROM PCP.TEST_VIEW_CLOB
WHERE TEXT LIKE '%SELECT%';





#######################  LOB Ä®·³ Á¶È¸ 
--  
--´ÜÀÏ Çà¸¸ Á¶È¸ °¡´É.
--/* 1) Ä®·³¸í  2) ÀüÃ¼±æÀÌ  3) ½ÃÀÛÀ§Ä¡ */  
SELECT dbms_lob.substr(ISPT_REQ_DESC, dbms_lob.getlength(ISPT_REQ_DESC), 1)   
  FROM DPTOW_OST.TB_OST_ISPT
WHERE ROWNUM < 2;


#######################  µ¥ÀÌÅÍ°¡ ÀÌ¹Ì µé¾î°¡ ÀÖ´Â Å×ÀÌºíÀÇ ÄÃ·³Å¸ÀÔ º¯°æ pl sql
-- Ã»±¸ÃëÁö, Ã»±¸¿øÀÎ, Á¶Á¤È­ÇØ Å×ÀÌºí ¼öÁ¤
-- ÀÓ½Ã Å×ÀÌºí »ý¼º
create table tmm205_tmp as select * from tmm205;

-- varchar2 ÄÃ·³ »èÁ¦ÇÏ°í clobÅ¸ÀÔÄÃ·³ Ãß°¡
alter table tmm205 drop column hang_content;
alter table tmm205 add(hang_content clob);
comment on column tmm205.hang_content is '³»¿ë';

-- µ¥ÀÌÅÍ ÀüÈ¯
/
declare
  lv_hang_content         clob;
begin
  update tmm205 set hang_content = empty_clob();
  for c_tmm205_tmp in (select * from tmm205_tmp) loop
    select hang_content into lv_hang_content from tmm205
    where bub_cd = c_tmm205_tmp.bub_cd
    and sa_no = c_tmm205_tmp.sa_no
    and user_id = c_tmm205_tmp.user_id
    and hang_cd = c_tmm205_tmp.hang_cd
    and owner_id = c_tmm205_tmp.owner_id for update;
    
    dbms_lob.open(lv_hang_content, dbms_lob.lob_readwrite);
    dbms_lob.write(lv_hang_content, length(c_tmm205_tmp.hang_content), 1, c_tmm205_tmp.hang_content);
    dbms_lob.close(lv_hang_content);
  end loop;
end;
/


#####################  Å×ÀÌºí½ºÆäÀÌ½º ÃÖ±Ù 3´Þ°£ TS Áõ°¡ÃßÀÌ Á¶»ç
==========================================================================
 ÃÖ±Ù 3´Þ°£ TS Áõ°¡ÃßÀÌ Á¶»ç
==========================================================================
select *
from ( -- ÃÖ±Ù 3°³¿ù µ¥ÀÌÅ¸ Áõ°¡·® Áß¿¡¼­ ÃÖ´ë°ªÀ» EXTRA_TBS¿¡ ÀúÀåÇØ µÒ.
    select tablespace_name as "TBS¸í",
      m1 as "ÇÑ´ÞÀü Áõ°¡·®(M)",
      m2 as "µÎ´ÞÀü Áõ°¡·®(M)",
      m3 as "¼®´ÞÀü Áõ°¡·®(M)",
      greatest(m1, m2, m3) as "3°³¿ùÁß ÃÖ´ë Áõ°¡·®(M)",
      greatest(m1, m2, m3)*2 as "ÃÖ´ëÁõ°¡·®*2 (M)",
      total_MB as "TBS Total size(M)",
      free_MB as "TBS Free size(M)",
      round((total_MB-free_MB)/total_MB, 4)*100 as "TBS»ç¿ëÀ²(%)",
      free_MB - greatest(m1, m2, m3)*2 "Ãß°¡¿©ºÎ"
    from (
        select tbs.tablespace_name , l.total_MB, k.free_MB,
          (
-- ÃÖ±Ù ¼®´Þ Àü µ¥ÀÌÅ¸ Áõ°¡·®
            select avg(used_mb)
            from monitor.tb_tbsinfo
            where ( checkdate like to_char(sysdate -60, 'YYMMDD') || '%'
                  or checkdate like to_char(sysdate -61, 'YYMMDD') || '%')
              and tablespace_name = tbs.tablespace_name ) - (
            select avg(used_mb)
            from monitor.tb_tbsinfo
            where (checkdate like to_char(sysdate -90, 'YYMMDD') || '%'
                  or checkdate like to_char(sysdate -91, 'YYMMDD') || '%')
              and tablespace_name = tbs.tablespace_name ) M3 ,
          (
-- ÃÖ±Ù µÎ´Þ Àü µ¥ÀÌÅ¸ Áõ°¡·®
            select avg(used_mb)
            from monitor.tb_tbsinfo
            where (checkdate like to_char(sysdate -30, 'YYMMDD') || '%'
                  or checkdate like to_char(sysdate -31, 'YYMMDD') || '%')
              and tablespace_name = tbs.tablespace_name ) - (
            select avg(used_mb)
            from monitor.tb_tbsinfo
            where( checkdate like to_char(sysdate -60, 'YYMMDD') || '%'
                  or checkdate like to_char(sysdate -61, 'YYMMDD') || '%')
              and tablespace_name = tbs.tablespace_name ) M2 ,
          (
-- ÃÖ±Ù ÇÑ´Þ Àü µ¥ÀÌÅ¸ Áõ°¡·®
            select avg(used_mb)
            from monitor.tb_tbsinfo
            where (checkdate like to_char(sysdate, 'YYMMDD') || '%'
                  or checkdate like to_char(sysdate -1, 'YYMMDD') || '%')
              and tablespace_name = tbs.tablespace_name ) - (
            select avg(used_mb)
            from monitor.tb_tbsinfo
            where (checkdate like to_char(sysdate -30, 'YYMMDD') || '%'
                  or checkdate like to_char(sysdate -31, 'YYMMDD') || '%')
              and tablespace_name = tbs.tablespace_name ) M1
        from dba_tablespaces tbs,
          (
            select tablespace_name,
              round(sum(bytes)/1024/1024, 3) free_MB
            from dba_free_space
            group by tablespace_name ) k,
          (
            select tablespace_name ,
              sum(bytes)/1024/1024 total_MB
            from dba_data_files
            group by tablespace_name ) l
        where
---- ½Å±Ô·Î »ý¼ºµÈ TABLEÀÏ °æ¿ì, 80% RULE Àû¿ë
--          tbs.tablespace_name not in (
--            select tablespace_name
--            from monitor.TB_TBSINFO t
--            group by tablespace_name
--            having count(*) < 25)
---- UNDO, TEMP, TS_ORG_WORK tablespaceÀÏ °æ¿ì,  RULE Àû¿ë
--          and tbs.tablespace_name not like '%UNDO%'
--          and tbs.tablespace_name not like '%WORK%'
          k.tablespace_name(+) = l.tablespace_name
          and tbs.tablespace_name = k.tablespace_name )
    order by tablespace_name )



-------------------------------------------------------------------------



WITH EXTRA_TBS AS (SELECT *
        FROM   ( -- ÃÖ±Ù 3°³¿ù µ¥ÀÌÅ¸ Áõ°¡·® Áß¿¡¼­ ÃÖ´ë°ªÀ» EXTRA_TBS¿¡ ÀúÀåÇØ µÒ.
SELECT tablespace_name ,
                       greatest(m1, m2, m3) max_mb
                FROM   (SELECT tbs.tablespace_name ,
                               ( -- ÃÖ±Ù ¼®´Þ Àü µ¥ÀÌÅ¸ Áõ°¡·®
SELECT nvl(avg(used_mb), 0)
                                FROM   monitor.tb_tbsinfo
                                WHERE  (checkdate like to_char(sysdate -60, 'YYMMDD') || '%'
                                        OR     checkdate like to_char(sysdate -61, 'YYMMDD') || '%')
                                AND    tablespace_name = tbs.tablespace_name ) - (SELECT nvl(avg(used_mb), 0)
                                FROM   monitor.tb_tbsinfo
                                WHERE  (checkdate like to_char(sysdate -90, 'YYMMDD') || '%'
                                        OR     checkdate like to_char(sysdate -91, 'YYMMDD') || '%')
                                AND    tablespace_name = tbs.tablespace_name ) M3 ,
                               ( -- ÃÖ±Ù µÎ´Þ Àü µ¥ÀÌÅ¸ Áõ°¡·®
SELECT nvl(avg(used_mb), 0)
                                FROM   monitor.tb_tbsinfo
                                WHERE  (checkdate like to_char(sysdate -30, 'YYMMDD') || '%'
                                        OR     checkdate like to_char(sysdate -31, 'YYMMDD') || '%')
                                AND    tablespace_name = tbs.tablespace_name ) - (SELECT nvl(avg(used_mb), 0)
                                FROM   monitor.tb_tbsinfo
                                WHERE  (checkdate like to_char(sysdate -60, 'YYMMDD') || '%'
                                        OR     checkdate like to_char(sysdate -61, 'YYMMDD') || '%')
                                AND    tablespace_name = tbs.tablespace_name ) M2 ,
                               ( -- ÃÖ±Ù ÇÑ´Þ Àü µ¥ÀÌÅ¸ Áõ°¡·®
SELECT nvl(avg(used_mb), 0)
                                FROM   monitor.tb_tbsinfo
                                WHERE  (checkdate like to_char(sysdate, 'YYMMDD') || '%'
                                        OR     checkdate like to_char(sysdate -1, 'YYMMDD') || '%')
                                AND    tablespace_name = tbs.tablespace_name ) - (SELECT nvl(avg(used_mb), 0)
                                FROM   monitor.tb_tbsinfo
                                WHERE  (checkdate like to_char(sysdate -30, 'YYMMDD') || '%'
                                        OR     checkdate like to_char(sysdate -31, 'YYMMDD') || '%')
                                AND    tablespace_name = tbs.tablespace_name ) M1
                        FROM   dba_tablespaces tbs
                        WHERE -- ½Å±Ô·Î »ý¼ºµÈ TABLEÀÏ °æ¿ì, 80% RULE Àû¿ë
                               tbs.tablespace_name NOT IN (SELECT tablespace_name
                                FROM   MONITOR.TB_TBSINFO t
                                GROUP BY tablespace_name
                                HAVING count(*) < 25)
-- Ç×»ó °Ë»ç Á¦¿Ü ´ë»ó
                        AND    tablespace_name NOT IN ('UNDOTBS1',
                                       'UNDOTBS2',
                                       'UNDOTBS11',
                                       'UNDOTBS22',
                                       'PBC_TMP_STD01',
                                       'PBC_XCU_STD01',
                                       'PBC_XCU_SIX01',
                                       'PBC_M
AILD',
                                       'PBT_TCU_STD01',
                                       'PBT_TCU_SIX01',
                                       'PBC_BAK_STD01')
-- ÀÓ½Ã Á¦¿Ü ´ë»ó
                        AND    tablespace_name NOT IN('') )
                ORDER BY greatest(m1, m2, m3) desc ))
-- WITH END
SELECT 'TABLESPACE_NAME='||tablespace_name || ' ' || "Used_size(MB)" || '/' || "Total_size(MB)"||'(' || "Used_ratio(%)" || '%) ' || "Free_size(MB)" ||' f
ree'
FROM   ( (SELECT x.tablespace_name tablespace_name ,
                       round((to_number(Total_size)/1024/1024), 1) "Total_size(MB)" ,
                       round((Total_size-Free_size)/1024/1024, 1) "Used_size(MB)" ,
                       round(Free_size/1024/1024, 1) "Free_size(MB)" ,
                       (round( (Total_size-Free_size)/Total_size, 3))*100 "Used_ratio(%)"
                FROM   (SELECT tablespace_name ,
                               sum(bytes) Total_size
                        FROM   dba_data_files
                        GROUP BY tablespace_name ) x ,
                       (SELECT tablespace_name ,
                               sum(bytes) Free_size
                        FROM   dba_free_space
                        GROUP BY tablespace_name ) y
                WHERE  x.tablespace_name = y.tablespace_name(+)
-- Ç×»ó °Ë»ç  Á¦¿Ü ´ë»ó
                AND    x.tablespace_name NOT IN ('UNDOTBS1',
                               'UNDOTBS2',
                               'UNDOTBS11',
                               'UNDOTBS22',
                               'PBC_TMP_STD01',
                               'PBC_XCU_STD01',
                               'PBC_XCU_SIX01',
                               'PBC_MAILD',
                               'PBT_TCU_STD01',
                               'PBT_TCU_SIX01',
                               'PBC_BAK_STD01')
                AND    y.Free_size <= .2 * x.Total_size
                AND    y.Free_size < 2073741824
                AND    x.tablespace_name NOT IN (SELECT tablespace_name
                        FROM   EXTRA_TBS)
                UNION
-- ÃÖ±Ù 3°³¿ù ¿ùº° µ¥ÀÌÅ¸ Áõ°¡·®Áß¿¡¼­ ÃÖ´ë°ª(EXTRA_TBS) ÀÌ»óÀÇ FREESPACEÀ» À¯ÁöÇÑ´Ù.
SELECT x.tablespace_name tablespace_name ,
                       round((to_number(Total_size)/1024/1024), 1) "Total_size(MB)" ,
                       round((Total_size-Free_size)/1024/1024, 1) "Used_size(MB)" ,
                       round(Free_size/1024/1024, 1) "Free_size(MB)" ,
                       (round( (Total_size-Free_size)/Total_size, 3))*100 "Used_ratio(%)"
                FROM   (SELECT tablespace_name ,
                               sum(bytes) Total_size
                        FROM   dba_data_files
                        GROUP BY tablespace_name ) x ,
                       (SELECT tablespace_name ,
                               sum(bytes) Free_size
                        FROM   dba_free_space
                        GROUP BY tablespace_name ) y
                WHERE  x.tablespace_name = y.tablespace_name(+)
                AND    x.tablespace_name IN (SELECT tablespace_name
                        FROM   EXTRA_TBS)
                AND    y.Free_size/1024/1024 <= (SELECT MAX_MB
                        FROM   EXTRA_TBS
                        WHERE  tablespace_name = y.tablespace_name) ) ) ;


--- °¢ ¿ù Å×ÀÌºí½ºÆäÀÌ½º »ç¿ë·®

SELECT TABLESPACE_NAME,
       SUM(DECODE(DT,'1104', USEDS)) USEDS04,
       SUM(DECODE(DT,'1105', USEDS)) USEDS05,
       SUM(DECODE(DT,'1106', USEDS)) USEDS06,
       SUM(DECODE(DT,'1107', USEDS)) USEDS07,
       SUM(DECODE(DT,'1108', USEDS)) USEDS08,
       SUM(DECODE(DT,'1109', USEDS)) USEDS09,
       SUM(DECODE(DT,'1110', USEDS)) USEDS10,
       SUM(DECODE(DT,'1111', USEDS)) USEDS11,
       SUM(DECODE(DT,'1112', USEDS)) USEDS12
FROM (
SELECT SUBSTR(CHECKDATE,1,4) DT,TABLESPACE_NAME, ROUND(USED_MB/TOT_MB*100,2) USEDS
FROM 
monitor.tb_tbsinfo
WHERE CHECKDATE >= '1104000000' AND CHECKDATE <='1112310000'
AND SUBSTR(CHECKDATE,5,2)='01')
GROUP BY TABLESPACE_NAME
ORDER BY 1;




##################### opatch -help
opatch lsinventory

##################### ¿À¶óÅ¬ ÆÐÄ¡

1. imcgw01,imcgw02 ¾÷¹«Á¾·áÈÄ DB shutdown

 - 10.1.0.3 ¿£Áø »çÀü¹é¾÷

2. ¼­ºñ½º°¡µå Á¾·á ¹× non-cluster mode ·Î ÀüÈ¯

3. OUI ÀÎ½ºÅç

4. ¾÷±×·¹ÀÌµå ½ºÅ©¸³Æ® ¼öÇà

SQL> STARTUP UPGRADE

SQL> SPOOL patch.log

SQL> @?/rdbms/admin/catpatch.sql

SQL> SPOOL OFF
Review the patch.log

SQL> SHUTDOWN

 

5. ÄÄÆÄÀÏ ÆÐÅ°Áö

SQL> STARTUP

SQL> @?/rdbms/admin/utlrp.sql

6. Invalid ¿ÀºêÁ§Æ® È®ÀÎ

    SELECT count(*) FROM dba_objects WHERE status='INVALID';

     col object_name format a40

    SELECT owner, object_name FROM dba_objects WHERE status='INVALID' and owner='SYS' order by owner

    
7. DB component ¹öÀüÈ®ÀÎ : SELECT comp_name, version, status FROM dba_registry;


8. oracle ±ÇÀå ½ºÅ©¸³Æ®
REM Script to list missing and INVALID Objects in the database 
REM 
REM      MISSING.SQL                                                    
REM 
REM      This script recompiles all objects that have become invalidated      
REM 
REM      It should be run as SYS or SYSTEM
REM

set pagesize 0 
set linesize 120  
set feedback off 
set trimspool on 
set termout on

spool missing.sql

select A.Owner Oown, 
       A.Object_Name Oname, 
       A.Object_Type Otype, 
       'Miss Pkg Body' Prob 
  from DBA_OBJECTS A 
 where A.Object_Type = 'PACKAGE' 
   and A.Owner not in ('SYS','SYSTEM')
   and not exists 
        (select 'x' 
           from DBA_OBJECTS B 
          where B.Object_Name = A.Object_Name 
            and B.Owner = A.Owner 
            and B.Object_Type = 'PACKAGE BODY') 
union 
select Owner Oown, 
       Object_Name Oname, 
       Object_Type Otype, 
       'Invalid Obj' Prob 
  from DBA_OBJECTS 
 where Object_Type in 
     ('PROCEDURE','PACKAGE','FUNCTION','TRIGGER','PACKAGE BODY','VIEW') 
   and Owner not in ('SYS','SYSTEM') 
   and Status != 'VALID' 
 order by 1,4,3,2
/
spool off
##################### ½ºÆ®¸®¹Ö ÀÓ½ÃÆÄÀÏ·ÎºÎÅÍ import
if [ -r impipe1.dmp ]
then
    echo "impipe1.dmp exists!!"
else
    mkfifo impipe1.dmp
    chmod 770 impipe1.dmp
    echo "Pipe File (impipe1.dmp) created...!!"
fi

uncompress < 20070919_exp_perf1_v2db2.dmp.Z > impipe1.dmp &
sleep 5
imp perform/perform file=impipe1.dmp ignore=y buffer=6000000 commit=y \
log=imp_perform1.log indexes=n grants=n rows=y
~
##################### ½ºÆ®¸®¹Ö ÀÓ½ÃÆÄÀÏ·Î export
if [ -r expipe2.dmp ]
then
    echo "expipe2.dmp exists!!"
else
    mkfifo expipe2.dmp
    chmod 770 expipe2.dmp
    echo "Pipe File (expipe2.dmp) created...!!"
fi

cat expipe2.dmp | compress > exp_equit.dmp.Z &
exp system/mao1op file=expipe2.dmp buffer=6000000 compress=y \
log=exp_equit.log owner=equit consistent=y statistics=none constraints=y rows=y indexes=y



##################### ¿ø°Ý OSÀÎÁõ
SQL*PLUS
> show parameter remote_os_authent;

True: ¿ø°Ý OS ÀÎÁõ Çã¿ë
False: ¿ø°Ý OS ÀÎÁõ °ÅºÎ 

Ç×¸ñ¹øÈ£	DBMS-Oracle-302	Áß¿äµµ	ÇÊ¼ö	Á¡°Ë¹æ¹ý	Script	
Ãë¾àÁ¡	Oracle¿¡¼­ Áö¿øÇÏ´Â ¿ø°ÝÀÎÁõ ±â´ÉÀÌ È°¼ºÈ­µÇ¸é(TRUE), ¿ø°ÝÀÇ Å¬¶óÀÌ¾ðÆ®µéÀÌ ¿À¶óÅ¬ µ¥ÀÌÅÍº£ÀÌ½º¿¡ Á¢¼ÓÇÒ ¼ö ÀÖµµ·Ï Çã¿ëÇÑ´Ù. Áï, µ¥ÀÌÅÍº£ÀÌ½º´Â ÀûÀýÇÏ°Ô ÀÎÁõµÈ (Å¬¶óÀÌ¾ðÆ® ÀÚÃ¼ÀÇ OS°¡ ÀÎÁõÇÑ) ¸ðµç Å¬¶óÀÌ¾ðÆ®µéÀ» ½Å·ÚÇÑ´Ù.  ±×·¯³ª PCÀÇ °æ¿ì¿¡´Â ¹ÙÀÌ·¯½º?¿ú ¶Ç´Â ¹éµµ¾î¿Í °°Àº º¸¾È»ó Ãë¾àÇÑ PCÀÏ ¼öµµ ÀÖ¾î º¸¾È¿¡ ¹®Á¦°¡ »ý±æ ¼öµµ ÀÖ´Ù. ÀûÀýÇÑ ÀÎÁõ¿©ºÎ¸¦ º¸ÀåÇÒ ¼ö ¾ø¾î ¿ø°ÝÀÎÁõ ±â´ÉÀ» »ç¿ëÇÏ¸é º¸¾ÈÀÌ Ãë¾àÇØÁú ¼ö ÀÖ´Ù.	
Á¡°Ë¹æ¹ý	SQL*PLUS > show parameter remote_os_authent;  True: ¿ø°Ý OS ÀÎÁõ Çã¿ë False: ¿ø°Ý OS ÀÎÁõ °ÅºÎ  	
Á¶Ä¡»çÇ×	¿ø°ÝÀÎÁõ±â´ÉÀ» ºñÈ°¼ºÈ­()ÇÏµµ·Ï ¼³Á¤ÇÑ´Ù¸é ¿À¶óÅ¬ µ¥ÀÌÅÍº£ÀÌ½º¿¡ Á¢¼ÓÇÏ·Á´Â Å¬¶óÀÌ¾ðÆ®µéÀº server-based ÀÎÁõ(Áï, µ¥ÀÌÅÍº£ÀÌ½º ¼­¹öÀÇ ÀÎÁõ)À» ÇØ¾ß ÇÏ¹Ç·Î º¸¾ÈÀÌ °­È­µÈ´Ù. ÆÄ¶ó¹ÌÅÍ °ªÀ» ´ÙÀ½°ú °°ÀÌ ¼³Á¤ÇÏ¿© ¿ø°ÝÀÎÁõ±â´ÉÀ» ºñÈ°¼ºÈ­ÇÏ¿©¾ß ÇÑ´Ù.  Oracle 9i ¹× 10g ¿¡¼­´Â REMOTE_OS_AUTHENT ÆÄ¶ó¹ÌÅÍÀÇ °ªÀÌ ±âº»ÀûÀ¸·Î À¸·Î ¼³Á¤µÇ¾î ÀÖÀ¸³ª Oracle8i Àº TRUEÀ¸·Î ¼³Á¤µÇ¾î ÀÖÀ¸¹Ç·Î ¹Ýµå½Ã º¯°æÇÏ¿©¾ß ÇÑ´Ù. REMOTE_OS_AUTHENT ¸Å°³º¯¼ö´Â Á¤Àû ¸Å°³º¯¼ö·Î µ¥ÀÌÅÍº£ÀÌ½º¸¦ Àç½ÃÀÛÀÌ ÇÊ¿äÇÏ´Ù (11g ¿¡¼­´Â deprecated µÊ)	



########################  /as sysdba os ÀÎÁõ Á¢¼Ó ¼³Á¤
"sqlnet.ora" 2 lines, 89 characters
NAMES.DIRECTORY_PATH=(TNSNAMES, ONAMES, HOSTNAME)
#SQLNET.AUTHENTICATION_SERVICES=(NONE)  ------------> ÀÌ ¶óÀÎÀÌ ÀÖÀ¸¸é sysdba Á¢¼Ó ºÒ°¡




##################### ¾ÆÄ«ÀÌºê ·Î±× º¸±â

SQL> archive log list
Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            /arch1/
Oldest online log sequence     5351
Next log sequence to archive   5351
Current log sequence           5356


##################### µð·ºÅä¸® ¿ÀºêÁ§Æ® »ý¼º
CREATE DIRECTORY recv_obj AS '/temp';
CREATE DIRECTORY send_obj AS '/temp';

GRANT READ ON DIRECTORY recv_obj TO scrjappw1
GRANT WRITE ON DIRECTORY recv_obj TO scrjappw1


REVOKE WRITE ON DIRECTORY recv_obj FROM scrjappw1
GRANT WRITE ON DIRECTORY send_obj TO scrjappw1

######################  grant Á¤º¸
SQL> desc user_tab_privs;
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 GRANTEE                                   NOT NULL VARCHAR2(30)
 OWNER                                     NOT NULL VARCHAR2(30)
 TABLE_NAME                                NOT NULL VARCHAR2(30)
 GRANTOR                                   NOT NULL VARCHAR2(30)
 PRIVILEGE                                 NOT NULL VARCHAR2(40)
 GRANTABLE                                          VARCHAR2(3)
 HIERARCHY                                          VARCHAR2(3)
 
select grantee, table_name, privilege from user_tab_privs where owner='SCRJSHIP3';


######################  ¿î¿µÈ¯°æ°ú µ¿ÀÏÇÑ ±ÇÇÑÃ¼°è ºÎ¿©
SELECT 'GRANT ' || PRIVILEGE || ' ON ' || OWNER || '.' || TABLE_NAME || ' TO ' || GRANTEE || ';' FROM DBA_TAB_PRIVS
WHERE GRANTEE='DABOS02';

SELECT 'REVOKE ' || PRIVILEGE || ' ON ' || OWNER || '.' || TABLE_NAME || ' FROM ' || GRANTEE || ';' FROM DBA_TAB_PRIVS
WHERE GRANTEE='VOIPMIG';


SELECT 'GRANT ' || PRIVILEGE || ' ON ' || OWNER || '.' || TABLE_NAME || ' TO ' || GRANTEE || ';' FROM DBA_TAB_PRIVS
WHERE GRANTEE LIKE 'DPOW_%'


SELECT 'CREATE SYNONYM ' || OWNER || '.' || SYNONYM_NAME || ' FOR ' || TABLE_OWNER || '.' || TABLE_NAME || ';' FROM DBA_SYNONYMS
WHERE OWNER='DPDHCP';

######################  ¸ðµç Å×ÀÌºí ¹× ÆÐÅ°Áö¿¡ ±ÇÇÑºÎ¿©

SELECT 'GRANT SELECT,INSERT,UPDATE,DELETE ON ' || OWNER || '.' || OBJECT_NAME || ' TO DPOSMIG;' 
FROM DBA_OBJECTS
WHERE OWNER LIKE 'DPOW_OS%'
AND OBJECT_TYPE IN ('TABLE')
AND CREATED >= TO_DATE('2010-06-01','YYYY-MM-DD');

SELECT 'GRANT EXECUTE ON ' || OWNER || '.' || OBJECT_NAME || ' TO DPOSMIG;' FROM DBA_OBJECTS
WHERE OWNER LIKE 'DPOS%'
AND OBJECT_TYPE IN ('PROCEDURE','FUNCTION','PACKAGE')
AND CREATED >= TO_DATE('2010-01-01','YYYY-MM-DD');



####################### STORED PROCEDURE
select object_name from user_objects where object_type='PROCEDURE'

select object_name,status from user_objects where object_type='PROCEDURE'
and status='INVALID'
SQL> /
SP1121                               INVALID
SP1121MLT                            INVALID
SPCFMOD                              INVALID
SPCOPYPINFROMTO                      INVALID
SPCOPYPININFO                        INVALID
SPDELBASE                            INVALID
SPENTRYUPDTUSELAND                   INVALID
SPEV1268                             INVALID
SPEV1270                             INVALID
SPEV1283                             INVALID
SPEV1283DRIVE                        INVALID
SPEV1413                             INVALID
SPGETJIBUNHAP                        INVALID
SPPROCOTHERSBUNRELRGS01              INVALID
TODEV                                INVALID
TODEV1                               INVALID
TODEV100                             INVALID
TODEV300                             INVALID
TODEV400                             INVALID
TODEVCMORT                           INVALID
TODEVTRADE                           INVALID

select object_name, status from user_objects where object_type='PROCEDURE'
and object_name in(
'SP1121MLT'
,'SPENTRYUPDTUSELAND'
,'SPEV1268'
,'SPEV1270'
,'SPEV1283'
,'SPEV1283DRIVE'
,'SPEV1413')

stored procedure ¼Ò½º È®ÀÎ Á¶È¸
prompt "########################" SPCalInfinite;
select text from user_source where name=upper('SPCalInfinite');


##################### ÀÎµ¦½º ¸ñ·Ï, ÀÎµ¦½º Á¤ÀÇ¼­ ÃßÃâ SQL
SELECT 
       TC.COMMENTS,
       I.OWNER,
       I.TABLE_NAME,
       I.INDEX_NAME,
       DECODE(C.CONSTRAINT_TYPE, 'P', 'PK'),
       IC.COLUMN_POSITION,
       CC.COMMENTS,
       IC.COLUMN_NAME,
       TCOL.NULLABLE,
       TCOL.DATA_TYPE,
       TCOL.DATA_LENGTH
FROM   DBA_TAB_COMMENTS TC,
       DBA_COL_COMMENTS CC,
       DBA_INDEXES I,
       DBA_TAB_COLUMNS TCOL,
       DBA_IND_COLUMNS IC,
       DBA_CONSTRAINTS C
WHERE  1=1
AND    TC.OWNER=I.OWNER
AND    TC.TABLE_NAME=I.TABLE_NAME
AND    I.INDEX_NAME=IC.INDEX_NAME
AND    I.INDEX_NAME=C.CONSTRAINT_NAME(+)
AND    IC.INDEX_OWNER=TCOL.OWNER
AND    IC.TABLE_NAME=TCOL.TABLE_NAME
AND    IC.COLUMN_NAME=TCOL.COLUMN_NAME
AND    IC.INDEX_OWNER=CC.OWNER
AND    IC.TABLE_NAME=CC.TABLE_NAME
AND    IC.COLUMN_NAME=CC.COLUMN_NAME
AND    I.OWNER LIKE 'DPOW_%'
AND    I.TABLE_NAME NOT LIKE 'SYS_EXPORT_TABLE%'
AND    I.TABLE_NAME <> 'DPOW_OSI'
ORDER BY 2, 3, 4, 6
;

####################### Å×ÀÌºí½ºÆäÀÌ½ºº° »ç¿ëÇöÈ² Á¶È¸ (µ¥ÀÌÅÍ, ÀÎµ¦½º ¼¼±×¸ÕÆ® ¼±Á¤)
SQL> select tablespace_name, sum(bytes/1024/1024) from user_segments
group by tablespace_name ;

SQL> select tablespace_name, sum(bytes)/1024/1024 from dba_segments
group by tablespace_name ;




########################### 10g LOG
MINER
How To Recover After Delete From Table Using 10g Logminer? [ID 390537.1] 
--------------------------------------------------------------------------------

  Modified 24-NOV-2011     Type HOWTO     Status PUBLISHED   

In this Document
  Goal
  Solutio
--------------------------------------------------------------------------------

Applies to: 
Oracle Server - Enterprise Edition - Version: 9.2.0.1 to 10.2.0.3 - Release: 9.2 to 10.2
Information in this document applies to any platform.

Goal
How to recover after delete from table using 10g logminer?

Solution
In 10g when you are using the LogMiner against the same database that generated the redo log files, LogMiner scans the control file and determines the redo log files needed, based on the requested time or SCN range. You no longer need to map the time frame to an explicit set of redo log files. For this scan to occur, we need to use the continuous_mine option and specify approximate startscn or starttime. 

1. The minimal supplemental logging must be set on

connect / as sysdba
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA;

2. Create a table as scott user.

connect scott/tiger; 
create table tab1 (id number, name varchar2(20)); 

3. Insert 100 records in the new table 

begin 
  for i in 1..100 loop 
    insert into TAB1 values (i, 'test'||TO_CHAR (i)); 
  end loop; 
  commit;
end; 
/ 

4. Find out what is the current time 

ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY MM DD';

ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MON-YYYY HH24:MI:SS'; 
select sysdate from dual; 

SYSDATE 
-------------------- 
06-SEP-2006 23:19:22 

5. Delete the 100 records from the scott.tab1 table 

delete from tab1; 
commit; 
6. Find out what is the current time.

select sysdate from dual; 

SYSDATE 
-------------------- 
06-SEP-2006 23:19:55 
7. Connect as sysdba and start a logminer using STARTTIME => '06-SEP-2006 23:19:22', ENDTIME => '06-SEP-2006 23:20:22' 

connect / as sysdba 
ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MON-YYYY HH24:MI:SS'; 
EXECUTE DBMS_LOGMNR.START_LOGMNR (STARTTIME => '06-SEP-2006 23:19:22', ENDTIME => '06-SEP-2006 23:20:22', options => DBMS_LOGMNR.DICT_FROM_ONLINE_CATALOG + DBMS_LOGMNR.CONTINUOUS_MINE); 
8. Create a table to store the info from v$logmnr_contents. you can select directly from v$logmnr_contents but the contents of the v$logmnr_contents will be lost once you end up logminer session. 

create table mycontents as select * from v$logmnr_contents; 
9. At this time you can end up your logminer session and just work later on the mycontents table you created in step 8 above. 

execute dbms_logmnr.end_logmnr(); 
10. Now you can select from the table and get the sql_undo 

set heading off feedback off 
spool myinsert.sql 

SELECT sql_undo 
FROM   mycontents 
WHERE  seg_owner = 'SCOTT' AND 
       table_name = 'TAB1' and
       operation = 'DELETE'; 

spool off 
11. Myinsert.sql should look something like 


insert into "SCOTT"."TAB1"("ID","NAME") values ('1','test1'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('2','test2'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('3','test3'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('4','test4'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('5','test5'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('6','test6'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('7','test7'); 
...
insert into "SCOTT"."TAB1"("ID","NAME") values ('92','test92'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('93','test93'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('94','test94'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('95','test95'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('96','test96'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('97','test97'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('98','test98'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('99','test99'); 
insert into "SCOTT"."TAB1"("ID","NAME") values ('100','test100'); 

NOTE: You need to double check the record  in v$logmnr_contents are actually the right records. Describe v$logmnr_contents and you will see a lot of columns that will help you to verify  you are working on the correct set of data.


-------- ¿øº» ¸Þ½ÃÁö -------- Á¦¸ñ:  log miner 
³¯Â¥:  Thu, 01 Dec 2011 16:43:37 +0900 
º¸³½ »ç¶÷:  ÃÖ¿øÈñ <duncan@lguplus.co.kr> 
¹Þ´Â »ç¶÷:  ±è¹ÌÇö// <crispy@lguplus.co.kr> 



Advance Recovery
Logminer ( delete, update µ¥ÀÌÅÍ º¹±¸)
? Logminer¸¦ ÀÌ¿ëÇÏ¿© DML º¯°æµÈ µ¥ÀÌÅÍ º¹±¸
? Logminer¸¦ ÀÌ¿ëÇÏ¿© archive fileÀ» ÀÐ¾î¼­ º¹±¸ ¼öÇà
? LoggingµÈ data¸¸ °¡´ÉÇÏ¹Ç·Î, force logging ÇÊ¿ä
? Logminer¸¦ ÅëÇÑ º¹±¸ ¼öÇà
? v$archived_log¸¦ Á¶È¸ÇØ¼­ Àß¸ø DMLÀ» ¼öÇàÇÑ ½Ã°£´ëÀÇ archive¸¦ Ã£À½
? Logminer add logfile
? SQL> EXEC DBMS_LOGMNR.ADD_LOGFILE('<archiveÀÇ ÆÄÀÏ>',DBMS_LOGMNR.ADDFILE);
? v$logmnr_logs ºä¸¦ ÅëÇØ¼­ È®ÀÎ
? Logminer start
? SQL> alter session set nls_date_format='YYYY/MM/DD HH24:MI:SS';
? SQL> EXECUTE DBMS_LOGMNR.START_LOGMNR( -
OPTIONS => DBMS_LOGMNR.DICT_FROM_ONLINE_CATALOG);
? v$logmnr_contents ¸¦ º¹Á¦ÇÏ´Â Å×ÀÌºí »ý¼º(¼¼¼Ç Á¾·á½Ã Á¤º¸ ¾ø¾îÁü)
? create table <¹é¾÷ÇÒ Å×ÀÌºí¸í> tablespace users as select * from
v$logmnr_contents;
? v$logmnr_contents¸¦ ¹é¾÷ÇÑ Å×ÀÌºí.SQL_UNDO ¸¦ spool·Î Á¶È¸ÇØ¼­ ¼öÇàÇÏ 
¿© º¹±¸
? <Âü°í>How to Recover from delete on a table using 10g logminer (by 
example)?
(Doc ID 390537.1)

 
##################### LISTAGG
 
 SELECT LISTAGG(last_name, '; ')
         WITHIN GROUP (ORDER BY hire_date, last_name) "Emp_list",
       MIN(hire_date) "Earliest"
  FROM employees
  WHERE department_id = 30;
  
  
########################### 10g¿¡¼­ »õ·Î³ª¿Â flashback


¸¸¾à ÇÊ¿ä¾øÀ» °æ¿ì¿¡´Â
SQL> purge recyclebin;

purge dba_recyclebin;   /as sysdba

¸¸¾à ÈÞÁöÅë¿¡ µéÀº Å×ÀÌºíÀ» Á¶È¸ÇÏ½Ã·Á¸é
SQL> show recyclebin; 

»èÁ¦µÈ Å×ÀÌºíÀ» µÇ»ì¸®°í ½Í´Ù¸é

SQL> flashback table Å×ÀÌºí¸í to before drop;

select * from <º¹¿øÇÒ table_name>  as of timestamp (sysdate-30(ÃÊ)/1440)


SELECT 'DROP TABLE ' || OWNER || '.' || SEGMENT_NAME || ';', 'flashback table ' || OWNER || '.' || SEGMENT_NAME || ' to before drop;' FROM DBA_SEGMENTS
WHERE SEGMENT_NAME IN (
'TB_OSW_WRK_INFL_TGT_TEMP'
,'TEMP_FTTH_SBCR_20091207_TEMP'
,'TB_OSZ_DIFSYS_DPT100119'
,'TB_OSZ_PTY100119'
,'TB_OSZ_PTY_REL100119'
,'TB_OSZ_SYSBT_DPT_REL100119'
);


###################### flashback Äõ¸® ÀÌ¿ëÇÏ¿© Æ¯Á¤½ÃÁ¡ÀÇ µ¥ÀÌÅÍ º¸±â

create table dptow_osz.recover_tb_osz_pgm as select * from dptow_osz.tb_osz_pgm  as of timestamp (sysdate-1.5);

select count(1) from dptow_osz.tb_osz_pgm;



###################### SYSDATE °è»ê

SELECT SYSDATE FROM DUAL;

SELECT SYSDATE-1/24 FROM DUAL;  --½Ã°£´ÜÀ§

SELECT SYSDATE-1/1440 FROM DUAL;  -- ºÐ´ÜÀ§

####################################################################################################
####################################################################################################
########### FLASHBACK TEST SCENARIO (TABLE UN-DROP)
####################################################################################################
####################################################################################################

The un-drop feature brings the table back to its original name, but 
not the associated objects like indexes and triggers, which are left 
with the recycled names.

########### 1. Å×ÀÌºí°ú °ü·ÃµÈ ±âÅ¸¿ÀºêÁ§Æ® Á¶È¸
Å×ÀÌºí º¹±¸¸¦ ¸ÕÀú ÇØ¹ö¸®°Ô µÇ¸é °ü·Ã¿ÀºêÁ§Æ®µéµµ ÈÞÁöÅëÀ¸·ÎºÎÅÍ BIN$ÀÇ ÀÌ¸§À¸·Î º¹±¸µÇ¾î¹ö¸®¹Ç·Î 
¿øº»ÀÇ ÀÌ¸§À» ¾Ë ¼ö ¾ø°Ô µÊ(Åë½Ã µî º¹Á¦½Ã½ºÅÛÀ¸·ÎºÎÅÍ ÂüÁ¶ÇÏ´Â ¼ö¹Û¿¡ ¾øÀ½)
ÀÌ¸¦ ÇÇÇÏ±â À§ÇØ¼­ ÇöÀç ÈÞÁöÅë¿¡¼­ °ú°ÅÀÇ ¿øº» ÀÌ¸§µéÀ» ¸ÕÀú È®º¸ÇÒ °Í.

»èÁ¦µÈ Å×ÀÌºíµéÀÇ °ü·Ã¿ÀºêÁ§Æ®µéÀÇ ¿øº»/ÈÞÁöÅë ÀÌ¹ÌÁö Á¶È¸
SELECT *
FROM DBA_RECYCLEBIN
WHERE BASE_OBJECT IN (SELECT BASE_OBJECT FROM DBA_RECYCLEBIN
WHERE ORIGINAL_NAME = 'TMP_OSF_EQP_INCRD_CONF')
AND ORIGINAL_NAME != 'TMP_OSF_EQP_INCRD_CONF';

È¤Àº ½Ã°£ ¿ª¼øÀ¸·Î Á¶È¸ 
SELECT *
FROM DBA_RECYCLEBIN
order by droptime desc;



SELECT OBJECT_NAME, ORIGINAL_NAME, TYPE
FROM DBA_RECYCLEBIN
WHERE BASE_OBJECT = (SELECT BASE_OBJECT FROM DBA_RECYCLEBIN
WHERE ORIGINAL_NAME = 'TMP_OSF_EQP_INCRD_CONF')
AND ORIGINAL_NAME != 'TMP_OSF_EQP_INCRD_CONF';

OWNER                          OBJECT_NAME                    ORIGINAL_NAME                    OPERATION TYPE                      TS_NAME                        CREATETIME          DROPTIME            DROPSCN     PARTITION_NAME                   CAN CAN RELATED     BASE_OBJECT PURGE_OBJEC SPACE      
------------------------------ ------------------------------ -------------------------------- --------- ------------------------- ------------------------------ ------------------- ------------------- ----------- -------------------------------- --- --- ----------- ----------- ----------- -----------
T00227                         BIN$pBCeprTJSJTgRAAkgXeATQ==$0 IX_TMP_OSF_EQP_INCRD_CONF        DROP      INDEX                     TS_OSMIG                       2011-04-29:00:06:20 2011-05-25:11:39:55  1.178e+013                                  NO  YES     1044646     1044646     1045104        6272


È¤Àº

show recyclebin


########### 2. Å×ÀÌºí UN-DROP º¹±¸

FLASHBACK TABLE T00227.TMP_OSF_EQP_INCRD_CONF TO BEFORE DROP;


########### 3. Å×ÀÌºí°ú °ü·ÃµÈ ±âÅ¸¿ÀºêÁ§Æ® RENAME
ALTER INDEX "BIN$pBCeprTJSJTgRAAkgXeATQ==$0" RENAME TO IX_TMP_OSF_EQP_INCRD_CONF;




####################################################################################################
####################################################################################################
########### FLASHBACK TEST SCENARIO (ROW LEVEL º¹±¸)
####################################################################################################
####################################################################################################


########### 1. µ¥ÀÌÅÍ »èÁ¦
delete from dptow_osz.tb_osz_noti_msg where noti_msg_id between '142310818' and '142310827';

10 ROWS »èÁ¦

COMMIT;



########### 2. Àß¸øµÈ DMLÀÌ ÀÇ½ÉµÇ´Â ½Ã°£ ±¸°£ Á¶°ÇÀ¸·Î µ¥ÀÌÅÍ Á¶È¸

select versions_startscn, versions_endscn, versions_starttime, versions_endtime, versions_xid, versions_operation, noti_msg_id 
from T00227.TMP_OSF_EQP_INCRD_CONF versions between timestamp
to_date('5/25/2011 11:00:00','mm/dd/yyyy hh24:mi:ss')
and to_date('5/25/2011 12:00:00','mm/dd/yyyy hh24:mi:ss')
WHERE VERSIONS_OPERATION = 'D' --I, U, D
order by VERSIONS_STARTTIME DESC;

10 rows selected.

VERSIONS_STARTSCN	VERSIONS_ENDSCN	VERSIONS_STARTTIME	VERSIONS_ENDTIME	VERSIONS_XID	VERSIONS_OPERATION	NOTI_MSG_ID
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310818
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310819
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310820
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310821
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310827
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310823
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310824
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310825
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310826
11784224078335		2011/05/24 16:04:56		001B000400007EE3	D	142310822

10 rows selected.


########### 3. Á¶È¸µÈ XID È¤Àº SCN ¹øÈ£·Î UNDO SQL ÃßÃâ

SELECT UNDO_SQL
FROM FLASHBACK_TRANSACTION_QUERY
WHERE XID = '001B000400007EE3';


UNDO_SQL
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310827','064704','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310826','064703','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310825','064702','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310824','064701','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310823','064700','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310822','064153','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310821','064152','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310820','064151','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310819','064150','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');
insert into "DPTOW_OSZ"."TB_OSZ_NOTI_MSG"("NOTI_MSG_ID","NOTI_MSG_TGTR_PTY_ID","NOTI_MSG_TITL","NOTI_MSG_DESC","PROC_TGT_PGM_ID","DELV_PARM","NOTI_MSG_SND_DATE","NOTI_MSG_CFM_DATE","NOTI_MSG_CFM_YN") values ('142310818','037777','[Àå¾ÖÁ¢¼ö] 100928-001422','¾¾ÄÉÀÌ¿£Áö´Ï¾î¸µ(¾È¾çµ¿)(ÀåÈñÁ¤)ÀÎÅÍ³ÝÀÌ µÇ¾ú´Ù ¾ÈµÇ¾ú´Ù ÇÔ// ÇöÀç Á¤»óÀÌ³ª ¾ÈµÈ´Ù°í ÇÏ½É// Á¡°Ë¿äÃ»','OSTPC113','trblAcpNo=100928-001422',TO_DATE('10/09/28', 'RR/MM/DD'),NULL,'Y');

10 ROWS È®ÀÎ

########### 4. UNDO SQL (INSERT) ¼öÇà

COMMIT;



########### 5. »èÁ¦µÇ¾ú´ø µ¥ÀÌÅÍ Á¶È¸

SELECT * from dptow_osz.tb_osz_noti_msg where noti_msg_id between '142310818' and '142310827';




########### 6. ³Ê¹« ¸¹Àº µ¥ÀÌÅÍ°¡ DELETE µÇ¾î UNDO SQL ¼öÇàÀ» ÅëÇÑ º¹±¸¿¡ ³Ê¹« ¸¹Àº ½Ã°£ÀÌ ¼Ò¿äµÉ °Í °°´Ù¸é,
CTAS ·Î Æ¯Á¤ ½ÃÁ¡À¸·Î º¹±¸

create table T00227.TMP_OSF_EQP_INCRD_CONF2 
as select * from T00227.TMP_OSF_EQP_INCRD_CONF  as of timestamp (sysdate-5/1440);    -- 5ºÐÀü µ¥ÀÌÅÍ·Î º¹±¸

# º¹±¸ÇÑ ÀüÃ¼ Å×ÀÌºí °Ç¼ö È®ÀÎ
select count(1) from T00227.TMP_OSF_EQP_INCRD_CONF2;

# ¿øº» »èÁ¦
drop table T00227.TMP_OSF_EQP_INCRD_CONF;

# º¹±¸º» RENAME
alter table T00227.TMP_OSF_EQP_INCRD_CONF2 rename to TMP_OSF_EQP_INCRD_CONF;

####################################################################################################
####################################################################################################
####################################################################################################

######################  Å×ÀÌºí µå¶ø  DROP
select 'DROP TABLE ' || OWNER || '.' || SEGMENT_NAME || ';', 'FLASHBACK TABLE ' || OWNER || '.' || SEGMENT_NAME || ' TO BEFORE DROP;', BYTES/1024/1024 from dba_SEGMENTS
where SEGMENT_NAME IN (
'TB_OSF_HFC_EQP_100327'
,'TB_OSF_HFC_EQP_110107'
,'TB_OSF_INSTL_PLC_110107'
,'TB_OSM_NAT_HSNO_0722'
,'TEMP_FTTH_SBCR_20091207_TEMP'
,'TB_OSZ_DIFSYS_DPT100119'
,'TB_OSZ_PTY100119'
,'TB_OSZ_PTY_REL100119'
,'TB_OSZ_SYSBT_DPT_REL100119'
);


#################### 10g ÈÞÁöÅë
10g¿¡¼­´Â Å×ÀÌºíÀ» »èÁ¦ÇÏ¸é ÈÞÁöÅëÀ» ¸¸µé¾î ³Ö¾îµÓ´Ï´Ù
È¤½Ã Àß¸øµÇ¾úÀ» °æ¿ì º¹±¸ÇÏ±â À§ÇÑ°ÍÀÌ±¸¿ä
¸¸¾à ÇÊ¿ä¾øÀ» °æ¿ì¿¡´Â

SQL> purge recyclebin;
ÇÏ½Ã¸é ÈÞÁöÅëÀ» ºñ¿ì°Ô µË´Ï´Ù

Ãß°¡·Î ¸¸¾à ÈÞÁöÅë¿¡ µéÀº Å×ÀÌºíÀ» Á¶È¸ÇÏ½Ã·Á¸é
SQL> show recyclebin;
 
»èÁ¦µÈ Å×ÀÌºíÀ» µÇ»ì¸®°í ½Í´Ù¸é

SQL> flashback table Å×ÀÌºí¸í to before drop;
ÇÏ½Ã¸é µË´Ï´Ù.


######################## CREATE TABLE AS  CTAS

CREATE TABLE  T00213.OE_EQUIPMST parallel 12 NOLOGGING
AS
SELECT /*+ parallel (OE_EQUIPMST,12) */ * FROM OE_EQUIPMST@DL_BOSSD;


SQL> create user q_user identified by pass
  2  default tablespace user_data  ==> ÀÌ°ÍÀ» »ý·«ÇÏ¸é ±âº» system»ç¿ë
  3  temporary tablespace temp;  ==> ÀÌ°ÍÀ» »ý·«ÇÏ¸é ±âº» temp»ç¿ë(9i)
SQL> grant connect, resource to q_user;
SQL> revoke unlimited tablespace from q_user;  ==> ¹«Á¦ÇÑ ±ÇÇÑÀ» Ãë¼Ò ÇÑ´Ù
SQL> alter user q_user quota 500k on user_data;  ==> q_user¿¡°Ô 500k »ç¿ë ±ÇÇÑ ÁØ´Ù





####################################################################################################
####################################################################################################
########### OWI 
####################################################################################################
####################################################################################################

DBMS_WORKLOAD.COLORED_SQL 
Æ¯Á¤ SQL ÀÌ AWR ¿¡ ³ª¿Àµµ·Ï Á¶Á¤

DBMS_MONITOR
--> 10046
10041, 10053

- errorstack -> hang, loop, slow performance ½Ã

- SORT_AREA_SIZE --> PGA_AGGREGATE_TARGET À¸·Î º¯°æ

- SGA_TARGET --> MEMORY_TARGET 11g

- SGA MEMORY ´Â GROW&SHRINK ÇÑ´Ù. GROW ´Â GRANULE ´ÜÀ§

- MUTEX »ç¿ë ½Ã, cursor pin wait X WAIT ¹ß»ý °¡´É


- Æ¯Á¤ sqlÀÌ ´À¸± ¶§?
AVG WAIT TIME ºÐ¼® (AWR/10046)

- X$BH, HOTBLOCK ¿©ºÎ ÆÇ´Ü, Æ¯Á¤ TABLE ¿¡ ´ëÇÑ TOUCH COUNT

LRU -> TOUCH COUNT ALGORITHM

- HOT BLOCK ¿¡ ´ëÇÑ ¼Ö·ç¼Ç

1) PCT FREE
2) SQL TUNING
3) HASH PARTITION (TABLE)


-- FREE BUFFER WAIT ½Ã DB_BUFFER ÀÇ DIRTY BLOCK À» ³»·Á½á¼­ FREE BUFFER ¸¦ È®º¸ÇØ¾ß ÇÏ¹Ç·Î
DB_WRITER_PROCESSES  ¸¦ ´Ã¸± °Í CPUÀÇ 1/4 °³·Î Á¶Á¤
P1, P2 -> FILE#, BLOCK#


- V$SEGMENT_STATISTICS

- V$DBA_HIST_SYSSTAT

- AWR, RAC EFFICIENCY SECTION, GC LOAD PROFILE

- ENQUEUE -> FIFO / LATCH -> SPIN

- ITL -> INIT TRANS, MAX TRANS

- TX INDEX CONTENTION, ALLOCATE ITL ENTRY WAIT ¹ß»ý½Ã
1) REVERSE KEY INDEX -> RANGE SCANºÒ°¡
2) INDEX KEY º¯°æ

- TX LOCK -> DML ÈÄ NO COMMIT, DDL

- TM LOCK -> TABLE LOCK, FK ¿¡ INDEX »ý¼ºÇÒ °Í, APPEND ´Â OLTP ¿¡¼­ Á¶½ÉÇÒ °Í 


######################### TS QUOTAS
ALTER USER DPOSEAI QUOTA UNLIMITED ON TS_OSO_IDX;

SELECT * FROM DBA_TS_QUOTAS
WHERE USERNAME='DPOSEAI';


SELECT * FROM DBA_SEGMENTS
WHERE TABLESPACE_NAME='TS_OSC_IDX'
AND OWNER='DPOSMIG';


3) ¿î¿µ¿µ¿ª¿¡ ¿î¿µ°èÁ¤¼ÒÀ¯·Î º¹Á¦Å×ÀÌºí »ý¼º CTAS
   º¹Á¦Å×ÀÌºí¿¡ ÀüÈ¯
   ¿øº»Å×ÀÌºí »èÁ¦
   ÀüÈ¯¿Ï·áµÈ º¹Á¦Å×ÀÌºíÀ» ¿øº»¸íÀ¸·Î RENAME
   INDEX, Á¦¾àÁ¶°Ç, Æ®¸®°Å µî Àç»ý¼º
   
   ¿¹½Ã)
   - DPOSMIG·Î ·Î±×ÀÎ
   
   - CREATE TABLE DPOW_OSF.TB_OSF_MNTH_FCTY_STAT_MIG
   PARALLEL (DEGREE 8) 
   NOLOGGING 
   TABLESPACE TS_OSF    -- Å×ÀÌºí½ºÆäÀÌ½º¸¦ ¿î¿µ¿µ¿ªÀ¸·Î ¸í½ÃÀûÀ¸·Î ÁöÁ¤!!
   AS 
   SELECT /*+ parallel (TB_OSF_MNTH_FCTY_STAT,8) */ *
   FROM DPOW_OSF.TB_OSF_MNTH_FCTY_STAT;   
   
   
################ ¿ÀºêÁ§Æ® ¼ö È®ÀÎ

SELECT
(
SELECT COUNT(1) FROM DBA_CONSTRAINTS
WHERE CONSTRAINT_TYPE='P'
AND OWNER LIKE 'DPOW_%'
AND TABLE_NAME LIKE 'TB_%'
) PK_CNT,
(
SELECT COUNT(1) FROM DBA_CONSTRAINTS
WHERE CONSTRAINT_TYPE='R'
AND OWNER LIKE 'DPOW_%'
AND TABLE_NAME LIKE 'TB_%'
) FK_CNT,
(
SELECT COUNT(1) FROM DBA_INDEXES
WHERE OWNER LIKE 'DPOW_%'
AND TABLE_NAME LIKE 'TB_%'
) IX_CNT
FROM DUAL;

PK_CNT      FK_CNT      IX_CNT     
----------- ----------- -----------
       1193         435        2746

1 rows selected.

PK_CNT      FK_CNT      IX_CNT     
----------- ----------- -----------
       1193         395        2746
       
          
######################## sqlplus ¿¡¼­ ÆÐÅ°Áö ÇÁ·Î½ÃÀú ½ÇÇà 

SYS#LGDPOSP2> var o_status number;
SYS#LGDPOSP2> var o_message varchar2(500);
SYS#LGDPOSP2> exec DPOSO.PG_OSOSO_VOIP_STAT.SP_INS_MNG_DSV_RQ_STAT_MAIN (:o_status, :o_message);
PL/SQL procedure successfully completed.

SYS#LGDPOSP2> SYS#LGDPOSP2> SYS#LGDPOSP2> SYS#LGDPOSP2> SYS#LGDPOSP2> SYS#LGDPOSP2> SYS#LGDPOSP2> commit;

Commit complete.

   
######################## µ¥ÀÌÅÍ°¡ Á¸ÀçÇÏ¿© ÄÃ·³º¯°æÀÌ ¾ÈµÇ´Â °æ¿ì

1. ±âÁ¸Å×ÀÌºí·ÎºÎÅÍ ÀÓ½Ã Å×ÀÌºí »ý¼º

CREATE TABLE TB_RN313_TMP
AS SELECT * FROM TB_RN313;

2. ±âÁ¸ Å×ÀÌºí truncate ÈÄ ÄÃ·³º¯°æ

TRUNCATE TABLE TB_RN313;

ALTER TABLE TB_RN313 MODIFY INDI_NO VARCHAR2(8);

3. ÀÓ½ÃÅ×ÀÌºí -> ±âÁ¸Å×ÀÌºí insert

INSERT INTO TB_RN313 (SELECT * FROM TB_RN313_TMP);

4. ÀÓ½ÃÅ×ÀÌºí »èÁ¦
DROP TABLE TB_RN313_TMP;


######################## CREATE USER¹®

CREATE USER  DPTUZN
       IDENTIFIED BY DPTUZN
       DEFAULT TABLESPACE TS_OSO
       TEMPORARY TABLESPACE TEMP_DEV
;
GRANT create session, unlimited tablespace TO  DPTUZN;
GRANT RESOURCE, CONNECT TO  DPTUZN;


######################## CREATE USER ½Ã¿¡ ±âÁ¸ ºñ¹Ð¹øÈ£¸¦ º¸Á¸ÇÏ°í ½Í´Ù¸é, È¤Àº ºñ¹Ð¹øÈ£ À¯½ÇÇßÀ» ¶§ µðºñ¸µÅ© »ý¼º½Ã È°¿ë ±¸¹®
CREATE USER POW_BT 
IDENTIFIED BY VALUES '440E13D1D4C0C988' <----- DBA_USERS.PASSWORD ÄÃ·³ÀÇ ¾ÏÈ£È­µÈ °ª



######################## ½ºÅ°¸¶ »ý¼º
CREATE USER  scrjappw2
       IDENTIFIED BY scrjappw2
       DEFAULT TABLESPACE users
       TEMPORARY TABLESPACE temp
       
       
       QUOTA UNLIMITED (OR 100M) ON TS_NAME
       
       
       
       
;
GRANT
       create procedure,
       create sequence,
       create session,
       create table,
       create trigger,
       create view,
       create synonym,
       unlimited tablespace
TO  scrjappw2;




   
   



######################## µðºñ¸µÅ©·Î µ¥ÀÌÅÍ ³Ö±â


insert into TB_CS001
select * from TB_CS001@hp4;

insert into TB_CS000
select * from TB_CS000@hp4;

insert into tb_re005
select * from scrjv2ee2.tb_re005
where  OFCIAL_NO ='UHD90005'
;

######################## sequence È®ÀÎ

select seq_name.currval from dual;
select seq_name.nextval from dual;


SQL> SELECT LAST_NUMBER FROM DBA_SEQUENCES
WHERE SEQUENCE_NAME='SQ_OSC_AST_PROC_FCTY_LINEAST';

LAST_NUMBER
-----------
   57400653

1 rows selected.

SQL> SELECT LAST_NUMBER FROM DBA_SEQUENCES
WHERE SEQUENCE_NAME='SQ_OSC_AST_PROC_FCTY_EQPAST';

LAST_NUMBER
-----------
    6325383

1 rows selected.

SQL> SELECT LAST_NUMBER FROM DBA_SEQUENCES
WHERE SEQUENCE_NAME='SQ_OSC_AST_PROC_FCTY_CLNEAST';

LAST_NUMBER
-----------
   21761055

1 rows selected.



EXEC DPTOW_OSC."RESET_SEQ_N" ( 'SQ_OSC_AST_PROC_FCTY_EQPAST', 11550000 );
EXEC DPTOW_OSC."RESET_SEQ_N" ( 'SQ_OSC_AST_PROC_FCTY_LINEAST', 70710000 );
EXEC DPTOW_OSC."RESET_SEQ_N" ( 'SQ_OSC_AST_PROC_FCTY_CLNEAST', 40010000 );


SELECT LAST_NUMBER FROM DBA_SEQUENCES
WHERE SEQUENCE_NAME='SQ_OSC_AST_PROC_FCTY_EQPAST';

SELECT LAST_NUMBER FROM DBA_SEQUENCES
WHERE SEQUENCE_NAME='SQ_OSC_AST_PROC_FCTY_LINEAST';


SELECT LAST_NUMBER FROM DBA_SEQUENCES
WHERE SEQUENCE_NAME='SQ_OSC_AST_PROC_FCTY_CLNEAST';




EXEC DPTOW_OSC."RESET_SEQ_N" ( 'SQ_OSC_AST_PROC_FCTY_EQPAST', 11550000 );


###################### quotation µû¿ÈÇ¥ escape
select ename||chr(39)||'s Salary is '||sal from emp


###################### & AMPERSAND escape
select ename||chr(38)||'s Salary is '||sal from emp

################# ¿î¿µ°ú ½ÃÄö½º ¸ÂÃß±â
SELECT 'EXEC ' || SEQUENCE_OWNER || '.RESET_SEQ_N ( ''' || SEQUENCE_NAME || ''',' || LAST_NUMBER || ');' 
FROM DBA_SEQUENCES
WHERE SEQUENCE_OWNER LIKE 'DPOW%'
ORDER BY SEQUENCE_OWNER, SEQUENCE_NAME;


######################## ½ÃÄö½º°ª ¹Ù²Ù´Â ÇÁ·Î½ÃÀú

-- DDL Script for PROCEDURE DPTOW_OSC.RESET_SEQ_N. Orange for ORACLE.
-- Generated on 2010/04/13 09:58:26 by SYSTEM@LGDPOSD

CREATE OR REPLACE PROCEDURE DPTOW_OSC."RESET_SEQ_N" ( p_seq_name in varchar2, t_val in number )
is
    l_val number;
    min_val number;
    inc_val number;
begin
    select min_value, increment_by, last_number into min_val, inc_val, l_val
      from user_sequences where sequence_name = p_seq_name;

    if (min_val < t_val) and (l_val != t_val) then
        execute immediate
        'alter sequence ' || p_seq_name || ' increment by ' || to_char(t_val-l_val) ||'';

        execute immediate
        'select ' || p_seq_name || '.nextval from dual' INTO l_val;

        execute immediate
        'alter sequence ' || p_seq_name || ' increment by ' || to_char(inc_val)  ||'';
    end if;
end reset_seq_n;
/

GRANT EXECUTE ON DPTOW_OSC.RESET_SEQ_N TO DPTOSC;

CREATE SYNONYM DPTOSC.RESET_SEQ_N FOR DPTOW_OSC.RESET_SEQ_N;


######################## default, null Á¦°Å

default value ·Î null °ªÀ¸·Î Update ÇÏ¸é ..

dba_tab_column ¿¡¼­ DATA_DEFAULT °ªÀÌ ¼ø¼ö °ø¹é(NULL) ÀÌ ¾Æ´Ñ NULL ·Î Ç¥±â µÈ´Ù.

ÀÌ°ÍÀº ¾îÂ¿ ¼ö ¾ø´Ù°í ÇÏ³×¿ä ^^;

Oracle Online help ±Û ÀÔ´Ï´Ù.

Note:
If a column has a default value, then you can use the DEFAULT clause to change the default to NULL, but you cannot remove the default value completely. That is, if a column has ever had a default value assigned to it, then the DATA_DEFAULT column of the USER_TAB_COLUMNS data dictionary view will always display either a default value or NULL.

[ÃâÃ³] Not Null, Default Á¦°Å ÇÏ±â|ÀÛ¼ºÀÚ Å¸¶ôÃµ»ç

######################## temporary tablespace ·Î ÀÎÇØ ÆÄÀÏ½Ã½ºÅÛ Ç®ÀÏ ¶§ temp ts Àç»ý¼º temp tablespace

1. Å¸ ÆÄÀÏ½Ã½ºÅÛ¿¡ temp1 »ý¼º

CREATE TEMPORARY TABLESPACE TEMP1 TEMPFILE '/data005/LGDPOSH/temp1_01.dbf' SIZE 5000M REUSE AUTOEXTEND OFF NEXT  640K MAXSIZE UNLIMITED EXTENT MANAGEMENT LOCAL;

2. ALTER DATABASE DEFAULT TEMPORARY TABLESPACE TEMP1;

3. SELECT TEMPORARY_TABLESPACE, USERNAME FROM DBA_USERS;
TEMP1 ÀÓÀ» È®ÀÎ

4. DROP TABLESPACE TEMP1 INCLUDING CONTENTS AND DATAFILES; 

ORA-22864: cannot ALTER or DROP LOB indexes

######################## ÁÖ¹Î¹øÈ£ º¯Á¶
update COMPANY
set REP_RSDNT_NO =
(substr(REP_RSDNT_NO,4,3)||
substr(REP_RSDNT_NO,10,3)-2103)||
substr(REP_RSDNT_NO,13,1)||
substr(REP_RSDNT_NO,7,3)||
substr(REP_RSDNT_NO,1,3)
where LENGTH(REP_RSDNT_NO) =13 and REP_RSDNT_NO >'1000000000001';


update COMPANY
set REP_RSDNT_NO =
(substr(REP_RSDNT_NO,4,3)||
substr(REP_RSDNT_NO,10,3)-2103)||
'-'||
substr(REP_RSDNT_NO,13,1)||
substr(REP_RSDNT_NO,7,3)||
substr(REP_RSDNT_NO,1,3)
where LENGTH(REP_RSDNT_NO) =14 and substr(REP_RSDNT_NO,7,1)='-' and REP_RSDNT_NO >'1000000-000001';


######################## ÀÎµ¦½º 10°³ ÀÌ»ó Å×ÀÌºí
SELECT TABLE_NAME,COUNT(INDEX_NAME) FROM DBA_INDEXES
WHERE OWNER LIKE 'DP%'
GROUP BY TABLE_NAME
HAVING COUNT(INDEX_NAME) > 9;

######################## EXCEL VLOOKUP

=VLOOKUP(´ë»ó½ºÆ®¸µ, ´ë»ó¿µ¿ª, 1, FALSE)

1 Ã¹ÄÃ·³¸¸
FALSE Á¤È®È÷ ºñ±³

######################## µ¿ÀÇ¾î, synonym »ý¼º

CREATE SYNONYM TB_CI101 for scrjappa4.TB_CI101;

######################## TS »ý¼º
CREATE TABLESPACE TS_SM_SANG_DATA
DATAFILE
  '/sangup5/oracle9i/oradata/rdf_sang_data_01' SIZE 2000M ;

CREATE TABLESPACE TS_SM_SANG_INDEX
DATAFILE
  '/sangup5/oracle9i/oradata/rif_sang_index_01' SIZE 2000M ; 


CREATE TABLESPACE TS_SI_ROME_DATA
DATAFILE
  '/aros4/oracms/oradata/rdf_rome_data_01' SIZE 2000M ;
  
CREATE TABLESPACE TS_SI_ROME_INDEX
DATAFILE
  '/aros3/oracms/oradata/rif_rome_index_01' SIZE 2000M ; 


--- ASM CREATE TABLESPACE

DATA DISK GROUP È®ÀÎ

. oraenv +ASM

select * from gv$asm_diskgroup;


SQL> CREATE TABLESPACE ITAMFDS_DATA DATAFILE '+DATA' SIZE 1000M AUTOEXTEND ON MAXSIZE 30G;
Tablespace created.
SQL> CREATE TABLESPACE ITAMFDS_IDX DATAFILE '+DATA' SIZE 1000M AUTOEXTEND ON MAXSIZE 30G;
Tablespace created.


######################## index ÄÃ·³ °Ë»ö
select index_name,column_name from user_ind_columns where index_name='TX_RN401_01'

######################## index »ý¼º
spool ci_tx_rn401_01.lst

CREATE INDEX tx_rn401_01 ON tb_rn401
(
RECEV_DATE
)
PCTFREE   5
TABLESPACE TS_CO2_INDEX
STORAGE (
INITIAL 1024K
NEXT 1024K
  MINEXTENTS  1
  MAXEXTENTS  2147483645
  PCTINCREASE 0
  )
;

spool off
  
spool ci_tx_rn403_01.lst

CREATE INDEX tx_rn403_01 ON tb_rn403
(
ins_date
)
PCTFREE   5
TABLESPACE TS_CO2_INDEX
STORAGE (
INITIAL 1024K
NEXT 1024K
  MINEXTENTS  1
  MAXEXTENTS  2147483645
  PCTINCREASE 0
  )
;

spool off

############################# SGA »çÀÌÁîÁ¶È¸
SQL> conn /as sysdba
Connected.
SQL> show sga

Total System Global Area  941590160 bytes
Fixed Size                   743056 bytes
Variable Size             402653184 bytes
Database Buffers          536870912 bytes
Redo Buffers                1323008 bytes


°øÀ¯Ç® »çÀÌÁî = SGA - Redo Buffers - Database Buffers =  400mb

slccdb2 total memory 16gb
swap size 6gb


show parameter pfile
spfile ¾²´Â °æ¿ì
alter system set SHARED_POOL_SIZE = 200M;

init.ora ¾²´Â °æ¿ì
init.ora ¼öÁ¤ ÈÄ Àç±âµ¿

// *Cause:  More shared memory is needed than was allocated in the shared
//          pool.
// *Action: If the shared pool is out of memory, either use the
//          dbms_shared_pool package to pin large packages,
//          reduce your use of shared memory, or increase the amount of
//          available shared memory by increasing the value of the
//          INIT.ORA parameters "shared_pool_reserved_size" and
//          "shared_pool_size".
//          If the large pool is out of memory, increase the INIT.ORA
//          parameter "large_pool_size".

shared_pool_size = 3500000                                            # SMALL
# shared_pool_size = 5000000                                          # MEDIUM
# shared_pool_size = 9000000

############################## ÆÄ¶ó¸ÞÅÍ°¡ alter session, alter system À¸·Î ¼öÁ¤°¡´ÉÇÑÁö ¿©ºÎ
select *v$parameter

############################## ÆÄ¶ó¸ÞÅÍ°ª È®ÀÎ
select name,value from v$parameter where name='open_links'

############################## db link ºñ¹Ð¹øÈ£
/AS SYSDBA·Î 
SELECT * FROM sys.link$ ;

############################## db link »ý¼º

--ÀÎ½ºÅÏ½º´ç MAX DB LINK °³¼ö
open_links_per_instance              integer     50


global_names init ÆÄ¶ó¸ÞÅÍ°¡ true ·Î µÇ¾îÀÖÀ¸¸é µðºñ¸µÅ©¸íÀÌ Å¸°Ùµðºñ sid ¿Í µ¿ÀÏÇØ¾Æ ÇÔ.
alter system set global_names=false scope=both;


¸ÕÀú sqlnet µî·Ï, ¼Ò½º tnsname.ora ÆÄÀÏ¿¡ Å¸°ÙÀÌ ´ëÇÑ ¾Ù¸®¾î½º Ãß°¡

select object_name from user_objects where object_type='DATABASE LINK';


create database link wcr_link connect to wcr identified by wcr using 'CCSD';

create database link SCRJAPPW2_DEVSANG1 connect to SCRJAPPW2 identified by SCRJAPPW2 using 'corpDev';
drop database link SCRJAPPW2_DEVSANG1;

create database link SCRJAPPW4_DEVSANG1 connect to SCRJAPPW4 identified by SCRJAPPW4 using 'corpDev';
drop database link SCRJAPPW4_DEVSANG1;

create database link SCRJV2EE1_DEVETL1 connect to SCRJV2EE1 identified by SCRJV2EE1 using 'devetl1';
drop database link SCRJAPPW4_DEVSANG1;


db link Á¤ÀÇ¿¡ tns Á¤ÀÇ¸¦ ÅëÃ¤·Î ³Ö¾îµµ µÊ
create database link imsi_link connect to pow identified by wao1pbc using '(DESCRIPTION = 
    (ADDRESS_LIST = 
      (ADDRESS = (PROTOCOL = tcp)(HOST = 192.168.250.20)(PORT = 1521))
    )
    (CONNECT_DATA = 
      (SID = POWERBC1)
    )
  )';



Á¦´ë·Î µÇ´ÂÁö È®ÀÎ

select count(*) from tab@wcr_link;
select count(*) from tab@wym_link;
select count(*) from tab@wyj_link;
select count(*) from tab@whc_link;
select count(*) from tab@wjg_link;
select count(*) from tab@cm_link;


###############################################
select * from dba_sys_privs;
select 'grant select on '||table_nem from dba_tables where owner like 'SCRJSHIP';

select * from dba_tab_privs;
############################## index column È®ÀÎ
SQL>select index_name, column_name from user_ind_columns
where index_name in ('TX_STO_01', 'TX_CRE_03','TX_DEL_07') ; 


############################## authentication ¿À¶óÅ¬ ÀÎÁõ¹æ½Ä

http://download.oracle.com/docs/cd/B19306_01/server.102/b14231/dba.htm#sthref134

- os ÀÎÁõÀ» ÇÏ·Á¸é oracle ¿À³Ê°èÁ¤ÀÌ dba ±×·ì¿¡ ¼ÓÇØ¾ß ÇÔ.

- ÆÄ¶ó¸ÞÅÍ¸¦ Setting REMOTE_LOGIN_ PASSWORDFILE
In addition to creating the password file, you must also set the initialization parameter REMOTE_LOGIN_PASSWORDFILE to the appropriate value. The values recognized are:

NONE: Setting this parameter to NONE causes Oracle Database to behave as if the password file does not exist. That is, no privileged connections are allowed over nonsecure connections.

EXCLUSIVE: (The default) An EXCLUSIVE password file can be used with only one instance of one database. Only an EXCLUSIVE file can be modified. Using an EXCLUSIVE password file enables you to add, modify, and delete users. It also enables you to change the SYS password with the ALTER USER command.


############################## ½ºÅ°¸¶ÁöÁ¤ ÀÌ¿ëÇÑ select into

conn scrjv2ee1/scrjv2ee1

grant select on tb_re005 to scrjv2xe1
grant select on tb_re501 to scrjv2xe1

insert into tb_re005 (select * from scrjv2ee1.tb_re005 where ofcial_no = 'DEVTST0N')
insert into tb_re501 (select * from scrjv2ee1.tb_re501 where ofcial_no = 'DEVTST0N')


insert into tb_re005 (select * from scrjappw1.tb_re005);
insert into tb_re501 (select * from scrjappw1.tb_re501);


############################## ¼Ò½º¿Í Å¸°Ù ÄÃ·³¸®½ºÆ®°¡ ´Ù¸¥ °æ¿ì ÄÃ·³¸®½ºÆ® ÁöÁ¤.

insert into pow_bc.TB_BMISEQP_REWK_OUTWH_APLY_DTL(	REWK_OUTWH_APLY_NO 
,	APLY_SEQ           
,	EQP_NO             
,	MNG_NO             
,	SER_NO1            
,	MAC_ADDR1          
,	SER_NO2            
,	MAC_ADDR2          
,	PROC_ST_TYP        
,	HIST_SEQ           
,	INWH_APLY_YN     )  (select 	REWK_OUTWH_APLY_NO 
,	APLY_SEQ           
,	EQP_NO             
,	MNG_NO             
,	SER_NO1            
,	MAC_ADDR1          
,	SER_NO2            
,	MAC_ADDR2          
,	PROC_ST_TYP        
,	HIST_SEQ           
,	INWH_APLY_YN      from pow_bc.TB_BMISEQP_REWK_OUTWH_APLY_DTL@imsi_link);


############################### Backing Up Control Files

Use the ALTER DATABASE BACKUP CONTROLFILE statement to back up your control files. You have two options:

   1.
      Back up the control file to a binary file (duplicate of existing control file) using the following statement:
      ALTER DATABASE BACKUP CONTROLFILE TO '/oracle/backup/control.bkp';

   2.
      Produce SQL statements that can later be used to re-create your control file:
      ALTER DATABASE BACKUP CONTROLFILE TO TRACE;

############################### ¿À¶óÅ¬ ºñÆ®¼ö È®ÀÎ
devstis2@ora10g:/aros1/oracle10g >cd $ORACLE_HOME/bin
devstis2@ora10g:/aros1/oracle10g/bin >cd $ORACLE_HOME/bin
devstis2@ora10g:/aros1/oracle10g/bin >file oracle
oracle:         ELF 32-ºñÆ® LSB ½ÇÇà °¡´É 80386 ¹öÀü 1, µ¿ÀûÀ¸·Î ¸µÅ©µÊ, ºÐ¸® ¾ÈµÊ


############################# ÇÁ·ÎÆÄÀÏ, ¿À¶óÅ¬°èÁ¤ Å¸ÀÓ¾Æ¿ô µî ¼³Á¤
select * from dba_profiles;

-- 3ºÐÀ¸·Î È¤À¸ ÃÊ
ALTER PROFILE DPOS_PROFILE LIMIT IDLE_TIME 30;
-- ¹«ÇÑÀ¸·Î
ALTER PROFILE DEFAULT LIMIT IDLE_TIME UNLIMITED; 

password reuse

ALTER PROFILE NONEXPIRE LIMIT PASSWORD_REUSE_TIME UNLIMITED ;
ALTER PROFILE NONEXPIRE LIMIT PASSWORD_REUSE_MAX UNLIMITED;


############################### ¿À¶óÅ¬ Àå¾ÖºÐ¼®
/aros1/oracle1/bdump/
alert ·Î±×
alert ·Î±× ³»¿ë ³» trc ÆÄÀÏ


# core dump ÆÄÀÏ ¼Ó¼º º¸±â
file core

# ÄÚ¾î´ýÇÁ ³»¿ëº¸±â
cd /aros1/oracle1/cdump
dbx /aros1/oracle1/bin/oracle core
-> where

############# sqlplus shell Á¢¼Ó

sqlplus system/mao1cb <<!
alter user ossmig account unlock;
/
quit
!

sqlplus system/mao1cb <<!
alter user ossmig account unlock;
/
quit
!



export CURRENT_DIR=`pwd`
export BACKUP_DIR=$CURRENT_DIR"/BACKUP_SRC"
export list=$CURRENT_DIR"/package.list"

cd $BACKUP_DIR
rm -rf BK_*.sql

while read package_name
do

$ORACLE_HOME/bin/sqlplus -s << -!
/ as sysdba

#sqlplus -s /nolog <<!
#conn monitor/ahslxj

set long 20000
set lines 300
set pages 0
set head off
set termout off
set feed off
set echo off
set ver off

spool BK_${package_name}.sql

select CASE WHEN LINE=1 THEN 'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' IS'
ELSE text END from dba_source
where name = '${package_name}'
ORDER BY TYPE, LINE;
/

spool off

exit
-!

done < ${list}




################

sqlplus -s '/as sysdba' << EOF
set feedback off
set linesize 200
set pagesize 0
set echo off
set head off
set trimspool on

spool $WORK_DIR/check_ssn_all_tbls.sql

select 'spool $WORK_DIR/check_ssn_all_tbls.result'from dual;
select 'set timing off' from dual;
select 'set serveroutput on' from dual;
select 'set head off' from dual;
select 'set pagesize 300' from dual;
select 'set linesize 300' from dual;
select null from dual;



SELECT 'spool $WORK_DIR/Results/'||LOWER(owner)||'__'||LOWER(table_name)||'.result'||CHR(10)
       ||' SELECT '''||OWNER||'.'||TABLE_NAME||''' AS TBL_NAME, A.* FROM '||OWNER||'.'||TABLE_NAME
       ||' A WHERE ROWNUM <= 100;'||CHR(10)
       ||'spool off'
         FROM DBA_TABLES
        WHERE OWNER LIKE 'DPTOW%'
ORDER BY OWNER, TABLE_NAME;

spool off




############# sh -> sqlplus ÀÚµ¿ ¸ð´ÏÅÍ¸µ
while true
do

sqlplus -s '/as sysdba' << EOS
set lines 120;
set feedback off;
set heading off;
alter session set nls_date_format='MM/DD HH24:MI';
select sysdate,usn, state, undoblockstotal "Total", undoblocksdone "Done",
      round(undoblocksdone/undoblockstotal*100,2) "Processed%" ,
     undoblockstotal-undoblocksdone "ToDo",
          decode(cputime,0,'unknown',sysdate+(((undoblockstotal-undoblocksdone) /(undoblocksdone / cputime)) / 86400))
                     "Estimated time to complete"
     from v\$fast_start_transactions
;
EOS

sleep 10
done


############# Ã¢ time out À¸·Î ´ÝÈ÷Áö ¾Ê°Ô shell ÀÛ¾÷
[ossdbt1:LGDPOST:/sw/oracle] while true
> do
> sleep 5
> echo 'hi'
> done
hi
hi
hi
hi


############# export ¼Óµµ ´À¸± °æ¿ì Æ®¸®°Å

sqlplus SCRJV2E01/SCRJV2E01 <<!
select trigger_name from user_triggers ;
CREATE OR REPLACE TRIGGER LoginTrigger AFTER LOGON ON SCRJV2E01.SCHEMA
BEGIN execute immediate 'alter session set OPTIMIZER_GOAL=CHOOSE'; END;
/
quit
!


#############  Æ®¸®°Å »óÅÂ
select t.table_owner AS TABLE_OWNER, t.table_name AS TABLE_NAME, t.owner AS TRIGGER_OWNER, t.trigger_name AS TRIGGER_NAME, o.status AS OBJ_STATUS, t.status AS TRIGGER_STATUS
from dba_triggers t, dba_objects o
where 
t.owner=o.owner
and t.trigger_name=o.object_name
and table_owner like 'DP%'
ORDER BY 1,2,3,4;


############# Æ®¸®°Å insert ¾×¼Ç ½Ã Æ¯Á¤ °ªÀÌ µé¾î¿Ã¶§¸¸ ÇÏ°í ½ÍÀ» ¶§
IF :new.ITM_VAL4 = '01' and :new.ITM_VAL4 ='02' and :new.ITM_VAL4 ='03'

############# Æ®¸®°Å DISABLE, ENABLE
SELECT 'ALTER TRIGGER DPOSEAI.' || TRIGGER_NAME || ' DISABLE;', 'ALTER TRIGGER DPOSEAI.' || TRIGGER_NAME || ' ENABLE;' FROM DBA_TRIGGERS
WHERE OWNER='DPOSEAI'                                                                                                                   
AND TABLE_NAME IN (                                                                                                                     
'TB_OSF_PEQP'
,'TB_OSF_CRD_CONF' 
,'TB_OSF_PORT_CONF' 
,'TB_OSF_CHNL_CONF'
,'TB_OSF_AFFL_EQP'   
,'TB_OSF_AFFL_EQP_BY_CHNL'
,'TB_OSF_EQP_INCRD_CONF'  
,'TB_OSF_CIR_CONF_NODE'                                                                                                           
)
ORDER BY TABLE_NAME;


##################################### Æ¯Á¤ ¿ÀºêÁ§Æ® ACCESS ¼¼¼Ç KILL
SELECT 'alter system kill session ''' || S.SID || ',' || S.SERIAL# || ''';'
FROM V$ACCESS A, V$SESSION S
WHERE A.SID=S.SID
AND A.OBJECT='TB_OSO_TSK';


############################## lock table
LOCK TABLE CSSADM.TB_CC_CVAP_CABL_TPS_RPR_RSN IN EXCLUSIVE MODE;


--LOCK Á¶È¸
SELECT B.OBJECT_NAME, A.TYPE
FROM   V$LOCK A, DBA_OBJECTS B
WHERE  A.ID1=B.OBJECT_ID
AND B.OWNER='CSSADM'
AND B.OBJECT_NAME ='TB_CC_CVAP_CABL_TPS_RPR_RSN';


SELECT B.OBJECT_NAME, A.TYPE
FROM   V$LOCK A, DBA_OBJECTS B
WHERE  A.ID1=B.OBJECT_ID
AND B.OWNER='ITAMFDS'
AND B.OBJECT_NAME ='DH_IP_TMP';


############## lock À» °É°í ÀÖ´Â ¼¼¼Ç Ã£±â
SELECT
    substr(s.username||'/'||s.osuser,1,20) usr,
        s.sid sid,
        s.serial#,
        s.status,
        l.type,
        decode(lmode,1,'NONE',2,'SS',3,'SX',4,'S',5,'SSX',6,'X') held,
        decode(request,1,'NONE',2,'SS',3,'SX',4,'S',5,'SSX',6,'X') req,
        id1,
        id2,
        l.ctime,
        substr(s.program,1,15) program,
        s.process,
        p.spid,
        t.sql_text
FROM    
        v$sqltext   t,
        v$process   p,
        v$session   s,
        v$lock      l
WHERE
        l.sid   =   s.sid
AND     s.paddr =   p.addr
AND     s.username is not null
AND     l.type in ('TX','DX')
AND     t.address (+)   =   s.sql_address
AND     t.hash_value (+)   =   s.sql_hash_value
ORDER BY
        id1, id2, held, s.sid;    
        
############## Æ¯Á¤ Å×ÀÌºí¿¡ lock À» °É°í ÀÖ´Â ¼¼¼Ç Ã£±â Å×ÀÌºí LOCK TABLE LOCK
select 'alter system kill session ''' || A.SID || ',' || A.SERIAL# || ''';', a.sid, a.serial# 
from v$session a, v$lock b, dba_objects c 
where a.sid=b.sid and 
b.id1=c.object_id and 
b.type='TM' and 
c.object_name='TB_OSF_SUIT_INPT_INFO'; 


select 'alter system kill session ''' || A.SID || ',' || A.SERIAL# || ''';','kill -9 ' ||''||p.spid||';', a.* 
from v$session a, v$lock b, dba_objects c , v$process p
where a.sid=b.sid and 
b.id1=c.object_id and 
p.addr(+) = a.paddr and
b.type='TM' and 
c.object_name='TB_OSM_NEW_HSNO_REQ'; 


SID         SERIAL#     USERNAME                       OSUSER                         COMMAND     PROCESS      PROGRAM                                         
----------- ----------- ------------------------------ ------------------------------ ----------- ------------ ------------------------------------------------
       1102        1634 DPOSO                          trisha                                   0 1884:3084    plsqldev.exe                                    
       1101        8760 DPOSWAS                        trisha                                   0 3640:2380    plsqldev.exe                                    

 

2. ´ÙÀ½ ¸í·ÉÀ¸·Î SESSIONµéÀ» KILLÇÑ´Ù.

SQL> alter system kill session '139, 1110';


column username format a10
column sid format 999999
column lock_type format a20
column MODE_HELD format a11
column MODE_REQUESTED format a10
column LOCK_ID1 format a12
column LOCK_ID2 format a12


############## Library Cache Lock °ü·Ã Ã¼Å© 

ÃâÃ³ : http://wiki.oracleclub.com/display/CORE/ASH%28Active+Session+History%29

 

select inst_id, sid, serial#, event, p1text, p1, p1raw, p2text, p2, p2raw, p3text, p3, p3raw
from gv$session 
where event like 'library cache%' ;

                     P1 P1RAW            P2TEXT                                                                   P2 P2RAW
---------- ---------- ---------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------- ---------------- ---------------------------------------------------------------- ---------- ----------------
P3TEXT                                                                   P3 P3RAW
---------------------------------------------------------------- ---------- ----------------
         1       1189      31543 library cache lock                                               handle address                                                   1.3835E+19 C00000045F5C9E38 lock address                                                     1.3835E+19 C0000003F4B57A18
100*mode+namespace                                                      301 000000000000012D

         1       3105       8098 library cache lock                                               handle address                                                   1.3835E+19 C0000004506E6600 lock address                                                     1.3835E+19 C00000045B1779D0
100*mode+namespace

 C000000469C08AD8

SYS#LGDPOSP2> select kglnaobj as object
from x$kglob
where kglhdadr = 'C000000466F2F7B8' ;  2    3

OBJECT
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
PG_OSZ_COMMON

-- »çÈÄ¿¡µµ °¡´É
select kglnaobj as object
from x$kglob
where kglhdadr = 'C00000044B461768' ; --<< p1raw °ªÀ» °è»ê±â¿¡¼­ hex°ªÀ¸·Î º¯°æÇÏ¿© ÀÔ·Â..object È®ÀÎ

select kglnaobj as object
from x$kglob
where kglhdadr = 'C0000004078D9680' ;


select * from x$kglpn p, v$session s
where p.kglpnuse=s.saddr
and kglpnhdl='&P1RAW';

select * from x$kglpn p, v$session s
where p.kglpnuse=s.saddr
and kglpnhdl='13835058073724917608';


-- ÀÚµ¿Åë°è¼öÁý½Ã library cache lock ¹ß»ý¹®Á¦
http://blog.naver.com/PostView.nhn?blogId=neptuneosy&logNo=140067466531


°ËÁõµÈ¹Ù ¾øÀ½.. LIBARY CACHE Àç¹ß½Ã ¾Æ·¡ Äõ¸®·Î Ã¼Å© ÇØº¼°Í.

-- RUN BY SYS ( CURRENT ) 
select A.* 
from x$kgllk A, V$SESSION B
WHERE A.KGLLKSES = B.SADDR
AND B.EVENT ='latch: library cache' ;

SELECT * 
FROM X$KGLLK LOCK_A
WHERE KGLLKREQ = 0 
AND EXISTS ( SELECT LOCK_B.KGLLKHDL 
             FROM X$KGLLK LOCK_B, V$SESSION B
             WHERE LOCK_B.KGLLKSES = B.SADDR
              AND B.EVENT ='latch: library cache'
              AND LOCK_A.KGLLKHDL = LOCK_B.KGLLKHDL
              AND KGLLKREQ > 0 ) ;

-- BLOCKED SESSIONS 
SELECT * 
FROM X$KGLLK LOCK_A
WHERE KGLLKREQ > 0 
AND EXISTS ( SELECT LOCK_B.KGLLKHDL 
             FROM X$KGLLK LOCK_B, V$SESSION B
             WHERE LOCK_B.KGLLKSES = B.SADDR
              AND B.EVENT ='latch: library cache'
              AND LOCK_A.KGLLKHDL = LOCK_B.KGLLKHDL
              AND KGLLKREQ = 0 ) ;

-- MMON ÀÌ ¹®Á¦ÀÎÁö È®ÀÎ(m000) - 10.2.0.4 ¿¡¼­ ÇØ°áµÊ 
-- 10.2.0.4 ÀÌÇÏ 
SELECT a.SID, a.SERIAL#, a.OSUSER, a.PROGRAM
FROM V$SESSION a, V$SESSION b
where b.EVENT='latch: library cache'
and a.sid = b.BLOCKING_SESSION ;

-- ´Ù¸¥ ¼¼¼Ç¿¡ ÀÇÇØ¼­ library cache lock ÀÌ ¹ß»ý ÇÒ °æ¿ì
select *
from v$active_session_history
where SAMPLE_TIME > to_date('2011/10/26 13:00:00','YYYY/MM/DD hh24:mi:ss')  
and SAMPLE_TIME < to_date('2011/10/26 15:00:00','YYYY/MM/DD hh24:mi:ss') 
and EVENT ='latch: library cache'
and BLOCKING_SESSION is not null ; -- ºí·ÏÅ· ¼¼¼Ç

select * from v$active_session_history
where SAMPLE_TIME > to_date('2010/04/22 09:45:48','YYYY/MM/DD hh24:mi:ss')  
and SAMPLE_TIME < to_date('2010/04/22 09:52:48','YYYY/MM/DD hh24:mi:ss') 
AND EVENT ='latch: library cache';

select  SAMPLE_TIME, SQL_ID, COUNT(*) from v$active_session_history
where SAMPLE_TIME > to_date('2010/04/22 09:45:48','YYYY/MM/DD hh24:mi:ss')  
and SAMPLE_TIME < to_date('2010/04/22 09:52:48','YYYY/MM/DD hh24:mi:ss') 
AND EVENT ='latch: library cache'  -- ÇÊÅÍ¸µ ÀÌº¥Æ® Ã¼Å© 
HAVING COUNT(*) > 50  -- ÀÏÁ¤ Count ÀÌ»ó Ã¼Å© 
GROUP BY SAMPLE_TIME, SQL_ID ;

select  SAMPLE_TIME, SQL_ID, COUNT(*) from v$active_session_history
where SAMPLE_TIME > to_date('2010/04/22 09:45:48','YYYY/MM/DD hh24:mi:ss')  
and SAMPLE_TIME < to_date('2010/04/22 09:52:48','YYYY/MM/DD hh24:mi:ss') 
AND EVENT ='latch: library cache'
and sql_id in ('cwmqmv0y96fuj','guhqu0r2uuhst')
HAVING COUNT(*) > 50
GROUP BY SAMPLE_TIME, SQL_ID ;

select EVENT, COUNT(*) from v$active_session_history
where SAMPLE_TIME > to_date('2010/04/22 09:45:48','YYYY/MM/DD hh24:mi:ss')  
and SAMPLE_TIME < to_date('2010/04/22 09:52:48','YYYY/MM/DD hh24:mi:ss') 
GROUP BY EVENT ; 




############## ±âÅ¸ LOCK °ü·Ã Äõ¸®¹®
SELECT a.sid,
       decode(a.type, 'MR', 'Media Recovery', 'RT', 'Redo Thread', 'UN', 'User Name', 'TX', 'Transaction', 'TM', 'DML', 'UL', 'PL/SQL User Lock', 'DX', 'Distributed Xaction', 'CF', 'Control File', 'IS', 'Instance State', 'FS', 'File Set', 'IR', 'Instance Recovery', 'ST', 'Disk Space Transaction', 'IR', 'Instance Recovery', 'ST', 'Disk Space Transaction', 'TS', 'Temp Segment', 'IV', 'Library Cache Invalidation', 'LS', 'Log Start or Switch', 'RW', 'Row Wait', 'SQ', 'Sequence Number', 'TE', 'Extend Table', 'TT', 'Temp Table', a.type) lock_type,
       decode(a.lmode, 0, 'None', /* Mon Lock equivalent */
          1, 'Null', /* N */
          2, 'Row-S (SS)', /* L */
          3, 'Row-X (SX)', /* R */
          3, 'Row-X (SX)', /* R */
          4, 'Share', /* S */
          5, 'S/Row-X (SSX)', /* C */
          6, 'Exclusive', /* X */
          to_char(a.lmode)) mode_held,
       decode(a.request, 0, 'None', /* Mon Lock equivalent */
          1, 'Null', /* N */
          2, 'Row-S (SS)', /* L */
          3, 'Row-X (SX)', /* R */
          4, 'Share', /* S */
          5, 'S/Row-X (SSX)', /* C */
          6, 'Exclusive', /* X */
          to_char(a.request)) mode_requested,
       to_char(a.id1) lock_id1,
       to_char(a.id2) lock_id2
FROM   v$lock a
WHERE  (id1,
               id2) in (SELECT b.id1,
               b.id2
        FROM   v$lock b
        WHERE  b.id1=a.id1
        and    b.id2=a.id2
        and    b.request>0)
---------------------------------------------------------
SELECT
    substr(s.username||'/'||s.osuser,1,20) usr,
        s.sid sid,
        s.serial#,
        s.status,
        l.type,
        decode(lmode,1,'NONE',2,'SS',3,'SX',4,'S',5,'SSX',6,'X') held,
        decode(request,1,'NONE',2,'SS',3,'SX',4,'S',5,'SSX',6,'X') req,
        id1,
        id2,
        l.ctime,
        substr(s.program,1,15) program,
        s.process,
        p.spid,
        t.sql_text
FROM    
        v$sqltext   t,
        v$process   p,
        v$session   s,
        v$lock      l
WHERE
        l.sid   =   s.sid
AND     s.paddr =   p.addr
AND     s.username is not null
AND     l.type in ('TX','DX')
AND     t.address (+)   =   s.sql_address
AND     t.hash_value (+)   =   s.sql_hash_value
ORDER BY
        id1, id2, held, s.sid
---------------------------------------------------------
SELECT
       decode(a.type, 'MR', 'Media Recovery', 'RT', 'Redo Thread', 'UN', 'User Name', 'TX', 'Transaction', 'TM', 'DML', 'UL', 'PL/SQL User Lock', 'DX', 'Distributed Xaction', 'CF', 'Control File', 'IS', 'Instance State', 'FS', 'File Set', 'IR', 'Instance Recovery', 'ST', 'Disk Space Transaction', 'IR', 'Instance Recovery', 'ST', 'Disk Space Transaction', 'TS', 'Temp Segment', 'IV', 'Library Cache Invalidation', 'LS', 'Log Start or Switch', 'RW', 'Row Wait', 'SQ', 'Sequence Number','TE', 'Extend Table', 'TT', 'Temp Table', a.type) lock_type,
count(*)
FROM   v$lock a
WHERE  (id1,
               id2) in (SELECT b.id1,
               b.id2
        FROM   v$lock b
        WHERE  b.id1=a.id1
        and    b.id2=a.id2
        and    b.request>0)
group by 
       decode(a.type, 'MR', 'Media Recovery', 'RT', 'Redo Thread', 'UN', 'User Name', 'TX', 'Transaction', 'TM', 'DML', 'UL', 'PL/SQL User Lock', 'DX', 'Distributed Xaction', 'CF', 'Control File', 'IS', 'Instance State', 'FS', 'File Set', 'IR', 'Instance Recovery', 'ST', 'Disk Space Transaction', 'IR', 'Instance Recovery', 'ST', 'Disk Space Transaction', 'TS', 'Temp Segment', 'IV', 'Library Cache Invalidation', 'LS', 'Log Start or Switch', 'RW', 'Row Wait', 'SQ', 'Sequence Number','TE', 'Extend Table', 'TT', 'Temp Table', a.type) 
;
---------------------------------------------------------
select a.type,s.sid,s.serial#,s.CLIENT_INFO,MACHINE,TERMINAL,PROGRAM
from v$lock  a
        ,v$session s
where a.type='DX'
and  (id1,
               id2) in (SELECT b.id1,
               b.id2
        FROM   v$lock b
        WHERE  b.id1=a.id1
        and    b.id2=a.id2
        and    b.request>0)
and a.sid = s.sid(+)
;
        


--* ¾Æ·¡ÀÇ Äõ¸®¹®À» ¼öÇàÇÏ¿© library cache pin holder¼¼¼ÇÀ» È®ÀÎÇÒ ¼ö ÀÖ´Ù.  library cache lock ¿¡µµ Àû¿ë °¡´É
select sid holder,
KGLPNMOD held,
KGLPNREQ reg,
event, wait_time
from x$kglpn , v$session
where KGLPNHDL in
   (select p1raw
from v$session_wait
where wait_time=0
and event like 'library cache pin%')
and KGLPNMOD <> 0
and v$session.saddr=x$kglpn.KGLPNUSE
/


--* ¾Æ·¡ÀÇ Äõ¸®¹®À» ¼öÇàÇÏ¿© library cache pin ´ë±â¸¦ ÇÏ°í ÀÖ´Â ¼¼¼ÇÀ» È®ÀÎÇÒ ¼ö ÀÖ´Ù.
select sid, event, state, p1text, p1, p1raw, p2text, p2, p2raw, p3text, p3, p3raw
from v$session 
where event like 'library cache%'

---* ¾Æ·¡ÀÇ Äõ¸®¹®À» ¼öÇàÇÏ¿© °æÇÕÀ» ¾ß±âÇÑ ¿ÀºêÁ§Æ®¸¦ È®ÀÎÇÒ ¼ö ÀÖ´Ù.
select s.sid, kglpnmod "Mode", kglpnreq "Req", kglnaobj "Object"
from   x$kglpn p, v$session s
where  p.kglpnuse=s.saddr
and    kglpnhdl='&P1RAW' ;

---* ¾Æ·¡ Äõ¸®¹®À» ¼öÇàÇÏ¿© ÇØ´ç ÀÌº¥Æ® ¹ß»ý ½ÃPINÀ» Á¡À¯ÇÑ ¼¼¼Ç ¹× ¸ðµå¸¦ È®ÀÎÇÒ ¼ö ÀÖ´Ù.
select s.sid, kglpnmod "Mode", kglpnreq "Req"
from   x$kglpn p, v$session s
where  p.kglpnuse=s.saddr
and    kglpnhdl='&P1RAW' ; 


---*°ú´ÙÇÏ°Ô ÇÏµåÆÄ½ÌÀ» ¼öÇàÇÏ´Â ¼¼¼Ç È®ÀÎ
select a.sid,
       c.username,
       b.name,
       a.value,
       round((sysdate - c.logon_time) * 24) hours_connected
from   v$sesstat a,
       v$statname b,
       v$session c
where  c.sid = a.sid
and    a.statistic# = b.statistic#
and    a.value > 0
and    b.name = 'parse count (hard)'
order by a.value desc;




######################### À§ Äõ¸®·Îµµ library cache pin/lock holder ¸¦ Ã£À» ¼ö ¾øÀ» ¶§, hanganalyze ´ýÇÁ·Î ¿øÀÎºÐ¼®


Å×ÀÌºí DROP, TRUNCATE, RENAME µîÀÇ DDL ÀÛ¾÷ ¼öÇà ½Ã ÀÛ¾÷ÀÌ ÁøÇàµÇÁö ¾Ê°í ¸ØÃçÀÖ´Â Çö»óÀÌ ÀÖ¾ú½À´Ï´Ù.

WAIT EVENT¸¦ ºÐ¼®ÇØº» °á°ú library cache lockÀÌ °É¸° °ÍÀ» ¾Ë°Ô µÇ¾ú°í ¾î¶°ÇÑ sessionÀÌ lockÀ» Àâ°í ÀÖ´ÂÁö Ã£¾ß¾ß ÇÏ´Âµ¥

ÀÌ°É Ã£±â°¡ ½±Áö ¾Ê¾Ò½À´Ï´Ù.

====================================================================================================================

1)  SID : 975°¡ library cache lock¿¡ °É·Á¼­ DDLÀÛ¾÷À» ¼öÇàÇÏÁö ¸øÇÏ°í ´ë±âÇÏ°í ÀÖ´Â °ÍÀ» ¾Ë ¼ö ÀÖÀ½

select * from v$lock where type in ('TM', 'TX');
select sid, seq#, event, wait_time from v$session_wait;

 

2) saddrÁ¤º¸¸¦ Ã£±â À§ÇÑ query

select sid,saddr from v$session where event= 'library cache lock';

 

3) Ã£¾Æ³½ saddrÁ¤º¸¸¦ ÅëÇÏ¿© holder Ã£±â(1)

SELECT * FROM X$KGLLK LOCK_A
WHERE KGLLKREQ = 0
AND EXISTS (SELECT LOCK_B.KGLLKHDL FROM X$KGLLK LOCK_B
WHERE KGLLKSES = 'saddr_from_v$session' /* BLOCKED SESSION */
AND LOCK_A.KGLLKHDL = LOCK_B.KGLLKHDL
AND KGLLKREQ > 0);
=> no rows

 

4) Ã£¾Æ³½ saddrÁ¤º¸¸¦ ÅëÇÏ¿© holder Ã£±â(2)
SELECT SID,USERNAME,TERMINAL,PROGRAM FROM V$SESSION
WHERE SADDR in
(SELECT KGLLKSES FROM X$KGLLK LOCK_A
WHERE KGLLKREQ = 0
AND EXISTS (SELECT LOCK_B.KGLLKHDL FROM X$KGLLK LOCK_B
WHERE KGLLKSES = 'saddr_from_v$session' /* BLOCKED SESSION */
AND LOCK_A.KGLLKHDL = LOCK_B.KGLLKHDL
AND KGLLKREQ > 0)
);

=> no rows
====================================================================================================================

À§ 4°³ÀÇ Äõ¸®¸¦ ÅëÇÏ¿© Ã£À» ¼ö ÀÖ´Â Á¤º¸°¡ ¾ø¾ú´Âµ¥ hanganalyze¸¦ ÅëÇÏ¿© ºÐ¼®ÀÌ °¡´ÉÇÏ¿´½À´Ï´Ù.

 

SQL> connect / as sysdba
SQL> oradebug setmypid
SQL> oradebug unlimit
SQL> oradebug hanganalyze 3
SQL> oradebug dump systemstate 266

 

Hanganalyze ·Î ºÐ¼® ÇÑ traceÀÇ ÀÏºÎºÐÀ» ¹ßÃéÇØ º¸¸é ´ÙÀ½°ú °°½À´Ï´Ù.

 

====================================================================================================================

==============
HANG ANALYSIS:
==============
Open chains found:
Chain 1 : <cnode/sid/sess_srno/proc_ptr/ospid/wait_event> :
    <0/880/35919/0xa9720988/2314240/SQL*Net message from client>
 -- <0/975/1654/0xac6dc0f0/3875032/library cache lock>  --> ´Ù¸¥ °÷¿¡¼­ Ã£À» ¼ö ¾ø¾ú´ø SID:975¿¡ ´ëÇÑ HOLDER°¡  

                                                                      '880/35919'¿´´Ù´Â »ç½ÇÀ» ¾Ë ¼ö ÀÖ¾ú½À´Ï´Ù.
Other chains found:
Chain 2 : <cnode/sid/sess_srno/proc_ptr/ospid/wait_event> :
    <0/1009/1060/0xa96e5888/1728668/No Wait>
Chain 3 : <cnode/sid/sess_srno/proc_ptr/ospid/wait_event> :
    <0/1017/50481/0xa96e09c8/3784824/jobq slave wait>
Chain 4 : <cnode/sid/sess_srno/proc_ptr/ospid/wait_event> :
    <0/1074/2/0xac6d81f0/1081504/Streams AQ: qmn slave idle wait>
Chain 5 : <cnode/sid/sess_srno/proc_ptr/ospid/wait_event> :
    <0/1075/2/0xa96e1988/3027096/Streams AQ: waiting for time man>
Chain 6 : <cnode/sid/sess_srno/proc_ptr/ospid/wait_event> :
    <0/1086/1/0xac6d6270/806992/Streams AQ: qmn coordinator idle>
Extra information that will be dumped at higher levels:
[level  4] :   1 node dumps -- [REMOTE_WT] [LEAF] [LEAF_NW] 
[level  5] :   5 node dumps -- [SINGLE_NODE] [SINGLE_NODE_NW] [IGN_DMP] 
[level  6] :   1 node dumps -- [NLEAF] 
[level 10] : 272 node dumps -- [IGN] 

====================================================================================================================

 

'880/35919' ¸¦ kill½ÃÅ² ÈÄ DDLÀÛ¾÷Àº Á¤»óÀûÀ¸·Î ¼öÇà µÇ¾ú½À´Ï´Ù.



############## ¸ðµç ¼¼¼Ç Á×ÀÌ±â

select 'alter system kill session ''' || SID || ',' || SERIAL# || ''';' from v$session where username='SCRJV2T09';

############## ¼¼¼ÇÀÇ sql¹® È®ÀÎ

column username format a10
column lockwait format a10
column sql_text format a80
column object_owner format a14
column object format a15
select b.username username, c.sid sid, c.owner object_owner,
c.object object, b.lockwait, a.sql_text SQL
from v$sqltext a, v$session b, v$access c
where a.address=b.sql_address 
and a.hash_value=b.sql_hash_value 
and b.sid = c.sid 
and c.owner <> 'SYS'
/

############## ÇÁ·Î¼¼½ºÀÇ process id ·Î  USERNAME, LOGON TIME, sql¹® È®ÀÎ
set serveroutput off
set pages 0
accept v :

col username for a10
break on username
set line 100
spool gsql.lst
select s.username username, a.sql_text sql
from   v$process p, v$session s, v$sqltext a
where  p.spid = &v
and    p.addr = s.paddr
and    s.sql_address = a.address
and    s.sql_hash_value = a.hash_value
order by piece
/
spool off


16402


select s.username username, to_char(s.LOGON_TIME,'YYYYMMDD-hh24:mi:ss'), a.sql_text sql
from   v$process p, v$session s, v$sqltext a
where  p.spid = 2555
and    p.addr = s.paddr
and    s.sql_address = a.address
and    s.sql_hash_value = a.hash_value
order by piece
/       


col username for a10
break on username
set line 100
spool gsql.lst
select s.username username, a.sql_text sql
from   v$session s, v$sqltext a
where  s.sid = 594
and s.serial# = 8273
and    s.sql_address = a.address
and    s.sql_hash_value = a.hash_value
order by piece
/
spool off

23635
594
8273
select c.sql_text
from v$session a, v$process b, v$sqltext c, v$sess_io d
where b.spid=10683
and b.addr=a.paddr
and a.sid=d.sid
and a.sql_hash_value=c.hash_value(+)
and a.sql_address=c.address(+);




SELECT  sql_text
FROM 		v$sqltext_with_newlines
WHERE 	address = 
        (SELECT prev_sql_addr --DECODE (RAWTOHEX (sql_address),
                           -- '00', prev_sql_addr,
                           -- sql_address
                          --
               FROM v$session
              WHERE SID = 1786)
ORDER BY piece;

################### ¼¼¼Ç ID(SID) ¸¸ ¾Ë¸é prev_sql_addr, sql_address Á¶È¸¸¦ ÅëÇØ SQL ¹® Á¶È¸  ¼­ºêÄõ¸®¹æ½Ä
SELECT  sql_text
FROM 		v$sqltext_with_newlines
WHERE 	address = 
        (SELECT 	DECODE (RAWTOHEX (sql_address), '00', prev_sql_addr, sql_address)
         FROM 		v$session
         WHERE 		SID = 1786)
ORDER BY piece;

################### ¼¼¼Ç ID(SID) ¸¸ ¾Ë¸é prev_sql_addr, sql_address Á¶È¸¸¦ ÅëÇØ SQL ¹® Á¶È¸  À¯´Ï¿Â¹æ½Ä
SELECT /*+ ordered */ sql_text, piece FROM v$session s, v$sqltext_with_newlines t 
WHERE s.sid = :sid 
AND s.serial# = :serial 
AND s.sql_address = t.address 
AND s.sql_hash_value = t.hash_value 
AND s.sql_hash_value <> 0 
UNION ALL 
SELECT /*+ ordered */ sql_text, piece 
FROM v$session s, v$sqltext_with_newlines t 
WHERE s.sid = :sid AND s.serial# = :serial 
AND s.prev_sql_addr = t.address 
AND s.prev_hash_value = t.hash_value 
AND s.sql_hash_value = 0 
ORDER BY piece 



#################### V$SESSION_LONGOPS

6ÃÊÀÌ»ó ¼¼¼Ç.

sql_id, SQL_HASH_VALUE, SQL_ADDRESS, SID µî


SOFAR ÄÃ·³À» ÅëÇØ¼­ ÁøÇà»óÈ² ¸ð´ÏÅÍ¸µ

SELECT * FROM  V$SESSION_LONGOPS
WHERE SID='364'
ORDER BY START_TIME DESC;


#################### ±ä Æ®·£Àè¼Ç ¿¹»ó Á¾·á½Ã°£
  select sid,
       serial#,
       opname,
       to_char(start_time, 'HH24:MI:SS') startt,
       round(ELAPSED_SECONDS/60, 2) ProgressedTime_Minute,
       round(TIME_REMAINING/60, 2) RemainTime_Minute,
       round((sofar/totalwork)*100,2) "complete(%)"
from   v$session_longops
where  totalwork > 0 
AND round(TIME_REMAINING/60, 2) > 0
and sid=1612;
DPOW_OSZ.TB_OSZ_DSV_RQ

#################### ´ë·® dml Æ®·£Àè¼Ç ÁøÇà¿©ºÎ È®ÀÎ

select  s.audsid      audsid,
        s.sid         sid,
        s.serial#     Serial#,
        p.spid        pid,
        t.UBABLK      ubablk,
        t.used_ublk   U_Block,
        t.used_urec   U_Record,
        substrb(t.start_time,-8,8)  S_Time
  from  v$transaction   t,
        v$process       p,
        v$session       s
 where  t.ses_addr = s.saddr
   and  s.paddr    = p.addr
   and sid=1390;
   
   
   
###########################################################################

/* ¶ô¹ß»ý »ç¿ëÀÚ¿Í sql, object Á¶È¸ */

select distinct x.session_id,  a.serial#,d.object_name,a.machine,a.terminal,a.program,b.address,b.piece, b.sql_text
from v$locked_object x, v$session a, v$sqltext b, dba_objects d
where x.session_id = a.sid
and x.object_id = d.object_id
and a.sql_address = b.address
--and a.terminal = 'È«±æµ¿'
order by b.address,b.piece;

locked object

SELECT username U_NAME, owner OBJ_OWNER,
object_name, object_type, s.osuser,
DECODE(l.block,
  0, 'Not Blocking',
  1, 'Blocking',
  2, 'Global') STATUS,
  DECODE(v.locked_mode,
    0, 'None',
    1, 'Null',
    2, 'Row-S (SS)',
    3, 'Row-X (SX)',
    4, 'Share',
    5, 'S/Row-X (SSX)',
    6, 'Exclusive', TO_CHAR(lmode)
  ) MODE_HELD
FROM gv$locked_object v, dba_objects d,
gv$lock l, gv$session s
WHERE v.object_id = d.object_id
AND (v.object_id = l.id1)
AND v.session_id = s.sid
--and s.username like 'NCS%'
--and d.object_name='SLA_REPORT_PERIOD'
ORDER BY username, session_id;


 

/* ¶ô ¹ß»ý »ç¿ëÀÚÈ®ÀÎ */
select distinct x.session_id,  a.serial#,d.object_name,a.machine,a.terminal,a.program, a.logon_time
--select  'alter system kill session ''' || a.sid || ',' || a.serial# || ''';'
from gv$locked_object x, gv$session a, dba_objects d
where x.session_id = a.sid
and x.object_id = d.object_id
order by logon_time;
;

###################  ÇöÀç Á¢¼ÓÀÚÀÇ sql ºÐ¼®
select distinct a.sid,a.serial#,a.machine,a.terminal,a.program,b.address,b.piece, b.sql_text
from v$session a, v$sqltext b
where a.sql_address = b.address
order by a.sid, a.serial#,b.address,b.piece;


###################  ³»°¡ Á¢¼ÓÇÑ ¼¼¼Ç Ã¼Å©
select distinct a.inst_id,a.status,a.sid,a.serial#,a.machine,a.terminal,a.program,b.address,b.piece, b.sql_text
from gv$session a, gv$sqltext b
where a.sql_address = b.address
and   a.osuser='duncan'
order by a.sid, a.serial#,b.address,b.piece; 

###################  PARALLEL DML

¿¹Á¦) SQL> alter session enable parallel dml ;
        SQL> update /*parallel (emp,4) */ emp
                 set sal = sal * 10 ;
                 
DELETE /*parallel (A,4) */  
FROM POW_CB.TB_CBCTMONBILLCUST A
WHERE NOT EXISTS
(SELECT 'X' FROM POW_CB.TB_CBCSUBSSTRUCDEV B WHERE A.SUBS_ID = B.SUBS_ID AND A.PD_CD=B.FRYMD AND A.FRYMD=B.PD_CD);	


PL-SQL ¾È¿¡¼­ ALTER ¸í·É ¾²·Á¸é

EXECUTE IMMEDIATE 'alter session enable parallel dml'

##################### º´·Ä DML parallel
alter table POW_OO.TB_OOSSPEEDDATA_P NOLOGGING;

alter session force parallel dml ;

INSERT /*+ parallel (TB_OOSSPEEDDATA_P,4) APPEND */ INTO POW_OO.TB_OOSSPEEDDATA_P
SELECT /*+ parallel (TB_OOSSPEEDDATA,4) */ * FROM POW_OO.TB_OOSSPEEDDATA
WHERE CHKDATE > SYSDATE - 62;





#####################  ´ë¿ë·® ÀÇ µ¥ÀÌÅÍ¸¦ »èÁ¦ÇÒ °æ¿ì ¾î¶»°Ô »èÁ¦ÇÏ´Â°¡? ´ÜÀ§ commit
ÇÑ¹øÀÇ SQL·Î DELETE¸¦ ÇÒ°æ¿ì »ç¿ëÀÚ PCÀÇ ¹®Á¦³ª DB TOOLÀÇ hangÀ¸·Î ¿¹±âÄ¡ ¾ÊÀº ÀÌÀ¯·Î failµÇ´Â »óÈ²ÀÌ ¹ß»ýÇÏ°Ô µÈ´Ù. ±×·³ ÀÌ¶§ ¿À¶óÅ¬ PMONÇÁ·Î¼¼½º¿¡ ÀÇÇØ RollbackÀÌ µÉ°ÍÀÌ¸ç »èÁ¦µÈ µ¥ÀÌÅÍ·® ¸¸Å­ ºÎÇÏ°¡ ¹ß»ýÇÏ°Ô µÈ´Ù.(°æÇè¿¡ ÀÇÇÏ¸é ÁøÂ¥ ºÎÇÏ°¡ ½ÉÇÒ°æ¿ì ·Î±×ÀÎµµ ¾ÈµÇ´Â »óÈ²µµ ÀÖ¾úÀ½)

±×·³ ÀÛ¾÷ ½ÇÆÐ·Î·Î ÀÎÇÑ ºÎÇÏ¸¦ ÃÖ¼ÒÈ­ÇÑ ¹æ¹ýÀ» ¹«¾ùÀÏ±î?
»èÁ¦ µÇ´Â Áß°£¿¡ commitÀ» ¼öÇàÇÏ¿© RollbackÀ¸·Î ÀÎÇÑ ºÎÇÏ¸¦ ÁÙÀÌ´Â ¹æ¹ýÀÏ°ÍÀÌ´Ù. 
¾Æ·¡¿Í °°ÀÌ PL/SQL¸¦ ÀÌ¿ëÇÏ¿© µ¥ÀÌÅÍ¸¦ »èÁ¦ÇÏ´Â °¡¿îµ¥ commitÀÌ ¼öÇàÇÏµµ·Ï ÀÛ¼ºÇÒ¼ö ÀÖ´Ù.

¹°·Ð Á÷Á¢ÀûÀ¸·Î ÇÑ¹øÀÇ DELETE¹®À¸·Î ¼öÇàÇÏ´Â ¼Óµµº¸´Ù´Â ´À¸±°ÍÀÌ´Ù. 
ÇÏÁö¸¸, µ¥ÀÌÅÍº£ÀÌ½º¿¡¼­ ÀÛ¾÷½Ã °¡Àå Å« °í·Á»çÇ×Àº ¾ÈÁ¤¼ºÀÌ´Ù. 
µû¶ó¼­ DELETE½Ã ÀÛ¾÷½ÇÆÐ·Î ÀÎÇÑ Àå¾Ö¿ä¼Ò¸¦ ¾È°í °¡´Â°Íº¸´Ù »èÁ¦½Ã°£À» ´À¸±Áö¾ðÁ¤ ¾ÈÁ¤ÀûÀ¸·Î ORA-01555 ¿¡·¯ÇÑ ¹ø ¹ß»ýÇÏ´Â°ÍÀÌ ÈÎ¾À ÁÁÀ»°ÍÀÌ´Ù. 

1. µ¥ÀÌÅÍ°¡ »èÁ¦µÈ °Ç¼ö¸¦ ¸ð´ÏÅÍ¸µÀº ¾î¶»°Ô ÇÏ´Â°¡?
¾Æ·¡½ºÅ©¸³Æ®¿¡¼­´Â  dbms_system ÆÐÅ°Áö¸¦ ¸¹ÀÌ »ç¿ëÇÏ°í ÀÖ´Ù. 
PL/SQLÀ» ½ÇÇàÇÏ¿´À» °æ¿ì dbms_output ³»¿ëÀº buffer¿¡ ÀúÀåµÇ°í, ½ÇÇà¿Ï·áÈÄ¿¡¾ß °ªº¸¿©ÁÖ±â ¶§¹®¿¡ Áß°£¿¡ ¾ó¸¸Å­ µ¥ÀÌÅÍ¸¦ »èÁ¦ÇÏ¿´´ÂÁö È®ÀÎÇÒ ¹æ¹ýÀÌ ¾øÀ¸¹Ç·Î, 
dbms_system ÆÐÅ°Áö¸¦ ÀÌ¿ëÇÏ¿© commitÀ» ¼öÇàÇÒ¶§ alert.log¿¡ ±â·ÏÇÏ¿© ¸ð´ÏÅÍ¸µÀ» ÇÒ¼ö ÀÖ´Ù.(»èÁ¦ ¿Ï·á ¿¹»ó½Ã°£µµ ±¸ÇÒ¼ö ÀÖ´Ù)

2. commit °Ç¼ö´Â ¾ó¸¸Å­ ÇÏ´Â°ÍÀÌ Àû´çÇÑ°¡?
µ¥ÀÌÅÍÀÇ °Ç¼ö¿¡ µû¶ó ´Ù¸£°ÚÁö¸¸, °æÇè¿¡ ÀÇÇÏ¸é 5¸¸°Ç ~ 10¸¸°ÇÀÌ Àû´çÇÑ°Í °°´Ù. ±× ÀÌ»ó ÀÌÇÏµµ µÇÁö¸¸, 
±× Á¤µµÀÇ °Ç¼ö·Î commitÀ» ¼öÇàÇÏ¿´¾îµµ ¾ÆÁ÷±îÁö Å« ¹®Á¦°¡ ¾ø±â ¶§¹®ÀÌ´Ù. 

3. »èÁ¦ Á¶°ÇÀ¸·Î ÀÎµ¦½º°¡ ÀÖÀ» °æ¿ì¿Í ¾øÀ» °æ¿ì »èÁ¦´Â ¾î¶»°Ô ÇÏ´Â°¡?
ÀÎµ¦½ºÀÇ À¯¹«´Â »èÁ¦ ´ë»ó µ¥ÀÌÅÍÀ» Ã£¾Æ°¡´Â °Ë»ö ½Ã°£ÀÇ Â÷ÀÌÀÌ´Ù. ÀÎµ¦½º ¾øÀ» °æ¿ì Å×ÀÌºí full scanÇÏ¹Ç·Î DB_FILE_MULTIBLOCK_READ_COUNT ÆÄ¶ó¹ÌÅÍ¸¦ Àû´çÇÑ °ªÀ¸·Î ÁÖ¸é ¾î´ÀÁ¤µµ ±Øº¹ÇÒ¼ö ÀÖ´Ù. 

4.  ¾Æ·¡ ½ºÅ©¸³Æ®·Î ÀÛ¾÷ÇÏ¿©µµ ¹®Á¦´Â ¹ß»ýµÇÁö ¾Ê´Â°¡?
À§¿¡¼­ Àá±ñ ¾ð±ÞÇÏ¿´Áö¸¸ cursorÀý¿¡ ÀÖ´Â select¹®À¸·Î Àå½Ã°£ fetchÇÏ°Ô µÇ¹Ç·Î ORA-01555 ¿¡·¯°¡ ¹ß»ýµÉ¼ö ÀÖ´Ù.
undo tablespace¸¦ Å©°Ô ´Ã·ÁÁÖ´ø°¡, undo_retention½Ã°£À» ÀÓ½ÃÀûÀ¸·Î Á¶Á¤ÇØ¾ß ÇÏÁö¸¸, Á¦ÀÏÁÁÀº ¹æ¹ýÀº undo»ç¿ë·®À» ¸ð´ÏÅÍ¸µÀ» ÇÏ¿© fullÀÌ ³ªÁö ¾Êµµ·Ï »èÁ¦ ÀÛ¾÷À» Á¶Á¤ÇÏ´Â °ÍÀÌ´Ù. 


 

set time on 
set timing on 
set echo on 
set serveroutput on 
  
DECLARE   
  CURSOR c1 IS   
         SELECT ROWID FROM SCOTT.TEST  
          WHERE DELETE_DATE < '200701'; -- µ¥ÀÌÅÍ »èÁ¦ Á¶°Ç ÁöÁ¤   
   nCNT number := 0;   
   sMSG varchar2(100) := ' '; 
BEGIN    
   BEGIN      
      FOR cur_rec IN c1 LOOP        
          delete from SCOTT.TEST        
          where rowid = cur_rec.rowid;        
            
           nCNT := nCNT + 1;        
          -- Áß°£ commit ¼öÇà        
          if mod(nCNT, 50000) =0 then         
               sMSG := ' '||to_char(sysdate,'MM-DD HH24:MI:SS')||to_char(nCNT,'999,999,990')||' Row Deleted'; 
               sys.dbms_system.ksdwrt(2, sMSG);         
               commit;        
          end if;      
      END LOOP;    
  
   EXCEPTION      
      WHEN OTHERS THEN        
          sMSG := ' '||to_char(sysdate,'YYYY-MM-DD HH24:MI:SS')||to_char(nCNT,'999,999,990')||' Row Deleted'; 
          sys.dbms_system.ksdwrt(2, sMSG);        
          DBMS_OUTPUT.PUT_LINE(sMSG ); 
          sMSG := ' '||to_char(sysdate,'YYYY-MM-DD HH24:MI:SS')||'-'||SQLERRM;        
          sys.dbms_system.ksdwrt(2, sMSG);    
              DBMS_OUTPUT.PUT_LINE(sMSG ); 
  END; 
  COMMIT;   
  DBMS_OUTPUT.PUT_LINE('Delete Cnt = ' || nCNT); 
END; 
/ 

############## lock type

System Type 	Description 	System Type 	Description

BL
Buffer hash table instance
	

NA..NZ
Library cache pin instance (A..Z = namespace)

CF
Control file schema global enqueue
	

PF
Password File

CI
Cross-instance function invocation instance
	

PI, PS
Parallel operation

CU
Cursor bind
	

PR
Process startup

DF
Data file instance
	

QA..QZ
Row cache instance (A..Z = cache)

DL
Direct loader parallel index create
	

RT
Redo thread global enqueue

DM
Mount/startup db primary/secondary instance
	

SC
System commit number instance

DR
Distributed recovery process
	

SM
SMON

DX
Distributed transaction entry
	

SN
Sequence number instance

FS
File set
	

SQ
Sequence number enqueue

HW
Space management operations on a specific segment
	

SS
Sort segment

IN
Instance number
	

ST
Space transaction enqueue

IR
Instance recovery serialization global enqueue
	

SV
Sequence number value

IS
Instance state
	

TA
Generic enqueue

IV
Library cache invalidation instance
	

TS
Temporary segment enqueue (ID2=0)

JQ
Job queue
	

TS
New block allocation enqueue (ID2=1)

KK
Thread kick
	

TT
Temporary table enqueue

LA .. LP
Library cache lock instance lock (A..P = namespace)
	

UN
User name

MM
Mount definition global enqueue
	

US
Undo segment DDL

MR
Media recovery


##################### ½º³À¼¦ µ¥ÀÌÅÍ snapshot ÀúÀå µñ¼Å³Ê¸®

DBA_HIST_SYS_TIME_MODEL

DBA_HIST_SYS_TIME_MODEL displays historical system time model statistics. This view contains snapshots of V$SYS_TIME_MODEL.

-- ³¯Â¥º°·Î ´©Àû db cpu (user-call cpu time ONLY)°ª ÃßÃâÄõ¸®

--°¢ ³¯Â¥º°·Î, ÀÌÀü ½º³À ³¯Â¥¿ÍÀÇ DB CPU °ªÀÇ DELTA(Â÷ÀÌ) ¸¦ ±¸ÇØ¼­ ¸ðµç ·Î¿ì¿¡ ´ëÇØ SUM ÇÏ¿© Ãâ·ÂÇÑ´Ù.
--°¢ ½º³ÀÀÇ DB CPU °ªÀº ´©Àû°ªÀÌ¹Ç·Î, À§¿Í °°ÀÌ DELTA °ªÀ» SUM ÇÏ¸é ³¯Â¥º° DB CPU °ªÀÌ ÃßÃâµÈ´Ù.

SELECT SNAP_DAY, ROUND(SUM(GAP)/1000000, 0) "Time(s)"
FROM (
SELECT SNAP_DAY, -- ¹Ù·Î ÀÌÀü ½º³ÀÀÇ ³¯Â¥°¡ ÇöÀç ½º³ÀÀÇ ³¯Â¥¿Í µ¿ÀÏÇÑ °æ¿ì¿¡´Â gap sum, ¾Æ´Ñ°æ¿ì 0
       CASE (LAG(SNAP_DAY, 1) OVER(ORDER BY SNAP_ID) )
         WHEN SNAP_DAY THEN GAP_VALUE
         ELSE 0
         END GAP
FROM (
SELECT TO_CHAR(SN.BEGIN_INTERVAL_TIME, 'YYYY-MM-DD') SNAP_DAY  -- °¢ ½º³À³¯Â¥
     , TM.VALUE -  LAG(TM.VALUE, 1) OVER(ORDER BY TM.SNAP_ID) GAP_VALUE  
-- °¢ ½º³ÀÀÇ cpu time delta°ª ¸¦ ±¸ÇÑ´Ù: °¢ ·Î¿ìÀÇ ´©Àû cpu time - ¹Ù·ÎÀÌÀü ½º³À ·Î¿ìÀÇ ´©Àû cpu time
     , SN.BEGIN_INTERVAL_TIME 
     , SN.SNAP_ID
FROM DBA_HIST_SYS_TIME_MODEL TM,  DBA_HIST_SNAPSHOT SN
WHERE TM.SNAP_ID = SN.SNAP_ID
  AND TM.INSTANCE_NUMBER = SN.INSTANCE_NUMBER
  AND TM.DBID = SN.DBID
  AND TM.STAT_NAME = 'DB CPU'
  AND SN.INSTANCE_NUMBER = :INSTANCE_NUMBER
  AND SN.BEGIN_INTERVAL_TIME > TO_DATE(:SDATE, 'YYYYMMDD' )   -- ³¯Â¥¹üÀ§ ÁöÁ¤
  AND SN.BEGIN_INTERVAL_TIME <= TO_DATE(:EDATE, 'YYYYMMDD') + 1
  AND TO_CHAR(SN.BEGIN_INTERVAL_TIME, 'HH24') >= :SHH24   -- ½Ã°£´ë ÁöÁ¤
  AND TO_CHAR(SN.BEGIN_INTERVAL_TIME, 'HH24') < :EHH24
  AND TO_CHAR(SN.BEGIN_INTERVAL_TIME, 'D') NOT IN ('1', '7') -- Åä/ÀÏ Á¦°Å
))
GROUP BY SNAP_DAY
ORDER BY SNAP_DAY
;




DB CPU: 
Amount of CPU time (in microseconds) spent on database user-level calls. This does not include the CPU time spent on instance background processes such as PMON.

##################### Oracle 8i, 9i startup and shutdown

* Oracle 8i startup

$svrmgrl
SVRMGRL>connect internal
SVRMGRL>startup
SVRMGRL>exit
$lsnrctl start

* Oracle 8i shutdown
$lsnrctl stop
$svrmgrl
SVRMGRL>connect internal
SVRMGRL>shutdown (or shutdown immediate)
SVRMGRL>exit

* Oracle 9i startup
$dgmgrl
DGMGRL>connect oracleid/oraclepasswd
DGMGRL>startup
DGMGRL>exit
$lsnrctl start

* Oracle 9i shutdown
$lsnrctl stop
$dgmgrl
DGMGRL>connect oracleid/oraclepasswd
DGMGRL>shutdown (or shutdown immediate)
DGMGRL>exit

[ÃâÃ³] Oracle 8i, 9i startup and shutdown |ÀÛ¼ºÀÚ Àººû°£´Þ



##################### ¸®½º³Ê ÆÐ½º¿öµå º¯°æ, ¼³Á¤, 
LSNRCTL> help
The following operations are available
An asterisk (*) denotes a modifier or extended command:

start               stop                status
services            version             reload
save_config         trace               spawn
change_password     quit                exit
set*                show*


¸®½º³Ê º°·Î ÆÐ½º¿öµå°¡ µû·Î ¼³Á¤µÇ¾îÀÖÀ½, (ÆÄÀÏ¿¡¼± ¾ÏÈ£È­µÇ¾îÀÖÀ¸¹Ç·Î, change_password ¸í·ÉÀ» ÅëÇØ¼­ º¯°æ)
LSNRCTL> change_password LI_LGDPOSP2_OSSDB2
Old password:
New password:
Reenter new password:
Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=ossdb2-vip)(PORT=2521)(IP=FIRST)))



##################################### temp Å×ÀÌºí½ºÆäÀÌ½º »ç¿ë ¼¼¼Ç
 select s.sid,s.username, u.tablespace, u.contents, u.extents, u.blocks*8/1024 MB
from v$session s, v$sort_usage u
where s.saddr=u.session_addr;

 select 'alter system kill session ''' || S.SID || ',' || S.SERIAL# || ''';',s.sid,s.username, u.tablespace, u.contents, u.extents, u.blocks*8/1024 MB
from v$session s, v$sort_usage u
where s.saddr=u.session_addr;


##################################### Æ¯Á¤¿ÀºêÁ§Æ® LOCK ¼¼¼Ç KILL
¿À¶óÅ¬ÀÇ Å×ÀÌºí¿¡ DML °ü·Ã ÀÛ¾÷À» ÇÏ´Ùº¸¸é ORA-00054 ¿¡·¯¸¦ Á¾Á¾ ¸¸³ª°Ô µÈ´Ù. (Á¾Á¾ ¸¸³ªÁö ¸»¾Æ¾ß ÇÏ³ª, ¾îÂ¿ ¼ö ¾øÀÌ ¸¸³ª´Â µí) ÀÎµ¦½º °ü·ÃµÈ ÀÛ¾÷ÀÇ Lock ÀÌ³ª ±âÅ¸ DML ÀÛ¾÷¿¡¼­ Lock ÀÌ °É¸° °æ¿ì ÀÌ°°Àº Áõ»óÀ» ¸¹ÀÌ ¸¸³¯ ¼ö ÀÖ´Ù.

STEP 1 : Lock ÀÌ ¹ß»ýÇÑ OBJECT È®ÀÎ
SELECT object_id, object_type
    FROM dba_objects
  WHERE object_name='Å×ÀÌºí / ÀÎµ¦½º ÀÌ¸§';

STEP 2 : Lock À» Àâ°í ÀÖ´Â ¼¼¼Ç ID È®ÀÎ
SELECT *
    FROM v$locked_object
  WHERE object_id='STEP1¿¡¼­ °Ë»öÇÑ object_id';

(¿À¶óÅ¬ »ç¿ëÀÚ ÀÌ¸§°ú ¼¼¼Ç ID ¸¦ ±â¾ïÇØ µÐ´Ù)

STEP 3 : Lock À» Àâ°í ÀÖ´Â ¼¼¼ÇÀÇ Serial ¹øÈ£ È®ÀÎ
SELECT sid, serial#, command, taddr
    FROM v$session
  WHERE sid='STEP2ÀÇ ¼¼¼Ç ID ¹øÈ£';

STEP 4 : ¼¼¼Ç °­Á¦ Á¾·á
ALTER SYSTEM KILL SESSION '<¼¼¼Ç ID, Serial#>';

STEP 5 : ¼¼¼Ç Á¾·á È®ÀÎ ¹× Rollback Ã¼Å©
SELECT used_ublk
    FROM v$transaction
  WHERE ADDR='<STEP3ÀÇ TADDR>';

Âü°í URL : http://kr.forums.oracle.com/forums/thread.jspa?messageID=1457903


############## lock À» °É°í ÀÖ´Â os ÇÁ·Î¼¼½º 
5. È¤½Ã 'ORA-00031: session marked for kill' ERROR°¡ ¹ß»ýÇÏ¸é     
         ÇØ´ç PROCESS¸¦ Ã£´Â´Ù.
( V$PROCESS ÀÇ SPID´Â SYSTEM PROCESS ID ·Î OS »óÀÇ PROCESS ID¸¦ ¸»ÇÑ´Ù.)    

SELECT P.SPID      
FROM V$PROCESS  P,  V$SESSION  S      
WHERE P.ADDR = S.PADDR    
AND S.SID = 200 
AND S.SERIAL#= 2319;   
     
set serveroutput off
accept v_sid :
accept v_serialno :
select spid from v$session s, v$process p
where  s.sid = &v_sid
and    s.serial# = &v_serialno
and    s.paddr = p.addr;


SVRMGR> connect internal
Connected.

1. ÇöÀç Á¢±ÙÇÏ°í ÀÖ´Â OBJECTÀÇ SID(SESSION ID) ¸¦ Ã£´Â´Ù.
   ÀÌ´Â V$ACCESS ÀÇ OWNER ³ª OBJECT ¸¦ ÀÌ¿ëÇÏ¿© Ã£´Â´Ù.

SVRMGR> select distinct sid from v$access where owner = 'DELPROC';
SID
----------
396
413
452                                                                     
3 rows selected.                                                                 

 

2. ÇöÀç Á¢±ÙÇÏ°í ÀÖ´Â SESSEION Áß¿¡ LOCK¿¡ °É·ÁÀÖ´Â°ÍÀ» Ã£´Â´Ù.                 
                                                

SELECT * FROM V$LOCK WHERE SID IN (396,413,452) ;                                       
                                

400B60D8        400B6188        396     TX      131119  1088    6      
0       6318    2
8B03C1CC        8B03C1E0        396     TM      8572    0       3       0
        6315    2
8B03BE6C        8B03BE80        396     TM      8634    0       3       0
        465     2
8B03BD94        8B03BDA8        396     TM      8638    0       3       0
        465     2
8B03BCBC        8B03BCD0        396     TM      8996    0       3       0
        6315    2
8B03BBE4        8B03BBF8        396     TM      8564    0       3       0
        467     2
8B03BB0C        8B03BB20        396     TM      8654    0       3       0
        465     2
8B03BAA0        8B03BAB4        396     TM      8560    0       3       0
        461     2
8B03BA34        8B03BA48        396     TM      7544    0       3       0
        6318    2


3. LOCK¿¡ °É¸° SESSION ÀÇ SERIAL#¿Í PADDR(PROCESS ADDRESS)¸¦ Ã£´Â´Ù.           
                                                        

SVRMGR> SELECT SID, SERIAL#, PADDR FROM V$SESSION                                     
                                
     2>  WHERE SID = 396 ;                                                         
        
SID        SERIAL#    PADDR                                                        
        
---------- ---------- --------                                                   
                
       396        250 8D1893B8                                                 
                
1 row selected.                                                                  

 

4. ÇØ´ç SESSIONÀ» KILL ÇÑ´Ù.                                                       
                

SVRMGR> ALTER SYSTEM KILL SESSION '396,250' ;                                   
                                


5. È¤½Ã 'ORA-00031: session marked for kill' ERROR°¡ ¹ß»ýÇÏ¸é     
         ÇØ´ç PROCESS¸¦ Ã£´Â´Ù.
( V$PROCESS ÀÇ SPID´Â SYSTEM PROCESS ID ·Î OS »óÀÇ PROCESS ID¸¦ ¸»ÇÑ´Ù.)    

SVRMGR> SELECT P.SPID      
     2>   FROM V$PROCESS  P,  V$SESSION  S      
     3>  WHERE P.ADDR = S.PADDR    
     4>    AND S.SID = 396 ;  
SPID    
---------       
1055    
1 row selected.   


6. Ã£Àº PROCESS¸¦ È®ÀÎÇÑ´Ù.

TIGER1/oracle/app/oracle/product/7.3.4>ps -ef |grep 1055
  oracle  1055     1 194 11:41:15 ?        102:02 oracleTIGER1 (LOCAL=NO)
  oracle  1331  1165  1 13:56:39 ttyp3     0:00 grep 1055


7.  ÇØ´ç PROCESS°¡ ÀÖÀ¸¸é OS »ó¿¡¼­ KILL ÇÑ´Ù.

TIGER1/oracle/app/oracle/product/7.3.4>kill -9 1055


8.  ÇØ´ç SESSIONÀÌ Á×¾ú´ÂÁö È®ÀÎÇÑ´Ù.
SELECT * FROM V$SESSION
 WHERE SID = 396
no row selected


9.  ÇØ´ç PROCESS°¡ ¾øÀ¸¸é ROLLBACKÇÏ´Â ÁßÀÌ¹Ç·Î ³¡³¯¶§±îÁö ±â´Ù¸®´Â ¼ö¹Û¿¡ ¾ø´Ù. 
                                
     ¾Æ´Ï¸é DB¸¦ SHOTDOWN Çß´Ù°¡ ´Ù½Ã STARTUP ÇÑ´Ù.                                       



10.  ÁÖÀÇ : OPS È¯°æ¿¡¼­ V$SESSION °ú V$PROCESSÀÇ Á¤º¸´Â ÇÑ½ÃÁ¡¿¡ ¼­·Î ´Ù¸£´Ù.       

         SERVER 2°³¸¦ ¸ðµÎ CHECK ÇØ º¸¾Æ¾ß ÇÔ


11. IP¹× USER ID (1998³â 9¿ù 29ÀÏ ÇöÀç)                                        

                OS USER  PASSWD  DB USER  PASSWD
        TIGER1  oracle  rose73  SYSTEM  MAN
        TIGER2  oracle  rose73  SYSTEM  MAN
        LION1   oracle  ? (ÀÌÈÆ) SYSTEM  MAN
        LION2   oracle  ? (ÀÌÈÆ) SYSTEM  MAN
        DRAGON  oracle  emforhs1        SYSTEM  MAN
        LEOPARD oracle  rose73  SYSTEM  MAN 
        
        
        
        
############## Æ¯Á¤ Å×ÀÌºí¿¡ lock À» °É°í ÀÖ´Â ¼¼¼Ç Ã£±â
emp Å×ÀÌºí¿¡ lockÀ» °É°í ÀÖ´Â sessionÀ» Ã£´Â´Ù. 

$ sqlplus system/manager 
select a.sid, a.serial#, 'alter system kill session ''' || a.sid || ',' || a.serial# || ''';'
from v$session a, v$lock b, dba_objects c 
where a.sid=b.sid and 
b.id1=c.object_id and 
b.type='TM' and 
c.object_name='TB_OOSEDUTVSPEEDDATA_PC_INFO'; 

select a.sid, a.serial#, p.spid
from v$session a, v$lock b, dba_objects c , v$process p 
where a.sid=b.sid and 
b.id1=c.object_id and 
p.addr(+) = a.paddr and
b.type='TM' and 
c.object_name='TB_OSZ_DSV_RQ_DITMS'; 

############## DB LOCK ÇØÁ¦ ÀýÂ÷

1. SM/@lockcheck.sql ¼öÇà 

ÁýÇà°ü°³¹ß:SQL>@lockcheck.sql

USERNAME    SID    SERIAL# OSUSER   LOCK_TYPE       MODE_HELD   MODE_REQUE LOCK_ID1 LOCK_ID2
---------- ---- ---------- -------- --------------- ----------- ---------- -------- --------
              5          1 oracle   Temp Segment    Row-X (SX)  None       2        1
STIS        108       1153 oracle   Transaction     Exclusive   None       65566    28497
STIS         38       7452 oracle   Transaction     None        Share      131082   38038
STIS        131       1375 oracle   Transaction     None        Share      131082   38038
STIS        160         32 oracle   Transaction     None        Share      131082   38038
STIS        119       2353 oracle   Transaction     Exclusive   None       131082   38038
STIS        111       1076 oracle   Transaction     None        Share      131082   38038
STIS        108       1153 oracle   Transaction     None        Share      131082   38038
STIS        110        443 oracle   Transaction     None        Share      131082   38038
STIS        160         32 oracle   Transaction     Exclusive   None       196624   38069
STIS        131       1375 oracle   Transaction     Exclusive   None       393231   38074
STIS        111       1076 oracle   Transaction     Exclusive   None       524315   37994
STIS         38       7452 oracle   Transaction     Exclusive   None       589839   38044
STIS        110        443 oracle   Transaction     Exclusive   None       655394   28508

14 rows selected.

2. @g/ SID SERIAL# À§ ·Î¿ìº°·Î ¼öÇàÇÏ¸é¼­ spid È®ÀÎ


3. @gsql spid ¼öÇàÇÏ¿© °ü·ÃµÈ Äõ¸®¹®À» È®ÀÎ

4. 3¹ø È®ÀÎ°á°ú ÇØÁ¦ ´ë»ó Äõ¸®ÀÎ °æ¿ì @gkill sid, #serial ·Î ¼¼¼ÇÀ» KILL
@gkill 108, 1153
S

############### undo Å×ÀÌºí½ºÆäÀÌ½º »ç¿ëÀ² (expried ¿µ¿ªµµ »©¾ß ÇÔ - undo retention ÀÌ Áö³ª¼­ µ¤¾î½áµµ µÇ´Â ¿µ¿ª)


select x.tablespace_name,
  x.total_MB,
  (x.total_MB-y.expired_MB-z.free_MB) used_MB ,
  (y.expired_MB+z.free_MB) free_MB,
  round((x.total_MB-y.expired_MB-z.free_MB)/x.total_MB, 4)*100 pct_used
from (
    select tablespace_name,
      sum(bytes)/1024/1024 total_MB
    from dba_data_files
    where tablespace_name like '%UNDO%'
    group by tablespace_name ) x,
    (
    select tablespace_name,
      round(sum(bytes)/1024/1024, 3) expired_MB
    from dba_undo_extents
    where status = 'EXPIRED'
    group by tablespace_name ) y,
(
    select tablespace_name,
      round(sum(bytes)/1024/1024, 3) free_MB
    from dba_free_space
    group by tablespace_name ) z
where x.tablespace_name = y.tablespace_name(+)
  and y.tablespace_name = z.tablespace_name
  and (x.total_MB-y.expired_MB-z.free_MB) >= 0.9 * x.total_MB
  and (y.expired_MB+z.free_MB) < 1000
  
  

############### Å×ÀÌºí½ºÆäÀÌ½º »ç¿ëÀ²

SELECT c.TABLESPACE_NAME,
       ROUND(SUM(A.BYTES) / (1024 * 1024)) "total M",
       ROUND(SUM(B.FREES) / (1024 * 1024)) "free M",
       ROUND(SUM(A.BYTES) / (1024 * 1024 * 1024)) "total G",
       ROUND(SUM(B.FREES) / (1024 * 1024 * 1024)) "free G",       
       ROUND(ROUND(SUM(B.FREES) / (1024 * 1024)) /ROUND(SUM(A.BYTES) / (1024 * 1024)) *100) "free %",
       --ROUND((ROUND(SUM(A.BYTES) / (1024 * 1024)) - ROUND(SUM(B.FREES) / (1024 * 1024))) / ROUND(SUM(A.BYTES) / (1024 * 1024)) * 100) "utilization %",
       ROUND(((SUM(A.BYTES) - SUM(B.FREES)) / (1024 * 1024)) / (SUM(A.BYTES) / (1024 * 1024)) * 100) "utilization %"
       --c.CONTENTS,
       --c.LOGGING,
       --c.ALLOCATION_TYPE,
       --c.SEGMENT_SPACE_MANAGEMENT       
FROM   (SELECT FILE_ID,
               TABLESPACE_NAME,
               SUM(BYTES) BYTES
        FROM   DBA_DATA_FILES
        GROUP BY FILE_ID,
               TABLESPACE_NAME) A,
       (SELECT TABLESPACE_NAME,
               FILE_ID,
               SUM(BYTES) FREES
        FROM   DBA_FREE_SPACE
        GROUP BY TABLESPACE_NAME,
               FILE_ID) B,
        dba_tablespaces C
WHERE A.TABLESPACE_NAME = B.TABLESPACE_NAME(+)
AND   A.FILE_ID = B.FILE_ID(+)
and   a.tablespace_name(+) = c.tablespace_name 
GROUP BY c.TABLESPACE_NAME,
       c.CONTENTS,
       c.LOGGING,
       c.ALLOCATION_TYPE,
       c.SEGMENT_SPACE_MANAGEMENT
order by 1;


############### Raw Device ¿¡ µ¥ÀÌÅÍÆÄÀÏ Ãß°¡ ÀýÂ÷

1. ½Ã½ºÅÛÆÄÆ®¿¡¿¡ raw device Ãß°¡ ¿äÃ»
2. @tbsp_space   TS »ç¿ëÀ² Ã¼Å©
3. »ç¿ëÀ²ÀÌ ¸¹Àº TS¿¡ µ¥ÀÌÅÍÆÄÀÏ Ãß°¡.
4. SELECT FILE_NAME FROM DBA_DATA_FILES
5. ¸¶Áö¸· ÆÄÀÏ ÀÏ·Ã¹øÈ£ + 1 ·Î »ý¼º
6. FILE SIZE ´Â RAW DEVICE »ý¼ºÇÑ SIZE - 4 ÀÌÇÏ (RAW DEVICEÀÇ Çì´õ°¡ 4¹ÙÀÌÆ®¸¦ Â÷Áö)
7. »ý¼º ÈÄ !ls ÆÄÀÏ¸í, Á¸ÀçÇÏ´ÂÁö È®ÀÎ ÆÄÀÏ¸í¤· ¾Õ¿¡ r Ãß°¡  ex) rdf_cdc_35
8. @tbsp_space »ç¿ëÀ² ³»·Á°¬´ÂÁö È®ÀÎ
9. f_util.lst ¿¡¼­ df, rdf ¸íÀ¸·Î grep


############## ½ÃÄö½º Ãß°¡
DROP SEQUENCE SCRJAPPW.PJUBINGAMTONGSEQ;

CREATE SEQUENCE SCRJAPPW.PJUBINGAMTONGSEQ
  START WITH 41
  MAXVALUE 308915775
  MINVALUE 1
  CYCLE
  CACHE 20
  NOORDER;




############### Å×ÀÌºí Ãß°¡

CREATE TABLE TB_RA405 (					
REGT_VER	VARCHAR2(2)	NOT NULL
REGT_NO	VARCHAR2(4)	NOT NULL
NOTI_CLS_CD	VARCHAR2(5)	NOT NULL
NOTI_YEAR	VARCHAR2(4)	NOT NULL
NOTI_SEQ	NUMBER(9,0)	NOT NULL
CRUD_FLAG	VARCHAR2	(1)
)
PCTFREE  10
PCTUSED  40
TABLESPACE TS_WEB_DATA1
STORAGE (
INITIAL 1024K
NEXT 1024K
  MINEXTENTS  1
  MAXEXTENTS  2147483645
  PCTINCREASE 0
  )
;


#################3  Á¶È¸°á°ú Áßº¹ Á¦°Å

$cat *.lst > all.lst 

$sort -u all.lst > all_sort.lst


######## process parameter ¼³Á¤
show parameters processes;


NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
aq_tm_processes                      integer     0
db_writer_processes                  integer     1
job_queue_processes                  integer     0
log_archive_max_processes            integer     2
processes                            integer     3000
SQL> show parameter pfile;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
spfile                               string

########
v$parameter
v$spparameter

select name,value from v$parameter where name like '%DICTIONARY%'
select name,value from v$spparameter where name like '%DICTIONARY%'


################################ ¿À¶óÅ¬ ÇÁ·Î½ÃÀú ½ÇÇà

ToadÀÌ¿ë ½Ã
---------------------------------------------------------------------------------
DECLARE
 o_returnCode  VARCHAR2(1);
 o_returnMsg  VARCHAR2(40);
BEGIN 
  cancProcess('20051015','0651','A','11024320','Y',o_returnCode,o_returnMsg);
END;

SQLPLUS ÀÌ¿ë½Ã
-------------------------------------------------------------------------------------

set suboutput on;
                variable o_returnCode varchar2;
    variable o_returnMsg varchar2;
    
exec cancProcess('20051015','0651','A','11024320','Y',:o_returnCode,:o_returnMsg)


o_returnCode   out varchar2,
o_returnMsg    out varchar2)
is

#############################  ½ÃÄö½º ¹øÈ£ ¸®™VÇÏ´Â ÇÁ·Î½ÃÀú

CREATE OR REPLACE PROCEDURE DPTOW_OSW."RESET_SEQ_N" ( p_seq_name in varchar2, t_val in number )
is
    l_val number;
    min_val number;
    inc_val number;
begin
    select min_value, increment_by, last_number into min_val, inc_val, l_val
      from user_sequences where sequence_name = p_seq_name;

    if (min_val < t_val) and (l_val != t_val) then
        execute immediate
        'alter sequence ' || p_seq_name || ' increment by ' || to_char(t_val-l_val) ||'';

        execute immediate
        'select ' || p_seq_name || '.nextval from dual' INTO l_val;

        execute immediate
        'alter sequence ' || p_seq_name || ' increment by ' || to_char(inc_val)  ||'';
    end if;
end reset_seq_n;
/

GRANT EXECUTE ON DPTOW_OSW.RESET_SEQ_N TO DPTOSW;

CREATE SYNONYM DPTOSW.RESET_SEQ_N FOR DPTOW_OSW.RESET_SEQ_N;


################################# Æ¯Á¤ ¿ÀºêÁ§Æ® PURGE
-- Æ¯Á¤ SQL Cursor¸¦ PurgeÇÏ°íÀÚ ÇÒ °æ¿ì
select address, hash_value from v$sqlarea where sql_text like '....';
ADDRESS                 HASH_VALUE
------------              ---------------
2F4651EC                 3900782439

exec sys.dbms_shared_pool.purge('2F4651EC.3900782439', 'C');

½ÇÇàÀº Àß µÇ´Âµ¥, ÇØ´ç ·¹ÄÚµå°¡ °è¼Ó »ç¶óÁöÁö ¾Ê°í Á¶È¸µÊ.


-- Æ¯Á¤ Procedure¸¦ PurgeÇÏ°íÀÚ ÇÒ °æ¿ì
exec sys.dbms_shared_pool.purge('OWI.TEST_PROC','P');

Á¤¸» PURGE µÇ¾ú´ÂÁö È®ÀÎÇÏ´Â ¹æ¹ý?


SELECT * FROM V$DB_OBJECT_CACHE
WHERE 1=1
AND LOCKS=0
AND NAME LIKE 'PG%'
AND NAME = 'PG_OSWPC_MAINWRKACP';
AND OWNER='DPTOSW';



http://wiki.ex-em.com/index.php/DBMS_SHARED_POOL.PURGE


#################################  [ÃâÃ³] [ORACLE]SQL*Plus¿¡¼­ Æ¯¼ö¹®ÀÚ INSERTÇÏ±â (&)|ÀÛ¼ºÀÚ ÀÌÁö

¿À¶óÅ¬ÀÇ SQL*Plus¿¡¼­´Â Substitution VariableÀ» ÀÌ¿ëÇÏ¿© ¿ÜºÎ¿¡¼­ °ªÀ» ÀÔ·Â ÇÒ ¼ö ÀÖµµ·ÏÇÏ°í ÀÖ´Ù.
±× Default ¹®ÀÚ¸¦ & ·Î »ç¿ëÇÏ°í ÀÖÀ¸¸ç ÀÌ &°¡ »ç¿ëµÇ¸é SQL*Plus´Â »ç¿ëÀÚ¿¡°Ô ÇØ´çÇÏ´Â °ªÀ» ÀÔ·ÂÇÏµµ·Ï ±â´Ù¸®°í ÀÖ°Ô µÈ´Ù.

¿¹¸¦ µé¾î
INSERT INTO TEMPTBL (COL1) VALUES ('YOU&I')¸¦ ½ÇÇà ÇÏ°ÔµÇ¸é SQL*Plus´Â
Enter value for i: ¿Í °°Àº ¸Þ½ÃÁö¸¦ ³ªÅ¸³»¸ç °ªÀ» ÀÔ·ÂÇÒ¶§ ±îÁö ±â´Ù¸®°Ô µÈ´Ù.

±×·¯³ª ½ÇÁ¦´Â 'YOU&I'¶ó´Â °ªÀÌ ÀüÃ¼ÀûÀ¸·Î ÀÔ·Â µÇ¾îÁ®¾ß ÇÏ´Â°Í°ú °°ÀÌ Æ¯¼ö ¹®ÀÚ¸¦ INSERT, UPDATEÇØ¾ß ÇÏ´Â °æ¿ì°¡ ¹ß»ýÇÏ°Ô µÇ°í UPDATE, DELETEµîÀÇ WHEREÀý¿¡µµ °ª¿¡ &µî Æ¯¼ö
¹®ÀÚ°¡ ÀÖ´Ù¸é ¿À·ù ¶Ç´Â ¿øÇÏÁö ¾Ê´Â °á°ú¸¦ ¾ò°Ô µÈ´Ù.

¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡¦¡

ÀÌ·¯ÇÑ ¹®Á¦¸¦ ÇØ°áÇÏ±â À§ÇÏ¿© ´ÙÀ½ÀÇ 3°¡Áö ¹æ¹ýÀÌ ÀÖÀ» ¼ö ÀÖ´Ù.

1. Substitution Variable ±â´ÉÀ» Áß´Ü½ÃÅ² ÈÄ INSERT, UPDATE, DELETEÇÑ´Ù.

   SET DEFINE OFF ¶Ç´Â SET SCAN OFF¸í·ÉÀ» ½ÇÇàÇÏ¿© Substitution Variable±â´ÉÀ»
   Áß´Ü ½ÃÅ²´Ù.
   ¿¹Á¦)
   SQL> set define off
   SQL> INSERT ITO TEMPTBL (COL1) VALUES ('YOU&I');
   1 row created.
   SQL> SELECT * FROM TEMPTBL;
 
   COL1
   ---------------
   YOU&I

2. Substitution Variable¸¦ ´Ù¸¥ ¹®ÀÚ·Î ÁöÁ¤ÇÏ¿© Ã³¸®ÇÑ´Ù.

   SET DEFINEÀ» ÀÌ¿ëÇÏ¿© Substitution Variable ¹®ÀÚ¸¦ ´Ù¸¥ ¹®ÀÚ·Î ÁöÁ¤ÇÑ´Ù.

   ¿¹Á¦)
  
   SQL> set define #
   SQL> INSERT ITO TEMPTBL (COL1) VALUES ('YOU&I');
   1 row created.

   SQL> SELECT * FROM TEMPTBL;
  
   COL1
   ---------------
   YOU&I


3. ESCAPE ¹®ÀÚ¸¦ ÁöÁ¤ÇÏ¿© Æ¯¼ö¹®ÀÚ¸¦ Æ¯¼ö ±â´ÉÀÌ ¾Æ´Ñ ¹®ÀÚ·Î ÀÎ½ÄÇÏµµ·Ï ÇÑ´Ù.

   ±âº»ÀûÀ¸·Î SQL*Plus´Â \(Back Slash) ¹®ÀÚ¸¦ ESCAPE¹®ÀÚ·Î ÁöÁ¤µÇ¾î ÀÖÀ¸¸ç
   ESCAPE±â´ÉÀº OFF·Î ÁöÁ¤µÇ¾î ÀÖ´Ù.
  
   (SHOW ESCAPE ¸í·ÉÀ» ÀÌ¿ëÇÏ¿© ESCAPE ON/OFF »óÅ×¸¦ ¾Ë ¼ö ÀÖ´Ù
   SQL> show escape
   escape OFF <---- ESCAPE Mode°¡ OFF µÇ¾î ÀÖ´Ù.)
  
   SET ESCAPE ON ¸í·ÉÀ» ÀÌ¿ëÇÏ¿© ESCAPE¹®ÀÚ¸¦ ¾µ ¼ö ÀÖµµ·Ï ÇÑ´Ù.

   SQL> set escape on
   SQL> show escape
   escape "\" (hex 5c) <---- ESCAPE Mode°¡ µ¿ÀÛÁßÀÌ¸ç \ À¸·Î ÁöÁ¤µÇ¾î ÀÖ´Ù.
   SQL> INSERT ITO TEMPTBL (COL1) VALUES ('YOU\&I');
  
   1 row created.

   SQL> SELECT * FROM TEMPTBL;
  
   COL1
   ---------------
   YOU&I
   
   


#################### Carriage Return & Line Feed
Programming 2012/09/23 00:00

Carriage Return
: Ä¿¼­¸¦ ±× ÁÙÀÇ ¸Ç ¾ÕÀ¸·Î ¿Å±â´Âµ¥ »ç¿ëµÇ´Â ¼­½Ä Á¦¾î ¹®ÀÚ·Î, ¾Æ½ºÅ° ¹®ÀÚ ¼Â¿¡¼­ ½ÊÁø¼ö "13" ¿¡ ÇØ´ç

Line Feed
: Ä¿¼­¸¦ ÇÑ ÁÙ ¹ØÀ¸·Î ³»¸®´Âµ¥ »ç¿ëµÇ´Â ¼­½Ä Á¦¾î ¹®ÀÚ·Î, ¾Æ½ºÅ° ¹®ÀÚ ¼Â¿¡¼­ ½ÊÁø¼ö "10" ¿¡ ÇØ´ç


¿£ÅÍ(Enter)°ªÀº, Carriage ReturnÀÌ ¸ÕÀú ¹ß»ýÇÏ°í Line Feed°¡ ³ªÁß¿¡ ¹ß»ýÇÕ´Ï´Ù.
¸ðµç ÁÙ¹Ù²Þ¿¡ Carriage Return ÀÌ Ç×»ó ÇÊ¿äÇÏÁö´Â ¾Ê½À´Ï´Ù.


[»ç¿ë¿¹]
- VB	: vbCrLf
- ASP	: chr(13) & chr(10)
- C#	: \r\n
- SQL	: char(13) + char(10)

--CHR(13)||CHR(10)
select 'aaaa' || CHR(13)||CHR(10) ||'bb' from dual;



################################ sort_area_size

http://blog.naver.com/tosaymin?Redirect=Log&logNo=20018747491

sort_area_size : ÇÁ·Î¼¼½ºº°·Î »ç¿ëÇÏ´Â SORT ¸¦ À§ÇÑ ¸Þ¸ð¸®¿µ¿ª »çÀÌÁî, ÀÌ°ÍÀ» ¿À¹öÇÏ¸é TEMP TABLESPACE »ç¿ëÇÔ

################################ ÇÁ·Î½ÃÀú ÆÐÅ°Áö ÇÔ¼ö ºä ¼Ò½º

DBA_SOURCE

¼Ò½º»ó Æ¯Á¤ ÅØ½ºÆ® °Ë»ö

SELECT 'FC_INSA_ORGN_TO_SAP_DPTCD',OWNER,NAME,TYPE,LINE,TEXT FROM DBA_SOURCE
WHERE TEXT LIKE '%FC_INSA_ORGN_TO_SAP_DPTCD%'
UNION ALL
SELECT 'FC_VTRL_DPTCD_TO_ORGN_DPTCD',OWNER,NAME,TYPE,LINE,TEXT FROM DBA_SOURCE
WHERE TEXT LIKE '%FC_VTRL_DPTCD_TO_ORGN_DPTCD%';


DBA_SOURCE ¿ø°Ý À¸·ÎºÎÅÍ ¼Ò½º °¡Á®¿À±â

SELECT TEXT FROM (

SELECT '1' AS "ORD", LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' IS',TEXT) AS "TEXT"
FROM DBA_SOURCE@DL_LGDPOSD_MONITOR
WHERE NAME = 'PG_OSOSO_XPDBIZ_CERT'
AND OWNER = 'DPTOSO'
AND TYPE IN ('PROCEDURE')
UNION ALL
SELECT '2' AS "ORD", 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = 'PG_OSOSO_XPDBIZ_CERT'
        AND    OWNER = 'DPTOSO'
        AND    OBJECT_TYPE IN ('PROCEDURE')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
UNION ALL
SELECT '3' AS "ORD", LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' IS',TEXT) AS "TEXT"
FROM DBA_SOURCE@DL_LGDPOSD_MONITOR
WHERE NAME = 'PG_OSOSO_XPDBIZ_CERT'
AND OWNER = 'DPTOSO'
AND TYPE IN ('FUNCTION')
UNION ALL
SELECT '4' AS "ORD", 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = 'PG_OSOSO_XPDBIZ_CERT'
        AND    OWNER = 'DPTOSO'
        AND    OBJECT_TYPE IN ('FUNCTION')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
UNION ALL
SELECT '5' AS "ORD", LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' IS',TEXT) AS "TEXT"
FROM DBA_SOURCE@DL_LGDPOSD_MONITOR
WHERE NAME = 'PG_OSOSO_XPDBIZ_CERT'
AND OWNER = 'DPTOSO'
AND TYPE IN ('PACKAGE')
UNION ALL
SELECT '6' AS "ORD", 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = 'PG_OSOSO_XPDBIZ_CERT'
        AND    OWNER = 'DPTOSO'
        AND    OBJECT_TYPE IN ('PACKAGE')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
UNION ALL
SELECT '7' AS "ORD", LINE, DECODE(LINE,1,'CREATE OR REPLACE ' || TYPE || ' ' || OWNER || '.' || NAME || ' IS',TEXT) AS "TEXT"
FROM DBA_SOURCE@DL_LGDPOSD_MONITOR
WHERE NAME = 'PG_OSOSO_XPDBIZ_CERT'
AND OWNER = 'DPTOSO'
AND TYPE IN ('PACKAGE BODY')
UNION ALL
SELECT '8' AS "ORD", 1 AS "LINE", SLASH
FROM   (SELECT '1' AS "KEY"
        FROM   DBA_OBJECTS
        WHERE  OBJECT_NAME = 'PG_OSOSO_XPDBIZ_CERT'
        AND    OWNER = 'DPTOSO'
        AND    OBJECT_TYPE IN ('PACKAGE BODY')) A,
       (SELECT '1' AS "KEY",
               '/' AS "SLASH"
        FROM   DUAL) B
WHERE  A.KEY=B.KEY
)

############################## ½Ã½ºÅÛ Æ®·¹ÀÌ½º  TRACE
alter session set events 'immediate trace name systemstate level 266';

Àå¾Ö¸ñ·ÏÁ¶È¸°¡ ¸ô¸±¶§ ¿ä°Å ¼öÇàÇØÁÖ½Ã¸é µÅ¿©~ 

2-3¹øÀº ÇØ´Þ¶ó°í ÇÏ½Ã³×¿ä~



########################

(°¡) ÇÑÂÊ INSTANCE ¸¦ SHUTDOWN IMMEDIATE
(³ª) Ã¢À» ÇÏ³ª ´õ ¶ç¿ì°í, SHUTDOWN µÈ ÃøÀÇ alert.log ¸¦ 'tail -f' ¸í·É¾î·Î ¸ð´ÏÅÍ¸µ½ÃÀÛÇÕ´Ï´Ù.
(´Ù) instance ¸¦ startup ½ÃÅµ´Ï´Ù.
(¶ó) ´ÙÀ½ message °¡ alertlog ¿¡ ±â·ÏµÊÀÌ È®ÀÎµÇ¸é.
"Picked broadcast on commit scheme to generate SCNs"
(¸¶) Ã¢À» ÇÏ³ª ´õ ¶ç¿î µÚ, ´ÙÀ½°ú °°Àº ¹æ¹ýÀ» »ç¿ëÇÏ¿© systemstate dump ¸¦ ¼öÁýÇÕ´Ï´Ù.
SQL> connect / as sysdba
SQL> oradebug setmypid
SQL> oradebug unlimit
SQL> oradebug hanganalyze 3
SQL> oradebug dump systemstate 10
++++ wait for 20-30 seconds and issue the above command again.
SQL> oradebug hanganalyze 3
SQL> oradebug dump systemstate 10
++++ wait for 20-30 seconds and issue the above command again.
SQL> oradebug hanganalyze 3
SQL> oradebug dump systemstate 10
(¹Ù) UDUMP ¿¡ »ý¼ºµÈ TRACEFILE À» upload ÇØÁÖ¼¼¿ä.




#################################  ÄÃ·³ UNUSED ¼³Á¤
µ¥ÀÌÅÍ°¡ Å« Å×ÀÌºíÀÇ °æ¿ì LOCK ¾øÀÌ DROP°ú °°Àº È¿°ú

alter table DPOW_OSF.TB_OSF_FRAME_LNLT set unused (CONF_USG_CD);


#####################  DB_NAME°ú SID È®ÀÎ ¹æ¹ý
 
Oracle SID¸¦ ¾Ë·Á¸é ´ÙÀ½ Ã³·³ ÁúÀÇ ÇÕ´Ï´Ù.

SQL> select instance from v$thread;

INSTANCE
----------------
LSMS

Oracle DB_NAMEÀº ´ÙÀ½ Ã³·³ ÁúÀÇ ÇÏ±¸¿ä...

SQL> select name from v$database;

NAME
---------
LSMS

ORACLE_SID³ª DB_SID´Â °°Àº °ªÀ» °¡¸®Å°¸ç v$thread¿¡¼­ È®ÀÎ °¡´É!!
DB_NAMEÀº v$database¿¡¼­ È®ÀÎ °¡´É!!!


# service_name È®ÀÎ service name
select name, value from v$parameter where name like '%service%';





#################################  ÆÐÅ°Áö ÄÄÆÄÀÏ ¹× INVALID Á¶È¸
set verify off
set space 0
set heading off
set feedback off
set pages 1000
spool obj_comp.sql
select 'set termout on' from dual;
select 'set echo on' from dual;

SELECT 'ALTER PACKAGE '||OWNER||'.'||OBJECT_NAME||' COMPILE;'
FROM   DBA_OBJECTS
WHERE  STATUS <> 'VALID'
--AND OBJECT_NAME <> 'TOSP_DEBT_CSS_CONNECT_PKG'
AND    OBJECT_TYPE = 'PACKAGE'
AND    (OWNER LIKE 'DPO%'
        OR     OWNER LIKE 'DABOS%')
AND    OWNER <> 'DPOSMIG'
UNION ALL
SELECT 'ALTER PACKAGE '||OWNER||'.'||OBJECT_NAME||' COMPILE BODY;'
FROM   DBA_OBJECTS
WHERE  STATUS <> 'VALID'
--AND    OBJECT_NAME <> 'TOSP_DEBT_CSS_CONNECT_PKG'
AND    OBJECT_TYPE='PACKAGE BODY'
AND    (OWNER LIKE 'DPO%'
        OR     OWNER LIKE 'DABOS%')
AND    OWNER <> 'DPOSMIG';
   
   
SELECT * 
FROM   DBA_OBJECTS
WHERE  STATUS <> 'VALID'
AND    (OWNER LIKE 'DPO%'
        OR     OWNER LIKE 'DABOS%')
   
SELECT 'ALTER PACKAGE '||OWNER||'.'||OBJECT_NAME||' COMPILE BODY;'
FROM   DBA_OBJECTS
WHERE  STATUS <> 'VALID'
--AND OBJECT_NAME <> 'TOSP_DEBT_CSS_CONNECT_PKG'
AND    OBJECT_TYPE IN ('PACKAGE','PACKAGE BODY','PROCEDURE','FUNCTION')
AND    (OWNER LIKE 'DPO%'
        OR     OWNER LIKE 'DABOS%')
AND    OWNER <> 'DPOSMIG';

SELECT 'ALTER PROCEDURE '||OWNER||'.'||OBJECT_NAME||' COMPILE;'
FROM   DBA_OBJECTS
WHERE  STATUS <> 'VALID'
AND    OBJECT_TYPE = 'PROCEDURE'
AND    OWNER='ITAMFDS';

   
 ÆÐÅ°Áö ¹Ý¿µ ÈÄ ¿ø ¿ÀºêÁ§Æ®¿Í SYNONYM TIMESTAMP ºÒÀÏÄ¡°Ç Á¶È¸
 
select do.obj# d_obj,do.name d_name, do.type# d_type,
po.obj# p_obj,po.name p_name,
to_char(p_timestamp,'DD-MON-YYYY HH24:MI:SS') "P_Timestamp",
to_char(po.stime ,'DD-MON-YYYY HH24:MI:SS') "STIME",
decode(sign(po.stime-p_timestamp),0,'SAME','*DIFFER*') X
from sys.obj$ do, sys.dependency$ d, sys.obj$ po
where P_OBJ#=po.obj#(+)
and D_OBJ#=do.obj#
and do.status=1 /*dependent is valid*/
and po.status=1 /*parent is valid*/
and po.stime!=p_timestamp /*parent timestamp not match*/
order by 2,1;
    
           
################################# dbms_redefinition ÆÐÅ°Áö ÀÌ¿ëÇÑ ¿Â¶óÀÎ Å×ÀÌºí ±¸¼ºº¯°æ (ÄÃ·³¼ø¼­ º¯°æ µî)
grant execute on dbms_redefinition to SCRJFMS;

conn scrjfms/scrjfms

# ÆÐÅ°ÁöÀÌ¿ë °¡´É¿©ºÎ Ã¼Å©
exec dbms_redefinition.can_redef_table('SCRJFMS', 'TB_FA131');

# CREATE TMP TBL
CREATE TABLE TB_FA131_TMP(
SEQ     VARCHAR2        (5)     NOT NULL,
SEQ_CLS VARCHAR2        (1)     NOT NULL   
)

# ±âÅ¸ ¿ÀºêÁ§Æ® »ý¼º

# REDEF
exec dbms_redefinition.start_redef_table('SCRJFMS','TB_FA131','TB_FA131_TMP', 'SEQ_CLS SEQ, SEQ SEQ_CLS');

# SYNC
exec dbms_redefinition.sync_interim_table('SCRJFMS','TB_FA131','TB_FA131_TMP');

# CHECK
SELECT * FROM TB_FA131;

# FINISH
exec dbms_redefinition.finish_redef_table('SCRJFMS','TB_FA131','TB_FA131_TMP');

# DROP TMP
DROP TABLE TB_FA131_TMP;


######## µðºñ¸µÅ©
conn scrjv2t01/scrjv2t01@v2db2


2. ½ºÅ°¸¶ »ý¼º
CREATE USER  scrjbmst1
       IDENTIFIED BY scrjbmst1
       DEFAULT TABLESPACE TS_BMST1_DATA
       TEMPORARY TABLESPACE TEMP
;

3. TS_BMST1_DATA, TS_BMST1_INDEX Ãß°¡

CREATE TABLESPACE TS_BMST1_DATA
DATAFILE
  '/aros4/oracms/oradata/rdf_bmst_data_01' SIZE 800M ;
  
CREATE TABLESPACE TS_BMST1_INDEX
DATAFILE
  '/aros3/oracms/oradata/rif_bmst_index_01' SIZE 500M ; 
  
  
  
CREATE TABLESPACE TS_BMST1_INDEX
DATAFILE
  '/aros3/oracms/oradata/rif_bmst_index_01' SIZE 500M
EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1024K
SEGMENT SPACE MANAGEMENT AUTO;
  

CREATE TABLESPACE TS_BMST1_INDEX
DATAFILE
  '/aros3/oracms/oradata/rif_bmst_index_01' SIZE 500M
EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1024K
SEGMENT SPACE MANAGEMENT AUTO;


CREATE TABLESPACE TS_GIS_DATA1
DATAFILE
  '/aros14/ora10g/oradata/dbac1/rdf_gis_data_01' SIZE 2500M
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
SEGMENT SPACE MANAGEMENT AUTO;

CREATE TABLESPACE TS_GIS_INDX1
DATAFILE
  '/aros14/ora10g/oradata/dbac1/rdf_gis_indx_01' SIZE 500M
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
SEGMENT SPACE MANAGEMENT AUTO;
    
spool cu.lst
set echo on
CREATE USER  gis
       IDENTIFIED BY gis
       DEFAULT TABLESPACE TS_GIS_DATA1
       TEMPORARY TABLESPACE temp1
;
GRANT
	       create procedure,
	       create sequence,
	       create session,
	       create table,
	       create trigger,
	       create view,
	       create synonym,
	       unlimited tablespace
	TO  gis;

spool off


create user PIA    identified by piaexe090313 default tablespace PIA_A;
create user POW_IA identified by POW_IA       default tablespace PIA_A;

alter user POW_IA quota unlimited on PIA_A;
alter user POW_IA quota unlimited on PIA_A_IDX;
alter user POW_IA quota unlimited on PIA_A_LOB;

GRANT CREATE SESSION TO PIA;
GRANT CREATE SYNONYM TO PIA;
GRANT CREATE TABLE TO POW_IA;
GRANT CREATE SESSION TO POW_IA;
GRANT CREATE TRIGGER TO POW_IA;
GRANT CREATE SEQUENCE TO POW_IA;
GRANT CREATE PROCEDURE TO POW_IA;



########### UTL_FILE   ÆÄÀÏÃ³¸®  FILE Ã³¸®
Oracle 9i ¹öÁ¯ºÎÅÍ UTL_FILE ÆÐÅ°Áö°¡ CREATE DIRECTORY¿¡ ´ëÀÀÇÏ°Ô µÇ¾ú´Ù.
µð·ºÅä¸®ÀÇ Ãß°¡¿¡ µû¸£´Â Àç±âµ¿µµ ºÒÇÊ¿ä.

    µð·ºÅä¸® ¿ÀºêÁ§Æ®ÀÇ ÀÛ¼º
    DIRECTORYÀÇ ÀÛ¼ºÀº CREATE DIRECTORY ±ÇÇÑÀÌ ÇÊ¿ä 

         CREATE DIRECTORY recv_area AS '/u05/file_storage/recv_dir';
         CREATE DIRECTORY send_area AS '/u05/file_storage/send_dir';

    µð·ºÅä¸®¿¡ÀÇ ¾×¼¼½º±ÇÀÇ ¼³Á¤
    ÀÐ±â ±ÇÇÑ°ú ¾²±â ±ÇÇÑÀº °³º°ÀûÀ¸·Î Ã³¸®ÇÑ´Ù.

        GRANT READ ON DIRECTORY recv_area TO user_name ;
        GRANT WRITE ON DIRECTORY send_area TO user_name ;
         --
         SELECT * FROM ALL_DIRECTORIES ;

 

¡á ÆÄÀÏ¾²±â (ÃÊ±âÈ­ ÆÄ¶ó¸ÞÅÍ »ç¿ë½Ã )

    CREATE OR REPLACE PROCEDURE RIVUS.CREATE_DIR_WRITE_SAMPLE

    AS

      vHandle   UTL_FILE.FILE_TYPE;

      vDirname  VARCHAR2(250);

      vFilename VARCHAR2(250);

      vOutput   VARCHAR2(32767);

    BEGIN

      vDirname  := 'SEND_AREA'; -- (ÁÖ)µð·ºÅä¸® ¿ÀºêÁ§Æ®¸íÀ» ´ë¹®ÀÚ·Î ÁöÁ¤ÇÑ´Ù

      vFilename := 'test.txt';

      vHandle   := UTL_FILE.FOPEN(vDirname ,vFilename,'w', 32767);

      vOutput   := 'CREATE DIRECTORY °æÀ¯·ÎÀÇ ÆÄÀÏÃâ·Â';

      UTL_FILE.PUT_LINE(vHandle, vOutput);

      UTL_FILE.FCLOSE(vHandle);

    EXCEPTION WHEN OTHERS THEN

      UTL_FILE.FCLOSE_ALL;

      RAISE;

    END;

    / 

¡á ÆÄÀÏÀÐ±â (ÃÊ±âÈ­ ÆÄ¶ó¸ÞÅÍ »ç¿ë½Ã )

    CREATE OR REPLACE PROCEDURE RIVUS.CREATE_DIR_READ_SAMPLE

    AS

      vHandle   UTL_FILE.FILE_TYPE;

      vDirname  VARCHAR2(250);

      vFilename VARCHAR2(250);

      vInput    VARCHAR2(32767);

    BEGIN

      vDirname  := 'RECV_AREA';

      vFilename := 'test.txt';

      vHandle   := UTL_FILE.FOPEN(vDirname ,vFilename,'r', 32767);

     

      BEGIN

        LOOP

          UTL_FILE.GET_LINE(vHandle, vInput,32767);

          DBMS_OUTPUT.PUT_LINE(vInput);

        END LOOP;

      EXCEPTION WHEN NO_DATA_FOUND THEN

        DBMS_OUTPUT.PUT_LINE('ÆÄÀÏÀÇ ¸¶Áö¸·');

      END;

     

      UTL_FILE.FCLOSE(vHandle);

    EXCEPTION WHEN OTHERS THEN

      UTL_FILE.FCLOSE_ALL; RAISE;

    END;

    / 
    
    
############################## Å×ÀÌºí1 ¿¡¼­ Å×ÀÌºí2·Î PK ·Î Á¶ÀÎÇÏ¿© Æ¯Á¤ ÄÃ·³ UPDATE ÇÏ´Â PL-SQL
CREATE OR REPLACE PROCEDURE POO.SP_TB_OOZZCBSBCR_CELL_NET_NO
/*****************************************************************
  XION ÀÇ TB_BCORCONT_SBC (°¡ÀÔ°è¾à) Å×ÀÌºíÀ» EXPORT ÈÄ POO °èÁ¤¿¡ IMPORT ÇÑ °ÍÀÌ´Ù.
  »ý¼ºÀÏ : 2009-04-09
  
  job ¿¡ µî·ÏµÇ¾î ÀÖ´Ù.
  ¹øÈ£: 642
  ÃÖÃÊ ½ÇÇàÀÏ½Ã: 2009-04-10 01:00:00
  ÁÖ±â: ÃÖÃÊ1È¸
  
  HISTORY :
  ³¯ Â¥        ÀÌ  ¸§    ³»  ¿ë
  2009-04-09   ¼­Á¤Áø    TB_OOZZCBSBCR (°¡ÀÔÀÚ¿øºÎ(QMS)) ÀÇ cell_net_no ÄÃ·³À» UPDATE ÇÑ´Ù.
  2009-04-10   ¼­Á¤Áø    ÃÖÃÊ ½ÇÇàÀÏ½Ã¿¡ 1È¸ ½ÇÇà ÈÄ SP_TB_OOZZCBSBCR_CELL_NET_NO PROCEDURE ¿Í  TB_BCORCONT_SBC Å×ÀÌºíÀ» DROP ÇÑ´Ù.
  *******************************************************************/
 IS
  V_ERR_MSG VARCHAR2(4000);
BEGIN
  DBMS_OUTPUT.ENABLE;
  DBMS_OUTPUT.PUT_LINE(' ************** SP_TB_OOZZCBSBCR_CELL_NET_NO ************** ');
  DBMS_OUTPUT.PUT_LINE(' ************** TB_OOZZCBSBCR_UPDATE START ************** ');
  update TB_OOZZCBSBCR a
     set a.cell_net_no = (select b.cell_net_no
                            from TB_BCORCONT_SBC b
                           where b.sbc_cont_no = a.sbcr_no);
  DBMS_OUTPUT.PUT_LINE(' ************** TB_OOZZCBSBCR_UPDATE END ************** ');
  COMMIT;

EXCEPTION
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE(SQLERRM);
    ROLLBACK;
    V_ERR_MSG := SQLERRM;
    INSERT INTO TB_SP_ERROR_HIS
    VALUES
      ('SP_TB_OOZZCBSBCR_CELL_NET_NO', V_ERR_MSG, SYSDATE - 1);
    COMMIT;
  
END SP_TB_OOZZCBSBCR_CELL_NET_NO;
/



SET SERVEROUTPUT ON

DECLARE
  ROW_COUNT NUMBER;

  CURSOR TABLE_TABS IS
    SELECT TABLE_NAME
      FROM DBA_TABLES
     WHERE OWNER = 'SCOTT';



#################### INDEX RENAME

SELECT 'ALTER INDEX ' || OWNER || '.' || INDEX_NAME || ' RENAME TO ' || REPLACE(INDEX_NAME,'OP_','') || ';' FROM DBA_INDEXES
WHERE TABLE_OWNER LIKE 'DPOW_OS%'
AND INDEX_NAME LIKE 'OP_%';


################################  DBMS_JOB PACKAGEÀÇ »ç¿ë ¹æ¹ý°ú ¿¹Á¦

http://download.oracle.com/docs/cd/B10501_01/server.920/a96521/jobq.htm#9499

UnixÀÇ cron°ú °°ÀÌ ¿À¶óÅ¬¿¡¼­µµ ÀÏÁ¤ÇÑ ½ÃÁ¡, ¶Ç´Â °£°ÝÀ¸·Î ¹Ýº¹ÇØ¼­ jobÀ» ¼öÇà½ÃÅ³ ¼ö ÀÖ´Ù. DBMS_JOB package¸¦ ÀÌ¿ëÇÏ¿© ¼öÇà½ÃÅ³ ¼ö ÀÖ´Âµ¥, ÀÌ°ÍÀ» À§ÇØ¼­´Â SNP background process°¡ startµÇ¾î ÀÖ¾î¾ß ÇÑ´Ù.

´ÙÀ½ÀÇ parameter¸¦ init.ora file¿¡ ¼³Á¤ÇÑ ÈÄ oracleÀ» startupÇÏ¸é SNP process°¡ ¿Ã¶ó¿Â´Ù.


job_queue_processes = 1

-> ÀÌ ÆÄ¶ó¹ÌÅÍ´Â snp process¸¦ ¸î °³ ¶ç¿ïÁö¸¦ °áÁ¤ÇÑ´Ù.

default=0
job_queue_interval = 60
-> ÀÌ ÆÄ¶ó¹ÌÅÍ´Â snp process°¡ ±ú¾î³ª´Â °£°ÝÀ» ÃÊ·Î ¼³Á¤ÇÑ´Ù.

DBMS_JOB Package´Â ´ÙÀ½°ú °°Àº procedure¸¦ ÀÌ¿ëÇÏ¿© »ç¿ëÇÑ´Ù.

DBMS_JOB.submit(job out binary_integer,
what in varchar2,
next_date in date defalut sysdate,
interval in varchar2 default 'null',
no_parse in boolean default false)

-> dbms_job.submit procedure´Â jobÀÇ ³»¿ëÀ» Á¤ÀÇÇÏ°í oracleÀÌ jobÀ» ¼öÇàÇÒ ¼ö ÀÖµµ·Ï ÇÑ´Ù. ´ÙÀ½ÀÇ ¿¹Á¦¸¦ ÅëÇÏ¿© ½ÇÁ¦ »ç¿ë¹ýÀ» ¾Ë¾Æº¸ÀÚ.

[ ¿¹Á¦ ] file jobcre.sql
begin
dbms_job.submit(:jobno,
-- job ÀÇ ¹øÈ£
'insert into scott.testdate values(1, sysdate);',
-- jobÀÇ ³»¿ë : ' 'À¸·Î °¨½ÎÁØ´Ù.
-- procedure¸¦ ½ÇÇàÇÏ´Â °æ¿ì ' username.procedure_name;' ¸¸ ¾²¸é µÈ´Ù.

sysdate,
-- jobÀÌ ½ÇÇàµÉ ½Ã°£

'sysdate + 5/24/60' ,
-- jobÀÌ ½ÇÇàµÇ´Â °£°Ý , À§ÀÇ °æ¿ì´Â 5ºÐ¸¶´Ù ½ÇÇàÇÏµµ·Ï Çß´Ù.
-- ' 'À¸·Î °¨½ÎÁØ´Ù.

FALSE );
end;
/


$ sqlplus scott/tiger

SQL> variable jobno number;
SQL> @jobcre
SQL> print jobno -- job ¹øÈ£ È®ÀÎ : ¿©±â¼­´Â 166¹ø
SQL> exec dbms_job.run(166);
SQL> commit;

Áö±ÝºÎÅÍ interval¿¡ µû¶ó jobÀÌ ½ÇÇàµÈ´Ù.

job ½ÇÇà ¿©ºÎ¸¦ ¾Ë¾Æº¸±â À§ÇØ¼­ ´ÙÀ½ÀÇ sql ¹®ÀåÀ» ¼öÇàÇÑ´Ù.

SQL> col what format a20
SQL> select what, job, next_date, next_sec, failures, bro
ken
from user_jobs;

±× ¿Ü¿¡
SQL> exec dbms_job.run(jobno);
- jobÀÇ °­Á¦ ½ÇÇà, jobÀÌ 16¹ø failµÇ¾î brokenµÈ °æ¿ì´Â À§ÀÇ ¸í·É¾î·Î °­Á¦·Î runÀ» ½ÃÄÑ¼­ ½ÇÇàµÇ¸é ´Ù½Ã interval¸¶´Ù ½ÇÇàµÈ´Ù.

SQL> exec dbms_job.broken(jobno, TRUE);
- jobÀ» disable½ÃÅ´

SQL> exec dbms_job.remove(jobno);
- jobÀÇ »èÁ¦

snapshot°ú job°úÀÇ °ü°è
======================
snapshot µµ job À¸·Î µî·ÏµÇ¾î µ¹¾Æ°©´Ï´Ù.
Áï, select job, what from dba_jobs; ¸¦ Á¶È¸ÇÏ¸é,
what ºÎºÐ¿¡ snapshot ÀÌ Á¤ÀÇµÇ¾î ÀÖ½À´Ï´Ù.

µû¶ó¼­, snapshot ¿¡ ´ëÇÑ disable ¹æ¹ý µîÀº job °ú °°½À´Ï´Ù.


interval ½Ã°£ ÁöÁ¤ ¿¹Á¦
======================
1. 10ºÐ¿¡ ÇÑ¹ø¾¿ ½ÇÇàÇÏ´Â °æ¿ì

sysdate + 1/24/6 ¶Ç´Â sysdate + 1/144
-> 1/24 (1½Ã°£-60ºÐ) / 6 : 10ºÐ ´ÜÀ§
1/144 : 24*6 À¸·Î ³ª´©¾îµµ °°Àº ÀÇ¹Ì°¡ µÈ´Ù.

2. 1ºÐ¿¡ ÇÑ¹øÀ¸·Î ÁöÁ¤ÇÏ´Â °æ¿ì
sysdate + 1/24/60 ¶Ç´Â sysdate + 1/1440

3. ¸ÅÀÏ »õº® 2½Ã·Î ÁöÁ¤ÇÏ´Â °æ¿ì
trunc(sysdate) + 1 + 2/24 -> ´ÙÀ½³¯ »õº® 2½Ã¸¦ ÁöÁ¤ÇÔ.

4. ¸ÅÀÏ ¹ã 11½Ã·Î ÁöÁ¤ÇÏ´Â °æ¿ì
trunc(sysdate) + 23/24 -> ¿À´Ã ¹ã 11½Ã¸¦ ÁöÁ¤ÇßÀ½. 



BEGIN
DBMS_JOB.CHANGE(44, NULL, NULL, 'TRUNC(SYSDATE+1,'DD') + 23/24');
END;

http://docstore.mik.ua/orelly/oracle/bipack/ch13_02.htm


################## ÇöÀç µµ´Â job KILL ÇÏ°í ´ÙÀ½ ÁÖ±â¶§ ¼öÇàÇÏ°í ½ÍÀ»¶§  (±×³É KILL ÇÏ¸é ¼º°øÇÒ ¶§ ±îÁö °è¼Ó Àç¼öÇàµÊ)
--JOB »ý¼º OWNER ·Î

EXEC dbms_job.broken(961,true);
COMMIT;

select * from dba_jobs
where job in ('961');

BROKEN=Y·Î µÊ


--SYSTEMÀ¸·Î
alter system kill session '115,21914' ;

--JOB »ý¼º OWNER ·Î
EXEC dbms_job.broken(961,FALSE,TRUNC(SYSDATE+1)+8/24);
COMMIT;




13.2.7.2 The DBMS_JOB.BROKEN procedure

The BROKEN procedure is used to set or unset the broken flag for a job. Jobs flagged as broken are not automatically re-executed. Here's the header for this program:

    PROCEDURE DBMS_JOB.BROKEN
       (job IN BINARY_INTEGER
       ,broken IN BOOLEAN
       ,next_date IN DATE DEFAULT SYSDATE);

Parameters are summarized in the following table.
Parameter
	
Description
job
	

Unique identifier of the job
broken
	

Flag indicating job is broken (TRUE) or not broken (FALSE)
next_date
	

Next execution date of the job


################## ÇöÀç µµ´Â job Á¶È¸ÇÏ±â

v$session program Àº ¾Æ·¡¿Í °°ÀÌ Á¶È¸µÊ.

oracle@pwerqms1 (J008)


select * from dba_jobs_running
order by this_sec desc;

select * from dba_jobs
where job in ('221','341');



select * 
from dba_jobs_running r, dba_jobs j
where r.job=j.job;





################## À¯Àúº°, ½ºÅ°¸¶º° ·Î¿ì Ä«¿îÆ® , row Ä«¿îÆ®
BEGIN

  DBMS_OUTPUT.ENABLE(100000);
  FOR R_TABS IN TABLE_TABS
  LOOP
    EXECUTE IMMEDIATE 'SELECT COUNT(*) FROM SCOTT.'||R_TABS.TABLE_NAME INTO ROW_COUNT;

    DBMS_OUTPUT.PUT_LINE(RPAD(R_TABS.TABLE_NAME, 50) || ROW_COUNT);
  END LOOP;
END;
/

 

SCOTT ¿¡ Ã£°í ½ÍÀº À¯Àú ÀÌ¸§ ÀûÀ¸½Ã¸é µÉ °Í °°½À´Ï´Ù.

¾Æ´Ï½Ã¸é À¯Àú ºÎºÐ ´Ù Áö¿ì½Ã°í ÀüÃ¼ À¯Àú row countµµ °¡´ÉÇÕ´Ï´Ù. ½Ã°£Àº °É¸®½Ã°ÚÁö¸¸..

COUTN(*) ÇÏ½Ç ¶§ parallel ÁÖ½Ã¸é ºü¸£°í¿ä ¤»

 



################## flush
10g ÀÌ»ó ¹öÀüÀÌ¶ó¸é..

alter system flush buffer_cache;

 

±× ÀÌÀü ¹öÀüÀÌ¶ó¸é..

alter session set events = ¡®immediate trace name flush_cache¡¯;

 

Âü°í·Î shared poolÀ» »èÁ¦ÇÏ°í ½Í´Ù¸é.. (sql ÆÄ½ÌµÈ °Íµµ ¼Óµµ¿¡ ¾ÆÁÖ ¾à°£ ¿µÇâÀ» ¹ÌÄ¨´Ï´Ù)

ALTER SYSTEM FLUSH BUFFER_CACHE;
ALTER SYSTEM FLUSH SHARED_POOL;

[ÃâÃ³] SHARED_POOL, BUFFER_CACHE FLUSH ÇÏ±â|ÀÛ¼ºÀÚ ½éÀÌÀÚ¹Ù


################## 8i Àç±âµ¿

svrmgrl
connect internal
shutdown immediate
startup


################## ¸®½º³Ê Àç±âµ¿ ¾ÈÇÏ°í »õ¼³Á¤ ¸®·ÎµåÇÏ´Â ¹æ¹ý (sqlnet.ora µî ¼öÁ¤½Ã)
lsnrctl reload LISTENERVLS401

LISTENERVLS101
LISTENERVLS201
LISTENERVLS301
LISTENERVLS401


################## ¸®½º³Ê ºñ¹Ð¹øÈ£ ÁöÁ¤

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS_LIST =
        (ADDRESS = (PROTOCOL = TCP)(HOST = tps3)(PORT = 1521))
      )
    )
  )
SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (SID_NAME = TPS)
      (ORACLE_HOME = /oracle/app/oracle/product/9.2.0)
    )
    (SID_DESC =
      (SID_NAME = POWERCB)
      (ORACLE_HOME = /oracle/app/oracle/product/9.2.0)
    )
    (SID_DESC =
      (GLOBAL_DBNAME = TPSOEM)
      (ORACLE_HOME = /oracle/app/oracle/product/9.2.0)
      (SID_NAME = TPSOEM)
    )
  )



#trace_level_listener = 16
#trace_file_listener = listener
#trace_directory_listener = /oracle/app/oracle/product/9.2.0/network/log
#trace_timestamp_listener = on

logging_listener = off

#----ADDED BY TNSLSNR 16-SEP-2007 01:06:55---
PASSWORDS_LISTENER = C7AF4D4447063F8E
#--------------------------------------------

#ÄÁÆ®·Ñ½Ã
lsnrctl

Password:
The command completed successfully
LSNRCTL> set current_listener LISTENER
Current Listener is LISTENER
LSNRCTL> status
Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=tps3)(PORT=1521)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for HPUX: Version 9.2.0.6.0 - Production
Start Date                26-AUG-2009 22:37:24
Uptime                    4 days 11 hr. 29 min. 57 sec
Trace Level               off
Security                  ON
SNMP                      OFF
Listener Parameter File   /oracle/app/oracle/product/9.2.0/444333333333333333333333322222222222333222work/admin/listener.ora
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=tps3)(PORT=1521)))
Services Summary...
Service "POWERCB" has 1 instance(s).
  Instance "POWERCB", status UNKNOWN, has 1 handler(s) for this service...
Service "TPS" has 2 instance(s).
  Instance "TPS", status UNKNOWN, has 1 handler(s) for this service...
  Instance "TPS", status READY, has 1 handler(s) for this service...
Service "TPSOEM" has 1 instance(s).
  Instance "TPSOEM", status UNKNOWN, has 1 handler(s) for this service...
The command completed successfully



################## Å×ÀÌºí¸í º¯°æ
ALTER TABLE ±¸Å×ÀÌºí¸í RENAME TO ½ÅÅ×ÀÌºí¸í; 

ALTER TABLE TB_RI213 RENAME TO TB_RI215;

Å×ÀÌºí ¸®³×ÀÓ ½Ã ÇØ´ç Å×ÀÌºíÀÇ ÀÎµ¦½º¸¦ RENAMEµÈ Å×ÀÌºíÀ» ÂüÁ¶ÇÏµµ·Ï ÀÚµ¿º¯°æµÊ (VALID)


##################  µ¥ÀÌÅÍÆÄÀÏ Ãß°¡

alter tablespace TS_SIN_INDX add datafile '/aros5/oracle9i_dbf/index/rif_sin_06' size 1000M;  

################### µ¥ÀÌÅÍÆÄÀÏ Àç¹èÄ¡ rename 

alter tablespace TS_SCRJV2T01_DATA1 offline;

mv /aros6/oradata/rdf_scrjv2t05_data_02 /aros3/oradata/rdf_scrjv2t01_data_06
mv /aros6/oradata/rdf_scrjv2t05_data_03 /aros3/oradata/rdf_scrjv2t01_data_07

alter tablespace TS_SCRJV2T01_DATA1 rename datafile '/aros6/oradata/rdf_scrjv2t05_data_02' to '/aros3/oradata/rdf_scrjv2t01_data_06';
alter tablespace TS_SCRJV2T01_DATA1 rename datafile '/aros6/oradata/rdf_scrjv2t05_data_03' to '/aros3/oradata/rdf_scrjv2t01_data_07';

alter tablespace TS_SCRJV2T01_DATA1 online;


alter tablespace TS_PERFORM_INDEX offline;
mv /aros5/oracle9i/oradata/rif_perform_index_01 /aros1/oracle9i/oradata/rif_perform_index_01
mv /aros5/oracle9i/oradata/rif_perform_index_02 /aros1/oracle9i/oradata/rif_perform_index_02
alter tablespace TS_PERFORM_INDEX rename datafile '/aros5/oracle9i/oradata/rif_perform_index_01' to '/aros1/oracle9i/oradata/rif_perform_index_01';
alter tablespace TS_PERFORM_INDEX rename datafile '/aros5/oracle9i/oradata/rif_perform_index_02' to '/aros1/oracle9i/oradata/rif_perform_index_02';
alter tablespace TS_PERFORM_INDEX online;



alter tablespace POO_Q offline;

mv /oradata8/POO/POO_Q_12 /oradata8/POO/POO_Q_12.dbf

alter tablespace POO_Q rename datafile '/oradata8/POO/POO_Q_12' to '/oradata8/POO/POO_Q_12.dbf';

alter tablespace POO_Q online;


imcprm01 oracms /aros1/oracms/SQL/dba/akh/mv_cms/scrjdba/users> Âü°í

5. alert log À§Ä¡ Á¶È¸

conn /as sysdba
show parameters
background_dump_dest                 string      /scrs1/oracle1/bdump




7. Å×ÀÌºí½ºÆäÀÌ½º ¸®»çÀÌÂ¡
  1* select file_name,bytes/1024/1024 from dba_data_files where tablespace_name='TS_CMS_INDEX01'
SQL> /

FILE_NAME                                BYTES/1024/1024
---------------------------------------- ---------------
/aros3/oracms/oradata/rif_cms_index1_01              200


alter database
datafile '/aros3/oracms/oradata/rif_cms_index1_01' resize 500m;


+ IN ASM

ALTER DATABASE DATAFILE '+DATA/ptltest/datafile/itamfds_data.458.791914303' RESIZE 3.2M;


################ TEMP ¿µ¿ªÈ®ÀÎ TEMPORARY TABLESPACE

select * from database_properties where property_name like '%TEMP%'; 

select FILE_NAME, TABLESPACE_NAME, BYTES / 1024/ 1024 , STATUS, AUTOEXTENSIBLE from dba_temp_files;


alter database tempfile '/ora/PTLCAT2/data001/temp01.dbf' resize 200m;


TEMP »ç¿ëÀ² »ç¿ë·®

SELECT BYTES_CACHED/1024/1024, EXTENTS_USED,
BYTES_USED/1024/1024 FROM SYS.V_$TEMP_EXTENT_POOL;
 
SELECT DECODE(B.C1, '1', FILE_ID||'', 'ÇÕ°è'), SUM(EXTENTS_USED)
FROM (
SELECT FILE_ID, EXTENTS_USED
FROM SYS.V_$TEMP_EXTENT_POOL) A
,(SELECT '1' C1 FROM DUAL
 UNION ALL
 SELECT '2' FROM DUAL) B
 GROUP BY DECODE(B.C1, '1', FILE_ID||'', 'ÇÕ°è');
 
 
 
SELECT d.status "Status", d.tablespace_name "Name", d.CONTENTS "Type",
       d.extent_management "Extent Management",
       max(TO_CHAR (NVL (A.BYTES / 1024 / 1024, 0), '99,999,990.900')) "Size (M)",
       max(TO_CHAR (NVL (u.BYTES, 0) / 1024 / 1024, '99999999.999')
       || '/'
       || TO_CHAR (NVL (A.BYTES / 1024 / 1024, 0), '99999999.999')) "Used (M)",
       max(TO_CHAR (NVL (t.BYTES / A.BYTES * 100, 0), '990.00')) "Cached %"    ,
       max(TO_CHAR (NVL (u.BYTES / A.BYTES * 100, 0), '990.00')) "Used %"
  FROM SYS.dba_tablespaces d,
       (SELECT   tablespace_name, SUM (BYTES) BYTES
            FROM dba_temp_files
        GROUP BY tablespace_name) A,
       (SELECT   tablespace_name, SUM (bytes_cached) BYTES
            FROM v$temp_extent_pool
        GROUP BY tablespace_name) t ,
        (SELECT   tablespace_name, SUM (bytes_used) BYTES
            FROM v$temp_extent_pool
        GROUP BY tablespace_name) u
WHERE d.tablespace_name = A.tablespace_name
   AND d.tablespace_name = t.tablespace_name
   AND d.extent_management LIKE 'LOCAL'
   AND d.CONTENTS LIKE 'TEMPORARY'
group by d.status, d.tablespace_name, d.contents, d.extent_management;



########################## DROP USER

1. ÇØ´çÀ¯Àú Á¢¼Ó KILL
ALTER SYSTEM KILL SESSION 'SID,SERIAL#';

2. USER DROP
DROP USER XXX CASCADE;

3. ÇØ´ç À¯Àú°¡ »ç¿ëÇÏ´ø µ¥ÀÌÅÍÆÄÀÏ È®ÀÎ

- Å¸ À¯Àú°¡ È¤½Ã ÇØ´ç µ¥ÀÌÅÍÆÄÀÏÀ» »ç¿ëÇÒ¼ö µµ ÀÖÀ¸¹Ç·Î Ã¼Å©

SQL> select distinct owner from dba_segments where tablespace_name='TS_PERFORM_INDEX';
no rows selected

SQL> select distinct owner from dba_segments where tablespace_name='TS_PERFORM_DATA';
no rows selected

4. »èÁ¦´ë»ó µ¥ÀÌÅÍÆÄÀÏ È®ÀÎ

SQL> SELECT FILE_NAME FROM DBA_DATA_FILES WHERE TABLESPACE_NAME LIKE 'TS_PERFORM%';

FILE_NAME
--------------------------------------------------------------------------------
/aros4/oracms/oradata/rdf_perform_data_01
/aros4/oracms/oradata/rdf_perform_data_02
/aros3/oracms/oradata/rif_perform_index_01
/aros3/oracms/oradata/rdf_perform_data_03
/aros3/oracms/oradata/rif_perform_index_02
/aros3/oracms/oradata/rdf_perform_data_04
/aros3/oracms/oradata/rif_perform_index_03
/aros4/oracms/oradata/rdf_perform_data_05
/aros3/oracms/oradata/rif_perform_index_04
/aros3/oracms/oradata/rdf_perform_data_06
/aros3/oracms/oradata/rif_perform_index_05
/aros3/oracms/oradata/rdf_perform_data_07
/aros3/oracms/oradata/rif_perform_index_06
/aros3/oracms/oradata/rdf_perform_data_08
/aros5/oracms/oradata/rdf_perform_data_09
/aros5/oracms/oradata/rdf_perform_data_10
/aros5/oracms/oradata/rdf_perform_data_11
/aros5/oracms/oradata/rdf_perform_data_12
/aros5/oracms/oradata/rdf_perform_data_13
/aros5/oracms/oradata/rdf_perform_data_14
/aros5/oracms/oradata/rdf_perform_data_15
/aros5/oracms/oradata/rdf_perform_data_16
/aros5/oracms/oradata/rdf_perform_data_17
/aros6/oracms/oradata/rif_perform_index_07
/aros6/oracms/oradata/rif_perform_index_08
/aros6/oracms/oradata/rif_perform_index_09
/aros6/oracms/oradata/rif_perform_index_10
/aros6/oracms/oradata/rif_perform_index_11
/aros6/oracms/oradata/rif_perform_index_12
/aros6/oracms/oradata/rif_perform_index_13
/aros6/oracms/oradata/rif_perform_index_14
/aros6/oracms/oradata/rif_perform_index_15
/aros6/oracms/oradata/rif_perform_index_16


5. Å×ÀÌºí½ºÆäÀÌ½º »èÁ¦ 
drop tablespace TS_PERFORM_DATA INCLUDING CONTENTS AND DATAFILES


³¡
################################## corrupted undo tablespace »èÁ¦ 

SQL> select segment_name, tablespace_name, status
from dba_rollback_segs
order by 2;  2    3

°á°ú rollback segment »óÅÂ PARTLY AVAILABLE(ONLINE ½Ã / NEEDS RECOVERY (OFFLINE ½Ã)

À§ »óÅÂÀÎ ROLLBACK SEGMENT ¸¦ INIT ÆÄÀÏ¿¡ µî·Ï

_offline_rollback_segments=_SYSSMU1$,_SYSSMU2$,_SYSSMU3$,_SYSSMU4$,_SYSSMU5$,_SYSSMU6$,_SYSSMU7$,_SYSSMU8$,_SYSSMU9$,_SYSSMU10$,
_SYSSMU11$,_SYSSMU12$,_SYSSMU13$,_SYSSMU14$,_SYSSMU15$,_SYSSMU16$,_SYSSMU17$,_SYSSMU18$,_SYSSMU19$,_SYSSMU20$,
_SYSSMU21$,_SYSSMU22$,_SYSSMU23$,_SYSSMU24$,_SYSSMU25$,_SYSSMU26$,_SYSSMU27$,_SYSSMU28$,_SYSSMU29$,_SYSSMU30$,
_SYSSMU31$,_SYSSMU32$,_SYSSMU33$,_SYSSMU34$,_SYSSMU35$,_SYSSMU36$,_SYSSMU37$,_SYSSMU38$,_SYSSMU39$,_SYSSMU40$,
_SYSSMU41$,_SYSSMU42$,_SYSSMU43$,_SYSSMU44$,_SYSSMU45$,_SYSSMU46$,_SYSSMU47$,_SYSSMU48$,_SYSSMU49$,_SYSSMU50$,
_SYSSMU51$,_SYSSMU52$,_SYSSMU53$,_SYSSMU54$,_SYSSMU55$,_SYSSMU56$,_SYSSMU57$,_SYSSMU58$,_SYSSMU59$,_SYSSMU60$,
_SYSSMU61$,_SYSSMU62$,_SYSSMU63$,_SYSSMU64$,_SYSSMU65$,_SYSSMU66$

DB Àç±âµ¿

À§ ROLLBACK SEGMENT »èÁ¦

drop rollback segment "_SYSSMU1$";
drop rollback segment "_SYSSMU2$";
drop rollback segment "_SYSSMU3$";
drop rollback segment "_SYSSMU4$";
drop rollback segment "_SYSSMU5$";
.
.
.

UNDO TABLESPACE »èÁ¦

DROP TALBESPACE RBS INCLUDING CONTENTS AND DATAFILES;






######################### tablespace transport export TTS


 < MDSYS À¯Àú»ý¼º°ü·Ã >

1. À¯Àú»ý¼º

SQL> select username from dba_users where username='ORDSYS'; 

 

If ORDSYS does NOT exist: 

SQL> @?/ord/admin/ordinst.sql 

 

2. MDSYS ÆÐÅ°Áö »ý¼º

SQL>connect / as sysdba 

SQL>alter session set current_schema=MDSYS; 

SQL>@?/md/admin/mdinst.sql 

 

3. MDSYS ¼³Ä¡ È®ÀÎ

verify_spatial_installation.sql



4. À¯Àú lock

alter user MDSYS account lock; 



 

 

< ÁöÀûµ¥ÀÌÅÍ ÀÌ°ü >

 

1. v2web02 °³¹ßÈ¯°æÀÇ ÁöÀûµ¥ÀÌÅÍ tts (transportable tablespace) ÀÌ°üÀ» À§ÇÑ ´ë»ó TBS read only

alter tablespace TS_SCRJGIS3_DATA1 read only;

select * from v$datafile;


2. exp with transport_tablespace option

 

3. lvol »ý¼º (2004 MB)

 

/dev/vx/rdsk/oradg2/df_rdgis_data_01

/dev/vx/rdsk/oradg2/df_rdgis_data_02

/dev/vx/rdsk/oradg2/df_rdgis_data_03

/dev/vx/rdsk/oradg2/df_rdgis_data_04

/dev/vx/rdsk/oradg2/df_rdgis_data_05

/dev/vx/rdsk/oradg2/df_rdgis_data_06

/dev/vx/rdsk/oradg2/df_rdgis_data_07

/dev/vx/rdsk/oradg2/df_rdgis_data_08

/dev/vx/rdsk/oradg2/df_rdgis_data_09

/dev/vx/rdsk/oradg2/df_rdgis_data_10

/dev/vx/rdsk/oradg2/df_rdgis_data_11

 

4. ÇØ´ç µ¥ÀÌÅÍ ÆÄÀÏ ¶ó¿ìÆÃ2¼­¹ö·Î dd Ä«ÇÇ

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_01 of=/dev/vx/rdsk/oradg2/df_rdgis_data_01 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_02 of=/dev/vx/rdsk/oradg2/df_rdgis_data_02 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_03 of=/dev/vx/rdsk/oradg2/df_rdgis_data_03 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_04 of=/dev/vx/rdsk/oradg2/df_rdgis_data_04 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_05 of=/dev/vx/rdsk/oradg2/df_rdgis_data_05 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_06 of=/dev/vx/rdsk/oradg2/df_rdgis_data_06 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_07 of=/dev/vx/rdsk/oradg2/df_rdgis_data_07 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_08 of=/dev/vx/rdsk/oradg2/df_rdgis_data_08 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_09 of=/dev/vx/rdsk/oradg2/df_rdgis_data_09 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_10 of=/dev/vx/rdsk/oradg2/df_rdgis_data_10 bs=8192

dd if=/work_temp/oracle2/GIS/DATA/rdf_scrjgis3_data_11 of=/dev/vx/rdsk/oradg2/df_rdgis_data_11 bs=8192

 

5. scrjgis À¯Àú»ý¼º

 

6.  imp with transport_tablespace option

 

7. default tablespace º¯°æ : alter user scrjgis default tablespace TS_SCRJGIS3_DATA1;

 

8. ¾÷¹«È®ÀÎ

################################ ¿À¶óÅ¬ ½ºÆÄ¼£/°ø°£/SPATIAL ¿ÀºêÁ§Æ®ÀÇ Á¤º¸ µñ¼Å³Ê¸®

SELECT * FROM ALL_SDO_INDEX_INFO;

################################ ¸ðµç µñ¼Å³Ê¸® ºäÀÇ Á¤º¸ µñ¼Å³Ê¸®
select * from dictionary;


################################ role ÀÌ °¡Áø ¿ÀºêÁ§Æ® ±ÇÇÑ Á¤º¸
SELECT * FROM ROLE_TAB_PRIVS WHERE ROLE='NCS_PARLL_ROLE';

grant select,insert,update,delete on ncs.account_contact to NCS_PARLL_ROLE;
grant select on ncs.ACCOUNT_CONTACT_SQ to NCS_PARLL_ROLE;


################################ advisory view
shared_pool

select shared_pool_size_for_estimate as pool_size, estd_lc_size, estd_lc_time_saved from v$shared_pool_advice;


POOL_SIZE	ESTD_LC_SIZE	ESTD_LC_TIME_SAVED
160	36	924795
192	67	947856
224	98	951684
256	129	953092
288	160	954113
320	191	954881
352	222	955498
384	253	955991
416	284	956408
448	315	956800
480	346	957201
512	377	957502
544	408	957885
576	439	958131


db_buffer_cache

column c1   heading 'Cache Size (m)'        format 999,999,999,999
column c2   heading 'Buffers'               format 999,999,999
column c3   heading 'Estd Phys|Read Factor' format 999.90
column c4   heading 'Estd Phys| Reads'      format 999,999,999

select
   size_for_estimate          "Cache Size (m)",
   buffers_for_estimate       "Buffers",
   estd_physical_read_factor  "Estd Phys|Read Factor",
   estd_physical_reads        "Estd Phys| Reads"
from
   v$db_cache_advice
where
   name = 'DEFAULT'
and
   block_size  = (SELECT value FROM V$PARAMETER
                   WHERE name = 'db_block_size')
and
   advice_status = 'ON';

Cache Size (m)	Buffers	Estd Phys|Read Factor	Estd Phys| Reads
64	7936	2.1828	2539494605
128	15872	1.2465	1450242976
192	23808	1.1534	1341845701
256	31744	1.0969	1276198579
320	39680	1.0551	1227495060
384	47616	1.0327	1201434224
448	55552	1.0221	1189154966
512	63488	1.0163	1182348620
576	71424	1.0116	1176917477
640	79360	1.0075	1172166483
704	87296	1.004	1168072744
768	95232	1.0008	1164319584
784	97216	1	1163420547
832	103168	0.9977	1160723160
896	111104	0.9951	1157725255
960	119040	0.9926	1154857393
1024	126976	0.9898	1151514676
1088	134912	0.9871	1148431977
1152	142848	0.9846	1145558491
1216	150784	0.9823	1142819798
1280	158720	0.964	1121563476


################################ SQLº°·Î MUTEX OFF

/*+ opt_param('_kks_use_mutex_pin','false') ORDERED FULL(A)  */ /* OSTPCTrblGenInfoRegQ.retrieveTrblList [Àå¾Ö¸ñ·ÏÁ¶È¸] */



################################ sql_id º° sharable memory
select * from dba_hist_sqlstat;


DBA_HIST_LIBRARYCACHE


################################ sqlÀ» ¸Þ¸ð¸®¿¡ keep ÇÏ±âÀ§ÇÑ ½ºÅ©¸³Æ® »Ì´Â sql

  select t.*,'exec sys.dbms_shared_pool.keep('''||address||','||hash_value||''',''C'');' 
from gv$sqltext t where sql_text like '%select %from dual%' 
and inst_id=&inst; (rac ÀÏ°æ¿ì ÀÎ½ºÅÏ½º¹øÈ£ 0, 1, ½ºÅÄµå¾ó·Ð¿¡¼­´Â and Àý Á¦°Å)

################################ ÇöÀç ¼¼¼Ç wait event 10g
select b.sid,b.serial#, sql_id , sql_child_number, b.osuser,b.username,a.event,a.p1,a.p2,a.p3,a.seconds_in_wait"SECONDS",a.wait_time "WTIME"
from v$session_wait a, v$session b
where a.sid=b.sid 
and b.type <> 'BACKGROUND'
and a.event not like 'SQL*Net%'
and a.event not like 'jobq slave wait%'
/



-- check_owi_state.sql
set head off
set feedback off
set verify off
set lines 150
set pages 300
spool check_owi_state.lst
prompt #######################################################################################
alter session set nls_date_format='yyyy-mm-dd hh24:mi:ss' ;
select 'CHECK TIME : ', sysdate from dual ;
prompt check owi state
select * from (
select event, count(*) from v$session_wait group by event order by 2 desc
) where rownum <= 5 ;
prompt

spool off
exit

################################# ÃÖ±Ù º¯°æµÈ ¿ÀºêÁ§Æ®

SELECT *
  FROM dba_objects
 WHERE (created > sysdate - 1 OR last_ddl_time > sysdate -1)
   AND object_type= 'TABLE'
   AND owner != 'SYS' ;



################################ Æ¯Á¤ ¼¼¼Ç ÃßÃâ ½ºÅ©¸³Æ®


-- Æ¯Á¤ ÅØ½ºÆ®°¡ sql¹®¿¡ Æ÷ÇÔµÈ ¼¼¼Ç
select 'alter system kill session ''' ||s.sid||','||s.serial#||''';',
       s.machine,
       s.program,
       S.osuser OS_User,
       s.username,
       s.status,
       s.last_call_et,
       q.sql_text
from   v$session s,
       v$sqltext q
where  q.address=s.sql_address
AND    type='USER'
--and q.piece=0
--And S.status in('INACTIVE','KILLED')
--and s.program not like ('%CJQ%')
--AND S.PROGRAM NOT LIKE ('%QMN%')
--AND MODULE ='JDBC Thin Client'
--AND LOGON_TIME <= SYSDATE+0.1
--AND LOGON_TIME >= SYSDATE-1.999
--AND S.USERNAME = 'PBC02'
--AND S.MACHINE LIKE '%'
and    s.sql_hash_value= q.hash_value
AND    q.sql_text LIKE '%TB_OSF%'
order by 1;


  select 'alter system kill session ''' ||s.sid||','||s.serial#||''';', 'kill -9 ' ||''||p.spid||';' ,
       s.logon_time,
       s.machine,
       s.program,
       S.osuser OS_User,
       s.username,
       s.status,
       s.last_call_et
from v$process p, v$session s,v$session_wait w
--,v$sqltext q
where p.addr(+) = s.paddr
AND type='USER'
and s.sid=w.sid
--and w.EVENT not in ('SQL*Net message from client')
--and q.piece=0
--And S.status in('INACTIVE','KILLED')
--and s.program not like ('%CJQ%')
--AND S.PROGRAM NOT LIKE ('%QMN%')
---AND MODULE ='JDBC Thin Client'
--AND LOGON_TIME <= SYSDATE+0.1
--AND LOGON_TIME >= SYSDATE-1.999
--AND S.USERNAME = 'PBC02'
--AND S.MACHINE LIKE '%'
and    s.sql_hash_value= q.hash_value
AND    q.sql_text LIKE '%TB_OSF%'
order by 1;

select 'alter system kill session ''' ||s.sid||','||s.serial#||''';', 'kill -9 ' ||''||p.spid||';' ,
       s.logon_time,
       s.machine,
       s.program,
       S.osuser OS_User,
       s.username,
       s.status,
       s.last_call_et,
       Q.SQL_ID
from v$process p, v$session s,v$session_wait w,v$sqltext q
where p.addr(+) = s.paddr
AND type='USER'
and s.sid=w.sid
and s.sql_hash_value= q.hash_value
--and w.EVENT not in ('SQL*Net message from client')
--and q.piece=0
--And S.status in('INACTIVE','KILLED')
--and s.program not like ('%CJQ%')
--AND S.PROGRAM NOT LIKE ('%QMN%')
---AND MODULE ='JDBC Thin Client'
--AND LOGON_TIME <= SYSDATE+0.1
--AND LOGON_TIME >= SYSDATE-1.999
--AND S.USERNAME = 'PBC02'
--AND S.MACHINE LIKE '%'
AND Q.SQL_TEXT LIKE '%OSTPCTrblGenInfoRegQ.retrieveTrblList%'
order by 1


select 'alter system kill session ''' ||s.sid||','||s.serial#||''';', 'kill -9 ' ||''||p.spid||';' ,
       s.logon_time,
       s.machine,
       s.program,
       S.osuser OS_User,
       s.username,
       s.status,
       s.last_call_et,
       Q.SQL_TEXT
from v$process p, v$session s,v$sqltext q -- ,v$session_wait w
where p.addr(+) = s.paddr
AND type='USER'
--and s.sid=w.sid
and s.sql_hash_value= q.hash_value
--and w.EVENT not in ('SQL*Net message from client')
--and q.piece=0
--And S.status in('INACTIVE','KILLED')
--and s.program not like ('%CJQ%')
--AND S.PROGRAM NOT LIKE ('%QMN%')
---AND MODULE ='JDBC Thin Client'
--AND LOGON_TIME <= SYSDATE+0.1
--AND LOGON_TIME >= SYSDATE-1.999
AND S.USERNAME like 'DPO%'
--AND S.MACHINE LIKE '%'
AND Q.SQL_TEXT LIKE '%Àå¾Ö¸ñ·ÏÁ¶È¸%'
and s.last_call_et > 10
order by s.last_call_et DESC;


select 'alter system kill session ''' ||s.sid||','||s.serial#||''';', 'kill -9 ' ||''||p.spid||';' ,
       s.logon_time,
       s.machine,
       s.program,
       S.osuser OS_User,
       s.username,
       s.status,
       s.last_call_et,
       Q.SQL_TEXT
from v$process p, v$session s,v$sqltext q ,v$session_wait w
where p.addr(+) = s.paddr
AND type='USER'
and s.sid=w.sid
and s.sql_hash_value= q.hash_value
--and w.EVENT not in ('SQL*Net message from client')
--and q.piece=0
--And S.status in('INACTIVE','KILLED')
--and s.program not like ('%CJQ%')
--AND S.PROGRAM NOT LIKE ('%QMN%')
---AND MODULE ='JDBC Thin Client'
--AND LOGON_TIME <= SYSDATE+0.1
--AND LOGON_TIME >= SYSDATE-1.999
AND S.USERNAME like 'DPO%'
--AND S.MACHINE LIKE '%'
AND Q.SQL_TEXT LIKE '%PG_OSTPC_TRBLCMPL%'
--and s.last_call_et > 10
order by s.last_call_et DESC;

----»þ¶óµå sharad lock ¶ô

SELECT 'alter system kill session ''' ||s.sid||','||s.serial#||''';',
username U_NAME, owner OBJ_OWNER,
object_name, object_type, s.osuser,
DECODE(l.block,
  0, 'Not Blocking',
  1, 'Blocking',
  2, 'Global') STATUS,
  DECODE(v.locked_mode,
    0, 'None',
    1, 'Null',
    2, 'Row-S (SS)',
    3, 'Row-X (SX)',
    4, 'Share',
    5, 'S/Row-X (SSX)',
    6, 'Exclusive', TO_CHAR(lmode)
  ) MODE_HELD
FROM gv$locked_object v, dba_objects d,
gv$lock l, gv$session s
WHERE v.object_id = d.object_id
AND (v.object_id = l.id1)
AND v.session_id = s.sid
and s.username like 'NCS%'
and d.object_name='SLA_REPORT_PERIOD'
ORDER BY username, session_id;



################################# ¿À·¡µÈ DB LINK ¼¼¼Ç »èÁ¦ µðºñ¸µÅ©

select 'alter system kill session ''' ||s.sid||','||s.serial#||''';', 'kill -9 ' ||''||p.spid||';' ,
       s.logon_time,
       s.machine,
       s.program,
       S.osuser OS_User,
       s.username,
       s.status,
       s.last_call_et
from v$process p, v$session s--,v$sqltext q -- ,v$session_wait w
where p.addr(+) = s.paddr
AND type='USER'
--and s.sid=w.sid
--and s.sql_hash_value= q.hash_value
--and w.EVENT not in ('SQL*Net message from client')
--and q.piece=0
And S.status in('INACTIVE')
--and s.program not like ('%CJQ%')
AND S.PROGRAM LIKE ('%TNS%')
---AND MODULE ='JDBC Thin Client'
AND LOGON_TIME < SYSDATE-2
--AND LOGON_TIME >= SYSDATE-1.999
AND S.USERNAME IN ('PBC02','DPGWPVS')
--AND S.MACHINE LIKE 'HGW-GW2'
--AND Q.SQL_TEXT LIKE '%Àå¾Ö¸ñ·ÏÁ¶È¸%'
--and s.last_call_et > 10
order by s.last_call_et DESC;




################################# rac lock tree - kill script  ¶ôÆ®¸® locktree lock-tree


select /*+ no_merge(v) ordered */
       decode(v.hold_sid,null,'','('||v.inst_id||')'||v.hold_sid)            "Hold Sid"
      ,decode(v.wait_sid,null,'','^','v','('||v.inst_id||')'||v.wait_sid)   "Wait Sid"
      ,v.gb                  "HW type"
--    ,v.inst_id             "Instance"
      ,sw.seconds_in_wait    "Wait Time"
      ,v.type                "Lock Type"
      ,decode( v.lmode ,
         0, 'None'  ,          -- 'None' ,
         1, 'Null'  ,          -- 'Null' ,
         2, 'Row Sh',          -- 'Row Share' ,
         3, 'Row Ex',          -- 'Row Exclusive' ,
         4, 'Share' ,          -- 'Share' ,
         5, 'Sh R X',          -- 'Share Row Exclusive' ,
         6, 'Ex',              -- 'Exclusive' ,
         to_char( v.lmode ) )         "Hold Lock Mode"
      ,decode( v.request ,
         0,  'None'  ,         -- 'None' ,
         1,  'Null'  ,         -- 'Null' ,
         2,  'Row Sh',         -- 'Row Share' ,
         3,  'Row Ex',         -- 'Row Exclusive' ,
         4,  'Share' ,         -- 'Share' ,
         5,  'Sh R X',         -- 'Share Row Exclusive' ,
         6,  'Ex',             -- 'Exclusive' ,
         to_char( v.request ) )       "Request Lock Mode"
       ,(select object_name||'('||substr(object_type,1,1)||')' from dba_objects do where do.object_id = s.row_wait_obj# ) locked_obj
--     ,v.id1                          "ID1"
--     ,v.id2                          "ID2"
       ,substr(s.username,1,8 )                   as  username1
       ,to_char(s.sid)||','||to_char(s.serial# )  as  sid1
       ,substr(status,1,1)                        as  status1
       ,substr(s.sql_trace,1,2)||'/'||substr(s.sql_trace_waits,1,1)||'/'||substr(s.sql_trace_binds,1,1)                              as sql_trace1 
--     ,trunc(p.pga_alloc_mem/1024/1024)          as  pga1
       ,decode(substr(s.action,1,4),'FRM:',s.module||'(Form)','Onli',s.module||'(Form)','Conc',s.module||'(Conc)',s.module )         as module1
       ,substr(decode(sign(lengthb(s.program)-13),1,substr(s.program,1,13)||'..',s.program),1,4)                                     as pgm1
--     ,decode(s.blocking_session,null,'',substr(s.blocking_session_status,1,3)||'('||s.blocking_instance||')'||(s.blocking_session -1) ) as blocking1 
       ,s.seconds_in_wait                         as  seconds_in_wait1
       ,substr(s.event,1,25)                      as wait_event1
       ,last_call_et                              as lce1
       ,trim((select substr(sql_text,1,20) from gv$sql sq where sq.inst_id = s.inst_id and sq.sql_id  = s.sql_id and rownum= 1 ))                                as sql_text1
       ,s.machine                                 as machine1
       ,s.osuser                                  as osuser1
       ,s.terminal                                as user_info1
       ,to_char(logon_time,'yyyymmdd HH24:MI:SS') as logon1
       ,s.process                                 as cpid1
       ,p.spid                                    as spid1
       ,'kill -9 '||p.spid                        as kill1
       ,'alter system kill session '||''''||s.sid||','||s.serial#||''''||' ; ' as kill2
from (
      select rownum, inst_id, decode(request,0,to_char(sid)) hold_sid,
             decode(request,0,'^',to_char(sid)) wait_sid, sid, 
             decode(request,0,'holding','waiting') gb,
             id1,id2, lmode, request, type
      from   gv$lock
      where  (id1,id2,type ) in (select id1,id2,type from gv$lock where lmode = 0)
     ) v , gv$session s, gv$session_wait sw,gv$process         p
where v.sid = s.sid
and   v.inst_id = s.inst_id
and   s.sid = sw.sid
and   s.inst_id = sw.inst_id
and   s.paddr   = p.addr
and   s.inst_id = p.inst_id
--and   v.hold_sid is not null   -- holder¸¸ ¼±ÅÃ
--and   substr(status,1,1) ='I'  -- status inactive ¸¸ ¼±ÅÃ
order by v.id1, v.request, sw.seconds_in_wait desc;



################################# lock tree

SELECT decode(l.block, 1, '¦¨', 0, '¦¦¦¡') tree,
     , l.block
     , userenv('instance') instance_number
     , round(q.elapsed_time/1000000,0) "Elapsed Time"
     , l.sid
     , s.SERIAL#
--     , p.spid
--     , p.pid
     , s.username
     , s.status
     , (select owner||'.'||object_name from dba_objects where object_id = decode(s.ROW_WAIT_OBJ#, 0, l.id1, -1, l.id1, s.ROW_WAIT_OBJ#)) object
     , l.type
     , case 
       when l.type = 'BL' then 'Buffer Cache Management (PCM lock)'
       when l.type = 'CF' then 'Controlfile Transaction'
       when l.type = 'CI' then 'Cross Instance Call'
       when l.type = 'CU' then 'Bind Enqueue'
       when l.type = 'DF' then 'Data File'
       when l.type = 'DL' then 'Direct Loader'
       when l.type = 'DM' then 'Database Mount'
       when l.type = 'DR' then 'Distributed Recovery'
       when l.type = 'DX' then 'Distributed Transaction'
       when l.type = 'FS' then 'File Set'
       when l.type = 'IN' then 'Instance Number'
       when l.type = 'IR' then 'Instance Recovery'
       when l.type = 'IS' then 'Instance State'
       when l.type = 'IV' then 'Library Cache Invalidation'
       when l.type = 'JQ' then 'Job Queue'
       when l.type = 'KK' then 'Redo Log Kick'
       when l.type like 'L%' then 'Library Cache Lock'
       when l.type = 'MM' then 'Mount Definition'
       when l.type = 'MR' then 'Media Recovery'
       when l.type like 'N%' then 'Library Cache Pin'
       when l.type = 'PF' then 'Password File'
       when l.type = 'PI' then 'Parallel Slaves'
       when l.type = 'PR' then 'Process Startup'
       when l.type = 'PS' then 'Parallel slave Synchronization'
       when l.type like 'Q%' then 'Row Cache Lock'
       when l.type = 'RT' then 'Redo Thread'
       when l.type = 'SC' then 'System Commit number'
       when l.type = 'SM' then 'SMON synchronization'
       when l.type = 'SN' then 'Sequence Number'
       when l.type = 'SQ' then 'Sequence Enqueue'
       when l.type = 'SR' then 'Synchronous Replication'
       when l.type = 'SS' then 'Sort Segment'
       when l.type = 'ST' then 'Space Management Transaction'
       when l.type = 'SV' then 'Sequence Number Value'
       when l.type = 'TA' then 'Transaction Recovery'
       when l.type = 'TM' then 'DML Enqueue'
       when l.type = 'TS' then 'Table Space (or Temporary Segment)'
       when l.type = 'TT' then 'Temporary Table'
       when l.type = 'TX' then 'Transaction'
       when l.type = 'UL' then 'User-defined Locks'
       when l.type = 'UN' then 'User Name'
       when l.type = 'US' then 'Undo segment Serialization'
       when l.type = 'WL' then 'Writing redo Log'
       when l.type = 'XA' then 'Instance Attribute Lock'
       when l.type = 'XI' then 'Instance Registration Lock'
       end type_desc
     , l.lmode
     , case l.lmode
       when 0 then 'none'
       when 1 then 'null (NULL)'
       when 2 then 'row-S (SS)'
       when 3 then 'row-X (SX)'
       when 4 then 'share (S)'
       when 5 then 'S/Row-X (SSX)'
       when 6 then 'exclusive (X)'
       end lmode_desc
     , l.request
     , case l.request
       when 0 then 'none'
       when 1 then 'null (NULL)'
       when 2 then 'row-S (SS)'
       when 3 then 'row-X (SX)'
       when 4 then 'share (S)'
       when 5 then 'S/Row-X (SSX)'
       when 6 then 'exclusive (X)'
       end request_desc
     , l.ctime
     , q.sql_text
     , s.program
     , s.machine
     , s.module
     , s.action
FROM   v$lock l
     , v$session s
--     , v$process p
     , v$sqlarea q
WHERE 1 = 1
--  and (l.ID1, l.ID2) in (select id1, id2 from v$session, v$lock where LOCKWAIT = KADDR  and LOCKWAIT is not null)
  and l.sid = s.sid(+)
  and decode(s.STATUS, 'INACTIVE', PREV_SQL_ADDR, s.sql_address) = q.address(+)
  and l.type <> 'MR'
--  and s.paddr = p.addr(+)
order by l.id1, l.BLOCK desc, l.CTIME;



################################# lock tree with kill script and spid

SELECT decode(l.block, 1, '¦¨', 0, '¦¦¦¡') tree
     , l.block
     , userenv('instance') instance_number
     , round(q.elapsed_time/1000000,0) "Elapsed Time"
     , l.sid
     , s.SERIAL#
     , p.spid
     , p.pid
     , s.username
     , s.status
     , (select owner||'.'||object_name from dba_objects where object_id = decode(s.ROW_WAIT_OBJ#, 0, l.id1, -1, l.id1, s.ROW_WAIT_OBJ#)) object
     , l.type
     , case 
       when l.type = 'BL' then 'Buffer Cache Management (PCM lock)'
       when l.type = 'CF' then 'Controlfile Transaction'
       when l.type = 'CI' then 'Cross Instance Call'
       when l.type = 'CU' then 'Bind Enqueue'
       when l.type = 'DF' then 'Data File'
       when l.type = 'DL' then 'Direct Loader'
       when l.type = 'DM' then 'Database Mount'
       when l.type = 'DR' then 'Distributed Recovery'
       when l.type = 'DX' then 'Distributed Transaction'
       when l.type = 'FS' then 'File Set'
       when l.type = 'IN' then 'Instance Number'
       when l.type = 'IR' then 'Instance Recovery'
       when l.type = 'IS' then 'Instance State'
       when l.type = 'IV' then 'Library Cache Invalidation'
       when l.type = 'JQ' then 'Job Queue'
       when l.type = 'KK' then 'Redo Log Kick'
       when l.type like 'L%' then 'Library Cache Lock'
       when l.type = 'MM' then 'Mount Definition'
       when l.type = 'MR' then 'Media Recovery'
       when l.type like 'N%' then 'Library Cache Pin'
       when l.type = 'PF' then 'Password File'
       when l.type = 'PI' then 'Parallel Slaves'
       when l.type = 'PR' then 'Process Startup'
       when l.type = 'PS' then 'Parallel slave Synchronization'
       when l.type like 'Q%' then 'Row Cache Lock'
       when l.type = 'RT' then 'Redo Thread'
       when l.type = 'SC' then 'System Commit number'
       when l.type = 'SM' then 'SMON synchronization'
       when l.type = 'SN' then 'Sequence Number'
       when l.type = 'SQ' then 'Sequence Enqueue'
       when l.type = 'SR' then 'Synchronous Replication'
       when l.type = 'SS' then 'Sort Segment'
       when l.type = 'ST' then 'Space Management Transaction'
       when l.type = 'SV' then 'Sequence Number Value'
       when l.type = 'TA' then 'Transaction Recovery'
       when l.type = 'TM' then 'DML Enqueue'
       when l.type = 'TS' then 'Table Space (or Temporary Segment)'
       when l.type = 'TT' then 'Temporary Table'
       when l.type = 'TX' then 'Transaction'
       when l.type = 'UL' then 'User-defined Locks'
       when l.type = 'UN' then 'User Name'
       when l.type = 'US' then 'Undo segment Serialization'
       when l.type = 'WL' then 'Writing redo Log'
       when l.type = 'XA' then 'Instance Attribute Lock'
       when l.type = 'XI' then 'Instance Registration Lock'
       end type_desc
     , l.lmode
     , case l.lmode
       when 0 then 'none'
       when 1 then 'null (NULL)'
       when 2 then 'row-S (SS)'
       when 3 then 'row-X (SX)'
       when 4 then 'share (S)'
       when 5 then 'S/Row-X (SSX)'
       when 6 then 'exclusive (X)'
       end lmode_desc
     , l.request
     , case l.request
       when 0 then 'none'
       when 1 then 'null (NULL)'
       when 2 then 'row-S (SS)'
       when 3 then 'row-X (SX)'
       when 4 then 'share (S)'
       when 5 then 'S/Row-X (SSX)'
       when 6 then 'exclusive (X)'
       end request_desc
     , l.ctime
     , q.sql_text
     , s.program
     , s.machine
     , s.module
     , s.action
     , 'alter system kill session ''' ||l.sid||','||s.serial#||''';', 'kill -9 ' ||''||p.spid||';' 
FROM   v$lock l
     , v$session s
     , v$process p
     , v$sqlarea q
WHERE 1 = 1
--  and (l.ID1, l.ID2) in (select id1, id2 from v$session, v$lock where LOCKWAIT = KADDR  and LOCKWAIT is not null)
  and l.sid = s.sid(+)
  and decode(s.STATUS, 'INACTIVE', PREV_SQL_ADDR, s.sql_address) = q.address(+)
  and l.type <> 'MR'
  and s.paddr = p.addr(+)
order by l.id1, l.BLOCK desc, l.CTIME;



################################# undo »ç¿ë user session È®ÀÎÇÏ´Â ½ºÅ©¸³Æ®

select s.username usr, s.osuser osu, rn.name nam, s.sid sid, s.serial# ser, rs.xacts xac, rs.extents ext, (rs.rssize/1024) siz, ds.SEGMENT_TYPE, ds.TABLESPACE_NAME
from v$session s, v$transaction t, v$rollname rn, v$rollstat rs, dba_segments ds
where s.taddr = t.addr
and t.xidusn = rn.usn
and t.xidusn = rs.usn
and rn.name = ds.SEGMENT_NAME;

################################# DDL ÃßÃâ ÆÐÅ°Áö
set termout off

execute DBMS_METADATA.SET_TRANSFORM_PARAM(DBMS_METADATA.SESSION_TRANSFORM,'PRETTY',true);
execute DBMS_METADATA.SET_TRANSFORM_PARAM(DBMS_METADATA.SESSION_TRANSFORM,'SQLTERMINATOR',true);
--execute DBMS_METADATA.SET_TRANSFORM_PARAM(DBMS_METADATA.SESSION_TRANSFORM,'CONSTRAINTS', false);
select dbms_metadata.get_ddl('TABLESPACE',tablespace_name) from dba_tablespaces;

select dbms_metadata.get_ddl('USER',username) from dba_users;

select dbms_metadata.get_ddl('ROLE',role) from dba_roles;

select dbms_metadata.get_granted_ddl ('SYSTEM_GRANT', username)
from dba_users D, dba_sys_privs s
where d.username=s.grantee;

select dbms_metadata.get_ddl('TABLE',table_name,owner) ddl_text from dba_tables
where table_name = [Å×ÀÌºí¸í];

select dbms_metadata.get_ddl('TABLE',table_name,owner) ddl_text from dba_tables
where owner = [¿ÀºêÁ§Æ®¼ÒÀ¯ÀÚ¸í(WMSOWNR or SIMOWNR)] and table_name = [Å×ÀÌºí¸í];

select dbms_metadata.get_ddl('INDEX',index_name,owner) from dba_indexes 
where index_name = [ÀÎµ¦½º¸í];

select dbms_metadata.get_ddl('INDEX',index_name) from user_indexes 
where table_name = 'TB_RA105';


select dbms_metadata.get_ddl('CONSTRAINT',constraint_name,owner) from dba_constraints
where constraint_name = [constraint¸í];

select dbms_metadata.get_ddl(object_type,object_name,owner)
from dba_objects
where object_type in ('FUNCTION','PROCEDURE','SEQUENCE','VIEW') and owner in ('WMSUSER','WMSOWNR')
union all
select dbms_metadata.get_ddl('DB_LINK',db_link,owner)
from dba_db_links;


	select 'dbms_metadata.get_ddl(' || object_type || ',' || object_name || ',' || owner || ') from dba_objects where object_type in ('''FUNCTION''','''PROCEDURE''','''SEQUENCE''','''VIEW''') and owner in ('''DPOSF''');'
	from dba_objects
	where object_type in ('FUNCTION','PROCEDURE','SEQUENCE','VIEW') and owner in ('WMSUSER','WMSOWNR')




################################## undo tablespace free extent »çÀÌÁî¿Í ½ÇÁ¦ »ç¿ë·® Ã¼Å©

±×·±µ¥ ÀÏ¹ÝÀûÀ¸·Î »ç¿ëÇÏ´Â Å×ÀÌºí½ºÆäÀÌ½º Å©±â¸¦ È®ÀÎÇÏ´Â ½ºÅ©¸³Æ®¿¡¼­
free extent Å©±â´Â hwm Å©±â°¡ ¸Â½À´Ï´Ù. Æ®·£Àè¼ÇÀÌ °¡Àå ¸¹Àº, undo¸¦
»ç¿ëÇß´ø ¶§ÀÇ Å©±âÀÔ´Ï´Ù. temporary tablespaceÃ³·³ DB¸¦ restartÇÏ¸é
0À¸·Î ÁÙ¾îµå´Â °ÍÀÌ ¾Æ´ÏÁö¿ä.


-----------------------------------------------------------------------------
## tbs_hwm.sql - µ¥ÀÌÅÍÆÄÀÏ resize½Ã ÇÏÀÌ¿öÅÍ¸¶Å© Ç¥½Ã(hwm_used size±îÁö ´Ã¸®¸é µÊ)

doc
Æ¯Á¤ tablespace³» µ¥ÀÌÅÍÆÄÀÏÀÇ high water mark size Ãâ·Â
hwm_size ±îÁö resize ÇÏ¸é ORA-3297 ¿¡·¯¾øÀÌ ¼öÇà°¡´É
#

set verify off
set line 150
column file_name format a60 word_wrapped
break on report
compute sum of savings on report
undefine tablespace_name
column value new_val blksize
select value from v$parameter where name = 'db_block_size'
/

select tablespace_name, file_name,
ceil( blocks*&&blksize/1024/1024) file_size,
ceil( blocks*&&blksize/1024/1024) -
ceil( (nvl(hwm,1)*&&blksize)/1024/1024 ) hwm_free_size,
ceil( (nvl(hwm,1)*&&blksize)/1024/1024 ) hwm_used
from dba_data_files a,
( select file_id, max(block_id+blocks-1) hwm
from dba_extents
group by file_id having file_id in ( select file_id from dba_data_files
where tablespace_name= upper('&&tablespace_name')) ) b
where a.file_id = b.file_id(+)
and a.tablespace_name = upper('&tablespace_name')
order by B.file_id
/

undefine tablespace_name



±×·¸´Ù¸é rollback segment°¡ ¾î´À extent¸¦ »ç¿ëÇÏ°í ÀÖ´ÂÁöÀÇ Á¤º¸¸¦
¾Ë ¼ö ÀÖ½À´Ï´Ù. ¿©±â¿¡¼­µµ rollback segmentÀÇ extent°¡ Æ®·£Àè¼ÇÀÌ
³¡³ª°íµµ ÁÙ¾îµéÁö ¾Ê¾Ò½À´Ï´Ù.

## rbsinfo.sql
DOC
========================================================================'
= 3. RBS check '
========================================================================'
#
col Seg_name for a7
col Ext for a3
select /*+ use_hash(n,s,d) */
rpad(d.segment_name, 7, ' ' ) Seg_name,
rpad(s.extents, '3', ' ') Ext,
rpad(s.rssize/1024, 8, ' ' ) "Size(K)",
rpad(d.initial_extent, '7', ' ') Init_ext,
rpad(d.next_extent/1024, '7', ' ' ) "Next_ext(K)",
rpad(d.pct_increase, '3' , ' ' ) Pct_inc,
rpad(d.max_extents, '7', ' ' ) Max_ext,
rpad(optsize, '7', ' ' ) Optsize,
rpad(decode(d.status,'ONLINE','OnL','OFFLINE','OffL'), '4', ' ') St
from v$rollname n, v$rollstat s, sys.dba_rollback_segs d
where n.usn = s.usn
and d.segment_name = n.name(+);


±×·¸´Ù¸é ÀÌÁ¦´Â Áö±Ý ÇöÀç »ç¿ëÇÏ°í ÀÖ´Â rollback segment´Â ¾Æ·¡¿Í
°°½À´Ï´Ù.

## rbs_act.sql
doc
»ç¿ëÁßÀÎ rollback segment Á¤º¸ Ãâ·Â
#
col RBS format a5 trunc
col SID format 9990
col USER format a10 trunc
col COMMAND format a20 trunc
col status format a6 trunc

SELECT r.name "RBS", s.sid, s.serial#, s.username "USER", t.status,
t.cr_get, t.phy_io, t.used_ublk, t.noundo,
substr(s.program, 1, 78) "COMMAND"
FROM sys.v_$session s, sys.v_$transaction t, sys.v_$rollname r
WHERE t.addr = s.taddr
and t.xidusn = r.usn
ORDER BY t.cr_get, t.phy_io
/

[ÃâÃ³] undo tablespaceÀÇ ½ÇÁ¦ ¿ë·®À» Äõ¸®·Î È®ÀÎÇÏ·Á¸é.. |ÀÛ¼ºÀÚ ivy9902

################################## dbverify ·Î block corruption °ËÁõ

http://cafe.naver.com/prodba.cafe?iframe_url=/ArticleRead.nhn%3Farticleid=11953

################################## undo tablespace È®ÀÎ
SQL> show parameter undo_tablespace

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
undo_tablespace                      string      rbs

SQL> select file_name from dba_data_files where tablespace_name='RBS';

FILE_NAME
--------------------------------------------------------------------------------
/log_dev/oracle9i/oradata/rrbsdbtr9i_01

create undo tablespace UNDOTBS DATAFILE '/log_dev/oracle9i/oradata/undotbs.dbf' SIZE 1000M;

ALTER SYSTEM SET UNDO_TABLESPACE = UNDOTBS;
ALTER SYSTEM SET UNDO_TABLESPACE = UNDOTBS;
DROP TABLESPACE rbs including contents and datafiles;

select segment_name, tablespace_name, status
from dba_rollback_segs
order by 2;



create undo tablespace UNDOTBS DATAFILE '/aros3/oracle9i/oradata/undotbs.dbf' SIZE 1000M autoextend off; 
ALTER SYSTEM SET UNDO_TABLESPACE = UNDOTBS;
DROP TABLESPACE UNDOTBS1 including contents and datafiles;

UNDOTBS1           /aros4/oracle10g/oradata/dbtrdw/undotbs01.dbf        5740 MB 4402.88 M 1337.13 M  76.705 %

DROP TABLESPACE UNDOTBS including contents and datafiles;
create undo tablespace UNDOTBS DATAFILE '/aros4/oracle10g/oradata/dbtrdw/undotbs1.dbf' SIZE 1000M autoextend off; 

È¤½Ã ÆÄÀÏ½Ã½ºÅÛ¿¡¼­¸¸ ¸ÕÀú µ¥ÀÌÅÍÆÄÀÏÀÌ »èÁ¦µÈ °æ¿ì µ¥ÀÌÅÍÆÄÀÏ ¿ÀÇÁ¶óÀÎ½ÃÅ°°í µå¶øÇÏ±â.
ALTER DATABASE DATAFILE '/aros4/oracms/oradata/rdf_perform_data_02' OFFLINE DROP;

±×¸®°í ³ª¼­ Å×ÀÌºí½ºÆäÀÌ½º »èÁ¦
drop tablespace TS_PERFORM_DATA INCLUDING CONTENTS AND DATAFILES


*._offline_rollback_segments=¡±_SYSSMU3$¡±

  SQL> startup pfile=¡¯/u01/oacle/admin/test/pfile=inittest.ora¡¯ 

drop rollback segment "_SYSSMU3$"


¸¸¾à, DB°¡ OPEN µÇÁö ¾Ê´Â »óÈ²ÀÌ¶ó¸é CORRUPTED ROLLBACK SEGMENT ¸ñ·ÏÀ» dba_rollback_segs¿¡¼­ È®ÀÎÇÒ ¼ö ¾øÀ¸¹Ç·Î
±× ¸ñ·ÏÀ» ¾ò±â À§Çá, INIT PARAMETER ¿¡ ¾Æ·¡ ¶óÀÎÀ» ¹Ú¾Æ¼­ ´ýÇÁ¸¦ ¶°¼­ TRC ÆÄÀÏÀÇ ³»¿ëÀ» È®ÀÎÇÏ¿©
SYSSM ·Î grep ÇÑ´Ù.

event="10015 trace name context forerver, level 10"
_smu_debug_mode=1
_offline_rollback_segments=(_SYSSMU9$)
#_corrupted_rollback_segments=(_SYSSMU9$)

#####################################################################################################
############### PRIME µ¥ÀÌÅÍ ÀÌ°ü ÀÛ¾÷¼ø¼­
1. Å¸°ÙÀÇ Å×ÀÌºíÁß ¼Ò½º¿¡ ÀÖ´Â Å×ÀÌºíµéÀ» »èÁ¦
2. ¼Ò½º¿¡¼­ cool À» ÀÌ¿ëÇÏ¿© DDL ½ºÅ©¸³Æ® ÃßÃâ
3. DDL ³»¿ëÁß Å×ÀÌºí½ºÆäÀÌ½º¸¦ Å¸°Ù¿¡ ¸Â°Ô ¼öÁ¤

- 061016/akh.awk Âü°í
- grep TS *.ddl  -> TS_BMS_DATA
- SELECT TABLESPACE_NAME FROM  USER_SEGMENTS;

4. Å¸°Ù¿¡ Å×ÀÌºí »ý¼º (IMP·Î Å×ÀÌºíÀ» »ý¼ºÇÏ¸é ¼Ò½ºÀÇ ÄÚµå¿¡ Á¤ÀÇµÈ TS ³ª µðÆúÆ® TS·Î ÁöÁ¤µÇ¹Ç·Î Å×ÀÌºíÀ» ¸í½ÃÀûÀ¸·Î »ý¼º)
5. IMPORT Àü ¿©À¯°ø°£ÀÌ ÀÖ´ÂÁö Ã¼Å©
- ¼Ò½ºÀÇ »çÀÌÁî È®ÀÎ SELECT SUM(bytes)/1024/1024 FROM USER_SEGMENTS
- Å¸°ÙÀÇ ¿©À¯°ø°£ È®ÀÎ @tbsp_space ½ÇÇà

6. ¿©À¯°ø°£ÀÌ ¸ðÀÚ¶ö °æ¿ì µ¥ÀÌÅÍÆÄÀÏ Ãß°¡

7. Å©·Ð¿¡ µî·ÏµÈ ÀÏ exp °á°ú¸¦ ÀÌ¿ëÇÏ¿© import

+ TABLE -> TS_BMS_DATA
+ PK -> TS_BMS_INDEX
³ª¸ÓÁö ¿ÀºêÁ§Æ®´Â Å×ÀÌºí½ºÆäÀÌ½º¿¡ ÀúÀåµÇÁö ¾Ê°í µñ¼Å³Ê¸®¿¡ ÀúÀåµÊ.

oracms - scrjqmso

->

oracms1 - scrjbmst


############################## ÅõÆäÀÌÁîÄ¿¹Ô ½Ã ¶ôÃ³¸®

ORA-01591: lock held by in-doubt distributed transaction {id}

If Srimal is encountering this type of error, then a manual
recovery is required. It can be performed by the following
sequence (using '1.2.3' as a sample id):

1. Determine the state of the transaction.

    SELECT * FROM sys.dba_2pc_pending
        WHERE local_tran_id = '1.2.3';

2. Either force a commit or rollback, as appropriate.

    ROLLBACK FORCE '1.2.3';

SYS/CHANGE_ON_INSTALL


connect sys/CHANGE_ON_INSTALL@xxx as sysdba
rollback force '6.12.1436';


select * from DBA_LOCK
select username,osuser,sid,serial# from v$session
alter system kill session '<SID>, <serial#> '

select distinct username,osuser,sid,serial# from v$session order by osuser

[ÃâÃ³] ORA-01591|ÀÛ¼ºÀÚ ÇÑ¹ÎÁö¿ø



################################## TNSNAMES.ORA Ãß°¡ ¾øÀÌ DB LINK »ý¼º

CREATE DATABASE LINK DL_ARS1T3 CONNECT TO n101014 IDENTIFIED BY pslP3rfRpt USING '(description=
        (address_list=
            (address=
                (community=tcpcomm)
                (protocol=tcp)
               (host=10.117.123.159)
                (port=1521)))
        (connect_data=
            (sid=ARS1T3)))';
            
##################################
SQL>
grant function

GRANT EXECUTE F_EMP_FAVORATE_SEX_POSITION('2005017567') TO TESTUSER


grant create database link to scrjv2t02;

Grant succeeded.

create database link FROMWEB02 connect to scrjare4 identified by didqoare4 using 'v2web02';

SQL>select count(*) from tb_ry101@fromweb02;

  COUNT(*)
----------
create database link FROMWEB02 connect to scrjare3 identified by didqoare3 using 'v2web02';
create database link FROMWEB02 connect to scrjare4 identified by didqoare4 using 'v2web02';


ORA-02298: cannot validate (SCRJAPPG9.RE046_RE001_FK) - parent keys not found
A¿¡´Â Á¸ÀçÇÏ´Âµ¥ B¿¡´Â fk °ü°è·Î ´ëÀÀÇÏ´Â ·¹ÄÚµå°¡ ¾ø´Â ·¹ÄÚµå ¼ö 

SELECT COLUMN_NAME FROM USER_CONS_COLUMNS WHERE TABLE_NAME='TB_RE046' AND CONSTRAINT_NAME LIKE '%PK%';

SELECT COUNT(*) 
FROM TB_RE012 A
WHERE NOT EXISTS(SELECT 'X' FROM TB_RE009 B WHERE A.AGENT_SEQ = B.AGENT_SEQ);

À§ ·¹ÄÚµå¸¦ »èÁ¦ ÇÏ¸é, fk constraints »ý¼ºÀÌ °¡´É

¸¸¾à child found ·Î »èÁ¦¸¶Àú ¾ÈµÉ°æ¿ì, »èÁ¦´ë»ó Å×ÀÌºíÀ» ÂüÁ¶ÇÏ´Â Å×ÀÌºíÀÇ child ·¹ÄÚµåµµ »èÁ¦ ÇÏ°í ³ª¼­ ´Ù½Ã»èÁ¦

ORA-02298: cannot validate (SCRJAPPW.TX_JUB_RE005_GH_FK) - parent keys not


SELECT COUNT(*) 
FROM bjubsinch A
WHERE NOT EXISTS(SELECT 'X' FROM tb_re005 B WHERE A.fk_gh_ofcial_ver = B.ofcial_ver and  A.fk_gh_ofcial_no = B.ofcial_no);


delete
FROM bjubsinch A
WHERE NOT EXISTS(SELECT 'X' FROM tb_re005 B WHERE A.fk_gh_ofcial_ver = B.ofcial_ver and  A.fk_gh_ofcial_no = B.ofcial_no);

-> child Á¸Àç!

select  fk_regt_no, fk_regt_ver, fk_jub_no from bjubsline  where (fk_regt_no, fk_regt_ver, fk_jub_no)
in ( select FK_REGT_NO, FK_REGT_VER, NO
from bjubsinch a where not exists (
select 'x' from tb_re005 b where  a.fk_gh_ofcial_ver = b.ofcial_ver
and a.fk_gh_ofcial_no = b.ofcial_no  )
)
/

delete from bjubsline  where (fk_regt_no, fk_regt_ver, fk_jub_no)
in ( select FK_REGT_NO, FK_REGT_VER, NO
from bjubsinch a where not exists (
select 'x' from tb_re005 b where  a.fk_gh_ofcial_ver = b.ofcial_ver
and a.fk_gh_ofcial_no = b.ofcial_no  )
)
/
-> child ¸¦ »èÁ¦!

SELECT * 
FROM TB_RE012 A
WHERE NOT EXISTS(SELECT 'X' FROM TB_RE009 B WHERE A.AGENT_SEQ = B.AGENT_SEQ);


################################################## ÀÎµ¦½º ¾È°É¸° FK Á¶È¸

SELECT SOURCE_OWNER,SOURCE_TB,FK_NAME,SOURCE_COL,POSITION,DECODE(SUM(GOOD_YN),0,'NEED_INDEX','GOOD') FROM 
(SELECT RC.OWNER SOURCE_OWNER,RC.CONSTRAINT_NAME FK_NAME,RC.TABLE_NAME SOURCE_TB,RC.R_CONSTRAINT_NAME TARGET_PK,
        RCC.OWNER CON_OWNER,RCC.COLUMN_NAME SOURCE_COL,RCC.POSITION,
        IC.TABLE_NAME,IC.INDEX_NAME,
        DECODE(RCC.COLUMN_NAME,IC.COLUMN_NAME,IC.COLUMN_NAME,NULL) COLUMN_NAME,
        IC.COLUMN_POSITION,
        DECODE(RCC.COLUMN_NAME||RCC.POSITION, IC.COLUMN_NAME||IC.COLUMN_POSITION,1,0) GOOD_YN
FROM DBA_CONSTRAINTS RC,DBA_CONS_COLUMNS RCC,DBA_IND_COLUMNS IC
WHERE RC.OWNER=RCC.OWNER
AND RC.TABLE_NAME=RCC.TABLE_NAME
AND IC.TABLE_OWNER=RCC.OWNER
AND IC.TABLE_NAME=RCC.TABLE_NAME
AND RC.CONSTRAINT_NAME=RCC.CONSTRAINT_NAME
AND RC.CONSTRAINT_TYPE='R'
AND RC.STATUS='ENABLED'
AND RCC.POSITION IS NOT NULL
AND RCC.CONSTRAINT_NAME NOT LIKE 'PK%'
AND RC.OWNER LIKE 'DP%'
--AND POSITION >=2
--AND RC.TABLE_NAME IN ('TB_OSZ_SV_RQ','TB_OSZ_SV_RQ_NO','TB_OSZ_SV_CD','TB_OSZ_SV_CN')
)
GROUP BY SOURCE_OWNER,SOURCE_TB,FK_NAME,SOURCE_COL,POSITION
ORDER BY SOURCE_OWNER,SOURCE_TB,FK_NAME,POSITION,SOURCE_COL





##################### ÇÁ·ÒÇÁÆ® ¼³Á¤


¢Â OS»ó ÇÁ·ÒÇÁÆ® ¼³Á¤
- ¼³Á¤¹æ¹ý : Oracle ¼³Ä¡À¯ÀúÀÇ .profile¿¡ ¾Æ·¡ÀÇ ¼³Á¤À» Á¦ÀÏ ÇÏ´Ü¿¡ ¼³Á¤
             export PS1='['`hostname`:'$ORACLE_SID':'$PWD'']'' '

 

¢Â DB»ó ÇÁ·ÒÇÁÆ® ¼³Á¤
- ¼³Á¤¹æ¹ý : $ORACLE_HOME/sqlplus/admin/glogin.sql ÆÄÀÏÀÇ Á¦ÀÏ ÇÏ´Ü¿¡ ¼³Á¤
             °³¹ß±â ==> set sqlprompt "DEV:SQL> "
             Åë½Ã±â ==> set sqlprompt "TONG:SQL> "
             ¿î¿µ±â ==> set sqlprompt "PROD:SQL> "


 


##################### ¿À¶óÅ¬ ¼³Ä¡ OUI ORACLE UNIVERSAL INSTALLER ÀÌ¿ë½Ã .profile ¿¡ x-window ¼³Á¤ x window

# Oracle Universal Installer
export DISPLAY=172.20.83.163:0.0


##################################################
¾Æ½ºÅ°ÄÚµå Á¶È¸ÇÔ¼ö

dump(ÄÃ·³¸í)


SQLPLUS °èÁ¤?¾È¹°¾îº¸°í ·Î±ä sqlplus /nolog

¿À¶óÅ¬ ¹é±×¶ó¿îµå ÇÁ·Î¼¼½º Á¶È¸
ps -ef | grep ora_


¿À¶óÅ¬ È¯°æº¯¼ö È®ÀÎ
echo $ORACLE_SID


¿À¶óÅ¬
DB EXPORT TABLE´ÜÀ§
"exp.sh" 2 lines, 147 characters
exp scrjappw/scrjappw file=rbujunji.dmp buffer=6000000 compress=n \
log=exp_rbujunji.log indexes=n grants=n statistics=none rows=y tables=rbujunji


Á¶È¸½Ã ÀÎµ¦½º ¿©ºÎ Ã¼Å©
select index_name, column_name from user_ind_columns 
where table_name='DELIVER'
and	column_name in ('WOO_NO','FK_DELI_STS_CD');

select index_name, column_name from user_ind_columns 
where table_name='CODE'
and	column_name = 'NO';



´ÙÇàÈ÷ ¹®¼­ Ã£¾Ò³×¿ä ¿ø¹®¿¡ º¹»çÇØ¼­ º¸³À´Ï´Ù.

±è±â¸°animal49@paran.com

211.183.3.24

dba9i35/adm9i35

db: dba9i35

 isqlplus server
http://211.183.3.49:7777/isqlplusdba
oracle/oracle


################################### Æ¯Á¤ ´ë±â ÀÌº¥Æ®

select sid,
2    chr(bitand(p1,-16777216)/16777215)||
3    chr(bitand(p1, 16711680)/65535) "Lock",
4    bitand(p1, 65535) "Mode", 
5    p2,p3
6  from v$session_wait
7  where event like 'enq: SQ%';


################################### ºñÁ¤»ó ¼¼¼Ç ¹× Àå½Ã°£ IDLE¼¼¼Ç Ã£±â.

´ÙÀ½ SQLÀº ·Î±×¿ÂÇÑ ½Ã°£°ú SQLÀ» ¼öÇàÇÑ ½Ã°£, ±×¸®°í SQL ¼öÇàÈÄ WaitÇÑ ½Ã°£À»
ÀÓÀÇ Á¶°ÇÀ¸·Î ÁÖ¾î¼­ Àå½Ã°£ IDLE WaitÇÏ°Å³ª ¹®Á¦°¡ ÀÖ´Â ¼¼¼ÇÀ» Ã£´Â SQLÀÌ´Ù.

LAST_CALL_ET´Â ¸Å SQLÀ» ¼öÇàÇÒ¶§¸¶´Ù 0ºÎÅÍ ½ÃÀÛµÇ¸ç, ÃÊ´ÜÀ§ÀÌ´Ù.
WAIT ÄÃ·³µµ ÃÊ´ÜÀ§ÀÌ¸ç, ÀÌ°ÍÀº ¸Å Wait Event ¹ß»ý(SEQ# ÄÃ·³°ª Áõ°¡)¸¶´Ù
0À¸·Î ¸®¼ÂµÈ´Ù.
Áï, LAST_CALL_ET¿Í WAIT°ªÀÌ °ÅÀÇ °°´Ù¸é, SQL*Net °ü·Ã IDLE ÀÌº¥Æ®¿¡ Àå½Ã°£
´ë±âÁßÀÌ°Å³ª DB LINK¸¦ ÅëÇØ ÀÛ¾÷ÇÏ´Ù°¡ ¹®Á¦°¡ »ý°Ü¼­ HANG°É¸° ¼¼¼ÇÀÌ°Å³ª
enqueue°¡ °Å¸° ¼¼¼ÇÀÌ°Å³ª ¾îÂ¶µç IDLEÀÌ°Å³ª ¹®Á¦ÀÖ´Â ¼¼¼ÇÀÏ °¡´É¼ºÀÌ ³ô´Ù.
ÀÏ¹ÝÀûÀ¸·Î WAIT ÄÃ·³Àº SQL*Net °ü·ÃÀÌ ¾Æ´Ï¶ó¸é, ¾ÆÁÖ ÂªÀº°Ô Á¤»óÀÌ´Ù.

Á¶°ÇÀº ÀûÀýÈ÷ º¯°æÇØ °¡¸ç »ç¿ëÇÏ¸é µÈ´Ù.
;

SELECT S.LOGON_TIME, ROUND((SYSDATE - S.LOGON_TIME)*24*3600,2) Elap_Time,
      TO_CHAR(S.LAST_CALL_ET, '9,999,999,999,999') LAST_CALL,
      TO_CHAR(DECODE(SW.STATE,'WAITING',SW.SECONDS_IN_WAIT,'WAITED KNOWN TIME',SW.WAIT_TIME), '9,999,999,999,999') WAIT,
      SW.STATE,
      SW.SEQ#,
      S.*
FROM V$SESSION  S,
    V$SESSION_WAIT SW
WHERE TYPE <> 'BACKGROUND'
AND ROUND((SYSDATE - S.LOGON_TIME)*24,2) > 24 -- ·Î±×¿ÂÇÑÁö 24½Ã°£ÀÌ»ó Áö³­ ¼¼¼Ç
AND S.LAST_CALL_ET > 3600 * 2 -- ·Î±×¿ÂÇÑÈÄ ÃÖÁ¾ ¼öÇàÇÑ SQLÀÌ 2½Ã°£ÀÌ»ó Áö³­ ¼¼¼Ç
AND S.SID = SW.SID
AND DECODE(SW.STATE,'WAITING',SW.SECONDS_IN_WAIT,'WAITED KNOWN TIME',SW.WAIT_TIME) > 1 * 3600 -- ·Î±×¿ÂÇÑÈÄ ÃÖÁ¾ ¼öÇàÇÑ SQLÀÌ 1½Ã°£ÀÌ»ó IDLEÀÎ ¼¼¼Ç
ORDER BY WAIT DESC;


#################################### WAIT HISTORY
 ±¸´ë¼º[´ë¸®] ´ÔÀÇ ¸» :  
select * from dba_hist_active_sess_history where event like '%child completion%';
 ±¸´ë¼º[´ë¸®] ´ÔÀÇ ¸» :  
8575528 
 ±¸´ë¼º[´ë¸®] ´ÔÀÇ ¸» :  
_cursor_features_enabled = 10



#################################### ¿ÀºêÁ§Æ® »ç¿ëºóµµ Á¶»ç ½ºÅ©¸³Æ®

select (select instance_name from v$instance), a.object_owner, a.object_name,  sum(b.EXECUTIONS) exes, to_char(sysdate,'yyyymmdd') do_date
from v$sql b, (select object_owner,object_name,object_type, sql_id from v$sql_planwhere object_type = 'TABLE' and object_owner not in ('SYS','SYSTEM')) a
where b.sql_id = a.sql_id
group by a.object_owner, a.object_name;



#################################### account lock Á¶°Ç ¼öÁ¤
10G ¿¡¼­´Â ¿¬¼ÓµÈ Login Fail ( ÁÖ·Î ºñ¹ø¿¡ ÀÇÇÑ)  ½Ã Account  LOck ¹ß»ý ÇÑ´Ù.
-- Default Profile ¿¡ Á¤ÀÇµÈ login fail °ú lock time Á¶È¸
select * from dba_profiles where PROFILE='DEFAULT'
AND RESOURCE_NAME IN ('FAILED_LOGIN_ATTEMPTS','PASSWORD_LOCK_TIME');

-- FAILED_LOGIN_ATTEMPTS -- ¿¬¼ÓÇØ¼­ ·Î±ä Fail Count ½Ã User Account Lock ¹ß»ý
-- FAILED_LOGIN_ATTEMPTS Àº 10GR1 ¿¡¼­´Â UNLIMITED, 10GR2 ¿¡¼± 10 ÀÌ´Ù.
-- µðÆúÆ®·Î ¿¬¼ÓÇØ¼­ 10¹øÀÇ Password fail ½Ã Account Lock ¹ß»ýÇÔ
-- FAILED_LOGIN_ATTEMPTS °¡ 3À¸·Î Á¤ÀÇµÈ »óÈ²¿¡¼­
-- °á±¹ À¯Àú A°¡ Scott À¸·Î 3¹ø fail ½ÇÆÐ ÇÏ°í, Á¶¿ëÈ÷ ÀÖ´Â »óÅÂ¿¡¼­
-- À¯Àú B °¡ Scott À¸·Î Á¢¼Ó½Ã ¾Æ·¡¿Í °°Àº ¸Þ½ÃÁö¸¦ º¼¼ö ÀÖ´Ù.
-- °á±¹ À¯Àú B ´Â ¹«ÁËÀÏ °¡´É¼ºÀÌ ³ô´Ù.
-- ERROR:
-- ORA-28000: the account is locked

-- ACCOUNT_STATUS Á¤º¸°¡ LOCKED(TIMED) ÀÌ µÈ´Ù. Á¶È¸´Â ¾Æ·¡¿Í °°ÀÌ
-- SELECT USERNAME,ACCOUNT_STATUS,LOCK_DATE,PROFILE FROM DBA_USERS
-- WHERE ACCOUNT_STATUS ='LOCKED(TIMED)'
-- FAILED_LOGIN_ATTEMPTS º¯°æ ( ÇØ´çÀ¯ÀúÀÇ Profile ÀÌ DEFAULT ÀÏ¶§ )
-- alter profile DEFAULT LIMIT FAILED_LOGIN_ATTEMPTS 3 ;
-- Account Lock ÇØÁ¦ 
-- alter user scott account unlock ;



##########################################################################
sys user ¿ø°ÝÁ¢¼Ó Çã¿ë (TOAD, ISQLPLUS ETC)

1) PASSWORD FILE »ý¼º: orapwd file=$ORACLE_HOME/dbs/orapwDBA0IXX(SID) password=pracle entries=5

orapwd file=$ORACLE_HOME/dbs/orapwDBA9I35 password=oracle entries=5

2) init.ora ¼³Á¤: remote_login_passwordfile=exclusive <-> none

 

##########################################################################

conn /as sysdba = conn '/ as sysdab'


##########################################################################

# spfile »ý¼º
create spfile ='/dba6/dba/dba9i35/dbs/spfileDBA9I35.ora' from pfile='/dba6/dba/dba9i35/dbs/initDBA9I35.ora';

CREATE SPFILE = '$ORACLE_HOME/dbs/spfiledbac1.ora' from PFILE = '$ORACLE_HOME/dbs/initdbac1.ora'

create spfile ='/sw/oracle/product/10.2.0/dbs/spfileLGDPOSD.ora' from pfile='/sw/oracle/product/10.2.0/dbs/initLGDPOSD.ora';


create spfile ='/sw/oracle/product/10.2.0/dbs/spfileLGDPOSD.ora' from pfile='/sw/oracle/product/10.2.0/dbs/initLGDPOSD.ora';


create spfile ='/sw/oracle/product/10.2.0/dbs/spfileLGDPOST.ora' from pfile='/sw/oracle/product/10.2.0/dbs/initLGDPOST.ora';


create spfile ='/sw/oracle/product/10.2.0/dbs/spfilePOWEROO.ora' from pfile='/sw/oracle/product/10.2.0/dbs/initPOWEROO.ora';


SQL> startup
SQL> create spfile from pfile;
SQL> startup force
SQL> show parameter spfile
ÀÎ½ºÅÏ½º¸¦ ½ÃÀÛÇÏ°í pfile·Î spfileÀ» »ý¼ºÇÏ°í Àç½ÃÀÛÇÑ´Ù. ±×·¡°í spfileÀ» È®ÀÎÇÏ¸é Á¤»óÀ¸·Î spfileÀ» È®ÀÎÇÒ¼ö ÀÖ´Ù.


3. ÀÓÀÇÀÇ pfileÀ» ÀÌ¿ëÇØ¼­ start up

SQL> create pfile='/home/oracle/mydevdb.ora' from spfile;
SQL> startup force pfile=/home/oracle/mydevdb.ora
spfile·Î pfileÀ» »ý¼º(ÀÓÀÇ pfile»ý¼º)ÇÏ¿© ±× pfileÀÇ °æ·Î¸¦ ÁöÁ¤ÇÏ¿© start up ÇÒ¼ö ÀÖ´Ù.


4. ÀÓÀÇÀÇ spfileÀ» ÀÌ¿ëÇØ¼­ startup
SQL> !vi /home/oracle/param.txt
   spfile=/home/oracle/spmydevdb.ora

SQL> startup force pfile=/home/oracle/param.txt




# ÃÊ±âÈ­ ÆÄ¶ó¸ÞÅÍ È®ÀÎ
show parameter

select * from v$parameter where name like '%db%';

spfile »ç¿ë¿©ºÎ 
show spfile

1) null -> ¹Ì»ç¿ë
2) °æ·Î -> »ç¿ë


alter system set db_cache_size=12M scope=both;

# ÀÎ½ºÅÏ½º »óÅÂ
select INSTANCE_NUMBER, INSTANCE_NAME, STATUS, logins from v$instance
started : nomount
mounted : mount
OPEN : open

alter database mount | open

# darchive mode ¼³Á¤
alter database archivelog;
archive log list

############################## ALTER SYSTEM RAC

SQL> alter system set db_cache_size=30G SCOPE=MEMORY;
alter system set db_cache_size=30G SCOPE=MEMORY
*
ERROR at line 1:
ORA-32018: parameter cannot be modified in memory on another instance


SQL> alter system set db_cache_size=30G SCOPE=SPFILE;

System altered.

SQL> alter system set db_cache_size=30G SID='*';
alter system set db_cache_size=30G SID='*'
*
ERROR at line 1:
ORA-32018: parameter cannot be modified in memory on another instance

-- ÀÎ½ºÅÏ½º¸í ÁöÁ¤
SQL> alter system set db_cache_size=30G SID='PUOS1';


##########################################################################

# session  »óÅÂ
select SID, SERIAL#, username, status from v$session;

# µ¥ÀÌÅÍº£ÀÌ½º »óÅÂ
select open_mode from v$database;

# ¹é±×¶ó¿îµå ÇÁ·Î±×·¥
  1* select program,spid from v$process
SQL> /

PROGRAM                                          SPID
------------------------------------------------ ------------
PSEUDO
oracle@doctor1 (PMON)                            21205
oracle@doctor1 (DBW0)                            21210
oracle@doctor1 (LGWR)                            21217
oracle@doctor1 (CKPT)                            21222
oracle@doctor1 (SMON)                            21227
oracle@doctor1 (RECO)                            21232
oracle@doctor1 (TNS V1-V3)                       21371


show parameter background
show parameter user


À¯ÀúÆ®·¹ÀÌ½º ³²±âµµ·Ï ¼³Á¤
À¯Àú°¡ ÁöÁ¤
alter session set sql_trace=true;

°ü¸®ÀÚ°¡ ÁöÁ¤
exec dbms_system.set_sql_trace_in_session(7,12,true);

########################################### trace ÆÄÀÏÀ» 666 À¸·Î ³²±â°í ½ÍÀ¸¸é ¾Æ·¡ È÷µç ÆÄ¶ó¸ÞÅÍ Àû¿ë

*._trace_files_public=true

¸®½º³Ê Àç±âµ¿

umask 022




##########################################################################

·Î±×ÆÄÀÏ À§Ä¡
SQL> show parameter background

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
background_core_dump                 string      partial
background_dump_dest                 string      ?/rdbms/log


############################### CONSTRAINT RENAME INDEX RENAME
alter table TWCV01 rename constraint I_TWCV01_PK0 to I_TWCV01_PK;


Alter index I_TWCV01_PK0 rename to I_TWCV01_PK;



############################## SYS_CONTEXT ¸¦ ÀÌ¿ëÇÑ ¿À¶óÅ¬ È¯°æº¯¼ö Ãâ·Â


SELECT SYS_CONTEXT('USERENV','TERMINAL') terminal FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','LANGUAGE') language FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','SESSIONID') sessionid FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','INSTANCE') instance FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','ENTRYID') entryid FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','ISDBA') isdba FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','NLS_TERRITORY') nls_territory FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','NLS_CURRENCY') nls_currency FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','NLS_CALENDAR') nls_calendar FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','NLS_DATE_FORMAT') nls_date_format FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','NLS_DATE_LANGUAGE') nls_date_language FROM 
DUAL; 

SELECT SYS_CONTEXT('USERENV','NLS_SORT') nls_sort FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','CURRENT_USER') current_user FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','CURRENT_USERID') current_userid FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','SESSION_USER') session_user FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','SESSION_USERID') session_userid FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','PROXY_USER') proxy_user FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','PROXY_USERID') proxy_userid FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','DB_DOMAIN') db_domain FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','DB_NAME') db_name FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','HOST') host FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','OS_USER') os_user FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','EXTERNAL_NAME') external_name FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','IP_ADDRESS') ip_address FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','NETWORK_PROTOCOL') network_protocol FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','BG_JOB_ID') bg_job_id FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','FG_JOB_ID') fg_job_id FROM DUAL; 

SELECT SYS_CONTEXT('USERENV','AUTHENTICATION_TYPE') FROM DUAL; 



##########################ÇöÀç Æ®·¹ÀÌ½º °á°ú°¡ ¾î¶² ÆÄÀÏ¿¡ ÀúÀåµÇ°í ÀÖ´ÂÁö¸¦ Ã£´Â ¹æ¹ýÀÔ´Ï´Ù.
 
identify_trace_file.sql
SET LINESIZE 100
COLUMN trace_file FORMAT A60
SELECT s.sid,
       s.serial#,
       pa.value || '/' || LOWER(SYS_CONTEXT('userenv','instance_name')) ||    
       '_ora_' || p.spid || '.trc' AS trace_file
FROM   v$session s,
       v$process p,
       v$parameter pa
WHERE  pa.name = 'user_dump_dest'
AND    s.paddr = p.addr
AND    s.audsid = SYS_CONTEXT('USERENV', 'SESSIONID');
 
If you are using a windows environment you will need to alter the "/" to a "" in the concatenated string. The expected output from this script is displayed below.
 
ÀÚ, ÇÑ¹ø Ã£¾Æº¼±î¿ë?
SQL> @identify_trace_file.sql
       SID    SERIAL# TRACE_FILE
---------- ---------- ------------------------------------------------------------
       130      26739 /u01/app/oracle/admin/DEV/udump/dev1_ora_367660.trc
1 row selected.
SQL>
¾ÆÁ÷ Æ®·¹ÀÌ½ÌÀº ½ÃÀÛÇÏÁö ¾Ê¾Ò½À´Ï´Ù.


###########################################################################
tkprof   traceÆÄÀÏ¸í    output.txt
##########################################################################

select * from v$sql_workarea;

 

http://otn.oracle.com

useful books:
reference
concept
sql reference

 

##################### ASCII ·Î º¸±â dump()
SELECT
dump(b.chg_reason)
FROM tb_ra185
WHERE recev_seq = 26166
;

##################### ÇÑ±ÛÀ» 2byte·Î ±æÀÌ°è»ê lengthb()

¿À¶óÅ¬¿¡¼­ lengthÇÔ¼ö¸¦ »ç¿ëÇÏ¸é ÇÑ±ÛÀ» 1byte·Î °è»êÇÏ¿© ¸®ÅÏÇÑ´Ù.
ÇÑ±ÛÀ» 2byte·Î °è»êÇÏ¿© ¸®ÅÏ¹ÞÀ¸·Á¸é lengthbÇÔ¼ö¸¦ »ç¿ëÇØ¾ß ÇÑ´Ù.
¿¹Á¦)
SELECT LENGTH('È«±æµ¿'), LENGTHB('È«±æµ¿'),LENGTH('123456'), LENGTHB('123456')
  FROM DUAL
LENGTH('È«±æµ¿')  LENGTHB('È«±æµ¿')  LENGTH('123456')   LENGTHB('123456')
----------------   ------------------   ----------------    ------------------
        3                            6                            6                             6

##########################################################################

select * from v$sql_workarea;


# ¼¼¼ÇÁ¤º¸ º¸±â
select SID, SERIAL#, USERNAME, MACHINE, PROGRAM, MODULE
from v$session

# shared pool  »çÀÌÁîº¸±â
select sum(bytes)/1024/1024 
from v$sgastat
where pool='shared pool'

#
select * from v$sga_dynamic_free_memory;

CURRENT_SIZE
------------
    37748736


select * from v$rowcache



select * from v$sqlarea


* ORA-4031: SHAREDPOOL SIZE ºÎÁ· -> Áõ°¡½ÃÅ³°Í
ALTER SYSTEM FLUSH SHARED_POOL;


########################  Å×ÀÌºí BUFFER_POOL º¯°æ

TONG:SQL> show parameter keep

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
_keep_remote_column_size             boolean     TRUE
buffer_pool_keep                     string
control_file_record_keep_time        integer     7
db_keep_cache_size                   big integer 1920M

¸ÕÀú INIT ÆÄ¶ó¸ÞÅÍ Áß db_keep_cache_size °¡ ¼³Á¤µÇ¾îÀÖ¾î¾ß ÇÑ´Ù.


alter table hr.employees storage (buffer_pool keep);

alter table POW_BC.TB_BCORPUSH_SVC storage (buffer_pool DEFAULT);

# KEEP ¿©ºÎ º¯°æ ÈÄ, ½ÇÁ¦ ÇöÀç ¸Þ¸ð¸®¿¡ KEEP ¿©ºÎ È®ÀÎ
SELECT * FROM gv$db_object_cache WHERE TYPE <> 'CURSOR' AND UPPER(NAME) LIKE '%TB_BCORPUSH_SVC%' ;

# KEEP ¿©ºÎ º¯°æ ÈÄ, ½ÇÁ¦ ÇöÀç ¸Þ¸ð¸®°¡ ¾Æ´Ñ ¼Ó¼ºÀÇ KEEP ¿©ºÎ È®ÀÎ
SELECT BUFFER_POOL FROM DBA_TABLES
WHERE TABLE_NAME='TB_BCORPUSH_SVC';

keep, reycle, default

alter table hr.employees cache;



select * from dba_tables
where owner like 'DPOW%'
AND BUFFER_POOL <> 'DEFAULT';

-- °¢ Ç®ÀÇ HIT RATIO
select name,
       round((1-(physical_reads / (db_block_gets + consistent_gets)))*100)||'%' "Hit Ratio"
from   sys.v$buffer_pool_statistics
where  db_block_gets + consistent_gets > 0
/

############################ SGA, SHARED_POOL FREE ¿µ¿ª º¸±â

SELECT A.POOL                           as "pool name", 
       b.sumsga/1024/1024               as "ÃÑ SGA MB",
       (b.sumsga/1024/1024 - a.bytes/1024/1024)   as "»ç¿ë Mem MB",
       a.bytes/1024/1024                as "Free Mem MB",
       c.shared/1024/1024               as "Free Shared MB",
       a.bytes/b.sumsga*100.            as "Free Mem %",
       a.bytes/c.shared*100.            as "Free Shared %"
from v$sgastat a,
      ( select sum(value) as sumsga
         from v$sga) b,
      (select sum(bytes) as shared 
         from v$sgastat
        where pool='shared pool') C
where a.name = 'free memory'



##########################################################################
##########################################################################
##########################################################################


##########################################################################
µñ¼Å³Ê¸® ¸ÞÅ¸Á¤º¸
select * from dictionary;

ÄÁÆ®·ÑÆÄÀÏÁ¤º¸
desc v$controlfile_record_section

redo ¸®µÎ·Î±×ÆÄÀÏ Á¤º¸
SELECT group#, status, member FROM v$logfile;


Âü°í·Î redo log status °¡ active ÀÏ °æ¿ì
alter system checkpoint;



SELECT TO_CHAR(FIRST_TIME,'YYYYMMDD') ,COUNT(*) FROM V$LOG_HISTORY
GROUP BY TO_CHAR(FIRST_TIME,'YYYYMMDD')
order by 1 desc


############################################################# ¿À¶óÅ¬ ´ýÇÁ dump
-- Dump Library Cache details
alter system set events 'immediate trace name library_cache level 10';


#################################################################################
-- LS4 ·Î±×ÆÄÀÏ »èÁ¦/Ãß°¡ °¡ÇàÆ¯ ÀüÈ¯¿ë
--> LOG group 1,2,3,4´Â ¿î¿µ½Ã¿¡µµ »ç¿ëÇÔ
--> ÀüÈ¯ÀÛ¾÷ ÀÌÈÄ LOG group 7,8,9´Â »èÁ¦ÇÔ(ÆÄÀÏÀ§Ä¡ ¿ë·®È®ÀÎ ÇÊ¿äÇÔ)


ALTER DATABASE ADD LOGFILE (thread 1) GROUP 7 ('/data_kt_ls4/redo7aOrals4.redo','/data_kt_ls4/redo7bOrals4.redo') SIZE 1000M;
ALTER DATABASE ADD LOGFILE GROUP 8 ('/data_kt_ls4/redo8aOrals4.redo','/data_kt_ls4/redo8bOrals4.redo') SIZE 1000M;
ALTER DATABASE ADD LOGFILE GROUP 9 ('/data_kt_ls4/redo9aOrals4.redo','/data_kt_ls4/redo9bOrals4.redo') SIZE 1000M;

alter system switch logfile;
alter system switch logfile;
alter system switch logfile;
alter system switch logfile;
alter system switch logfile;
alter system switch logfile;

ALTER DATABASE DROP LOGFILE GROUP 1; 
ALTER DATABASE DROP LOGFILE GROUP 2; 
ALTER DATABASE DROP LOGFILE GROUP 3; 
ALTER DATABASE DROP LOGFILE GROUP 4; 

ALTER DATABASE ADD LOGFILE GROUP 1 ('/OsysData_ls4/redo1aOrals4.redo','/data_ls4/redo1bOrals4.redo') SIZE 100M reuse;
ALTER DATABASE ADD LOGFILE GROUP 2 ('/OsysData_ls4/redo2aOrals4.redo','/data_ls4/redo2bOrals4.redo') SIZE 100M reuse;
ALTER DATABASE ADD LOGFILE GROUP 3 ('/OsysData_ls4/redo3aOrals4.redo','/data_ls4/redo3bOrals4.redo') SIZE 100M reuse;
ALTER DATABASE ADD LOGFILE GROUP 4 ('/OsysData_ls4/redo4aOrals4.redo','/data_ls4/redo4bOrals4.redo') SIZE 100M reuse;

alter system switch logfile;

ALTER DATABASE DROP LOGFILE GROUP 5; 
ALTER DATABASE DROP LOGFILE GROUP 6; 



  
 

- redo ¸®µÎ·Î±× ±×·ì Ãß°¡

(thread 1)

RAC ¿¡¼­´Â THREAD Àý Ãß°¡ (¾î¶² ÀÎ½ºÅÏ½º°¡ »ç¿ëÇÒ °ÍÀÎÁö Á¤ÀÇ)

ALTER DATABASE ADD LOGFILE THREAD 1
GROUP 1
('/home/oracle/MYDB/disk1/redolog01_01.log',
 '/home/oracle/MYDB/disk2/redolog01_02.log',) size 20m,
 
 
ALTER DATABASE ADD LOGFILE

GROUP 1

('/home/oracle/MYDB/disk1/redolog01_01.log',

 '/home/oracle/MYDB/disk2/redolog01_02.log',) size 20m,

GROUP 2

('/home/oracle/MYDB/disk3/redolog02_01.log',

 '/home/oracle/MYDB/disk4/redolog02_02.log',) size 20m

 

- ¸®µÎ·Î±× ±×·ì »èÁ¦

ALTER DABASE DROP LOGFILE GROUP 1

 

¡Ø »èÁ¦½Ã ÁÖÀÇ »çÇ×

ÇöÀç ¸®µÎ·Î±×±×·ìÀÇ »óÅÂ°¡ CURRENT,ACITIVE ÀÌ¸é ¸®µÎ·Î±×¸¦ Àý´ë »èÁ¦ÇÒ¼ö ¾ø´Ù.

»èÁ¦ Àü¿¡ ¸ÕÀú LOGFILE SWITCH ¸¦ ¹ß»ý½ÃÄÑ¼­ INACTIVE »óÅÂ·Î ¸¸µé¾î¾ß ÇÑ´Ù.

´Ü, LOGFILE SWITCH ¸¦ ÇÑ´Ù°í ²À INACTIVE »óÅÂ°¡ µÇ´Â°ÍÀº ¾Æ´Ï´Ù. ÇÏÁö¸¸ ¿©·¯¹ø ÇÏ´Ùº¸¸é

°á±¹ INACTIVE »óÅÂ·Î º¯ÇÏ°Ô µÈ´Ù.



- ¸®µÎ·Î±× ¸â¹ö Ãß°¡

ALTER DATABASE ADD LOGFILE MEMBER '/home/oracle/MYDB/disk3/redolog01_03.log'
TO  ('/home/oracle/MYDB/disk1/redolog01_01.log', '/home/oracle/MYDB/disk2/redolog01_02.log',);

 

- ¸®µÎ·Î±× ¸â¹ö »èÁ¦

ALTER DATABASE DROP LOGFILE MEMBER '/home/oracle/MYDB/disk3/redolog01_03.log';

 

- ¸®µÎ·Î±× ¸®³×ÀÓ (ÆÄÀÏÀ§Ä¡ º¯°æÀÌ³ª ÆÄÀÏÀÌ¸§ º¯°æ½Ã¿¡ »ç¿ë)

ALTER DATABASE  RENAME FILE '/diska/logs/log1a.rdo', '/diska/logs/log2a.rdo' 
                                       TO '/diskc/logs/log1c.rdo', '/diskc/logs/log2c.rdo';

 

- ¸®µÎ·Î±× °­Á¦ SWITCH

ALTER SYSTEM SWITCH logfile;

 

- ¸®µÎ·Î±× »óÅÂ È®ÀÎ

SELECT * FROM V$LOG;
SELECT * FROM V$LOGFILE;







#######################################################################

½Ã°£´ëº° logswitch È½¼ö

--set linesize 103

select to_char(first_time,'MM-DD') day,
to_char(sum(decode(to_char(first_time,'hh24'),'00',1,0)),'999') "00",
to_char(sum(decode(to_char(first_time,'hh24'),'01',1,0)),'999') "01",
to_char(sum(decode(to_char(first_time,'hh24'),'02',1,0)),'999') "02",
to_char(sum(decode(to_char(first_time,'hh24'),'03',1,0)),'999') "03",
to_char(sum(decode(to_char(first_time,'hh24'),'04',1,0)),'999') "04",
to_char(sum(decode(to_char(first_time,'hh24'),'05',1,0)),'999') "05",
to_char(sum(decode(to_char(first_time,'hh24'),'06',1,0)),'999') "06",
to_char(sum(decode(to_char(first_time,'hh24'),'07',1,0)),'999') "07",
to_char(sum(decode(to_char(first_time,'hh24'),'08',1,0)),'999') "08",
to_char(sum(decode(to_char(first_time,'hh24'),'09',1,0)),'999') "09",
to_char(sum(decode(to_char(first_time,'hh24'),'10',1,0)),'999') "10",
to_char(sum(decode(to_char(first_time,'hh24'),'11',1,0)),'999') "11",
to_char(sum(decode(to_char(first_time,'hh24'),'12',1,0)),'999') "12",
to_char(sum(decode(to_char(first_time,'hh24'),'13',1,0)),'999') "13",
to_char(sum(decode(to_char(first_time,'hh24'),'14',1,0)),'999') "14",
to_char(sum(decode(to_char(first_time,'hh24'),'15',1,0)),'999') "15",
to_char(sum(decode(to_char(first_time,'hh24'),'16',1,0)),'999') "16",
to_char(sum(decode(to_char(first_time,'hh24'),'17',1,0)),'999') "17",
to_char(sum(decode(to_char(first_time,'hh24'),'18',1,0)),'999') "18",
to_char(sum(decode(to_char(first_time,'hh24'),'19',1,0)),'999') "19",
to_char(sum(decode(to_char(first_time,'hh24'),'20',1,0)),'999') "20",
to_char(sum(decode(to_char(first_time,'hh24'),'21',1,0)),'999') "21",
to_char(sum(decode(to_char(first_time,'hh24'),'22',1,0)),'999') "22",
to_char(sum(decode(to_char(first_time,'hh24'),'23',1,0)),'999') "23"
from v$log_history
group by to_char(first_time,'MM-DD')
order by 1 desc;



#######################################################################

createdatabse ¿¡¼­ ÁöÁ¤ÇÑ °¢ ÆÄÀÏ ÁöÁ¤Ä¡¿¡¼­ ¾î´ÀÁ¤µµ »ç¿ëÇÏ°í ÀÖ´ÂÁö Á¶È¸
select type,records_total,records_used from v$controlfile_record_section

SHOW PARAMETER CONTROL_FILES;
SELECT * FROM V$CONTROLFILE

¸®µÎ·Î±×Á¤º¸
select * from v$log  ±×·ì
SELECT * FROM V$LOGFILE ¸â¹ö

µ¥ÀÌÅÍÆÄÀÏÁ¤º¸
select * from v$datafile;

µ¥ÀÌÅÍº£ÀÌ½º
SELECT NAME , CREATED , LOG_MODE ,CHECKPOINT_CHANGE# , OPEN_MODE   FROM V$DATABASE

ÀÎ½ºÅÏ½ºº¹±¸ ¿¹»ó½Ã°£
select * from v$instance_recovery;

select RECOVERY_ESTIMATED_IOS, ACTUAL_REDO_BLKS, TARGET_REDO_BLKS, LOG_FILE_SIZE_REDO_BLKS, ESTIMATED_MTTR from v$instan
ce_recovery
/
EXTENTS -SEGMENT Á¤º¸
SELECT * FROM DBA_EXTENTS WHERE SEGMENT_NAME='EMP_EMP_ID_PK';

###################################### º¹±¸½Ã ´ë»ó ÆÄÀÏ Á¶È¸


º¹±¸ÇÒ¶§ Á¶È¸ÇÏ´Â  DATAFILE : V$RECOVER_FILE

º¹±¸ÇÒ¶§ ÇÊ¿äÇÑ ARCHIVE LOG :     V$RECOVERY_LOG


##########################################################################

ÄÁÆ®·ÑÆÄÀÏ º¹±¸

1. CREATE CONTROLFILE...

2. RECOVER DATABASE ...... USING BACKUP CONTROL FILE.

 

ÄÁÆ®·Ñ ÆÄÀÏ ´ÙÁßÈ­ÇÒ°Í 

1) SHUTDOWN
2)  °æ·ÎÈ®ÀÎ  SELECT * FROM V$CONTROLFILE
3) CP
4) INIT PFILE¿¡ Ãß°¡
5) START

(spfileÀÇ °æ¿ì 4¹øÀ» °¡Àå ¸ÕÀú alter system ...scope=spfile ¹®À» ÅëÇØ ÇÔ)

 



##########################################################################


recover ½Ã Æ¯Á¤ µ¥ÀÌÅÍÆÄÀÏ Á¦¿ÜÇÏ°í open ÇÒ ¶§ 
(µ¥ÀÌÅÍº¹Á¦ ½Ã ÀÏºÎ µ¥ÀÌÅÍÆÄÀÏÀº º¹Á¦°¡ ¾ÈµÈ °æ¿ì ÇØ´ç Å×ÀÌºí½ºÆäÀÌ½ºÀÇ µ¥ÀÌÅÍÆÄÀÏÀ» ¸¶¿îÆ® »óÅÂ¿¡¼­ ¿ÀÇÁ¶óÀÎ)



SQL> recover database;
ORA-00283: recovery session canceled due to errors
ORA-01110: data file 244: '/dev/dg_st_nossdb_mig01r/rdf_mig_16g_041'
ORA-01157: cannot identify/lock data file 244 - see DBWR trace file
ORA-01110: data file 244: '/dev/dg_st_nossdb_mig01r/rdf_mig_16g_041'

--- ¼Ò½º µ¥ÀÌÅÍº£ÀÌ½º¿¡¼­ ÇØ´ç Å×ÀÌºí½ºÆäÀÌ½º¸í Á¶È¸ÇÏ¿© datafile drop
select * from  dba_data_files where  file_name='/dev/dg_st_nossdb_mig01r/rdf_mig_16g_041';

select 'alter database datafile ''' || file_name || ''' offline drop;' from  dba_data_files where tablespace_name='TS_TOSSMIG_IMSI_IDX';


SQL>

Database altered.

.
.
.



SQL> recover database;

Media recovery complete.
SQL> SQL>
SQL>
SQL> alter database open;

Database altered.


##########################################################################
¼¼¼Ç ³¯Â¥Æ÷¸Ë º¯°æ
ALTER session set nls_date_format='YYYY-MM-DD HH24:MI:SS';

 

##########################################################################


  1* alter profile default limit password_verify_function verify_function
SQL> /

Profile altered.

SQL>
SQL>
SQL>
SQL> alter user sh identified by sh
  2  ;
alter user sh identified by sh
*
ERROR at line 1:
ORA-28007: the password cannot be reused


SQL> 
alter profile default limit password_verify_function null; (veryfy_function)
alter profile default limit PASSWORD_REUSE_TIME unlimited;

Àç½Ãµµ -> ¼º°ø


##########################################################################

À¯Àúº° Å×ÀÌºí½ºÆäÀÌ½º, ÇÒ´ç·®

dba_users
dba_ts_quotas

 

##########################################################################

SELECT GRANTED_ROLE FROM DBA_ROLE_PRIVS WHERE GRANTEE='SCRJDW';

select * from system_privilege_map;


±×·£Æ® °á°ú À¯Àú ÀÔÀå¿¡¼­ È®ÀÎ
select * from session_privs;



211.183.3.24


select * from dba_segments
where tablespace_name='USERDATA';


############################## SUPPLEMENTAL LOG GROUP »ý¼º ¹× »èÁ¦

CREATE TABLE "CR"."TCR05"
 (    "BUB_CD" VARCHAR2(6),
      "SA_NO" VARCHAR2(14),
      "BYUN_SER" NUMBER(4,0),
      "BYUN_NM" VARCHAR2(80),
      "DAM_NM" VARCHAR2(80),
      "BYUN_CD" VARCHAR2(1),
      "DAE_CD" VARCHAR2(2),
      "POST" VARCHAR2(8),
      "ADDR1" VARCHAR2(30),
      "ADDR2" VARCHAR2(60),
      "TEL" VARCHAR2(60),
      "FAX" VARCHAR2(60),
      "INTER_ID" VARCHAR2(60),
      "BANK_NM" VARCHAR2(20),
      "BANK_NO" VARCHAR2(20),
      "SD_FLG" VARCHAR2(1),
      "BOSU_DAY" VARCHAR2(10),
      "BOSU_AMT" NUMBER(13,0),
      "PASS_DAY" VARCHAR2(10),
      "ADD_REASON" VARCHAR2(200),
      "JDB_FLAG" VARCHAR2(1),
      "WK_SD_FLG" VARCHAR2(1) DEFAULT NULL,
      "BSCAL_DAY" VARCHAR2(10),
      "BSJG_BUB_CD" VARCHAR2(6),
      "BSJG_SA_NO" VARCHAR2(14),
      "BSCAL_STD_INC_GBNCD" VARCHAR2(2),
      "BSCAL_STD_INC_RATE" NUMBER(13,0),
      "FTN_BOSU_AMT" NUMBER(13,0),
      "BSREQ_TAMT" NUMBER(13,0),
      "BGSO_BSREQ_DAY" VARCHAR2(10),
      "BGSO_BSJG_DAY" VARCHAR2(10),
      "EMSVC_SIN_DAY" VARCHAR2(10),
      "SD_NM" VARCHAR2(80),
       SUPPLEMENTAL LOG GROUP "CR_TCR05_GR0" ("BUB_CD", "SA_NO", "BYUN_SER", "BYUN_NM", "DAM_NM", "BYUN_CD", "DAE_CD", "POST", "ADDR1", "ADDR2", "TEL", "FAX", "INTER_ID", "BANK_NM",
"BANK_NO", "SD_FLG", "BOSU_DAY", "BOSU_AMT", "PASS_DAY", "ADD_REASON", "JDB_FLAG", "WK_SD_FLG", "BSCAL_DAY", "BSJG_BUB_CD", "BSJG_SA_NO", "BSCAL_STD_INC_GBNCD",
"BSCAL_STD_INC_RATE", "FTN_BOSU_AMT", "BSREQ_TAMT", "BGSO_BSREQ_DAY") ALWAYS,
       SUPPLEMENTAL LOG GROUP "CR_TCR05_GR1" ("BGSO_BSJG_DAY", "EMSVC_SIN_DAY", "SD_NM") ALWAYS
 ) PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
STORAGE(INITIAL 67108864 NEXT 67108864 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
TABLESPACE "TSCRDATA1"; 


ALTER TABLE KS.TKS004 DROP SUPPLEMENTAL LOG GROUP KS_TKS004_GR0 ;


######################################################################################
drop tablespace userdata including contents and datafiles;

create tablespace userdata
datafile '?/dbs/userdata01.dbf' size 10m
extent management dictionary
default storage (initial 100k next 200k pctincrease 50  minextents 5 maxextents 100);


--select * from dba_tablespaces;

--select * from dba_data_files;


create table emp
(
no number(10)
)
tablespace userdata;

create table dept
(
no number (10)
)
tablespace userdata;



select * from dba_tablespaces;

select * from dba_segments
where tablespace_name='USERDATA';

select d.*, d.bytes/1024 from dba_extents d
where tablespace_name='USERDATA';


###################################################################### ERD ¸ðµ¨¸µ Âü°í
http://cafe.naver.com/sybaseealab/192


######################################################################################


undo_retention °ª È®ÀÎ

select * from V$UNDOSTAT 
show parameter undo_retention 

SQL> show parameter undo_tablespace;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
undo_tablespace                      string      UNDO_TMP_01


######################################################################################

CREATE DATABASE ¿¡¼­ DEFAULT TEMPORARY TABLESPACE temp ÁöÁ¤ÇÏ¸é USER·¹º§¿¡¼­ TEMP TS ÁöÁ¤¾ÈÇØµµ µÊ


ALTER DATABASE DEFAULT TEMPORARY TABLESPACE temp;

TS -> LOCAL UNIFORM SIZE ÁöÁ¤ÇÏ¸é, USER·¹º§¿¡¼­ STORAGE ¿É¼Ç ÁöÁ¤¾ÈÇØµµ µÊ.



B µðºñ¿¡¼­ TEMP1À¸·Î ÁöÁ¤µÈ USER SCHEME À» A µðºñ·Î ÀÌ°ü ½Ã 
A µðºñ¿¡¼­´Â µðºñ ·¹º§¿¡¼­ DEFAULT TEMP ·Î ÁöÁ¤µÇ¾îÀÖÀ» °æ¿ì, 

########################################### TEMP Å×ÀÌºí ½ºÆäÀÌ½º TEMPFILE OFFLINE ONLINE
alter database tempfile '/dev/vg_oradata005/rdf_data018_05000' offline;


SELECT 'fuser -u ' || file_name || ';', 'alter database tempfile ''' || file_name || ''' offline;' FROM DBA_TEMP_FILES
WHERE TABLESPACE_NAME='TEMP_MIG';

fuser °á°ú ÇÁ·Î¼¼½º È®ÀÎ ÈÄ À¯ÀúÇÁ·Î¼¼½ºÀÌ¸é kill ÇÏ°í ³ª¼­ drop


######################################################################################

ALTER DATABASE DATAFILE '?/dbs/userdata01.dbf' autoextend on
  2  next 10m maxsize 500m;




######################################################################################
´ë¹ý¿ø Àû¿ë °í·Á »çÇ×


Å×ÀÌºí·¹º§ µðÆúÆ® Å×ÀÌºí½ºÆäÀÌ½º ÁöÁ¤ -> user ·¹º§ µðÆúÆ® Å×ÀÌºí½ºÆäÀÌ½º ÁöÁ¤.

9-26
¼öµ¿ pctused ... ´ë½Å¿¡ 
segment space management auto  ¼³Á¤?

POO.TB_LIVELOGDATA 

10-23
select end_time, begin_time, undoblks 
from v$undostat;

´ë·® Á¶È¸ snapshot too old ¿¡·¯ ¹æÁö À§ÇØ
undotbs »çÀÌÁî Áõ°¡

ÇÇÅ©Å¸ÀÓ 10ºÐ ¾ðµÎºí·° »ç¿ë¼ö, ÇÑ½Ã°£(ÀÐ±âÀÏ°ü¼º º¸ÀåÇÏ°íÀÚ ÇÏ´Â ½Ã°£±æÀÌ)·Î È¯»êÇÏ¿© *4k ¸¦
undotbs »çÀÌÁî·Î ¼³Á¤

init param undo_retention=3600 (ÇÑ½Ã°£) À¸·Î ¼³Á¤



Å×ÀÌºí½ºÆäÀÌ½º º¯°æ & rebuild
11-25


##################################################### RAC  ÀÎ½ºÅÏ½º¸¦ ½Ì±Û·Î º¹±¸ÇÒ ¶§,

INIT ÆÄÀÏÀÇ RAC °ü·Ã ¼³Á¤À» »©°í ±¸¼º


SQL> shut
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> startup
ORA-00439: feature not enabled: Real Application Clusters


This completely deadlocks the normal way to alter the spfile. Even a startup nomount can not be issued, because the database can not get to the nomount stage. The workaround is quite simple, though:


oracle@bedrock:~$ cd $ORACLE_HOME/dbs
oracle@bedrock:~/app/oracle/product/10.2.0/server/dbs$ strings spfileXE.ora | grep -v cluster_database > initXE.ora
oracle@bedrock:~/app/oracle/product/10.2.0/server/dbs$ rm spfileXE.ora
oracle@bedrock:~/app/oracle/product/10.2.0/server/dbs$ sqlplus / as sysdba



##################################################### REFERENCE LINK
SHARED_POOL, ROW CACHE OBJECT, LATCH
http://www.oracle.com/technology/global/kr/pub/columns/dbtuning02.html


#####################################################  »ç¿ëÀÚ ¼¼¼Ç È¯°æº¯¼ö

select userenv('SID') from dual;



#####################################################
DROP COLUMN ´ë½Å UNUSED »ç¿ë?

########################################################## COMMENT Ä¿¸ÇÆ®
ALTER TABLE DPTOW_OSO.TB_OSO_TPS_CONS_REQ ADD ATCH_FILE_ID NUMBER(10);
COMMENT ON COLUMN DPTOW_OSO.TB_OSO_TPS_CONS_REQ.ATCH_FILE_ID IS 'Ã·ºÎÆÄÀÏID';

ALTER TABLE DPTOW_OSM.TB_OSM_BLD_AREA ADD OCOM_CLNE_LDIN_YN VARCHAR2(1) DEFAULT 'N';
COMMENT ON COLUMN TB_OSM_BLD_AREA.OCOM_CLNE_LDIN_YN IS 'Å¸»ç°ü·ÎÀÎÀÔ¿©ºÎ';

ALTER TABLE DPTOW_OSM.TB_OSM_BLD_AREA ADD ATCH_FILE_ID NUMBER(10);
COMMENT ON COLUMN DPTOW_OSM.TB_OSM_BLD_AREA.TB_OSM_BLD_AREA IS 'Ã·ºÎÆÄÀÏID';

µñ¼Å³Ê¸®¿¡¼­ Æ¯Á¤ Å×ÀÌºí Ä¿¸ÇÆ® ÃßÃâ
select 'COMMENT ON COLUMN ' || OWNER || '.' || TABLE_NAME || '.' || COLUMN_NAME || ' IS ''' || COMMENTS || ''';' from dba_col_comments
where table_name='TB_OSC_CONSK_ADDN_APBS';

select 'COMMENT ON COLUMN ' || OWNER || '.' || TABLE_NAME || '.' || COLUMN_NAME || ' IS ''' || COMMENTS || ''';' from dba_col_comments
where table_name IN (
'TB_OSF_SUIT_INPT_INFO'
)
UNION ALL
select 'COMMENT ON TABLE ' || OWNER || '.' || TABLE_NAME || ' IS ''' || COMMENTS || ''';' from 
dba_TAB_comments
where table_name IN (
'TB_OSF_SUIT_INPT_INFO'
)
;



######################################################################################

create global temporary tABLE temp
(no number(10),
name varchar2(20),
)on commit preserve rows
/


#################  AUTO_SPACE_ADVISOR_JOB

EXECUTE DBMS_SCHEDULER.DISABLE('AUTO_SPACE_ADVISOR_JOB');

SELECT * FROM DBA_scheduler_JOBS;


#################  Predefined Automatic Statistics Collection Job
Automatic Statistics Collection Job
A Scheduler job 
S_JOB is predefined upon installation of Oracle Database. GATHER_STATS_JOB collects optimizer statistics for all objects in the database for which there are no statistics or only stale statistics.

If you prefer to manage statistics collection manually, you can disable the job as follows:

EXECUTE DBMS_SCHEDULER.DISABLE('GATHER_STATS_JOB');

ÆÄ¿öÄÞ ¿À¶óÅ¬ Åë°è¼öÁý ÇÁ·Î¼¼½º

- 10g ±âÁØ

- ¿À¶óÅ¬ ¼³Ä¡½Ã ±âº»À¸·Î ¼³Ä¡, µî·Ï, È°¼ºÈ­µÇ´Â SYS ¼ÒÀ¯ÀÇ GATHER_STATS_JOB ÀâÀ» ÅëÇØ¼­ ÀÚµ¿ ¼öÁýÇÔ.
SQL> SELECT OWNER,JOB_NAME,PROGRAM_NAME,SCHEDULE_NAME,JOB_CLASS,ENABLED,STATE,LAST_START_DATE FROM DBA_SCHEDULER_JOBS WHERE JOB_NAME = 'GATHER_STATS_JOB';
OWNER	JOB_NAME	PROGRAM_NAME	SCHEDULE_NAME	JOB_CLASS	ENABLED	STATE	LAST_START_DATE
SYS	GATHER_STATS_JOB	GATHER_STATS_PROG	MAINTENANCE_WINDOW_GROUP	AUTO_TASKS_JOB_CLASS	TRUE	SCHEDULED	2009/02/12 22:00:02.625434 +09:00

- GATHER_STATS_JOB ÀâÀº ³»ºÎÀûÀ¸·Î GATHER_STATS_PROG ¶ó´Â ÇÁ·Î±×·¥À» ÀÌ¿ëÇÏ¿© Åë°è¸¦ ¼öÁýÇÔ.
SQL> SELECT * FROM DBA_SCHEDULER_PROGRAMS WHERE PROGRAM_NAME = 'GATHER_STATS_PROG';
OWNER	JOB_NAME	PROGRAM_NAME	SCHEDULE_NAME	JOB_CLASS	ENABLED	STATE	LAST_START_DATE
SYS	GATHER_STATS_JOB	GATHER_STATS_PROG	MAINTENANCE_WINDOW_GROUP	AUTO_TASKS_JOB_CLASS	TRUE	SCHEDULED	2009/02/12 22:00:02.625434 +09:00

- GATHER_STATS_PROG ÇÁ·Î±×·¥Àº ³»ºÎÀûÀ¸·Î DBMS_STATS.GATHER_DATABASE_STATS_JOB_PROC ÆÐÅ°Áö.ÇÁ·Î½ÃÀú¸¦ »ç¿ëÇÔ.
GATHER_DATABASE_STATS_JOB_PROC ÆÐÅ°Áö´Â ¿À¶óÅ¬ Internal ÇÁ·Î½ÃÀú·Î ¼Ò½ºÄÚµå¸¦ È®ÀÎÇÒ ¼ö ¾ø´Â °ÍÀ¸·Î º¸ÀÓ. 
ÀÌÀü Åë°è°¡ Á¸ÀçÇÏÁö ¾Ê°Å³ª, ÀÌÀüÅë°è¿Í ºñ±³ÇØ 10%ÀÌ»óÀÇ ·Î¿ìµéÀÌ º¯°æµÈ °æ¿ì Åë°èÁ¤º¸ ¼öÁý.

- º» ÀâÀº DBA_SCHEDULER_SCHEDULES µñ¼Å³Ê¸®¿¡ µî·ÏµÇÁö ¾ÊÀ¸¸ç º» ÀâÀÌ ¼Ò¼ÓµÈ WINDOW_GROUPS ÀÇ ÀÚÃ¼ ½ºÄÉÁìÀ» µû¸§. 
ÀÌ·¯ÇÑ ±¸Á¶·Î, ÆòÀÏ ¸ÅÀÏ 10pm ~ 6am  »çÀÌ, Åä, ÀÏ¿äÀÏ ÇÏ·çÁ¾ÀÏ À§ ÀâÀÌ ½ÇÇàµÊ. ½ÇÇà Áß ¿Ï·áµÇÁö ¸øÇÑ ÀâÀº ´ÙÀ½ WINDOW ¿¡ ÀÌ¾î¼­ ½ÇÇàµÊ.
°í°´Åë½Ã ÀÎ½ºÅÏ½º ±âÁØÀ¸·Î ¸¶Áö¸· ½ÇÇà½Ã ¼öÇà½Ã°£Àº ¾à 4ºÐ 30ÃÊÀÓ. ¸¶Áö¸· ¼öÇà½Ã°¢Àº 12ÀÏ 22½Ã, ´ÙÀ½ ¼öÇà½Ã°¢Àº 13ÀÏ 22½ÃÀÓ.
SQL> SELECT * FROM DBA_SCHEDULER_WINDOW_GROUPS WHERE WINDOW_GROUP_NAME='MAINTENANCE_WINDOW_GROUP';

- ÃÖ±ÙÀÇ Àâ ¼öÇà³»¿ªÀº ¾Æ·¡¿Í °°À½.
SQL> SELECT * FROM DBA_SCHEDULER_JOB_LOG 
WHERE JOB_NAME='GATHER_STATS_JOB' 
ORDER BY LOG_DATE DESC;

-
In situations when you want to disable automatic statistics gathering, the most direct approach is to disable the GATHER_STATS_JOB as follows:

BEGIN
  DBMS_SCHEDULER.DISABLE('GATHER_STATS_JOB');
END;
/


EXECUTE DBMS_SCHEDULER.DISABLE('GATHER_STATS_JOB');

EXECUTE DBMS_SCHEDULER.ENABLE('GATHER_STATS_JOB');


---- Á¶È¸

SELECT * FROM DBA_SCHEDULER_WINDOWS;

WINDOW_NAME	RESOURCE_PLAN	SCHEDULE_OWNER	SCHEDULE_NAME	SCHEDULE_TYPE	START_DATE	REPEAT_INTERVAL	END_DATE	DURATION	WINDOW_PRIORITY	NEXT_START_DATE	LAST_START_DATE	ENABLED	ACTIVE	MANUAL_OPEN_TIME	MANUAL_DURATION	COMMENTS
WEEKNIGHT_WINDOW				CALENDAR		freq=daily;byday=MON,TUE,WED,THU,FRI;byhour=22;byminute=0; bysecond=0		+000 08:00:00.000000000	LOW	2011/10/13 22:00:00.900000 +09:00	2011/10/12 22:00:00.892275 +09:00	TRUE	FALSE			Weeknight window for maintenance task
WEEKEND_WINDOW				CALENDAR		freq=daily;byday=SAT;byhour=0;byminute=0;bysecond=0		+002 00:00:00.000000000	LOW	2011/10/15 00:00:00.000000 +09:00	2011/10/08 06:00:02.444460 +09:00	TRUE	FALSE			Weekend window for maintenance task


Automatic statistics gathering
- Âü°íÀÚ·á ¿À¶óÅ¬ ºÏ: http://download.oracle.com/docs/cd/B19306_01/server.102/b14211/stats.htm#sthref1068


################################ Åë°è¼öÁý Àß ¿Ï·áµÇ¾ú´ÂÁö.

SELECT * FROM DBA_scheduler_JOBS;

################################# 1. ¿À¶óÅ¬ 10g¿¡¼­ DBMS_STATS ÆÐÅ°Áö »ç¿ë½Ã ÁÖÀÇÁ¡ 

CBO(Cost Based Optimizer) È¯°æ¿¡¼­, Å×ÀÌºí°ú ÀÎµ¦½º¿¡ ´ëÇÑ Åë°èÁ¤º¸¸¦ »ý¼ºÇÏ´Â ¹æ¹ýÀº Å©°Ô 

2°¡Áö°¡ Á¸ÀçÇÑ´Ù. 

ÇÏ³ª´Â ANALYZE ¸í·É¾îÀÌ¸ç, ´Ù¸¥ ÇÏ³ª´Â DBMS_STATS ÆÐÅ°Áö¸¦ »ç¿ëÇÏ´Â ¹æ¹ýÀÌ´Ù. 

ANALYZE ¸í·É¾î¸¦ »ç¿ëÇÒ °æ¿ì¿¡´Â CHAIN_CNT ¿Í °°ÀÌ, CBOÀÇ cost °è»ê½Ã¿¡ »ç¿ëµÇÁö ¾Ê´Â Á¤º¸µµ 

¼öÁýÇÑ´Ù´Â ÀåÁ¡ÀÌ ÀÖÀ¸³ª, DBMS_STATS ÆÐÅ°ÁöÀÇ »ç¿ëÆíÀÇ¼º, º´·Ä Ã³¸® °¡´É, ÆÄÆ¼¼Ç ·¹º§ÀÇ 

Åë°èÁ¤º¸ ¼öÁýÀÌ °¡´ÉÇÏ´Ù´Â ÀåÁ¡¿¡ ÀÇÇØ, DBMS_STATS ÆÐÅ°ÁöÀÇ »ç¿ëÀÌ ÀÏ¹ÝÈ­µÇ°í ÀÖ´Ù. 

ÀÏ¹ÝÀûÀ¸·Î DBMS_STATS ÆÐÅ°Áö¸¦ »ç¿ëÇÏ¿© ´ë¿ë·® Å×ÀÌºí°ú ÀÎµ¦½º¿¡ ´ëÇÑ Åë°èÁ¤º¸¸¦ »ý¼ºÇÏ´Â 

¸í·É¾î´Â ´ÙÀ½°ú °°À» °ÍÀÌ´Ù.

 

SQL> exec dbms_stats.gather_table_stats(ownname=>'SCOTT', -

      tabname=>'BIG_TAB', -

      degree=>   4, -

      cascade=> TRUE);
 


 

À§¿Í °°Àº ¸í·É¾î¸¦ ¼öÇàÇÏ°Ô µÉ °æ¿ì¿¡, 4°³ÀÇ º´·Ä ÇÁ·Î¼¼½º°¡ ±âµ¿µÇ¾î, Å×ÀÌºí¿¡ ´ëÇØ¼­´Â º´·Ä·Î 

Åë°èÁ¤º¸¸¦ ¼öÁýÇÏ°í, ÀÎµ¦½º¿¡ ´ëÇØ¼­´Â SerialÇÏ°Ô Åë°èÁ¤º¸¸¦ ¼öÁýÇÏ°Ô µÈ´Ù. 

ÇÏÁö¸¸ ¿À¶óÅ¬ 10g¿¡¼­´Â ÀÌ¿Í °°Àº ¹æ¹ýÀ¸·Î Å×ÀÌºí°ú ÀÎµ¦½º¿¡ ´ëÇÑ Åë°èÁ¤º¸¸¦ ¼öÁýÇÏ°Ô µÉ °æ¿ì¿¡ 

Ä®·³ È÷½ºÅä±×·¥ÀÌ ÀÚµ¿À¸·Î »ý¼ºµÇ°Ô µÈ´Ù. 

 

±× ÀÌÀ¯´Â gather_table_stats ÇÁ·Î½ÃÀúÀÇ ¾ÆÅ¥¸ÕÆ®ÀÎ method_optÀÇ ±âº»¼³Á¤ °ªÀÌ ¿À¶óÅ¬ 9i±îÁö´Â

'FOR ALL COLUMNS SIZE 1'ÀÎµ¥ ¹ÝÇÏ¿©, ¿À¶óÅ¬ 10gºÎÅÍ´Â 'FOR ALL COLUMNS SIZE AUTO'·Î 

º¯°æµÇ¾ú±â ¶§¹®ÀÌ´Ù (mothod_optÀÇ ¹æ¹ý¿¡´Â AUTO, SKEWONLY, REPEAT, SIZE [n]ÀÌ ÀÖ´Ù). 

 

ÀÏ¹ÝÀûÀ¸·Î Ä®·³ È÷½ºÅä±×·¥ÀÌ¶õ µ¥ÀÌÅÍÀÇ ºÐÆ÷µµ°¡ ±ÕµîÇÏÁö ¾ÊÀº Ä®·³¿¡ ´ëÇØ¼­¸¸ »ý¼ºÇÏ´Â °ÍÀÌ 

ÀÏ¹ÝÀûÀÌ¸ç, ¿øÄ¡ ¾Ê´ø Ä®·³ È÷½ºÅä±×·¥ÀÌ »ý¼ºµÉ °æ¿ì, ÇØ´ç Ä®·³ÀÇ selectivity°¡ º¯ÇÏ°Ô µÇ¾î 

¿ÉÆ¼¸¶ÀÌÀú°¡ ÀûÀýÇÑ ÀÎµ¦½º¸¦ ¼±ÅÃÇÏ´Âµ¥ ÀÖ¾î¼­, ¹æÇØ ¿ä¼Ò·Î ÀÛ¿ëÇÏ°Ô µÈ´Ù. 

µû¶ó¼­, ÀÌ·¯ÇÑ ¹®Á¦Á¡À» ¿¹¹æÇÏ±â À§ÇØ¼­ ±âÁ¸¿¡ »ç¿ëÇÏ´ø Åë°èÁ¤º¸ »ý¼º ½ºÅ©¸³Æ®¿¡ 

mothod_opt=>'FOR ALL COLUMNS SIZE 1'À» Ãß°¡ÇÏ´Â ¹æ¹ýÀÌ ÀÖ°í, ±âº» ½ºÅ©¸³Æ®¸¦ ±×´ë·Î 

»ç¿ëÇÏ±â À§ÇØ¼­´Â dbms_stats.set_param ÇÁ·Î½ÃÀú¸¦ »ç¿ëÇÏ¿© ±âº»¼³Á¤ °ªÀ» º¯°æÇÏ´Â ¹æ¹ýÀÌ ÀÖ´Ù.

 

SQL> exec dbms_stats.set_param ('METHOD_OPT','FOR ALL COLUMNS SIZE 1');

È®ÀÎ¹æ¹ý

SQL> select dbms_stats.get_param('METHOD_OPT') from dual;

DBMS_STATS.GET_PARAM('METHOD_OPT')

--------------------------------------------------------------------------------

FOR ALL COLUMNS SIZE 1 


¿øº¹
exec dbms_stats.set_param ('METHOD_OPT','FOR ALL COLUMNS SIZE AUTO');








2. _OPTIMIZER_INVALIDATION_PERIOD

 ÇÃ·£ÀÌ º¯°æµÇ¾î Äõ¸®ÀÇ ¼º´ÉÀÌ ´Ê¾îÁ³À» °æ¿ì

½Å±Ô·Î Åë°èÁ¤º¸¸¦ ¼öÁýÇØ Äõ¸®ÀÇ ÇÃ·£À» Á¤»óÀ¸·Î ¹Ù²Ù¾î ³õ¾ÒÀ¸³ª,

º¯°æµÈ Åë°èÁ¤º¸ÀÇ ¹Ý¿µÀÌ ¾ÈµÇ¾î ÇÃ·£°ú ½ÇÁ¦ execution plan ÀÌ ´Ù¸¥ °æ¿ì

¾Æ·¡ÀÇ ³»¿ëÀ» Âü°í ÇÏ¿© ¹Ý¿µÇÑ´Ù.

 

ÃâÃ³: http://wiki.ex-em.com/index.php/OPTIMIZER_INVALIDATION_PERIOD 

Oracle 10gºÎÅÍ´Â Åë°è Á¤º¸ ¼öÁý ½Ã °ü·ÃµÈ SQL Cursor¸¦ Áï½Ã invalidation½ÃÅ°Áö ¾Ê°í, ÀÏÁ¤ ½Ã°£ÀÌ Áö³ª ÈÄ¿¡ invalidation ½ÃÅ²´Ù. _OPTIMIZER_INVALIDATION_PERIOD ÆÄ¶ó¹ÌÅÍ´Â ÀÌ °ªÀ» °áÁ¤ÇÑ´Ù. ±âº»°ªÀº 18000(ÃÊ)(=5½Ã°£)ÀÌ´Ù. Áï, Åë°è Á¤º¸ ¼öÁý¿¡ ÀÇÇØ Åë°è Á¤º¸°¡ º¯°æµÈ ÈÄ ¾à 5½Ã°£¿¡ °ÉÃÄ ·£´ýÇÑ ½ÃÁ¡¿¡ ÇØ´ç Cursor°¡ ½ÇÇàµÉ ¶§ invalidationÀÌ ¹ß»ýÇÑ´Ù. ÀÌ°ÍÀ» Auto InvalidationÀÌ¶ó°í ºÎ¸¥´Ù. ÀÏÁ¤ ½Ã°£¿¡ °ÉÃÄ ·£´ýÇÏ°Ô Cursor¸¦ InvalidationÇÔÀ¸·Î½á Æ¯Á¤ ½ÃÁ¡¿¡ Hard Parse°¡ ÇÑ²¨¹ø¿¡ ¸ô¸®´Â Çö»óÀ» ÇÇÇÒ ¼ö ÀÖ´Ù. 

DBMS_STATS ÆÐÅ°Áö¸¦ ÀÌ¿ëÇØ Åë°è Á¤º¸ ¼öÁý½Ã NO_INVALIDATE ¿É¼ÇÀ» ÀÌ¿ëÇØ SQL Cursor°¡ invalidation µÇ´Â ½ÃÁ¡À» ÁöÁ¤ÇÒ ¼ö ÀÖ´Ù. NO_INVALIDATE ¿É¼Ç °ª¿¡ ÀÇÇÑ invalidation ÀÛµ¿ ¹æ½ÄÀº ´ÙÀ½°ú °°´Ù. 

NO_INVALIDATE = False : Åë°è Á¤º¸ º¯°æ ½Ã °ü·ÃµÈ SQL CursorµéÀÌ Áï½Ã invalidationµÈ´Ù. 9i¿¡¼­ÀÇ ±âº»°ªÀÌ´Ù. 
NO_INVALIDATE = True : Åë°è Á¤º¸ º¯°æ ½Ã °ü·ÃµÈ SQL CursorµéÀ» invalidationÇÏÁö ¾Ê´Â´Ù. SQL Cursor°¡ Shared Pool¿¡¼­ FlushµÈ ÈÄ ReloadµÉ ¶§ º¯°æµÈ Åë°è Á¤º¸°¡ ¹Ý¿µµÈ´Ù. 
NO_INVALIDATE = DBMS_STATS.AUTO_INVALIDATE : Åë°è Á¤º¸ º¯°æ½Ã °ü·ÃµÈ SQL CursorµéÀ» ÀÏÁ¤ ½Ã°£(_OPTIMIZER_INVALIDATION_PERIOD)¿¡ °ÉÃÄ °ñ°í·ç(·£´ýÇÏ°Ô) invalidationÇÑ´Ù. 10g¿¡¼­ÀÇ ±âº»°ªÀÌ´Ù. ¾ö¹ÐÇÏ°Ô ¸»ÇÏ¸é ±âÁ¸ SQL CursorµéÀ» invalidation½ÃÅ°´Â °ÍÀÌ ¾Æ´Ï¶ó »õ·Î¿î Child Cursor¸¦ »ý¼ºÇÑ´Ù. »ý¼ºµÈ Child Cursor¸¦ V$SQL_SHARED_CURSOR ºä¿¡¼­ Á¶È¸ÇØº¸¸é roll_invalid_mismatch¿¡ ÀÇÇØ Mismatch°¡ ¹ß»ýÇÑ °ÍÀ¸·Î Ã³¸®µÇ´Â °ÍÀ» È®ÀÎÇÒ ¼ö ÀÖ´Ù. 
10g¿¡¼­ÀÇ Åë°è Á¤º¸ ¼öÁý 
Oracle 10gºÎÅÍ´Â no_invalidate ¿É¼ÇÀÇ ±âº»°ªÀÌ DBMS_STATS.AUTO_INVALIDATEÀÌ´Ù. Áï, Åë°è Á¤º¸¸¦ Àç¼öÁýÇØµµ °ü·ÃµÈ SQL CursorµéÀÌ invalidateµÇÁö ¾Ê´Â´Ù. µû¶ó¼­ Åë°è Á¤º¸¸¦ ¹Ý¿µÇØÁÖ·Á¸é Shared PoolÀ» Flush(alter system flush shared_pool)À» ÇØÁÖ¾î¾ß ÇÑ´Ù. 

Åë°è Á¤º¸ ¼öÁýÀÇ ±âº» °¡ÀÌµå´Â OracleÀÇ ±âº» Çàµ¿ ¾ç½Ä(Áï Auto invalidation)À» »ç¿ëÇÏµÇ, Æ¯Á¤ SQL Cursor¸¦ Áï½Ã invalidationÇÏ·Á¸é Session ·¹º§¿¡¼­ _OPTIMIZER_INVALIDATION_PERIOD ÆÄ¶ó¹ÌÅÍ °ªÀ» ÁÙÀÌ´Â °ÍÀÌ´Ù. 

alter system set "_optimizer_invalidation_period" = 1;




################ Index ÀÛ¾÷½Ã Åë°èÁ¤º¸ °ü¸® ¹æ¹ý
CBOÈ¯°æ¿¡¼­ Åë°èÁ¤º¸¸¦ °ü¸®ÇÏ´Â DB ¿¡ index °ü·Ã ÀÛ¾÷½Ã  Åë°èÁ¤º¸ »óÅÂ¸¦ È®ÀÎ ÈÄ ÀÛ¾÷ ÇØÁÖ½Ã±â ¹Ù¶ø´Ï´Ù.
(Åë°èÁ¤º¸°¡ °»½ÅµÇ¾î¾ß ÇÏ´ÂÁö, °»½ÅµÇÁö ¸»¾Æ¾ß ÇÏ´ÂÁö, gathering µÇÁö ¸»¾Æ¾ß ÇÏ´ÂÁö´Â  DBA°¡ ÆÇ´ÜÇÒ°Í)

-.  ÀÎµ¦½º »ý¼º, º¯°æ, rebuild ½Ã ÇØ´ç Å×ÀÌºíÀÇ Åë°èÁ¤º¸ lock status¸¦ È®ÀÎÇÏ¿© ÀÛ¾÷ ÇÒ °Í.
-. ÀÛ¾÷Àü  cdmon/showstatlock À» »ç¿ëÇÏ¿© STATT ÄÃ·³ÀÌ "ALL" ·Î ³ª¿Í ÀÖÀ¸¸é Åë°èÁ¤º¸ lockÀÌ °É¸° »óÅÂ
-. lock°É¸° »óÅÂ¿¡¼­´Â indexÀÛ¾÷½Ã Åë°èÁ¤º¸ °ªÀÌ gathering µÇÁö ¾ÊÀ½.
-.  °ü·Ã ÀÛ¾÷ ÈÄ¿¡´Â ¹Ýµå½Ã lock status¸¦  ±âÁ¸À¸·Î º¯°æ ÇÏµµ·Ï ÇÒ °Í.
 

==> Åë°èÁ¤º¸   lock  : EXEC DBMS_STATS.LOCK_TABLE_STATS('owner', 'object_name');
                   unlock : EXEC DBMS_STATS.UNLOCK_TABLE_STATS('owner', 'object_name);


ex)
CREATE INDEX DMADM.K_CDS2_DLR_BOND_3IX
on DMADM.K_CDS2_DLR_BOND
(
CREDIT_CODE,   POS_ID,   ACCNT_DATE                      
)
TABLESPACE TS_DMI02;

OWNER                          INDEX_NAME                       NUM_ROWS LAST_ANALYZE TABLESPACE_NAME
------------------------------ ------------------------------ ---------- ------------ ------------------------------
DMADM                          K_CDS2_DLR_BOND_2IX               1848735 16-JAN-08    TS_DMI01
DMADM                          K_CDS2_DLR_BOND_3IX                                              TS_DMI02
DMADM                          K_CDS2_DLR_BOND_PK                1732527 10-DEC-07    TS_DMI01
DMADM                          K_CDS2_DLR_BOND_1IX               1806229 31-DEC-07    TS_DMI01





################ ½ºÅ°¸¶º° Åë°è¼öÁý Á¦ÇÑ
DBMS_STATS.LOCK_SCHEMA_STATS()
DBMS_STATS.UNLOCK_SCHEMA_STATS()



################# Åë°è ¼öÁý

EXEC DBMS_STATS.GATHER_TABLE_STATS(OWNNAME=>'DPTOW_OSF', TABNAME=>'TB_OSF_EQP_USE_RAT');

analyze ´Â Åë°èÁ¤º¸¼öÁý ¾ÈµÊ

ANALYZE ·Î È÷½ºÅä±×·¥ »ý¼ºÇÏ·Á¸é,

analyze table DPTOW_OSF.TB_OSF_EQP_USE_RAT  COMPUTE statistics FOR ALL COLUMNS;
analyze table DPTOW_OSF.TB_OSF_EQP_USE_RAT  COMPUTE statistics FOR COLUMNS "ÄÃ·³¸í";


È÷½ºÅä±×·¥ Á¤º¸ Âü°í

ALL_TAB_HISTOGRAMS
DBA_TAB_HISTOGRAMS


################# Å×ÀÌºí º° Åë°è ¼öÁý lock/unlock

SYS.GATHER_STATS_JOB ÀÌ ÆòÀÏ 22½Ã/ ÁÖ¸» 12½Ã¿¡ ½ÃÀÛÇÏ¿©¼­ Åë°èÁ¤º¸¸¦ ¼öÁý. 

¼öÁýÇÏ´Â µ¿¾È Å×ÀÌºí¿¡ LOCK À» °É±â ¶§¹®¿¡ Åë°èÁ¤º¸¸¦ ¼öÁý Á¤Áö ½ÃÅ´. 

- Å×ÀÌºí ÀÚÃ¼¿¡ LOCK¸¦ °Å´Â ¹æ¹ý 
EXEC DBMS_STATS.LOCK_TABLE_STATS('owner_name','table_name'); 

- OWNER ÀüÃ¼ ½ºÅ°¸¶¿¡ LOCK¸¦ °Å´Â ¹æ¹ý 
EXEC DBMS_STATS.LOCK_SCHEMA_STATS('owner_name'); 

--LOCKÀÌ °É·È´ÂÁö È®ÀÎÇÏ±â ( °ªÀÌ ALL ) 
Select OWNER,TABLE_NAME,STATTYPE_LOCKED from dba_tab_statistics
WHERE OWNER LIKE 'DPOW_OS%';

- ¹Ý´ë·Î LOCK¸¦ Çª´Â ¹æ¹ý 
EXEC DBMS_STATS.UNLOCK_TABLE_STATS('owner_name','table_name'); 



select 'EXEC DBMS_STATS.LOCK_TABLE_STATS('''||OWNER || ''',''' || TABLE_NAME || ''');'  from dba_tables 
where owner like 'DPO%' 
and num_rows > 2000000;

Select DISTINCT OWNER,TABLE_NAME from dba_tab_statistics
WHERE OWNER LIKE 'DPOW_OSF'
AND STATTYPE_LOCKED='ALL';

Select 'EXEC DBMS_STATS.UNLOCK_TABLE_STATS(''' || OWNER || ''',''' || TABLE_NAME || ''');'  from dba_tab_statistics
WHERE OWNER LIKE 'DPOW_OSF'
AND STATTYPE_LOCKED='ALL';



################# Åë°è ¼öÁý SAMPLE SIZE »ùÇÃ»çÀÌÁî
select TABLE_NAME, NUM_ROWS, SAMPLE_SIZE,LAST_ANALYZED,  SAMPLE_SIZE/NUM_ROWS*100 from dba_tables
where owner='POW_BC'
AND NUM_ROWS <> 0
AND TABLE_NAME LIKE 'TB_BMRSDW%'
ORDER BY 5 DESC;


################# ANALYZE compute statistics

analyze table DPTOW_OSF.TB_OSF_EQP_USE_RAT  COMPUTE statistics;

¼öÁýµÈ Åë°èÁ¤º¸ Á¦°Å

analyze table DPTOW_OSF.TB_OSF_EQP_USE_RAT delete statistics;

################# SAMPLE ANALYZE

analyze table DPOW_OSF.TB_OSF_PEQP  estimate statistics sample 10 percent;


analyze table POW_OD.TRBL_PP_SO_TB  estimate statistics sample 10 percent;

SELECT 'analyze table ' || OWNER || '.' || TABLE_NAME || ' estimate statistics sample 10 percent;'
FROM DBA_TABLES
WHERE OWNER IN (
'GROUPAPM',
'PWAS',
'POTIS',
'QMSWEB',
'XONAPM',
'XPEEDWEB',
'INFORM',
'OSSAPM',
'IRSWEB');

############################## Åë°èÁ¤º¸ Å¸ DB·Î ÀÌ°ü

1. Åë°èÁ¤º¸ ÀúÀå TABLE»ý¼º
exec dbms_stats.create_stat_table('POW_BC','STATS');

2. Åë°èÁ¤º¸ Å×ÀÌºí¿¡ Åë°èÁ¤º¸ ÀÌ°ü
exec dbms_stats.export_table_stats('POW_BC','TABLE_NAME',NULL,'STATS',NULL, TRUE);

3. Åë°èÁ¤º¸ ÀúÀå Å×ÀÌºí EXPORT/IMPORT
exp system/lgu!xhdtl tables=STATS file=expstat.dmp
imp system/lgu!roqkf file=expstat.dmp full=y log=implog.txt

4. Å¸°Ù DB¿¡ Åë°èÁ¤º¸ IMPORT
exec dbms_stats.import_table_stats('POW_BC',TABLE_NAME',NULL,'STATS');



############################## Åë°è ¹é¾÷ ¹× »ý¼º

-Åë°èÁ¤º¸ ¼öÁýÀ» À§ÇÑ Å×ÀÌºí »ý¼º

 execute dbms_stats.create_stat_table('KIGOOK','KIGOOK_STATS');

-Åë°èÁ¤º¸ ¼öÁý

 execute dbms_stats.gather_table_stats(ownname=>'KIGOOK',stattab=>'KIGOOK_STATS',tabname=>'TEST',method_opt=>'FOR ALL INDEXED COLUMNS SIZE 100',cascade=>'TRUE');

 select blocks from dba_tables where table_name='TEST';

-Åë°èÁ¤º¸ ¹é¾÷(anal_table_exp)

 execute dbms_stats.export_table_stats(ownname=>'KIGOOK',tabname=>'TEST',stattab=>'KIGOOK_STATS',cascade=>TRUE);

-¸¶±¸ º¯°æ

 -insert ÀÛ¾÷ + Åë°èÁ¤º¸ ¼öÁý(execute dbms_stats.gather_table_stats(ownname=>'KIGOOK',stattab=>'KIGOOK_STATS',tabname=>'TEST',method_opt=>'FOR ALL INDEXED COLUMNS SIZE 100',cascade=>'TRUE'); )

 -È®ÀÎ

  select blocks from dba_tables where table_name='TEST';


-Åë°èÁ¤º¸ Áý¾î³Ö±â
 
 -Åë°èÁ¤º¸ »èÁ¦
  analyze table TEST delete statistics;

 -È®ÀÎ
  select blocks from dba_tables where table_name='TEST';
 
 -Áý¾î³Ö±â(anal_table_imp)
  
  execute dbms_stats.import_table_stats(ownname=>'KIGOOK',tabname=>'TEST',stattab=>'KIGOOK_STATS',cascade=>TRUE);
 
 -È®ÀÎ
  select blocks from dba_tables where table_name='TEST';
 

############################## °ú°Å Åë°èÁ¤º¸ º¹±¸

- Åë°è º¸°ü ÁÖ±â È®ÀÎ

SELECT DBMS_STATS.GET_STATS_HISTORY_RETENTION FROM DUAL;
SELECT DBMS_STATS.GET_STATS_HISTORY_AVAILABILITY FROM DUAL;

- Åë°è ¼öÁý ÀÌ·Â È®ÀÎ

SELECT * FROM DBA_TAB_STATS_HISTORY WHERE TABLE_NAME='XXX';

SELECT * FROM DBA_TAB_STATS_HISTORY
WHERE TABLE_NAME='TB_OSZ_ATCH_FILE';


- °ú°Å Åë°è·Î º¹¿ø

EXEC DBMS_STATS.RESTORE_TABLE_STATS('AA','A1','½Ã°£');

EXEC DBMS_STATS.RESTORE_TABLE_STATS('DPOW_OSZ','TB_OSZ_ATCH_FILE','2011/11/04 23:20:02.496841 +09:00');




- °ú°Å Åë°è·Î º¹¿ø È®ÀÎ

DBA_TABLES


#################  DBMS_STATS.GATHER_TABLE_STATS Åë°è¼öÁý Åë°è ¼öÁý analyze ´ëÃ¼

SELECT /*+ RULE */
  'EXEC DBMS_STATS.GATHER_TABLE_STATS(OWNNAME=>'''||OWNER||''', TABNAME=>'''||A.TABLE_NAME ||''', '||
  CASE
    WHEN B.SSIZE > 10000 THEN 'ESTIMATE_PERCENT=>0.1, DEGREE=>10 , '
    WHEN B.SSIZE > 5000 THEN 'ESTIMATE_PERCENT=>1, DEGREE=>10 , '
    WHEN B.SSIZE > 1000 THEN 'ESTIMATE_PERCENT=>5, DEGREE=>10 , '
    WHEN B.SSIZE > 500 THEN 'ESTIMATE_PERCENT=>10, DEGREE=>4 , '
    WHEN B.SSIZE > 100 THEN 'ESTIMATE_PERCENT=>30, DEGREE=>4 , '
    WHEN B.SSIZE > 0 THEN 'ESTIMATE_PERCENT=>100, DEGREE=>2 , '
    ELSE ''
  END ||'METHOD_OPT=>''FOR ALL COLUMNS SIZE 1'', CASCADE=>TRUE , GRANULARITY=>''AUTO'');'
FROM DBA_TABLES A ,
  (
    SELECT SEGMENT_NAME,
      SUM(BYTES)/1024/1024 SSIZE
    
    FROM DBA_SEGMENTS
    WHERE SEGMENT_TYPE LIKE 'TABLE%'
      AND OWNER LIKE 'DPTOW_OS_'
    GROUP BY SEGMENT_NAME ) B
WHERE A.TABLE_NAME = B.SEGMENT_NAME
   AND OWNER IN ('DPTOW_OSZ','DPTOW_OSO')
ORDER BY A.OWNER, A.TABLE_NAME;


EXEC DBMS_STATS.GATHER_TABLE_STATS(OWNNAME=>'POW_OO', TABNAME=>'TB_BCORCONT_SBC', ESTIMATE_PERCENT=>5, DEGREE=>10 , METHOD_OPT=>'FOR ALL COLUMNS SIZE 1', CASCADE=>TRUE , GRANULARITY=>'AUTO');




SELECT /*+ RULE */
  'EXEC DBMS_STATS.GATHER_TABLE_STATS(OWNNAME=>'''||OWNER||''', TABNAME=>'''|| TABLE_NAME ||''', '|| 'ESTIMATE_PERCENT=>100, DEGREE=>32 , '|| 'METHOD_OPT=>''FOR ALL COLUMNS SIZE 1'', CASCADE=>TRUE , GRANULARITY=>''AUTO'');'
FROM DBA_TABLES
WHERE OWNER='DPOW_OSF'
AND TABLE_NAME IN (
'TB_OSF_CIR_NODE'
,'TB_OSF_CIR_NODE_HIS'
,'TB_OSF_CIR_NODE_LNK'
,'TB_OSF_CIR_NODE_LNK_HIS'
,'TB_OSF_CIR_NODE_LNK_TMP_TRNK'
,'TB_OSF_CIR_NODE_MULT_LNK'
,'TB_OSF_CIR_NODE_MULT_LNK_HIS'
,'TB_OSF_CIR_NODE_TMP_TRNK'
,'TB_OSF_TMP_CIR_NODE'
,'TB_OSF_TMP_CIR_NODE_LNK'
,'TB_OSF_TMP_CIR_NODE_MULT_LNK'
);




SELECT /*+ RULE */
  'EXEC DBMS_STATS.GATHER_TABLE_STATS(OWNNAME=>'''||OWNER||''', TABNAME=>'''||A.TABLE_NAME ||''', '||
  CASE
    WHEN B.SSIZE > 10000 THEN 'ESTIMATE_PERCENT=>100, DEGREE=>16 , '
    WHEN B.SSIZE > 5000 THEN 'ESTIMATE_PERCENT=>100, DEGREE=>16 , '
    WHEN B.SSIZE > 1000 THEN 'ESTIMATE_PERCENT=>100, DEGREE=>16 , '
    WHEN B.SSIZE > 500 THEN 'ESTIMATE_PERCENT=>100, DEGREE=>16 , '
    WHEN B.SSIZE > 100 THEN 'ESTIMATE_PERCENT=>100, DEGREE=>16 , '
    WHEN B.SSIZE > 0 THEN 'ESTIMATE_PERCENT=>100, DEGREE=>16 , '
    ELSE ''
  END ||'METHOD_OPT=>''FOR ALL COLUMNS SIZE 1'', CASCADE=>TRUE , GRANULARITY=>''AUTO'');'
FROM DBA_TABLES A ,
  (
    SELECT SEGMENT_NAME,
      SUM(BYTES)/1024/1024 SSIZE
    
    FROM DBA_SEGMENTS
    WHERE SEGMENT_TYPE LIKE 'TABLE%'
      AND OWNER LIKE 'DPOW_OSF'
    GROUP BY SEGMENT_NAME ) B
WHERE A.TABLE_NAME = B.SEGMENT_NAME
   AND OWNER IN ('DPOW_OSF')
   and table_name in (
'TB_OSF_PEQP'
,'TB_OSF_AFFL_EQP'
,'TB_OSF_BDWN_RPAR_DTLS'
,'TB_OSF_BDWN_RPAR_TGT'
,'TB_OSF_BDWN_RPAR_PROG'
,'TB_OSF_BDWN_RPAR_MEMO'
,'TB_OSF_EQP_POTB'
,'TB_OSF_EQP_DYN'
,'TB_OSF_EQP_DYN_PROG'
,'TB_OSF_EQP_DYN_TGT'
,'TB_OSF_SAME_INSTL_PLC'
)
ORDER BY A.OWNER, A.TABLE_NAME;



################# analyze, dbms_StatsÆÐÅ°Áö

1)
select 'ANALYZE TABLE '||table_name||' COMPUTE STATISTICS; ' from tabs ;

2)
sqlplus /nolog << EOF                                                                               
conn sys/didqosys                                                                                   
set echo on                                                                                         
set feedback on                                                                                     
spool new_alyz_2.lst                                                                                
set heading on                                                                                      
select to_char( sysdate, 'YY-MM-DD hh24:mi:ss' ) Start_Time from dual;                              
set heading off                                                                                     
execute dbms_stats.gather_table_stats( -                                                            
ownname => 'SCRJV2XX1', -                                                                           
tabname => 'PLAN_TABLE', -                                                                          
partname => null, -                                                                                 
estimate_percent => null, -                                                                         
block_sample => false, -                                                                            
method_opt => 'FOR ALL COLUMNS SIZE 1', -                                                           
degree => null, -                                                                                   
granularity => 'default', -                                                                         
cascade => true, -                                                                                  
stattab => null, -                                                                                  
statid => null, -                                                                                   
statown => null);     



analyze table xxx compute statistics;
analyze table xxx estimate statistics sample 10 percent;


##################################  raw device ¿¡¼­ file systemÀ¸·ÎÀÇ dd copy
1. raw device¿¡´Â LVCB(Logical Volume Control Block)°¡ ÀÖÁö¸¸ file system¿¡´Â ¾øÀ¸¹Ç·Î
   ¹Ýµå½Ã skipÀ» ÁöÁ¤ÇØ¾ß ÇÕ´Ï´Ù.

   bs´Â ÆÄÀÏ ÀÔÃâ·ÂÀÇ block(¹öÆÛ) Å©±âÀÌ¹Ç·Î º¹»çÇÒ ¶§ ¼Óµµ¿¡ ¿µÇâÀÌ ÀÖÀ» °Ì´Ï´Ù.
   - skip  : ÀÔ·Â ÆÄÀÏ¿¡¼­ Ã³¸®ÇÏÁö ¾Ê°í Åë°úÇÒ ºí·ÏÀÇ °³¼ö
             (Raw Device to Filesystem º¹»ç ½Ã ÁöÁ¤ÇØ¾ß ÇÔ)
   - seek  : Ãâ·Â ÆÄÀÏ¿¡¼­ Ã³¸®ÇÏÁö ¾Ê°í Åë°úÇÒ ºí·ÏÀÇ °³¼ö
             (Filesystem to Raw Device º¹»ç ½Ã ÁöÁ¤ÇØ¾ß ÇÔ)

   - count : º¹»çÇÒ È¸¼ö or ºí·ÏÀÇ °³¼ö (»ý·« ½Ã ¸ðµç µ¥ÀÌÅÍ º¹»ç )
             (Raw Device a Filesystem º¹»ç ½Ã ¹Ýµå½Ã ¸í½ÃÇØ¾ß ÇÔ, ±× ÀÌ¿ÜÀÇ °æ¿ì´Â »ý·« °¡´É)

ÇÃ·§Æû
	
LVCB
ÇÃ·§Æû
LVCB
Solaris
0
True64
64KB
HP-UX
0
Linux
0
AIX
4KB
Windows
0

2. ¾ÈÁ¤ÀûÀÎ °ÍÀº ±¸º°ÇÒ ¼ö ¾øÀ» °Í °°°í, ´Ù¸¸ rmÀ» ÇÏÁö ¾ÊÀ» °æ¿ì DB¿¡¼­ »èÁ¦µÈ datafileÀÌ ³²¾Æ ÀÖÀ» ¼ö ÀÖ½À´Ï´Ù.
 
3. dbfsize·Î È®ÀÎÇÏ½Ã¸é µË´Ï´Ù.

   $ORACLE_HOME/bin/dbfsize <Oracle Datafile ¸í>
   [file system °á°ú]
   /data05/TESTDB] dbfsize UNDO01_01.dbf
   Database file: UNDO01_01.dbf
   Database file type: file system             : File Type
   Database file size: 128000 8192 byte blocks :8192 byte BlockÀÌ 128000 °³

   [raw device °á°ú]

   Database file type: raw device             :
File Type
   Database file size: 1408 8192 byte blocks  : 8192 byte BlockÀÌ 1408 °³

   ¡Ø dbsize·Î Á¶È¸ÇÑ °á°ú(Dictionary View¿¡¼­ select·Î Á¶È¸ÇÑ block ¼öµµ ¸¶Âù°¡Áö)¿¡´Â
      Datafile Header Block ¹× LVCB°¡ Æ÷ÇÔµÇÁö ¾ÊÀ½.
      ´ÙÀ½°ú °°Àº °æ¿ì¿¡´Â ÆÄÀÏÀÌ ¼Õ»óµÈ °æ¿ìÀÌ¹Ç·Î ´Ù½Ã º¹»ç
      Header block file size is bad;            trying raw file format...
      Header block magic number is bad
 
Âü°í·Î...
1) Raw Device ¿¡¼­ FilesystemÀ¸·Î º¯È¯
   dd if=/dev/rv_data001 of=/data01/TESTDB/data001.dbf bs=4096 skip=1 count=2818
2) Filesystem ¿¡¼­ Raw Device·Î º¯È¯
   dd if=/data01/TESTDB/data001.dbf of=/dev/rv_data001 bs=4096 seek=1
3) Raw Device ¿¡¼­ Raw Device·Î º¹»ç
   dd if=/dev/re_data001 of=/dev/rv_data001_bk bs=4096 skip=1 seek=1

[ÃâÃ³] raw device ¿¡¼­ file systemÀ¸·ÎÀÇ dd copy¿¡°üÇÑ Áú¹®ÀÔ´Ï´Ù. (ProDBA) |ÀÛ¼ºÀÚ smileDBA

######################################  STATSPACK

ÆÐÅ°Áö¸¦ »ý¼ºÇÏ±â À§ÇÏ¿© ÇØ´ç ÆÄÀÏÀÌ ÀÖ´Â °÷À¸·Î ÀÌµ¿ÇÑ´Ù.

³ª´Â ORACLE\ORA92\RDBMS\ADMIN ¿©±â ÀÖ¾ú´Ù.

 

1. SQLPLUS·Î Á¢¼ÓÇÑ´Ù.(SYS°èÁ¤)

 

2. SPCREATE.SQÆÄÀÏÀ» ½ÇÇàÇÑ´Ù.

    ÀÌ¶§ STATSPACK¸¦ »ç¿ëÇÒ À¯Àú°¡ »õ¼ºÀÌ µÇ´Âµ¥ ºñ¹Ð¹øÈ£, TS, ÅÛÇÁTS¸¦ ÁöÁ¤ÇØ¾ßÇÑ´Ù.

 

3. ÆÄÀÏÀÌ ¿¡·¯¾øÀÌ ¿Ï·áµÇ¸é

   CONN PERFSTAT/ºñ¹Ð¹øÈ£ ·Î Á¢¼ÓÇÑ´Ù.

 

4. execute statspack.snap À» ½ÇÇàÇÑ´Ù.

 

5. ½ÇÇàÇÏ°í³ª¼­

   SELECT SNAP_ID, SNAP_TIME, SNAP_LEVEL FROM STATS$SNAPSHOT;

   ÀÌ Äõ¸®¸¦ ³¯¸®¸é ÇÏ³ªÀÇ ¸®ÅÏ°ªÀ» º¼¼ö ÀÖÀ» °ÍÀÌ´Ù.

 

6. Áö±Ý±îÁö ÇØ¿Â °ÍÀ» ÀÚµ¿À¸·Î ÇÏ±âÀ§ÇØ ´Ù½Ã SYS·Î ·Î±×ÀÎÇÑ´Ù.

 

7. ·Î±×ÀÎÈÄ¿¡

   ALTER SYSTEM SET JOB_QUEUE_PROCESSES=1 SCOPE=BOTH;

   ÀÌ·¸°Ô ¼öÁ¤ÇÑ´Ù.

 

8. ÇØ´ç°æ·Î¿¡ º¸¸é SPAUTO.SQLÀÌ¶ó´Â SQLÆÄÀÏÀÌ ÀÖÀ»°ÍÀÌ´Ù.

   ÀÌ ÆÄÀÏÀ» ½ÇÇàÇÏ¸é ÀÚµ¿À¸·Î ½º³À¼¦À» ÃëµæÇÏ°Ô µÈ´Ù.

 

9. 8¹øÀ» ¼öÇàÇÑ ÈÄ¿¡ ½º³À¼¦À» ÃëµæÇÏ´Â ½Ã°£À» º¯°æÇÏ·Á¸é

   EXECUTE DBMS_JOB.INTERVAL(JOB_ID, 'SYSDATE+(1/12)');

   ÀÌ·±½ÄÀ¸·Î º¯°æÇÏ¸é µÈ´Ù.

 

10. ÀÌ »óÅÂ¿¡¼­ 

    execute dbms_job.run(JOB_ID);

    ¶ó°í ÇÏ¸é ÀÌÁ¦ DB¿¡¼­ ÀÚµ¿À¸·Î ½º³À¼¦À» ÃëµæÇÒ °ÍÀÌ´Ù.

    ÁßÁöÇÒ·Á¸é

    execute dbms_job.remove(JOB_ID);

    ¶ó°í ÇÏ¸é µÈ´Ù.

 

À§ÀÇ 1¿¡¼­ 10¹ø±îÁö´Â SNAPSHOTÀ» ÃëµæÇÏ±â À§ÇÑ ±«Á¤ÀÌ´Ù.

 

ÀÌÁ¦ºÎÅÍ ÃëµæÇÑ µ¥ÀÌÅÍ¸¦ ¾î¶»°Ô »Ì¾Æ³»´ÂÁö ¾Ë¾Æº¸ÀÚ.

 

11. ÀÏ´Ü REPORT·Î Ãâ·ÂÇÏ·Á¸é

    2°³ ÀÌ»óÀÇ ½º³À¼¦ÀÌ ÀÖÀ¸¸é ÁÁ´Ù.

    ÀÌ ³»¿ëÀº 5¹øÀÇ Äõ¸®¸¦ ³¯·Á¼­ È®ÀÎÇÒ¼ö ÀÖ´Ù.

 

12. ¿¹¸¦ µé¾î SNAP_ID°¡ 1ºÎÅÍ 10±îÁö ÀÖ´Ù°í °¡Á¤ÇÏ¸é

    REPORT·Î »Ì¾Æ³¾¶§´Â

    spreport.sqlÀ» ½ÇÇàÇÏ¸é µÈ´Ù.

    ÀÌ¶§ 3°¡Áö ¿É¼ÇÀ» Áà¾ßÇÑ´Ù.

    ÇÏ³ª´Â ½ÃÀÛ½ÃÁ¡, ÇÏ³ª´Â Á¾·á½ÃÁ¡, ³ª¸ÓÁö´Â REPORTÀÌ¸§ÀÌ´Ù.

 

13. ÀÌ·¸°Ô ¿É¼ÇÀ» ÁÖ°í ½ÇÇàÇÏ°í³ª¼­

    Áö±Ý Á¢¼ÓÇØÀÖ´Â SQLPLUSÀÇ °æ·Î¿¡ °¡¸é ÇØ´ç ÆÄÀÏÀÌ ÀÖÀ»°ÍÀÌ´Ù.

 

±âº»ÀûÀÎ ¼ø¼­´Â ÀÌ·¸°Ô µÈ´Ù.

À§¿¡¼­ ÇÑ °úÁ¤Àº DEFAULT·Î ÇÑ°ÍÀÌ±â¶§¹®¿¡ ½º³À¼¦ LEVELÀÌ 5·Î µÇ¾îÀÖ´Ù.

ÀÌ ·¹º§À» ¼öÁ¤ÇÒ·Á¸é

execute statspack.snap(i_snap_level => 0) ÀÌ·±½ÄÀ¸·Î º¯°æÇÏ¸é µÈ´Ù.

 

¸¶Áö¸·À¸·Î

DBMS_JOBÀ» ÀÚµ¿À¸·Î ÇØ³ù±â¶§¹®¿¡ ÀÌ°ÍÀ» Á¤Áö ½ÃÅ°°í,

º¸°í¼­¸¦ ÀÛ¼ºÇÏ°í³ª¼­

SPDROP.SQLÀ» ½ÇÇàÇÏ¸é ÇØ´ç À¯Àú°¡ »èÁ¦µÇ´Â°ÍÀ» È®ÀÎÇÒ ¼ö ÀÖ´Ù.

http://download.oracle.com/docs/cd/B10501_01/server.920/a96533/statspac.htm#22142

SPPURGE.SQL ¿øÇÏ´Â ±¸°£ µ¥ÀÌÅÍ »èÁ¦ - HWM À¯Áö

¸ðµç ½º³Àµ¥ÀÌÅÍ Æ®··ÄÉÀÌÆ®

SPTRUNC.SQL 



#################  DBMS_JOB »ç¿ë¹ý (¿À¶óÅ¬ Àâ ½ºÄÉÁì·¯)
static dictionary¿¡, ½Ç½Ã°£À¸·Î °»½Å ¾ÈµÇ´Â Á¤º¸ ¹Ý¿µ

analyze table employees compute statistics;

select * from user_tables, °á°ú¹Ý¿µ.

spool spauto.lis

--
--  Schedule a snapshot to be run on this instance every hour, on the hour

variable jobno number;
variable instno number;
begin
  select instance_number into :instno from v$instance;
  dbms_job.submit(:jobno, 'statspack.snap;', trunc(sysdate+1/24,'HH'), 'trunc(SYSDATE+1/24,''HH'')', TRUE, :instno);
  commit;
end;
/

-- 5ºÐ¸¶´Ù ½ÇÇà
VARIABLE jobno NUMBER

 BEGIN
   DBMS_JOB.SUBMIT(:jobno, 'NMSDEV.prc_exe_scion_MIN;', SYSDATE, 'SYSDATE + 5/24/60');
   COMMIT;
 END;
/

print jobno -- job ¹øÈ£ È®ÀÎ

exec dbms_job.run(23);

commit;

-- 1½Ã°£ ¸¶´Ù ½ÇÇà
VARIABLE jobno NUMBER

 BEGIN
   DBMS_JOB.SUBMIT(:jobno, 'NMSDEV.PRC_EXE_BUF_RETRY;', SYSDATE, 'SYSDATE + 1/24');
   COMMIT;
 END;
/

print jobno -- job ¹øÈ£ È®ÀÎ

exec dbms_job.run(31);

commit;


-- »õº® 8½Ã¸¶´Ù ½ÇÇà
VARIABLE jobno NUMBER

 BEGIN
   DBMS_JOB.SUBMIT(:jobno, 'NMSDEV.PRC_EXE_BUF_CLEAN;', SYSDATE, 'trunc(sysdate) + 1 + 8/24');
   COMMIT;
 END;
/

print jobno -- job ¹øÈ£ È®ÀÎ

exec dbms_job.run(30);

commit;



######################################################################################

################### Å×ÀÌºí½ºÆäÀÌ½º ½ºÅä¸®Áö ¿É¼Ç È®ÀÎ
select TABLESPACE_NAME, EXTENT_MANAGEMENT, ALLOCATION_TYPE, SEGMENT_SPACE_MANAGEMENT from dba_tablespaces
/

TABLESPACE_NAME                EXTENT_MAN ALLOCATIO SEGMEN
------------------------------ ---------- --------- ------
SYSTEM                         DICTIONARY USER      MANUAL
TEMP                           LOCAL      UNIFORM   MANUAL
TOOLS                          LOCAL      SYSTEM    MANUAL
USERS                          LOCAL      SYSTEM    MANUAL
TBSP_TEST                      LOCAL      SYSTEM    MANUAL
TBSP_TEST1                     LOCAL      SYSTEM    MANUAL
V2_POS1TMPL                    LOCAL      SYSTEM    MANUAL
V2_DEVPORTAL                   LOCAL      SYSTEM    MANUAL
V2_DBA                         LOCAL      SYSTEM    MANUAL
TSBUB_DATA                     LOCAL      SYSTEM    MANUAL
TSBUB_INDEX                    LOCAL      SYSTEM    MANUAL


CREATE INDEX TX_DEL_17 ON EXE_COST 
(
APPR_DT 
)
PCTFREE  10
TABLESPACE TS_STIS
STORAGE (
INITIAL 1024K
NEXT 1024K
  MINEXTENTS  1
  MAXEXTENTS  2147483645
  PCTINCREASE 0
  )
;


ÀÎµ¦½º ÄÃ·³

create index emp_comp_idx on employees (department_id, job_id, last_name);


select department_id, job_id, last_name, rowid
from hr.employees
where department_id='50'
and job_id='ST_CLERK'
AND LAST_NAME='Grant'

-> ÀÎµ¦½º »ç¿ë

where department_id='50'
AND LAST_NAME='Grant'

-> ÀÎµ¦½º »ç¿ë


where job_id='ST_CLERK'
AND LAST_NAME='Grant'

-> ÀÎµ¦½º »ç¿ë¾ÈÇÔ (ÀÎµ¦½º ¼±ÇàÄÃ·³ ºÎÀç)

where department_id='50'
AND upper(LAST_NAME)='GRANT'

-> ÀÎµ¦½º »ç¿ë¾ÈÇÔ (ÀÎµ¦½º ÄÃ·³º¯Çü)

########################## µÎ ½ºÅ°¸¶ ÀÏÄ¡¿©ºÎ ºñ±³
 select
       CASE
         WHEN (T_BC.DATA_TYPE <> T_BT.DATA_TYPE) THEN 'YES-DATA_TYPE'
         WHEN (T_BC.DATA_LENGTH <> T_BT.DATA_LENGTH) THEN 'YES-DATA_LENGTH'
         WHEN (T_BC.DATA_PRECISION <> T_BT.DATA_PRECISION) THEN 'YES-DATA_PRECISION'
         WHEN (T_BC.DATA_DEFAULT <> T_BT.DATA_DEFAULT) THEN 'YES-DATA_DEFAULT'
         WHEN (T_BC.DATA_SCALE <> T_BT.DATA_SCALE) THEN 'YES-DATA_SCALE'
         WHEN (T_BC.NULLABLE <> T_BT.NULLABLE) THEN 'YES-NULLABLE'
         WHEN T_BT.OWNER IS NULL THEN 'YES-NOTCOLUMN'
         WHEN (T_BC.COLUMN_ID <> T_BT.COLUMN_ID) THEN 'YES-COLUMN_ID'
--  ELSE 'NO'
       END DIFF,
       T_BC.*,
       T_BT.*
from   (select OWNER,
               TABLE_NAME,
               TABLE_NAME TABLE_NAME1,
               COLUMN_NAME,
               DATA_TYPE,
               DATA_LENGTH,
               DATA_PRECISION,
               DATA_DEFAULT,
               DATA_SCALE,
               NULLABLE,
               COLUMN_ID
        from   dba_tab_columns
        where  table_name in (select 'TB_B'|| substr(TABLE_NAME, 5, 30)
                from   dba_tables
                where  owner = 'POW_BT' )
        and    owner = 'POW_BC') T_BC,
       (select OWNER,
               TABLE_NAME,
               'TB_B'|| substr(TABLE_NAME, 5, 30) TABLE_NAME1,
               COLUMN_NAME,
               DATA_TYPE,
               DATA_LENGTH,
               DATA_PRECISION,
               DATA_DEFAULT,
               DATA_SCALE,
               NULLABLE,
               COLUMN_ID
        from   dba_tab_columns
        where  owner = 'POW_BT') T_BT
where  T_BC.TABLE_NAME1 = T_BT.TABLE_NAME1 (+)
and    T_BC.COLUMN_NAME = T_BT.COLUMN_NAME (+)
ORDER BY T_BC.OWNER, T_BC.TABLE_NAME, T_BC.TABLE_NAME, T_BC.COLUMN_ID ;


################################################  Å×ÀÌºí DESC ÃßÃâÄõ¸®, Å×ÀÌºí¸í¼¼¼­
SELECT A.TABLE_NAME,C.COLUMN_ID,B.COLUMN_NAME,C.DATA_TYPE,C.NULLABLE,B.COMMENTS,DECODE(E.CONSTRAINT_TYPE,'P','YES','NO') AS PK,C.DATA_DEFAULT,DECODE(E.CONSTRAINT_TYPE,'R','YES','NO') AS FK
FROM dba_tab_comments A
,DBA_COL_COMMENTS B
,DBA_TAB_COLUMNS C
,(SELECT *
FROM DBA_CONS_COLUMNS 
WHERE POSITION IS NOT NULL) D
,DBA_CONSTRAINTS E
WHERE
--AB
A.OWNER=B.OWNER
AND A.TABLE_NAME=B.TABLE_NAME
--CB
AND C.OWNER=B.OWNER
AND C.TABLE_NAME=B.TABLE_NAME
AND C.COLUMN_NAME=B.COLUMN_NAME
--CD
AND C.OWNER=D.OWNER(+)
AND C.TABLE_NAME=D.TABLE_NAME(+)
AND C.COLUMN_NAME=D.COLUMN_NAME(+)
--DE
AND D.OWNER=E.OWNER(+)
AND D.CONSTRAINT_NAME=E.CONSTRAINT_NAME(+)
AND A.OWNER = 'POW_BC'
--AND A.TABLE_NAME IN ('TB_BCORAPLY_SBC_HIST')
ORDER BY A.TABLE_NAME,E.CONSTRAINT_TYPE,DECODE(E.CONSTRAINT_TYPE,'P','YES','NO'),C.COLUMN_ID




SELECT NULL "No", COMMENTS "¾îÆ®¸®ºäÆ®¸í", TABLE_NAME "ÄÃ·³¸í", NULL "µ¥ÀÌÅÍÅ¸ÀÔ", NULL "±æÀÌ", NULL "NULL", NULL PK, NULL FK, NULL "¼³¸í"
FROM ALL_TAB_COMMENTS 
WHERE OWNER = 'DPTOW_OSF' AND TABLE_NAME = 'TB_OSF_SUIT_INPT_RAT'
UNION ALL
SELECT T1.COLUMN_ID "No" ,
       T2.COMMENTS "¾îÆ®¸®ºäÆ®¸í" ,
       T1.COLUMN_NAME "ÄÃ·³¸í",
       T1.DATA_TYPE "µ¥ÀÌÅÍÅ¸ÀÔ" ,
       CASE
         WHEN T1.DATA_TYPE = 'VARCHAR2' THEN T1.DATA_LENGTH || ''
         WHEN T1.DATA_TYPE = 'NUMBER'
AND    T1.DATA_SCALE = 0 THEN T1.DATA_PRECISION || ''
         WHEN T1.DATA_TYPE = 'NUMBER'
AND    T1.DATA_SCALE > 0 THEN T1.DATA_PRECISION ||','|| T1.DATA_SCALE
         ELSE T1.DATA_LENGTH || ''
       END "±æÀÌ" ,
       DECODE(T1.NULLABLE, 'N', 'NOT NULL', NULL) "NULL" ,
       DECODE((SELECT COUNT(*)
                FROM   ALL_CONS_COLUMNS TCONCOL
                WHERE  OWNER = T1.OWNER
                AND    TABLE_NAME = T1.TABLE_NAME
                AND    COLUMN_NAME = T1.COLUMN_NAME
                AND    EXISTS (SELECT 1
                        FROM   ALL_CONSTRAINTS
                        WHERE  CONSTRAINT_TYPE = 'P'
                        AND    OWNER = TCONCOL.OWNER
                        AND    TABLE_NAME = TCONCOL.TABLE_NAME
                        AND    CONSTRAINT_NAME = TCONCOL.CONSTRAINT_NAME ) ), 1, 'YES', NULL) PK ,
       DECODE((SELECT COUNT(*)
                FROM   ALL_CONS_COLUMNS TCONCOL
                WHERE  OWNER = T1.OWNER
                AND    TABLE_NAME = T1.TABLE_NAME
                AND    COLUMN_NAME = T1.COLUMN_NAME
                AND    EXISTS (SELECT 1
                        FROM   ALL_CONSTRAINTS
                        WHERE  CONSTRAINT_TYPE = 'R'
                        AND    OWNER = TCONCOL.OWNER
                        AND    TABLE_NAME = TCONCOL.TABLE_NAME
                        AND    CONSTRAINT_NAME = TCONCOL.CONSTRAINT_NAME ) ), 1, 'YES', NULL) FK ,
       T1.DATA_DEFAULT "¼³¸í"
FROM   ALL_TAB_COLUMNS T1 LEFT JOIN ALL_COL_COMMENTS T2 ON T1.OWNER = T2.OWNER
AND    T1.TABLE_NAME = T2.TABLE_NAME
AND    T1.COLUMN_NAME = T2.COLUMN_NAME
WHERE  T1.OWNER = 'DPTOW_OSF'
AND    T1.TABLE_NAME = 'TB_OSF_RCK_CONF'
--ORDER BY T1.COLUMN_ID NULLS FIRST 


################################################  Å×ÀÌºí »ý¼º ¹× µ¥ÀÌÅÍ ÀÔ·Â ÇÁ·Î½ÃÀú PROCEDURE

spool cubeone.lst
SET ECHO ON
set time on timing on

DROP TABLE &TableName CASCADE CONSTRAINT;

PAUSE

CREATE TABLE &TableName (
 empno NUMBER(10)  ,
 empname VARCHAR2(50),
 dob DATE,
 bonus NUMBER(10,2) ,
 jumin_num CHAR(13),
 comm  float,
 deptno int
 );

PAUSE

--ALTER TABLE &TableName ADD CONSTRAINT &ConstName PRIMARY KEY (&KeyColumn);

PAUSE

--DROP PUBLIC SYNONYM &SynName;
--CREATE PUBLIC SYNONYM &SynName FOR &TableName;
--GRANT ALL ON &TableName TO PUBLIC;

DECLAR
  CntStart NUMBER := &Start;
  CntEnd NUMBER := &End;
BEGIN

FOR I IN CntStart..CntEnd

LOOP
  INSERT /*+ APPEND */  INTO &TableName VALUES (CntStart,
                         'Employee Name ? '||LTRIM(TO_CHAR(CNTStart)),
                          SYSDATE+1,
                          10*(CNTStart/100),
                          '000000'||TO_CHAR(CNTStart,'FM0000000'),
                          (CNTStart/1000)+CNTStart,
                          CNTStart/100);
  IF MOD(CNTStart, 1000) = 0
  THEN
     COMMIT;
  END IF;
  CNTStart := CNTStart + 1;
END LOOP;
END;
/



spool off


#################### hp asynch i/o ¿¡·¯³¯¶§ È®ÀÎ
/usr/bin/getprivgrp dba
/usr/sbin/setprivgrp dba MLOCK
µÎ¹øÂ° ¹®ÀåÀº ·çÆ®·Î ¼öÇà


######################################################################################################
######################################################################################################
################################################### UniX TIP
######################################################################################################
######################################################################################################

°ø¹é¶óÀÎ ÀÚÃ¼¸¦ »èÁ¦ÇÏ±â
grep -ve '^ *$' cnt.lst > to.txt

½ÃÀÛºÎÅÍ Ã¹ ±ÛÀÚ±îÁöÀÇ °ø¹éÀ» Á¦°ÅÇÏ±â
sed 's/^ *//' from.txt > to.txt

sed¿¡ -i ¿É¼ÇÀÌ ÀÖ½À´Ï´Ù.

±×·³ ¸®´ÙÀÌ·º¼ÇÀ» ¾ÊÇØµµ µÇÁÒ.

##################################### find

#### ÆÄÀÏ»çÀÌÁî°¡ 0 ÀÎ °ÍÀ» Ã£¾Æ ll ¶Ç´Â rm ¸í·ÉÀ» ¼öÇàÇÒ¶§..
> find . -size 0 -exec ll {} \;

#### ÆÄÀÏ±ÇÇÑÀÌ 644ÀÎ°Í¸¸ º¸°íÀÚ ÇÒ¶§.
> find . -perm 644 -print

#### Æ¯Á¤³»¿ëÀ» Æ÷ÇÔÇÑ ÆÄÀÏ ¸®½ºÆ® È®ÀÎ
> find ./* -type f | xargs grep 'Æ¯Á¤³»¿ë' 

#### ÀÌ°Ç Æ¯Á¤ µð·ºÅä¸®¿¡¼­  Æ¯Á¤ÆÄÀÏÀ» º¸°íÀÚ ÇÒ¶§
> find /ol0_ora* -name "*.dbf" -exec ls {} \; 

#### Æ¯Á¤ ³»¿ëÀ» Æ÷ÇÔÇÏ´Â Æ¯Á¤ÆÄÀÏÀ» Ã£°íÀÚ ÇÒ¶§
> find . -type f -name "*.xml" | xargs grep "action-name name"

# HP date ½Ã°£º¯°æ
date [-u] [mmddhhmm[[cc]yy]]                            
date 182208182008   

#find ./* -type f | xargs grep '/bin/chmod'

#######  ³¯Â¥ ¿¬»ê ³¯Â¥ Á¶Á¤ÇÏ´Â ½© ½ºÅ©¸³Æ®

»ç¿ë¹ý: Dday_time +2 (ÀÌÆ² µÚ ³¯Â¥½Ã°£)

#!/usr/bin/ksh

# Usage: Dday [yyyy mm dd] [{+|-}ndays] -or
# Dday -h | -H | -?

case "${1}" in
-h|-H)
        tail -20 ${0}
        exit
        ;;
esac


if [ $# -eq 0 ]
then
        Y=`date "+%Y"`
        M=`date "+%m"`
        D=`date "+%d"`
        TIME=`date -u | awk '{ print $4 }' | awk -F: '{print $1 }'`
        MINUTE=`date -u | awk '{ print $4 }' | awk -F: '{print $2 }'`
        nb=-1
elif [ $# -eq 1 ]
then
        Y=`date "+%Y"`;
        M=`date "+%m"`;
        D=`date "+%d"`;
        TIME=`date -u | awk '{ print $4 }' | awk -F: '{print $1 }'`
        MINUTE=`date -u | awk '{ print $4 }' | awk -F: '{print $2 }'`
        nb=$1;
elif [ $# -eq 3 ]
then
        Y=$1; M=$2; D=$3; nb=-1;
else
        Y=$1; M=$2; D=$3; nb=$4;
fi

awk -v TYear=$Y -v TMnth=$M -v TDay=$D -v TTime=$TIME -v TMINUTE=$MINUTE -v NBefore=$nb '

function IsLeap(yy)
{
        if ((yy%400)==0) {return 1;}
        if ((yy%100)==0) {return 0;}
        if ((yy%4)==0) {return 1;}
        return 0;
}
BEGIN {
        Mds="31:28:31:30:31:30:31:31:30:31:30:31";
        split(Mds,MDA,":");
# Find out the day of yesterday.
        Year = TYear+0;
        Mnth = TMnth+0;
        Day = TDay+0;
        Day += NBefore;
        while( (Day <= 0) || (Day > MDA[Mnth]) ) {
                if(Day <= 0) {
                        Mnth -= 1;
                        if(Mnth == 0) {
                                Mnth = 12;
                                Year--;
                                MDA[2] = IsLeap(Year) ? 29:28;
                        } else if( Mnth == 2 && IsLeap(Year)) {
                                MDA[2]=29;
                        }
                        Day += MDA[Mnth];
                } else if(Day > MDA[Mnth] ) {
                        if( Mnth == 2 && IsLeap(Year)) {
                                MDA[2]=29;
                        }
                        Day -= MDA[Mnth];
                        Mnth += 1;
                        if(Mnth == 13 ) {
                                Mnth = 1;
                                Year++;
                                MDA[2] = IsLeap(Year) ? 29:28;
                        }
                }
        }
        #print Mnth,Day,Hour

        #printf "%04d %02d %02d \n",Year,Mnth,Day;
        printf "%04d%02d%02d%02d%02d \n",Year,Mnth,Day,TTime,TMINUTE;

} ' -

exit


#######  ¾îÁ¦ ½Ã°£ ±¸ÇÏ±â
TZ=KST+15 date +%Y%m%d_%H:%M


# SUN date ½Ã°£º¯°æ
date [-u] [mmddhhmm¿¬µµ»ý·«]                            
date 06101630

date 06111630

date 06121630

date 06131630


# Æ¯Á¤ ÆÄÀÏ½Ã½ºÅÛ »ç¿ëÁßÀÎ À¯Àú º¸±â
fuser -cu /UHD

fuser -u /data004/LGDPOSH/temp01.dbf



 ÃÖ¿øÈñ[»ç¿ø] ´ÔÀÇ ¸» :  
172.20.145.12
 ÃÖ¿øÈñ[»ç¿ø] ´ÔÀÇ ¸» :  
ÀÌ°Ô ¹«½¼ ¾ÆÀÌÇÇÀÎÁö È¤½Ã È®ÀÎ °¡´ÉÇÏ½Å°¡¿ä?
## send mail Å×½ºÆ®
# telnet 165.244.7.17 25
Trying 165.244.7.17...
Connected to 165.244.7.17.
Escape character is '^]'.
220 hp4.com ESMTP Sendmail @(#)Sendmail version 8.13.3 - Revision 2.001 - 2005/02/12/8.9.3; Wed, 2 Apr 2008 15:37:37 +0900 (KST)
HELO 165.244.7.17
250 hp4.com Hello [165.244.7.50], pleased to meet you
MAIL FROM:<mailer@scourt.go.kr>
250 2.1.0 <mailer@scourt.go.kr>... Sender ok
RCPT TO:<duncan@lgcns.com>
250 2.1.5 <duncan@lgcns.com>... Recipient ok
DATA
354 Enter mail, end with "." on a line by itself
subject:test mail
test
test
devweb81
.
250 2.0.0 m326bbCs023288 Message accepted for delivery

500 5.5.1 Command unrecognized: ""
quit
221 2.0.0 hp4.com closing connection
Connection to 165.244.7.17 closed by foreign host.


# Àý´ëÆÐ½º¿¡ tar Ç®±â
tar -xvf img.tar -C /sangup1/imgdev/img080327


# ÇÏÀ§ µð·ºÅä¸® »ý¼º

cd /usr/local 
mkdir -p packages/local/bin

# ÇÁ·Î¼¼½º Àâ¾Æ¼­ ÀÏ°ýÀûÀ¸·Î Á×ÀÌ±â
ps -ef | grep SCServ64 | awk '{print "kill -9 " $2 }' > stop2.sh
chmod 755 stop2.sh


kill -9 `ps -ef|grep SCS|awk {'print $2'}`

# lsof
v2web01@root:/scrs1_dev/UHD/OV/sd/server/bin >netstat -an | grep 30998
165.244.7.15.64156   165.244.7.15.30998   32768      0 32768      0 CLOSE_WAIT
v2web01@root:/scrs1_dev/UHD/OV/sd/server/bin >uname -a
SunOS v2web01 5.8 Generic_117350-41 sun4u sparc SUNW,Sun-Fire-880
v2web01@root:/scrs1_dev/UHD/OV/sd/server/bin >ps -ef | grep 12053
  s2posd 12053 12044  0   1¿ù 26 ?        3:04 /usr/java/bin/java -client -DposAd -Xms192m -Xmx192m -XX:PermSize=64m -XX:MaxPe
    root  6583  8605  0 10:13:44 pts/10   0:00 grep 12053
v2web01@root:/scrs1_dev/UHD/OV/sd/server/bin >lsof -i tcp:30998
COMMAND   PID   USER   FD   TYPE        DEVICE SIZE/OFF NODE NAME
java    12053 s2posd  217u  IPv4 0x3000a96d0e8  0t15680  TCP v2web01:64156->v2web01:30998 (CLOSE_WAIT)


# user group other º°·Î ±ÇÇÑ º¯°æ

chmod o+x file_name

# Æ¯Á¤Æ÷Æ®·Î Åë½ÅÇÏ´Â ÇÁ·Î¼¼½º Ã£±â
netstat -an | grep 1150

lsof 1150



# cron crontab

crontab -l : ¿¹¾àµÈ ÀÛ¾÷¸®½ºÆ® Ãâ·Â
crontab -e : ¿¹¾àµÈ ÀÛ¾÷ ¼öÁ¤
crontab -r : ¿¹¾àµÈ ÀÛ¾÷ »èÁ¦

crond ½ÇÇà È®ÀÎ ¹æ¹ýÀº ps ¸í·É¾î¸¦ ÅëÇØ È®ÀÎ °¡´É ÇÏ´Ù.

ps -ef | grep crond

Å©·ÐÅÇ ½ÃÀÛ
=> /etc/rc.d/init.d/crond start
Å©·ÐÅÇÁ¾·á
=> /etc/rc.d/init.d/crond stop
Å©·ÐÅÇÀç½ÃÀÛ
=> /etc/rc.d/init.d/crond restart

/etc ¾È¿¡´Â ÇØ´ç Å©·ÐÅÇÀÇ ¼³Á¤ÆÄÀÏÀ» ÀúÀåÇÏ´Â µð·ºÅä¸®µéÀÌ Á¸Àç ÇÑ´Ù.
¾î¶² ³à¼®µéÀÎÁö º¸·Á¸é ls -al | grep cron ¸í·É¾î¸¦ ÅëÇØ È®ÀÎ ÇØ º¸ÀÚ.

±×¸®°í ÀÏ¹Ý»ç¿ëÀÚÀÇ crontab ¸í·É¾î»ç¿ëÀ» Á¦ÇÑÇÏ°íÀÚ ÇÑ´Ù¸é
/etc/cron.deny  ¿¡ ID¸¦ µî·ÏÇÑ´Ù.

¿¹) badboy ¶ó´Â »ç¿ëÀÚ°¡ Å©·ÐÅÇ »ç¿ëÀ» Á¦ÇÑÇÏµµ·Ï ÇÏ°í ½Í´Ù¸é
    /etc/cron.deny ¿¡ badboy¸¦ Ãß°¡

¿ì¼± crontab -e ¸í·É¾î·Î vi¸¦ ¶ç¿î´Ù.
±×¸®°í ¾Æ·¡´Â ¼³Á¤ Çü½Ä ÀÌ´Ù.

(Ç¥1)ÇÊµå º° ³»¿ë°ú ¹üÀ§
ºÐ
½Ã
ÀÏ
¿ù
¿äÀÏ
0~59
0~23
1~31
1~12
1~7(¿ù~ÀÏ)

³»¿ë
¿©·¯°ª	10,30,50****	¸Å 10,30,50ºÐ ¸¶´Ù ½ÇÇà
¹üÀ§°ª	01-3***	¸ÅÀÏ 1~3½Ã¿¡ ÁøÇà
½Ã°£°£°Ý	1*/5***	¸ÅÀÏ 5½Ã°£ °£°ÝÀ¸·Î ÁøÇà
¸ðµç°ª	*****	¸ÅºÐ¸¶´Ù ½ÇÇà

¿¹1)¸ÅÁÖ ÀÏ¿äÀÏ ¸¶´Ù sunday.sh¸¦ ½ÇÇà ÇÏ°í ½ÍÀ» °æ¿ì
****7 /home/kim/sunday.sh

¿¹2)¸ÅÀÏ,5½Ã°£ °£°ÝÀ¸·Î hour.sh¸¦ ½ÇÇà ÇÏ°í ½ÍÀ» °æ¿ì

1*/5*** /home/kim/hour.sh

# HP-UX CRON LOG
/var/adm/cron/log
ÇØ´ç Ä¿¸Çµå Á¶È¸ÇÏ¿© ½ÇÇà¿©ºÎ È®ÀÎ



# AIX MEMORY
lscfg -vp | grep -i size

# AIX M0EMORY »ç¿ëÀ² 
memory

# AIX swap size
slccdb2:[/]swap -s
allocated  =    6291456 blocks    used  =   199736 blocks      free  =    6091720 blocks



# Æ¯Á¤ÆÄÀÏµé¿¡ ´ëÇØ¼­ ³»¿ë°Ë»ö
find ./ -name '*.sql' | xargs grep 'ALTER' ;


find . -type f -exec grep -l jeus.properties {} \;

find . -type f -exec grep -l "scrs1/tmax/" {} \;

find . -type f -exec grep -l "aros1/tmax1/" {} \;

find . -type f -exec grep -l "tmax1" {} \;

find . -type f -exec grep -l "/var/tmp/" {} \;

find . -type f -exec grep -l "9736" {} \;

find . -type f -exec grep -l "97" {} \;

# °Ë»ö°á°ú »èÁ¦
find ./ -name $111 exec rm {};


ÀÚ¿ø»ç¿ëÀ² ¸ð´ÏÅÍ¸µ
HP glance
AIX topas
SOLARIS top



glance sorting -> o



############################## ipcs

ipcs -a :¸Þ¸ð¸®°ø°£ Á¤»ó ÇØÁ¦ ¾ÈÇÑ ÇÁ·Î¼¼½º È®ÀÎ

ipcrm -m(À§ °á°ú °¢ ¶óÀÎ Çì´õ°ª, º¯µ¿°¡´É) ¸Þ¸ð¸®ÁÖ¼Ò°ª  : ÇØ´ç ÇÁ·Î¼¼½º »èÁ¦






¼Ö¶ó¸®½º¿¡¼­ ps µÞ¿¡ Àß¸®Áö ¾Ê°Ô º¸´Â ¸í·É
/usr/ucb/ps -auxww


#### apache access log ÀÇ ³»¿ë Áß °íÀ¯ÇÑ Á¢¼Ó IPÀÇ °¹¼ö¸¦ Ä«¿îÆ®
cat access_log.20070125 | awk '{print $1}' | sort -u | wc -l


+ ¸ðµâºñ±³

find . -type f -exec ls -l {} \; | awk '{print $NF, $5}' | sort -du >  mod_was01.txt

find . -type f -exec ls -l {} \; | awk '{print $NF, $5}' | sort -du >  mod_was02.txt

find . -type f -exec ls -l {} \; | awk '{print $NF, $5}' | sort -du >  mod_tjcweb01.txt

find . -type f -exec ls -l {} \; | awk '{print $NF, $5}' | sort -du >  mod_tjcweb02.txt

·ÎÄÃ·Î °¡Á®¿Í¼­ ¿ïÆ®¶ó¿¡µðÅÍ·Î ºñ±³

+ ÇÕ»ê°á°ú Ãâ·Â
cat b.txt | awk '{total += $1; print total "\t"}

+ ¾ÆÆÄÄ¡ ¾×¼¼½º ·Î±× ¿äÃ» ¼­ºñ½ºº° ÀÀ´ä½Ã°£
grep 'HTTP/1.1\" 400' apache-stis50-access_log | awk '{ if($NF > 10) print $11,$7 }'

- 165.244.26.105 - - [10/Oct/2007:16:13:12 +0900] "POST /frontservletcrs?cmd=WC2GetRecvBasicInfoC HTTP/1.1" 200 2306 0

grep POST access_log_2600 | awk '{ if($NF > 10) print $8,$NF }'


+ ½Ã½ºÅÛ »ç¿ë·® Á¶È¸
sar 1 5 (1ÃÊ °£°ÝÀ¸·Î 5¹ø)


sar -u 1 100


+ SUN UX ½Ã½ºÅÛ »óÅÂ Á¶È¸
prtdiag -v

+ SUN UX ¸Þ¸ð¸® »ç¿ëÀ² Á¶È¸
prtconf 

Æ÷Æ®¿ÀÇÂÁ¤º¸ È®ÀÎ

netstat -au | grep 8080

usermod -d /scrs1/share share »ç¿ëÀÚÁ¤º¸º¯°æ
-s

bdf='df -k

ftp fsdgsdsdfsd <<!
user id pass

jar ÆÄÀÏ °Ë»ö

find ./ -name  WCRSCertInfoU.class
find ./ -name *.jar 
jar tvf `find ./ -name *.jar` | grep WCRSCertInfoU.class

½ºÆÄÅ©ÀåºñºñÆ®¼öÈ®ÀÎ
isainfo -kv




·ÎÄÉÀÏ º¯°æ
v2web01@logadm:/scrs1_dev/co2/log >locale -a
POSIX
common
en_US.UTF-8
C
iso_8859_1
ko
ko_KR.EUC
ko.UTF-8
ko_KR.UTF-8
th_TH
th_TH.TIS620
th
korean
v2web01@logadm:/scrs1_dev/co2/log >export LANG=ko_KR.EUC

echo $LANG


ÇÏÀ§µð·ºÅä¸®¸¸ Ã£±â
find ./ -type d -exec ls -ald {} \;
ls -lR | grep ^./

rm -rf ¾È¸ÔÈú¶§

\rm -rf

½Ã½ºÅÛ os, È£½ºÆ®¸í È®ÀÎ
uname -a

ulimit 


¾ÆÀÌÇÇÁ¤º¸ È®ÀÎ
getip È£½ºÆ®¸í

netstat -in
ÀÎÅÍÆäÀÌ½ºº° ¼¼ºÎÁ¤º¸È®ÀÎ
ifconfig ÀÎÅÍÆäÀÌ½º¸í -in

ÀÌ½ºÄÉÀÌÇÁµÈ "Áß°ýÈ£"(\{ \})´Â ¹Ù·Î ¾Õ¿¡ ³ª¿Â Á¤±Ô Ç¥Çö½ÄÀÇ ºóµµ¼ö¸¦ ³ªÅ¸³À´Ï´Ù.


sqlplus ¸í·É ¹é±×¶ó¿îµå·Î ½ÇÇà
¾Æ·¡³»¿ëÀ» sh ·Î ¸¸µé¾î¼­ ¹é±×¶ó¿îµå·Î ½ÇÇà

sqlplus /nolog <<!
conn ¾ÆÀÌµð/ÆÐ½º¿öµå
@run_sel
exit
!

½Éº¼¸¯ ¸µÅ© symbolic link

ln -s ../devices/pseudo/mm@0:null null
ln -s /extdisk11/EXP EXP

ln -s /extdisk11/EXP EXP


°èÁ¤Ãß°¡
etc/group
useradd -g dba -d /scrs1/users/weblogic/ -s /usr/bin/ksh -m -k /etc/skel weblogic
useradd -u 1000 -g 500 -d /aros1/bea8 -s /usr/bin/ksh -m -k /etc/skel weblogic

useradd -g 45 -d /aros2/PRIME -s /usr/bin/ksh -m -k /etc/skel qmst1

oracle:WM/2qx7d29SWo:100:100::/aros1/oracle:/usr/bin/ksh
useradd -g 100 -d /home/selectbw -s /usr/bin/ksh -m selectbw;


useradd -g 300 -d /scrs2/users/sqluser -s /usr/bin/ksh -m sqluser;

useradd -g other -d /aros2/wbacd -s /usr/bin/ksh -m -k /etc/skel cvsuser
useradd -g other -d /aros1/cvs -s /usr/bin/ksh -m -k /etc/skel cvsserv


useradd -g 45 -d /aros2/users/kapaadev -s /usr/bin/ksh -m -k /etc/skel kapadev

useradd -g 45 -d /scrs2/users/uhdslm -s /usr/bin/ksh -m -k /etc/skel uhdslm

telnet -n ¼­¹ö¸í
»õ°èÁ¤À¸·Î ·Î±ä

sql ½ÇÇàÈÄ ¿¡·¯ Á¶È¸
!grep -l ERROR *.lst

ÅÎ½Ãµµ .pc ÄÄÆÄÀÏ
make -f gamsa.mak

hp-ux
ls -l -> ll

¹é±×¶ó¿îµå·Î ½ÇÇà
nohup ./run.sh

ÆÄÀÏ½Ã½ºÅÛ ¿ë·®
bdf

bdf¿¡ ´ëÇÑ ¾Ë¸®¾Æ½º Á¶È¸
alias | grep bdf

µð·ºÅä¸® ±ÇÇÑº¸±â
ll -d /work

tar ¹­±â/Á¤º¸º¸±â
tar cvf/tar tvf xvf
tar cvf ps_1.tar ./*.txt
tar cvf sl_1.tar ./*.txt


ÀÌÀü¸í·Éº¸±â
history -100 | grep LD

ESC + k, j ÀÌÀü ´ÙÀ½ ¸í·Éº¸±â


³¯Â¥¹Ù²Ù±â mmddhh24mi
date 09270955




compress -v 
uncompress

gzip 
gzip -d

Wildcard Matches 
? Any single character 
* Any string of characters 
[set] Any character in set  
[!set] Any character not in set 

######################################################### SHELL SCRIPT 


################## ÀÌÀü ¸í·ÉÀÇ ¼º°ø/½ÇÆÐ¿©ºÎ º¯¼ö

[ossdb2:LGDPOSP2:/oracle/DBA_JOBS/monitor]
[ossdb2:LGDPOSP2:/oracle/DBA_JOBS/monitor] ls > /dev/null
[ossdb2:LGDPOSP2:/oracle/DBA_JOBS/monitor] echo $?
0
[ossdb2:LGDPOSP2:/oracle/DBA_JOBS/monitor] adsfasdfjalkfdja
ksh: adsfasdfjalkfdja:  not found
[ossdb2:LGDPOSP2:/oracle/DBA_JOBS/monitor] echo $?
1

echo $?
 
##################


* / ´Â ÃÖ»óÀ§ µð·ºÅÍ¸®¸¦ ¶æÇÔ. ¸¸¾à Ã£°íÀÚ ÇÏ´Â µð·ºÅÍ¸®°¡ ÀÖ´Ù¸é ±×°É·Î ´ëÃ¼

- ÆÄÀÏ ÀÌ¸§¿¡ foobar °¡ µé¾î°£ ÆÄÀÏ Ã£±â
   find / -name "foobar" -print

- Æ¯Á¤ »ç¿ëÀÚ(foobar) ¼ÒÀ¯ÀÇ ÆÄÀÏÀ» Ã£±â
   find / -user foobar -print | more

- ÃÖ±Ù ÇÏ·çµ¿¾È¿¡ º¯°æµÈ ÆÄÀÏÀ» Ã£±â
   find / -ctime -1 -a -type f | xargs ls -l | more

- ¿À·¡µÈ ÆÄÀÏ(30ÀÏ ÀÌ»ó ¼öÁ¤µÇÁö ¾ÊÀº ÆÄÀÏ) Ã£±â
   find / -mtime +30 -print | more

- ÃÖ±Ù 30ÀÏ¾È¿¡ Á¢±ÙÇÏÁö ¾ÊÀº ÆÄÀÏ°ú µð·ºÅÍ¸®¸¦ º°µµÀÇ ÆÄÀÏ·Î ¸¸µé±â
   find / ! ( -atime -30 -a ( -type d -o -type f ) ) | xargs ls -l > not_access.txt

- ÇÏÀ§ µð·ºÅÍ¸®·Î ³»·Á°¡Áö ¾Ê°í ÇöÀç µð·ºÅÍ¸®¿¡¼­¸¸ °Ë»öÇÏ±â
   find . -prune ...

- ÆÛ¹Ì¼ÇÀÌ 777 ÀÎ ÆÄÀÏ Ã£±â
   find / -perm 777 -print | xargs ls -l | more

- others ¿¡°Ô ¾²±â(write) ±ÇÇÑÀÌ ÀÖ´Â ÆÄÀÏÀ» Ã£±â
   find / -perm -2 -print | xargs ls -l | more

- others ¿¡°Ô ¾²±â(write) ±ÇÇÑÀÌ ÀÖ´Â ÆÄÀÏÀ» Ã£¾Æ ¾²±â ±ÇÇÑÀ» ¾ø¾Ö±â
   find / -perm -2 -print | xargs chmod o-w
      ¶Ç´Â
   find / -perm -2 -exec chmod o-w {} ; -print | xargs ls -l | more

- »ç¿ëÀÚÀÌ¸§°ú ±×·ìÀÌ¸§ÀÌ ¾ø´Â ÆÄÀÏ Ã£±â
   find / ( -nouser -o -nogroup ) -print | more

- ºó ÆÄÀÏ(Å©±â°¡ 0 ÀÎ ÆÄÀÏ) Ã£±â
   find / -empty -print | more
      ¶Ç´Â
   find / -size 0 -print | more

- ÆÄÀÏ Å©±â°¡ 100M ÀÌ»óÀÎ ÆÄÀÏÀ» Ã£±â
   find / -size +102400k -print | xargs ls -hl

- µð·ºÅÍ¸®¸¸ Ã£±â?
   find . -type d ...

- root ±ÇÇÑÀ¸·Î ½ÇÇàµÇ´Â ÆÄÀÏ Ã£±â
   find / ( -user root -a -perm +4000 ) -print | xargs ls -l | more

- ´Ù¸¥ ÆÄÀÏ½Ã½ºÅÛÀº °Ë»öÇÏÁö ¾Ê±â
   find / -xdev ...

- ÆÄÀÏ ÀÌ¸§¿¡ °ø¹éÀÌ µé¾î°£ ÆÄÀÏ Ã£±â
   find / -name "* *" -print

- ¼û°ÜÁø(hidden) ÆÄÀÏÀ» Ã£±â
   find / -name ".*" -print | more

- *.bak ÆÄÀÏÀ» Ã£¾Æ Áö¿ì±â
   find / -name "*.bak" -exec rm -rf {} ;

- *.bak ÆÄÀÏÀ» Ã£¾Æ Æ¯Á¤ µð·ºÅÍ¸®·Î ¿Å±â±â
   mv `find . -name "*.bak"` /home/bak/

- ¿©·¯°³ÀÇ ÆÄÀÏ¿¡¼­ Æ¯Á¤ ¹®ÀÚ¿­À» ¹Ù²Ù±â
   find / -name "*.txt" -exec perl -pi -e 's/Ã£À»¹®ÀÚ¿­/¹Ù²Ü¹®ÀÚ¿­/g' {} ;
   
- ÆÄÀÏµéÀ» °Ë»öÇÏ¿© 8007 À» Æ÷ÇÔÇÑ ÆÄÀÏµéÀÇ Á¦¸ñ¸¸ °Ë»ö
  find . -type f -exec grep -l 8007 {} \;

- 7ÀÏ ÀÌ»ó Áö³­ ÆÄÀÏ Á¶È¸
  find ./ -mtime +7 -name '*.gz' -exec ls {}/
  
  
  
  
find ./ -mtime -2 | grep .xml ls {}\
/aros2/webappv2/pbsv/pbsv/re1/jsp/server/FE00
find ./ -mtime +7 -a -name '*.xml' -o -name '*.XML' -o -name '*.pdf' -a -exec ls {} \;



find /oracle/product/10.2.0/ezwork/dmp/file -mtime +1 -name "*.dmp.Z" -exec rm {} \;

find ./ -mtime +7 -name '*.log' -exec ls {}/

\rm -rf `find ./ -mtime +14 -name '*.gz'`

\rm -rf `find ./ -mtime +14 -name '*.log'`
\rm -rf `find ./ -mtime +5 -name '*.arc'`

\rm -rf `find ./ -mtime +30 -name 'cdmp*'`
\rm -rf `find ./ -mtime +15 -name '*.trc'`

\rm -rf `find /logs001/LGDPOSP/bdump -mtime +7 -name '*.trc'`
\rm -rf `find /logs001/LGDPOSP/bdump -mtime +7 -name 'cdmp*'`
\rm -rf `find /logs001/LGDPOSP/adump -mtime +7 -name '*.aud'`
\rm -rf `find /logs001/LGDPOSP/udump -mtime +15 -name '*.trc'`


\rm -rf `find /logs001/LGDPOSP/bdump -mtime +7 -name '*.trc'`
\rm -rf `find /logs001/LGDPOSP/bdump -mtime +7 -name 'cdmp*'`
\rm -rf `find /logs001/LGDPOSP/adump -mtime +7 -name '*.aud'`
\rm -rf `find /logs001/LGDPOSP/udump -mtime +7 -name '*.trc'`



\rm -rf `find /logs001/LGDPOSD/bdump -mtime +7 -name '*.trc'`
\rm -rf `find /logs001/LGDPOSP/cdump -mtime +30 -name 'cdmp*'`
\rm -rf `find /logs001/LGDPOSP/cdump -mtime +30 -name 'core*'`
find /logs001/LGDPOSP/cdump -mtime +30 -name 'core*'

find ./ -mtime +7 -exec ls {}\

find ./ -mtime +7 -name .xml

\rm -rf `find ./ -mtime +14 -name '*.xlog'`
\rm -rf `find ./ -mtime +14 -name '*.log'`
\rm -rf `find ./ -mtime +14 -name '*.gz'`
\rm -rf `find ./ -mtime +14 -name '*.xlog'`
120ÀÏ ÀÌ»ó Áö³­ ÆÄÀÏ
\rm -rf `find ./ -mtime +30 -name '*.trc'`
\rm -rf `find ./ -mtime +30 -name 'cdmp*'`



Æ¯Á¤³¯Â¥·Î °Ë»ö
find . -type f -exec ls -l {} \;  | grep 2009



grep -c 140.1.6.88 20061017debug.log 20061018debug.log 20061019debug.log 20061020debug.log 20061021debug.log 20061022debug.log 20061023debug.log


grep -n ip=140. /scrs2/wbsv1/logs/applicationa/20061017debug.log /scrs2/wbsv1/logs/applicationa/20061018debug.log /scrs2/wbsv1/logs/applicationa/20061019debug.log /scrs2/wbsv1/logs/applicationa/20061020debug.log /scrs2/wbsv1/logs/applicationa/20061021debug.log /scrs2/wbsv1/logs/applicationa/20061022debug.log /scrs2/wbsv1/logs/applicationa/20061023debug.log


find . -type f -exec ls -l {} \;  | grep 2009


grep -n ip=140. /scrs2/wbsv1/logs/applicationa/20061023debug.log | sort -t \  -n -k 5,5

grep -n ip=140. /scrs2/wbsv1/logs/applicationa/20061022debug.log | sort -t \  -k 5,5 | sort -t \  -u -k 4,4 | sort -t \  -k 5,5 | cut -d ' ' -f 4,5 

grep -n ip=140. ./20061022debug.log | sort -t \  -k 5,5 | sort -t \  -u -k 5,5 | sort -t \  -k 4,4 | cut -d ' ' -f 4,5 > ipid_list.txt


grep -lc $LINE ./cwh.txt 

grep -n cmd=140. ./20061101debug.log | sort -t \  -k 5,5 | sort -t \  -u -k 5,5 | sort -t \  -k 4,4 | cut -d ' ' -f 4,5 > ipid_list.txt


cat ./cwh.txt |  cut -d ' ' -f 6,6 | cut -c 5- | sort -k 1,1 | sed -n 1


cat ./cwh.txt |  cut -d ' ' -f 6,6 | cut -c 5- | sort | uniq -c


cat ./cwh.txt | 
while read LINE; do echo $LINE; done


cat ./cwh.txt | grep -n a


Á¤±ÔÇ¥Çö½Ä ip

[1-9][0-9]{0,2}\.[1-9][0-9]{0,2}\.[1-9][0-9]{0,2}\.[1-9][0-9]{0,2}
\{ \}

find ./ -exec grep startTran {} \;


find ./ -name "*.sh" -exec grep for {} \;


find ./ -name "[Cc]on*"

¶óÀÎ¹øÈ£¿Í °°ÀÌ Ãâ·Â
grep -n '\[2006.11.12 23' JeusServer_11122006_0.log

´ë¼Ò¹®ÀÚ ¹«½Ã °Ë»ö
grep -i 

egrep
egrep 'a*d' a.txt | wc -l
egrep 'qw*e' a.txt | wc -l
egrep 'qw*e' a.txt | wc -l


¶óÀÎ¼öÃâ·Â
grep -c '\[2006.11.12 23' JeusServer_11122006_0.log

grep '\[2006.11.12 23' JeusServer_11122006_0.log

Æ¯Á¤¶óÀÎ Ãâ·Â
cat JeusServer_11122006_0.log | sed -n 6372326p



find /scrs2/wbsv1/source/ | grep -n java


find /scrs2/wbsv1/source/ -name "*.java" -print0 | xargs -r -0 grep -l startTran

find /scrs2/wbsv1/source/ -name "*.java" | grep -l startTran

grep -n ip=140. ./ipid_list.txt


grep -r startTran *


Çö µð·ºÅä¸®¸¦ ±âÁØÀ¸·Î ÇØ¼­ È®ÀåÀÚ°¡ c ÀÎ ÆÄÀÏÁß 'permission' À» Æ÷ÇÔÇÏ°í ÀÖ´Â ÆÄÀÏ Ã£±â


ÀÎ¿ë:

find /scrs2/wbsv1/source/ -name "*.java" -print | xargs grep -l startTran | more
find ./ -name "*" -exec grep -l startTran {} \;


for i in `cat a.txt`
 do
  name=`cat $i | grep choice`
  count=`cat $i | grep choice | wc -l`
   if test $count -gt 1 ;then
        echo "$i" 
   fi 
 done
 
 
 
 
grep -c 140.1.6.88 20061017debug.log 20061018debug.log 20061019debug.log 20061020debug.log 20061021debug.log 20061022debug.log 20061023debug.log


grep -n ip=140. /scrs2/wbsv1/logs/applicationa/20061017debug.log /scrs2/wbsv1/logs/applicationa/20061018debug.log /scrs2/wbsv1/logs/applicationa/20061019debug.log /scrs2/wbsv1/logs/applicationa/20061020debug.log /scrs2/wbsv1/logs/applicationa/20061021debug.log /scrs2/wbsv1/logs/applicationa/20061022debug.log /scrs2/wbsv1/logs/applicationa/20061023debug.log





grep -n ip=140. /scrs2/wbsv1/logs/applicationa/20061023debug.log | sort -t \  -n -k 5,5

grep -n ip=140. /scrs2/wbsv1/logs/applicationa/20061022debug.log | sort -t \  -k 5,5 | sort -t \  -u -k 4,4 | sort -t \  -k 5,5 | cut -d ' ' -f 4,5 



server="imcwas51 imcwas52 imcwas53 tjcwas51 tjcwas52 tjcwas53"; export server

#dir=`date "+%y%m%d"`

for current in $server

do

echo "----------------------------------------------------------"
echo "Putting to.... "$current
echo "----------------------------------------------------------"

ftp $current <<!

cd /work
mkdir cwh
cd cwh	
mkdir 061024
cd 061024
bin
mput ipid_list.sh
chmod 755 ipid_list.sh
close
!
done





imcwas51,52,53
tjcwas51,52,53


/scrs2/wbsv1/logs/applicationa
/scrs2/wbsv1/logs/applicationb

#####  SED

for f in `ls *.sh`
do
echo $f
sed  's/aros14\/tuxedo/aros14\/tuxedo81/g'  $f > $f.1
mv $f.1 $f
done



######################################################################################################
######################################################################################################
################################################### ETC
######################################################################################################
######################################################################################################


# ¾Æ½ºÅ°ÄÚµå°ª È®ÀÎ¹ý 
ALT + ¾Æ½ºÅ°ÄÚµå¹øÈ£

# ¼¾µå¸ÞÀÏ ¹ß¼Û Å×½ºÆ®

mailx duncan@lgcns.com
subject:1
1
ctrl-d
/var/adm/syslog/mail.log


######################################################################################################
######################################################################################################
################################################### VI EDITOR
######################################################################################################
######################################################################################################


.exrc

ÆÄÀÏ¿¡ ¾Æ·¡ ³»¿ëÀ¸·Î ¼öÁ¤
autoindent  => noautoindent 
showmatch  => noshowmatch 

set noautoindent autowrite noshowmatch wrapmargin=0 report=1



:g/^$/d

set noai 
set ai
°èÁ¤ È¨ .exrc ÆÄÀÏÀÌ vi ¼³Á¤ ÆÄÀÏ

d+ shift g   ³¡±îÁö Áö¿ì±â

¶óÀÎ¸¶Áö¸·À¸·Î °¡±â SHIFT + 4

¸¶Áö¸· ¶óÀÎÀ¸·Î °¡±â SHIFT + G 

:%s /^/@/g
¸ðµçÁÙ¿¡ @Ãß°¡

:1,. s /^/@/g
Ã¹¶óÀÎºÎÅÍ ÇöÀçÀ§Ä¡±îÁö ÁÙÃ³À½¿¡ @Ãß°¡

:3,7 s /^/@/g
3¶óÀÎºÎÅÍ 7¶óÀÎ±îÁö ÁÙÃ³À½¿¡ @Ãß°¡


:3,7 s /$/;/g

:%s /^M//g

^M ÄÁÆ®·ÑV + M
°³Çà¹®ÀÚ¸¦ °ø¹éÀ¸·Î º¯°æ
:%s /chg1.lst/chg1_BMS.lst


aft.lst aft_1.lst  bfr.lst bfr_1.lst chg.lst chg1_BMS.lst tar.lst  tarf.lst tarf_1.lst
:$ ÁÙ¸¶Áö¸·

alt+v ºÙÀÌ±â

O, I

!vi *.sql
!n ´ÙÀ½ÆÄÀÏ

¶óÀÎ³Ñ¹öº¸±â
:set nu

:set all

    sed s/"192.168.50.24:13401"/"192.168.71.21:13200"/g RCOMConfiguration_1.xml > RCOMConfiguration_1.xml.failover
    sed s/"192.168.50.24:13401"/"192.168.71.21:13200"/g RCOMConfiguration_2.xml > RCOMConfiguration_2.xml.failover

sed s/DPTO/DPO/g *.sql

########3  ÆÄÀÏ ³»¿ë ¹Ù²Ù±â

#sed 's/CSM\$/CSM\\$/g' alyz_CSMIG.sql > alyz_CSMIG.sql.temp
#mv alyz_CSMIG.sql.temp alyz_CSMIG.sql




############################ rmnl »ç¿ë¹ý
cat mk.sh | awk '{print "cat " $1 " | rmnl > " $1}' > akh

cat ACCOUNT.sql | rmnl > ACCOUNT.sql.tmp

############################ sed »ç¿ë¹ý

for file in `ls *.sql`

do

sed 's/scrjship/scrjship1/' $file >tmp

mv tmp $file

done

rm -rf tmp
######################################################################################################
######################################################################################################
################################################### LINUX
######################################################################################################
######################################################################################################
find ./ ! -name *.htm -exec rm {} \;
.htmÀ¸·Î ³¡³ªÁö ¾Ê´Â ÆÄÀÏÀ» ÇöÀç µð·ºÅä¸®¿¡¼­ Ã£¾Æ¼­ »èÁ¦

etc/services
xinetd.conf
ps -ef | grep inetd
kill -HUB pid 



# tree -d /opt/zenoss/new_alarm_generator/
/opt/zenoss/new_alarm_generator/
|-- _evt_sim  -> backup for all "simulated alarms", has CSV sample
|-- evt_real
|   |-- backup_do_not_delete_from_here  -> has XML sample
|   |-- bak
|   |-- done  -> Generated XML templates
|   `-- todo  -> XML templates to be generated
|-- evt_sim   -> CSV templates to be geenrated
|-- report
`-- src       -> has the python script



######################################################################################################
######################################################################################################    
################################################### APACHE TIP
######################################################################################################
######################################################################################################


### Á¢¼Ó ¾ÆÀÌÇÇ °É·¯³»±â

cat access_log | awk '{print $1}' > ip ; sort -u ip > ip3 ; wc -l ip3




### ¾ÆÆÄÄ¡ ¹öÀüÁ¤º¸ È®ÀÎ
bin/httpd -v

### access log ½Ç½Ã°£ ¸ð´ÏÅÍ¸µ
tail -f access_log | grep 140.2.211.32


### º¸¾ÈÁ¡°Ë
ERROR PAGE
FANCY INDEXING
SERVER-STATUS
SERVER-INFO
DOCUMENT ROOT - È¯°æ¼³Á¤ÆÄÀÏ, µîµî ³ëÃâ½Ã º¯°æ
ALIAS MANUAL, ICON


±âÁ¸ ¼º°øÀûÀ¸·Î ±¸ÃàµÈ ¼­¹öÀÇ ¾ÆÆÄÄ¡ ¾ÐÃà Ç¬ µð·ºÅä¸® config.nice ÆÄÀÏ ÂüÁ¶ÇØ¼­ configure ¿É¼Ç ÁöÁ¤

### so ÆÄÀÏÀÇ ³»¿ë º¸±â

imcweb23-n@root:/aros1/was60/Plugins/bin/32bits >ldd mod_was_ap20_http.so
        libsocket.so.1 =>        /lib/libsocket.so.1
        libnsl.so.1 =>   /lib/libnsl.so.1
        libdl.so.1 =>    /lib/libdl.so.1
        libiostream.so.1 =>      /usr/lib/libiostream.so.1
        libCrun.so.1 =>  /usr/lib/libCrun.so.1
        libgsk7cms.so =>         (ÆÄÀÏÀÌ ¾øÀ½)
        libm.so.1 =>     /lib/libm.so.1
        libc.so.1 =>     /lib/libc.so.1
        libmp.so.2 =>    /lib/libmp.so.2
        libmd5.so.1 =>   /lib/libmd5.so.1
        libscf.so.1 =>   /lib/libscf.so.1
        libdoor.so.1 =>  /lib/libdoor.so.1
        libuutil.so.1 =>         /lib/libuutil.so.1
        libm.so.2 =>     /lib/libm.so.2
        

### ¾ÆÆÄÄ¡¿¡ À¥½ºÇÇ¾î ÇÃ·¯±×ÀÎ ¼³Ä¡ ½Ã
.so, configÆÄÀÏ, log ÆÄÀÏ¸¸ Àâ¾ÆÁÖ¸é µÊ.
        
###·Î±×º° ³»¿ë
errorlog -> ±âµ¿±â, ¼³Á¤ÀÇ ¿¡·¯
accesslog -> ¼º°øÀû Á¢¼Ó½ÃÀÇ ·Î±×
    
    
#### ¼Ö¶ó¸®½º¿¡¼­ make ÄÄÆÄÀÏ½Ã ¿¡·¯³ª´Â °æ¿ì mkheader    
http://blog.naver.com/dhan0213?Redirect=Log&logNo=100015438388    


######################################################################################################
######################################################################################################
################################################### WAS TIP
######################################################################################################
######################################################################################################




###################### jeus dbpooladmin »ç¿ë¹ý

[v2web01:/scrs2_dev/users/s2edmsdev>dbpooladmin `uname -n`_container1 -Uadministrator -Pjeusadmin
[ErrorMsgManager] Message Manager is initialized
[2008.03.21 16:38:28][0] [TMLinkManager] accept thread is started
[2008.03.21 16:38:28][0] [TMClient] TMClient initailized
v2web01_container1>info -i  1 -k 1000



###################### Root cause of ServletException Null pointer

LAF-J ³ª À¥·ÎÁ÷ÀÌ µð·ºÅä¸®¿¡ ±ÇÇÑÀÌ ¾ø¾î ·Î±×¸¦ ½×À» ¼ö ¾øÀ» °æ¿ì¿¡µµ ¹ß»ý


######################¿Í½ºÀÇ cpu ºñÁ¤»ó °úÁ¡À¯ÇÏ´Â ÇÁ·Î¼¼½º È®ÀÎÇÏ´Â ¹æ¹ýÀÔ´Ï´Ù.


¿Í½ºÀÇ cpu ºñÁ¤»ó °úÁ¡À¯ÇÏ´Â ÇÁ·Î¼¼½º È®ÀÎÇÏ´Â ¹æ¹ýÀÔ´Ï´Ù.

ÀÌ¸¦ ÅëÇØ ¿î¿µÁß ¿Í½ºÀÇ cpu »ç¿ëÄ¡°¡ ³ô¾ÆÁú°æ¿ì, ¾î¶² ÀÛ¾÷ÀÌ cpu °úºÎÇÏ¸¦ À¯¹ßÇÑ °ÍÀÎÁö È®ÀÎÇÒ¼ö ÀÖ½À´Ï´Ù.

ÀýÂ÷´Â ¾Æ·¡¿Í °°½À´Ï´Ù.

 

1. top Á¤º¸Áß cpu »ç¿ëÄ¡°¡ ³ôÀº ¿Í½º µ¥¸óÀÇ PID È®ÀÎ

   PID USERNAME LWP PRI NICE  SIZE   RES STATE    TIME    CPU COMMAND

 27200 weblogic 501  29   10 2249M  688M sleep   87:14  2.26% java

 22165 weblogic 168  29   10 1665M  557M sleep   58:03  0.12% java

 

2. prstat·Î CPU »ç¿ëÀÌ ³ôÀº LWPID È®ÀÎ

  : prstat -L -p 27200 1 1

   PID    USERNAME  SIZE    RSS   STATE  PRI NICE      TIME      CPU   PROCESS/LWPID

 27200   weblogic     2247M  686M     sleep   29   10        0:02:02    0.2%      java/89

 27200   weblogic     2247M  686M     sleep   29   10        0:02:00    0.1%      java/96

 27200   weblogic     2247M  686M     sleep   29   10        0:11:28    0.1%      java/2

 

3. pstack ·Î thread ID È®ÀÎ

  : pstack 27200

-----------------  lwp# 89 / thread# 89  --------------------

 acc9f4aa lwp_cond_wait (89cb5e0, 89cb5c8, 0)

 accd5b6e _lwp_cond_wait (89cb5e0, 89cb5c8) + 1e

 ac7a3b9c __1cCosHSolarisFEventEdown6M_v_ (89cb5c8) + 58

 

 

4. kill -3 À¸·Î thread dump ¼öÇà

  : kill -3 27200

 - À§ÀÇ 3¹øÂ° ÀýÂ÷¿¡¼­ °Ë»öµÈ thread#¸¦ 16Áø¼ö·Î º¯È¯ÇÑ °ªÀ» thread dump ³»¿ë¿¡¼­ (/nid=16Áø¼ö·Î)°Ë»ö

    89 -> 0x59

 

"ExecuteThread: '77' for queue: 'weblogic.kernel.Default'" daemon prio=5 tid=0x089cabc0 nid=0x59 waiting for monito

r entry [2365f000..2365fd9c]

        at com.lgcns.laf.env.LLogWriter.println(LLogWriter.java:237)

        - waiting to lock <0x352e24e0> (a com.lgcns.laf.io.LNullWriter)

        at scrs.wb1.common.util.WCOMSessionU.getUserID(WCOMSessionU.java:114)

        at scrs.wb1.common.util.WCOMSessionU.isAlreadyLogin(WCOMSessionU.java:471)

        at scrs.wb1.common.servlet.WCOMFrontServletS.service(WCOMFrontServletS.java:165)

        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)

 

 5. source È®ÀÎ

 ` WCOMSessionU.java ÀÏºÐ

    public static String getUserID(HttpServletRequest pinsRequest) {

        String insSessionLoginID =  (String)getValue(pinsRequest, WCOMWebKeysU.SESS_USER_ID) ;

        LLog.debug.println("WCOMSessionU ¾È: "+WCOMWebKeysU.SESS_USER_ID + ": "+insSessionLoginID);

        if(insSessionLoginID == null)

            return null ;

        else
        else

            return insSessionLoginID ;

    }

 

À§ÀÇ ¹æ¹ýÀ» ÅëÇØ¼­ WCOMSessionU.java ¼Ò½º³»ÀÇ ·Î±×¸¦ ³²±â´Â ºÎºÐ¿¡¼­ cpu¸¦ °ú´Ù »ç¿ëÇÏ´ÂÀ» Ã£À»¼ö ÀÖ½À´Ï´Ù.

 

 

## ¾Æ·¡¿Í °°ÀÌ ½ºÅ©¸³Æ®¸¦ ¸¸µçÈÄ È®ÀÎÇÏ½Ã¸é µµ¿òÀÌ µÇ½Çµí ÇÕ´Ï´Ù.

dump.sh

 

if [ $# -eq 0 ]

then

  echo " ´ýÇÁ¸¦ ¼öÇàÇÒ PID¸¦ ÀÔ·Âº¯¼ö·Î ÁÖ¼¼¿ä."

  echo " ex) dump.sh PID"

else

  for dump in 1 2 3

  do

    echo "$dump¹øÂ° ´ýÇÁ¸¦ ¼öÇàÁßÀÔ´Ï´Ù."

    prstat -L -p $1 1 1 >> prstat.log

    pstack $1 >> pstack.log

    kill -3 $1

    echo

    sleep 2

  done

fi





######################


À¥½ºÇÇ¾î EAR ÆÄÀÏ Àû¿ë½Ã ÆÄÀÏ ³»ºÎÀÇ ¼­¹ö ¼³Á¤À» ¹«½ÃÇÏ°í CONFIG ÆÄÀÏÀÇ ¼³Á¤´ë·Î ÇÏ·Á¸é

imcedu1_n /aros1/was50/DeploymentManager/config/cells/imcedu1_nNetwork/applications/HOME.ear/deployments/HOME/HOM
E_EARWeb.war/WEB-INF]
[¾çÁ¾Çö] Å¹±¸°ø 45¾Ë ´ÔÀÇ ¸»:
ibm-web-ext.xmi :  fileServingEnabled="false"

ear ÆÄÀÏ ³»ºÎ¿¡¼­ ¼³Á¤ÇÏ·Á¸é
[¾çÁ¾Çö] Å¹±¸°ø 45¾Ë ´ÔÀÇ ¸»:
/aros1/STIS/stis/STIS_EAR/STIS.ear/STIS_EARWeb.war/WEB-INF]
[¾çÁ¾Çö] Å¹±¸°ø 45¾Ë ´ÔÀÇ ¸»:
ibm-web-ext.xmi :  fileServingEnabled="false"



À¥·ÎÁ÷ ¼³Ä¡½Ã, È£½ºÆ®ÆÄÀÏ ¼³Á¤º¯°æ
/aros1/bea8/bea]vi ./registry.xml
[¾çÁ¾Çö] Å¹±¸°ø 45¾Ë ´ÔÀÇ ¸»:
/aros1/bea8/bea]vi ./weblogic81/server/lib/DemoIdentity.jks

################### WAS ½Ãµ¿½Ã ¶óÀÌºê·¯¸® ÂüÁ¶ ¼ø¼­
1. WAS LIB
2. »ç¿ëÀÚ ÁöÁ¤ LIB (¼³Á¤ÆÄÀÏ)
3. WEB-INF/LIB
4. WEB-INF/CLASSES

2¹ø ÁöÁ¤ ½Ã ¸ðµâ µ¿Àû ¹Ý¿µ ºÒ°¡´ÉÇÏ¹Ç·Î ¸ðµâº¯°æ ½Ã WAS Àç±âµ¿ ÇÊ¿ä
